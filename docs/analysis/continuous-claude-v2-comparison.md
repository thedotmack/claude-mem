# Continuous Claude v2 vs Claude-Mem åˆ†æ

> åˆ†ææ—¥æœŸï¼š2025-12-28
> ä¾†æºï¼šhttps://github.com/parcadei/Continuous-Claude-v2

## å°ˆæ¡ˆæ¦‚è¿°

### Continuous Claude v2

ä¸€å€‹ Claude Code æ’ä»¶ï¼Œå°ˆæ³¨æ–¼**æœƒè©±é€£çºŒæ€§**ç®¡ç†ã€‚ä¸ä¾è³´ context compactionï¼Œè€Œæ˜¯ä½¿ç”¨ **ledgersï¼ˆå¸³æœ¬ï¼‰** å’Œ **handoffsï¼ˆäº¤æ¥ï¼‰** ä¾†ä¿å­˜ç‹€æ…‹ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼šContext compaction æœƒç”¢ç”Ÿæœ‰ææ‘˜è¦ï¼Œå°è‡´ä¿¡è™Ÿè¡°æ¸›ã€‚æ­¤ç³»çµ±é¸æ“‡**æ¸…é™¤ context ä½†ä¿ç•™ç„¡æç‹€æ…‹æª”æ¡ˆ**ï¼Œè®“æ–°æœƒè©±èƒ½å®Œæ•´æ¢å¾©ä¿¡è™Ÿã€‚

### ä¸»è¦åŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **Ledger/Handoff ç³»çµ±** | Ledger = æœƒè©±å…§ç‹€æ…‹ï¼ŒHandoff = è·¨æœƒè©±äº¤æ¥ |
| **6 ç¨® Hook** | SessionStart, PreToolUse, PostToolUse, PreCompact, UserPromptSubmit, SessionEnd |
| **Agent å”èª¿** | plan-agent, validate-agent, implement_plan, research-agent, debug-agent |
| **Braintrust æ•´åˆ** | Session tracingã€å­¸ç¿’æå–ã€è·¨æœƒè©±æ´å¯Ÿ |
| **Artifact Index** | SQLite FTS5 ç´¢å¼•ï¼Œç”¨æ–¼ RAG-based è¨ˆç•«é©—è­‰ |
| **TDD è‡ªå‹•åŒ–** | å¼·åˆ¶æ¸¬è©¦å„ªå…ˆé–‹ç™¼ |

### æ¶æ§‹æµç¨‹

```
Session Flow:
SessionStart â†’ è¼‰å…¥ ledger/handoff
    â†“
Working â†’ è¿½è¹¤è®Šæ›´
    â†“
PreCompact â†’ è‡ªå‹• handoffï¼ˆé¿å… compaction æå¤±ï¼‰
    â†“
SessionEnd â†’ æ¨™è¨˜çµæœã€æ¸…ç†
```

---

## æ ¸å¿ƒæ¯”è¼ƒ

### è¨­è¨ˆå“²å­¸

| æ–¹é¢ | Continuous Claude v2 | claude-mem |
|------|---------------------|------------|
| **è¨˜æ†¶ç­–ç•¥** | ç„¡æä¿å­˜ - å®Œæ•´ä¿å­˜æ‰€æœ‰ç‹€æ…‹ | èªç¾©å£“ç¸® - AI æå–é‡é» |
| **äº¤æ¥æ–¹å¼** | æ˜ç¢ºäº¤æ¥ - äººé¡å¯è®€çš„ handoff æ–‡ä»¶ | è‡ªå‹•è¨˜æ†¶ - èƒŒæ™¯é‹ä½œ |
| **Context ç®¡ç†** | æ¸…é™¤é‡å»º - æ¸… contextï¼Œé‡æ–°è¼‰å…¥ | æŒçºŒç´¯ç© - æ¼¸é€²å¼ context æ³¨å…¥ |

### æŠ€è¡“æ¶æ§‹

| æ–¹é¢ | Continuous Claude v2 | claude-mem |
|------|---------------------|------------|
| **ç‹€æ…‹ä¿å­˜** | Ledger/Handoff æª”æ¡ˆï¼ˆMarkdownï¼‰ | SQLite + Chroma å‘é‡åº« |
| **æœå°‹æ–¹å¼** | FTS5 å…¨æ–‡æœå°‹ + RAG | èªç¾©å‘é‡æœå°‹ï¼ˆChromaï¼‰ |
| **Hook æ•¸é‡** | 6 å€‹ï¼ˆå« PreToolUse, PreCompactï¼‰ | 5 å€‹ |
| **Agent ç³»çµ±** | å…§å»ºå¤šç¨®å°ˆç”¨ agent | ç„¡å…§å»º agent |
| **Token å„ªåŒ–** | Progressive disclosureï¼ˆ99.6% æ¸›å°‘ï¼‰ | èªç¾©å£“ç¸® |
| **è¿½è¹¤ç³»çµ±** | Braintrust span å±¤ç´šè¿½è¹¤ | Observation è¨˜éŒ„ |

### è³‡æ–™çµæ§‹

| æ–¹é¢ | Continuous Claude v2 | claude-mem |
|------|---------------------|------------|
| **ä¸»è¦å„²å­˜** | `thoughts/` ç›®éŒ„ï¼ˆgitignoredï¼‰ | `~/.claude-mem/claude-mem.db` |
| **å¿«å–** | `.claude/cache/` | `~/.claude-mem/chroma/` |
| **Git æ•´åˆ** | `.git/claude/` commit æ¨ç†æ­·å² | ç„¡ |

---

## Claude-Mem å¯å€Ÿé¡çš„æƒ³æ³•

### ğŸ”´ é«˜åƒ¹å€¼ - ç«‹å³å¯è¡Œ

#### 1. PreCompact Hook

**èªªæ˜**ï¼šåœ¨ context compaction å‰è§¸ç™¼ï¼Œä¿å­˜é—œéµç‹€æ…‹é¿å…æå¤±ã€‚

**åƒ¹å€¼**ï¼šç›®å‰ claude-mem ç„¡æ³•æ„ŸçŸ¥ compaction äº‹ä»¶ï¼Œå¯èƒ½åœ¨å£“ç¸®å¾Œéºå¤±é‡è¦ contextã€‚

**å¯¦ä½œé›£åº¦**ï¼šä¸­ - éœ€è¦ Claude Code æ”¯æ´æ­¤ hook é¡å‹ã€‚

#### 2. StatusLine Context æŒ‡ç¤ºå™¨

**èªªæ˜**ï¼šå³æ™‚é¡¯ç¤º context ä½¿ç”¨é‡ï¼ˆğŸŸ¢<60%, ğŸŸ¡60-79%, ğŸ”´â‰¥80%ï¼‰ï¼Œè®“ç”¨æˆ¶çŸ¥é“ä½•æ™‚è©²ä¿å­˜ã€‚

**åƒ¹å€¼**ï¼šæå‡ç”¨æˆ¶é«”é©—ï¼Œé é˜² context æº¢å‡ºã€‚

**å¯¦ä½œé›£åº¦**ï¼šä½ - claude-mem å·²æœ‰ statusline åŸºç¤è¨­æ–½ã€‚

```typescript
// ç¯„ä¾‹å¯¦ä½œ
const usage = contextTokens / maxTokens;
const indicator = usage < 0.6 ? 'ğŸŸ¢' : usage < 0.8 ? 'ğŸŸ¡' : 'ğŸ”´';
return `${indicator} ${Math.round(usage * 100)}% | ${observationCount} obs`;
```

#### 3. Handoff Observation é¡å‹

**èªªæ˜**ï¼šåœ¨ session çµæŸæˆ– compaction å‰ç”¢ç”Ÿæ˜ç¢ºçš„ã€Œäº¤æ¥æ–‡ä»¶ã€ï¼Œè£œå……ç¾æœ‰ observation ç³»çµ±ã€‚

**åƒ¹å€¼**ï¼šçµåˆç„¡æäº¤æ¥çš„å®Œæ•´æ€§èˆ‡èªç¾©å£“ç¸®çš„æ•ˆç‡ã€‚

**å¯¦ä½œé›£åº¦**ï¼šä½ - å¯ä½œç‚ºæ–° observation é¡å‹ã€‚

```typescript
interface HandoffObservation {
  type: 'handoff';
  session_goals: string[];
  completed_tasks: string[];
  pending_tasks: string[];
  key_decisions: string[];
  files_modified: string[];
  resume_instructions: string;
}
```

---

### ğŸŸ¡ ä¸­åƒ¹å€¼ - å€¼å¾—è€ƒæ…®

#### 4. FTS5 å…¨æ–‡æœå°‹ âœ… å·²å®Œæˆ

**èªªæ˜**ï¼šç²¾ç¢ºæ–‡å­—åŒ¹é…ï¼Œè£œå……å‘é‡æœå°‹ã€‚

**ç¾æ³**ï¼šclaude-mem å·²å¯¦ä½œ FTS5 æ··åˆæœå°‹ï¼Œæ”¯æ´ Vector + å…¨æ–‡æœå°‹é›™è»Œã€‚

**å·²å¯¦ä½œçš„ FTS5 è¡¨**ï¼š
- `observations_fts` - è§€å¯Ÿè¨˜éŒ„å…¨æ–‡æœå°‹
- `session_summaries_fts` - Session æ‘˜è¦å…¨æ–‡æœå°‹
- `user_prompts_fts` - ç”¨æˆ¶æç¤ºå…¨æ–‡æœå°‹

#### 5. Reasoning Historyï¼ˆæ¨ç†æ­·å²ï¼‰

**èªªæ˜**ï¼šå°‡æ¨ç†éç¨‹ç¶å®šåˆ° git commitï¼Œè¨˜éŒ„ã€Œç‚ºä»€éº¼é€™æ¨£æ”¹ã€ã€‚

**ç¾æ³**ï¼šç›®å‰ observation èˆ‡ commit ç„¡é—œè¯ã€‚

**å¯¦ä½œ**ï¼š
```typescript
interface Observation {
  // ... existing fields
  git_commit_hash?: string;
  git_branch?: string;
}
```

#### 6. PreToolUse Hook

**èªªæ˜**ï¼šå·¥å…·åŸ·è¡Œå‰æ””æˆªï¼Œå¯åš preflight æª¢æŸ¥ã€é©—è­‰ã€æˆ–é˜»æ­¢å±éšªæ“ä½œã€‚

**ç¾æ³**ï¼šåªæœ‰ PostToolUseã€‚

**åƒ¹å€¼**ï¼šå¯åœ¨æª”æ¡ˆå¯«å…¥å‰é©—è­‰ã€åœ¨å‘½ä»¤åŸ·è¡Œå‰ç¢ºèªç­‰ã€‚

#### 7. Config åˆä½µæ©Ÿåˆ¶

**èªªæ˜**ï¼šå…¨åŸŸ `~/.claude/` + å°ˆæ¡ˆ `.claude/` è¨­å®šè‡ªå‹•åˆä½µï¼Œå°ˆæ¡ˆè¦†è“‹å…¨åŸŸã€‚

**ç¾æ³**ï¼šåªæœ‰ `~/.claude-mem/settings.json`ã€‚

**åƒ¹å€¼**ï¼šå…è¨±å°ˆæ¡ˆç´šè‡ªè¨‚è¨­å®šã€‚

---

### ğŸŸ¢ å¯æ¢ç´¢ - é•·æœŸæ–¹å‘

#### 8. Agent å”èª¿ç³»çµ±

**èªªæ˜**ï¼šå…§å»º plan/validate/implement agentï¼Œå„æœ‰ç¨ç«‹ context windowã€‚

**æ½›åœ¨åƒ¹å€¼**ï¼š
- è¤‡é›œä»»å‹™åˆ†è§£
- æ¸›å°‘å–®ä¸€ context è² æ“”
- å°ˆæ¥­åŒ–è™•ç†

#### 9. Token ç²¾ç°¡ï¼ˆProgressive Disclosureï¼‰

**èªªæ˜**ï¼šå°‡å·¥å…· schema å¾ ~500 tokens æ¸›å°‘åˆ° 110 tokensï¼ˆ99.6% æ¸›å°‘ï¼‰ã€‚

**æ–¹æ³•**ï¼šåªåœ¨éœ€è¦æ™‚å±•é–‹å®Œæ•´ schemaã€‚

#### 10. Session Tracing

**èªªæ˜**ï¼šé¡ä¼¼ Braintrust çš„ span å±¤ç´šè¿½è¹¤ï¼šSession â†’ Turn â†’ Tool/LLM spansã€‚

**åƒ¹å€¼**ï¼šæ›´ç´°ç·»çš„æ•ˆèƒ½åˆ†æå’Œé™¤éŒ¯ã€‚

---

## æ•´åˆå»ºè­°

### çŸ­æœŸï¼ˆ1-2 é€±ï¼‰

1. **StatusLine åŠ å…¥ context è­¦å‘Š** - å¿«é€Ÿå‹åˆ©ï¼Œæå‡ UX
2. **æ–°å¢ Handoff observation é¡å‹** - è£œå……ç¾æœ‰ç³»çµ±
3. **ç ”ç©¶ PreCompact hook å¯è¡Œæ€§** - ç¢ºèª Claude Code æ˜¯å¦æ”¯æ´

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰

4. **å¯¦ä½œ FTS5 æ··åˆæœå°‹** - Vector + FTS5 é›™è»Œ
5. **Git commit é—œè¯** - å°‡ observation ç¶å®šåˆ° commit
6. **å°ˆæ¡ˆç´šè¨­å®š** - æ”¯æ´ `.claude-mem/` ç›®éŒ„

### é•·æœŸï¼ˆæ¢ç´¢æ€§ï¼‰

7. **Agent ç³»çµ±è¨­è¨ˆ** - è©•ä¼°æ˜¯å¦ç¬¦åˆ claude-mem å®šä½
8. **Token å„ªåŒ–** - åˆ†æ context æ³¨å…¥çš„ token æ•ˆç‡
9. **Tracing ç³»çµ±** - è©•ä¼°æ•´åˆå¤–éƒ¨è¿½è¹¤æœå‹™

---

## çµè«–

Continuous Claude v2 å’Œ claude-mem ä»£è¡¨å…©ç¨®ä¸åŒçš„è¨˜æ†¶ç®¡ç†å“²å­¸ï¼š

- **Continuous Claude**ï¼šç„¡æã€æ˜ç¢ºã€äººé¡å¯è®€
- **claude-mem**ï¼šå£“ç¸®ã€è‡ªå‹•ã€AI é©…å‹•

å…©è€…å¯ä»¥**äº’è£œ**è€Œéäº’æ–¥ã€‚å»ºè­° claude-mem å€Ÿé¡ Continuous Claude çš„ï¼š
1. **PreCompact æ„ŸçŸ¥** - åœ¨å£“ç¸®å‰ä¿å­˜é—œéµè³‡è¨Š
2. **æ˜ç¢ºäº¤æ¥** - è£œå……èªç¾©å£“ç¸®å¯èƒ½éºæ¼çš„ç´°ç¯€
3. **æ··åˆæœå°‹** - FTS5 + Vector æå‡å¬å›ç‡

é€™äº›æ”¹é€²å¯ä»¥åœ¨ä¿æŒ claude-mem è‡ªå‹•åŒ–å„ªå‹¢çš„åŒæ™‚ï¼Œå¢åŠ è¨˜æ†¶çš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚

---

## å·²å¯¦ä½œçš„æ”¹é€²ï¼ˆ2025-12-28ï¼‰

åŸºæ–¼ Continuous Claude v2 çš„å•Ÿç™¼ï¼Œclaude-mem å·²å®Œæˆä»¥ä¸‹ 7 é …æ”¹é€²ï¼š

### âœ… 1. StatusLine Token Savings é¡¯ç¤º

**è®Šæ›´å…§å®¹**ï¼š
- `context-generator.ts`ï¼šæ–°å¢ session savings è¿½è¹¤åŸºç¤è¨­æ–½
- `DataRoutes.ts`ï¼š`/api/stats` endpoint ç¾åœ¨å›å‚³ token savings æŒ‡æ¨™
- `statusline-hook.ts`ï¼šé¡¯ç¤ºæ ¼å¼åŒ–çš„ç¯€çœé‡

**æ•ˆç›Š**ï¼š
- ç”¨æˆ¶å¯å³æ™‚çœ‹åˆ°è¨˜æ†¶ç³»çµ±çš„ ROIï¼ˆå¦‚ã€ŒğŸ’° 132kt saved (90%)ã€ï¼‰
- æä¾›é€æ˜åº¦ï¼Œè®“ç”¨æˆ¶ç†è§£ claude-mem çš„åƒ¹å€¼
- æ¿€å‹µæŒçºŒä½¿ç”¨ï¼šçœ‹åˆ°ç¯€çœé‡æœƒå¼·åŒ–ä½¿ç”¨ç¿’æ…£

### âœ… 2. Per-Session Statistics API

**è®Šæ›´å…§å®¹**ï¼š
- `DataRoutes.ts`ï¼šæ–°å¢ `/api/stats/session/:id` endpoint
- `statusline-hook.ts`ï¼šåˆ†é›¢é¡¯ç¤º session vs global stats

**æ•ˆç›Š**ï¼š
- æ–° session æ­£ç¢ºé¡¯ç¤º 0% savedï¼ˆè€Œéç´¯ç©çš„å…¨åŸŸæ•¸æ“šï¼‰
- å¯è¿½è¹¤å–®ä¸€ session çš„è²¢ç»
- æ›´ç²¾ç¢ºçš„æ•ˆèƒ½åˆ†æ

### âœ… 3. Context Economics æŒ‡æ¨™

**è®Šæ›´å…§å®¹**ï¼š
- Session æ³¨å…¥æ™‚è¨ˆç®—ï¼šè¼‰å…¥ tokensã€ç¯€çœ tokensã€ç¯€çœç™¾åˆ†æ¯”
- å„²å­˜æ–¼ stats API ä¾›æŸ¥è©¢

**æ•ˆç›Š**ï¼š
- é‡åŒ–è¨˜æ†¶ç³»çµ±çš„åƒ¹å€¼
- ç•¶å‰å°ˆæ¡ˆæ•¸æ“šï¼šè¼‰å…¥ 15,004 tokensï¼Œç¯€çœ 132,124 tokensï¼ˆ90%ï¼‰
- 5x ROIï¼š~30k æŠ•å…¥ â†’ ~150k ç¯€çœ

### âœ… 4. PreCompact Hook åŸºç¤è¨­æ–½

**è®Šæ›´å…§å®¹**ï¼š
- `precompact-hook.ts`ï¼šæ–°å¢ hook æ¡†æ¶
- `hooks.json`ï¼šè¨»å†Š PreCompact äº‹ä»¶

**æ•ˆç›Š**ï¼š
- ç‚ºæœªä¾†çš„ compaction æ„ŸçŸ¥åšæº–å‚™
- å¯åœ¨ context å£“ç¸®å‰ä¿å­˜é—œéµç‹€æ…‹
- éŠœæ¥ Continuous Claude v2 çš„ handoff æ¦‚å¿µ

**ç‹€æ…‹**ï¼šç¨‹å¼ç¢¼å®Œæˆï¼Œç­‰å¾… Claude Code è§¸ç™¼

### âœ… 5. FTS5 æ··åˆæœå°‹

**è®Šæ›´å…§å®¹**ï¼š
- `SessionSearch.ts`ï¼šæ–°å¢ FTS5 æœå°‹æ–¹æ³•
- `migrations.ts`ï¼šå»ºç«‹ FTS5 è™›æ“¬è¡¨
- `SearchManager.ts`ï¼šæ•´åˆ Vector + FTS5 é›™è»Œæœå°‹

**å·²å»ºç«‹çš„ FTS5 è¡¨**ï¼š
- `observations_fts` - è§€å¯Ÿè¨˜éŒ„å…¨æ–‡æœå°‹
- `session_summaries_fts` - Session æ‘˜è¦å…¨æ–‡æœå°‹
- `user_prompts_fts` - ç”¨æˆ¶æç¤ºå…¨æ–‡æœå°‹

**æ•ˆç›Š**ï¼š
- ç²¾ç¢ºé—œéµå­—åŒ¹é…ï¼ˆFTS5ï¼‰è£œå……èªç¾©æœå°‹ï¼ˆChromaï¼‰
- æå‡å¬å›ç‡ï¼Œæ¸›å°‘éºæ¼
- æœå°‹é€Ÿåº¦ < 1msï¼ˆindexedï¼‰

### âœ… 6. Import API

**è®Šæ›´å…§å®¹**ï¼š
- `DataRoutes.ts`ï¼šæ–°å¢ `POST /api/import` endpoint
- `SessionStore.ts`ï¼šæ–°å¢ `importSdkSession`, `importObservation` ç­‰æ–¹æ³•

**æ•ˆç›Š**ï¼š
- æ”¯æ´å¾å‚™ä»½æª”æ¡ˆé‚„åŸè¨˜æ†¶
- å¯å¾å…¶ä»–å¯¦ä¾‹å°å…¥ observations
- ç‚ºåœ˜éšŠåˆ†äº«å¥ å®šåŸºç¤

### âœ… 7. Handoff Observation é¡å‹

**è®Šæ›´å…§å®¹**ï¼š
- `types.ts`ï¼šæ–°å¢ 'handoff' observation é¡å‹
- `migrations.ts`ï¼šæ›´æ–° CHECK constraint
- `SessionRoutes.ts`ï¼šæ–°å¢ `POST /api/sessions/handoff` endpoint

**æ•ˆç›Š**ï¼š
- æ˜ç¢ºçš„äº¤æ¥æ–‡ä»¶æ ¼å¼
- è¨˜éŒ„ session ç‹€æ…‹ã€å¾…è¾¦äº‹é …ã€é—œéµæ±ºç­–
- éŠœæ¥ Continuous Claude v2 çš„ handoff æ¦‚å¿µ

**ç‹€æ…‹**ï¼šç¨‹å¼ç¢¼å®Œæˆï¼Œè³‡æ–™åº« 0 ç­†è¨˜éŒ„ï¼ˆç­‰å¾… PreCompact è§¸ç™¼ï¼‰

---

## æ·±åº¦åˆ†æï¼šGit ç‰ˆæœ¬æ§åˆ¶è¨˜æ†¶

### Continuous Claude v2 çš„åšæ³•

```
<project>/
â”œâ”€â”€ thoughts/           â† gitignoredï¼ˆä¸é€²ç‰ˆæ§ï¼‰
â”œâ”€â”€ .git/claude/        â† é€²ç‰ˆæ§ï¼ˆcommit æ¨ç†æ­·å²ï¼‰
â”‚   â”œâ”€â”€ commit-abc123.md  "ç‚ºä»€éº¼é€™æ¨£æ”¹"
â”‚   â””â”€â”€ commit-def456.md
```

### æ½›åœ¨å„ªé»

#### 1. æ™‚é–“è»¸å°é½Š
```
git checkout v1.0
â†“
è‡ªå‹•ç²å¾— v1.0 æ™‚æœŸçš„è¨˜æ†¶ç‹€æ…‹
"ç•¶æ™‚ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ" â†’ ç›´æ¥æŸ¥çœ‹
```
- Debug æ­·å²ï¼šã€Œé€™å€‹ bug ç•¶æ™‚ç™¼ç¾äº†ä»€éº¼ï¼Ÿã€
- æ¶æ§‹è€ƒå¤ï¼šã€Œv2 ç‚ºä½•å¾ REST æ”¹æˆ GraphQLï¼Ÿã€

#### 2. åœ˜éšŠå”ä½œ
```
git pull origin main
â†“
ç²å¾—éšŠå‹çš„æ±ºç­–ç´€éŒ„
"åŸä¾† Alice ä¸Šé€±æ±ºå®šç”¨ Redis æ˜¯å› ç‚º..."
```
- Code review åŒ…å«æ¨ç†éç¨‹
- æ–°äºº onboarding æœ‰å®Œæ•´è„ˆçµ¡
- çŸ¥è­˜ä¸éš¨äººå“¡é›¢é–‹è€Œæµå¤±

#### 3. åˆ†æ”¯è¨˜æ†¶éš”é›¢
```
main branch:     ç©©å®šæ±ºç­–
feature/auth:    èªè­‰ç›¸é—œæ¢ç´¢
experiment/v3:   å¤§è†½å˜—è©¦
â†“
merge æ™‚åˆä½µè¨˜æ†¶
```

#### 4. å‚™ä»½èˆ‡ç½é›£æ¢å¾©
- Clone repo = ç²å¾—è¨˜æ†¶
- GitHub/GitLab = å…è²»å‚™ä»½
- ä¸éœ€é¡å¤–å‚™ä»½ `~/.claude-mem/`

#### 5. å¯©è¨ˆè¿½è¹¤
```
git log --author="Claude" .claude-mem/
â†“
å®Œæ•´çš„ AI æ±ºç­–æ­·å²
"èª°åœ¨ä»€éº¼æ™‚å€™æ±ºå®šç§»é™¤é€™å€‹åŠŸèƒ½ï¼Ÿ"
```

### æ½›åœ¨ç¼ºé»

#### 1. éš±ç§èˆ‡å®‰å…¨é¢¨éšª âš ï¸ åš´é‡
```
# è¨˜æ†¶å¯èƒ½åŒ…å«ï¼š
- "ç™¼ç¾ API_KEY=sk-xxx æš´éœ²åœ¨..."
- "è³‡æ–™åº«å¯†ç¢¼å•é¡Œ..."
- "å®‰å…¨æ¼æ´åœ¨ auth.ts ç¬¬ 42 è¡Œ..."

git push origin main
â†“
ğŸ˜± å…¨éƒ¨å…¬é–‹
```

#### 2. Repository è†¨è„¹
```
claude-mem ç¾æ³ï¼š
- 7,436 observations
- ~31 MB SQLite

å¦‚æœå­˜æˆ Markdownï¼š
- æ¯å€‹ ~500 bytes â†’ åˆå§‹ 3.7 MB
- Git æ­·å²ç´¯ç©ï¼š10x-100x
- Clone æ™‚é–“é¡¯è‘—å¢åŠ 
```

#### 3. Merge è¡çªåœ°ç„
```
Alice: Use PostgreSQL (JSONB support)
Bob:   Use MongoDB (Schema flexibility)

git merge â†’ <<<<<<< ç›¸åæ±ºç­–å¦‚ä½• mergeï¼Ÿ
```

#### 4. æŸ¥è©¢æ•ˆèƒ½å¤§å¹…ä¸‹é™
```
SQLite + Chromaï¼ˆç¾æ³ï¼‰:
- ç²¾ç¢ºæŸ¥è©¢ï¼š< 1msï¼ˆindexedï¼‰
- èªç¾©æœå°‹ï¼š< 100msï¼ˆvectorï¼‰
- è·¨å°ˆæ¡ˆæœå°‹ï¼šæ”¯æ´

Git + Markdown æª”æ¡ˆ:
- ç²¾ç¢ºæŸ¥è©¢ï¼šO(n) grep
- èªç¾©æœå°‹ï¼šâŒ ä¸æ”¯æ´
- è·¨å°ˆæ¡ˆæœå°‹ï¼šâŒ ä¸æ”¯æ´
```

#### 5. çµæ§‹æ€§ä¸åŒ¹é…
```
Git å„ªåŒ–ç›®æ¨™ï¼šæ–‡å­— diffã€äººé¡å¯è®€
claude-mem éœ€è¦ï¼š
- Supersession é—œä¿‚
- Decision chains
- Importance scores
- Memory tiers
- Vector embeddings

Git ç„¡æ³•è¡¨é”é€™äº›èªç¾©é—œä¿‚
```

#### 6. è·¨å°ˆæ¡ˆå­¸ç¿’æ¶ˆå¤± âš ï¸ æ ¸å¿ƒåŠŸèƒ½å–ªå¤±
```
ç¾æ³ï¼ˆå…¨åŸŸ DBï¼‰:
ã€Œæˆ‘åœ¨ pilotrunapp é‡éé¡ä¼¼çš„ auth å•é¡Œ...ã€
â†“
æœå°‹ â†’ æ‰¾åˆ°è§£æ³• â†’ æ‡‰ç”¨

Git-basedï¼ˆå°ˆæ¡ˆéš”é›¢ï¼‰:
æ¯å€‹ repo ç¨ç«‹ â†’ è·¨å°ˆæ¡ˆçŸ¥è­˜ç¢ç‰‡åŒ–
```

### å½±éŸ¿è©•ä¼°çŸ©é™£

| æ–¹é¢ | å½±éŸ¿ç¨‹åº¦ | èªªæ˜ |
|------|----------|------|
| éš±ç§é¢¨éšª | ğŸ”´ é«˜ | æ•æ„Ÿè³‡è¨Šå¤–æ´©é¢¨éšªå¤§ |
| æ•ˆèƒ½ | ğŸ”´ é«˜ | æŸ¥è©¢é€Ÿåº¦ä¸‹é™ 10-100x |
| è·¨å°ˆæ¡ˆå­¸ç¿’ | ğŸ”´ é«˜ | æ ¸å¿ƒåŠŸèƒ½å–ªå¤± |
| åœ˜éšŠå”ä½œ | ğŸŸ¢ æ­£é¢ | é¡¯è‘—æå‡ |
| æ™‚é–“è»¸å°é½Š | ğŸŸ¢ æ­£é¢ | æ–°èƒ½åŠ› |
| è¤‡é›œåº¦ | ğŸŸ¡ ä¸­ | Merge è¡çªè™•ç† |
| Sleep Agent | ğŸ”´ é«˜ | è¨˜æ†¶ç®¡ç†æ©Ÿåˆ¶éœ€é‡è¨­è¨ˆ |

### å»ºè­°æ–¹æ¡ˆï¼šæ··åˆé€£çµæ¨¡å¼

**ä¸å»ºè­°**ï¼šå®Œå…¨é·ç§»åˆ° Git å„²å­˜ï¼ˆæœƒå¤±å»å¤ªå¤šæ ¸å¿ƒå„ªå‹¢ï¼‰

**å»ºè­°**ï¼š

```typescript
// æ–¹æ¡ˆ 1: åªåŠ  Git å…ƒæ•¸æ“šï¼ˆä½ä¾µå…¥ï¼‰
interface ObservationRow {
  // ç¾æœ‰æ¬„ä½...
  git_commit_hash?: string;   // é—œè¯çš„ commit
  git_branch?: string;        // ç•¶æ™‚çš„åˆ†æ”¯
  git_repo_url?: string;      // repo è­˜åˆ¥
}

// æ–¹æ¡ˆ 2: å¯é¸å°å‡ºï¼ˆåœ˜éšŠåˆ†äº«ç”¨ï¼‰
// claude-mem export --project=my-app --type=decision --format=markdown
```

**é€™æ¨£å¯ä»¥**ï¼š
- âœ… ä¿ç•™ SQLite + Chroma æ ¸å¿ƒå„ªå‹¢
- âœ… ä¿ç•™è·¨å°ˆæ¡ˆå­¸ç¿’èƒ½åŠ›
- âœ… ä¿ç•™ Sleep Agent è¨˜æ†¶ç®¡ç†
- âœ… å¯é¸æ€§ Git é—œè¯ï¼ˆä¸å¼·åˆ¶ï¼‰
- âœ… åœ˜éšŠåˆ†äº«é€é export/import
- âœ… é¿å…éš±ç§é¢¨éšªï¼ˆå°å‡ºæ™‚éæ¿¾ï¼‰

---

## å„²å­˜æ¶æ§‹æ¯”è¼ƒè£œå……

### å…¨åŸŸ vs å°ˆæ¡ˆæœ¬åœ°

| æ–¹é¢ | CC v2ï¼ˆå°ˆæ¡ˆæœ¬åœ°ï¼‰ | claude-memï¼ˆå…¨åŸŸï¼‰ |
|------|------------------|-------------------|
| **å„²å­˜ä½ç½®** | `<project>/thoughts/` | `~/.claude-mem/` |
| **æ ¼å¼** | Markdown æª”æ¡ˆ | SQLite è³‡æ–™åº« |
| **éš”é›¢æ€§** | âœ… å¤©ç„¶éš”é›¢ | âŒ éœ€ç”¨ project æ¬„ä½éæ¿¾ |
| **è·¨å°ˆæ¡ˆæœå°‹** | âŒ ä¸æ”¯æ´ | âœ… å¯æœå°‹æ‰€æœ‰å°ˆæ¡ˆ |
| **Git æ•´åˆ** | âœ… å¯é¸æ“‡æ€§ commit | âŒ ç„¡ |
| **å‚™ä»½** | éš¨å°ˆæ¡ˆå‚™ä»½ | ç¨ç«‹å‚™ä»½å…¨åŸŸ DB |

### claude-mem ç¾æ³çµ±è¨ˆ

```
~/.claude-mem/claude-mem.db
â”œâ”€â”€ observations: 7,436 ç­†ï¼ˆ13 å€‹å°ˆæ¡ˆï¼‰
â”œâ”€â”€ sessions: 81 ç­†
â””â”€â”€ summaries: 765 ç­†

è¨˜æ†¶åˆ†å±¤ï¼ˆSleep Agentï¼‰:
â”œâ”€â”€ core:    232 (3%)   â† æ°¸ä¹…ä¿ç•™
â”œâ”€â”€ working: 596 (8%)   â† æ´»èºä½¿ç”¨
â””â”€â”€ archive: 6,608 (89%) â† å·²æ­¸æª”

Supersession: 6,800 ç­† (91%) å·²è¢«æ–°ç‰ˆæœ¬å–ä»£
```

### Sleep Agent vs å°ˆæ¡ˆåˆªé™¤

| æ–¹é¢ | CC v2 å°ˆæ¡ˆåˆªé™¤ | claude-mem Sleep Agent |
|------|---------------|----------------------|
| **è§¸ç™¼æ–¹å¼** | æ‰‹å‹•åˆªé™¤è³‡æ–™å¤¾ | è‡ªå‹•èƒŒæ™¯è™•ç† |
| **æ¸…ç†ç²’åº¦** | æ•´å€‹å°ˆæ¡ˆ | å–®ä¸€ observation |
| **å¯é€†æ€§** | âŒ ä¸å¯é€† | âœ… å¯å¾ archive æ¢å¾© |
| **æ™ºèƒ½ç¨‹åº¦** | ç„¡ï¼ˆå…¨åˆªï¼‰ | âœ… æ ¹æ“šç›¸é—œæ€§/æ™‚æ•ˆåˆ¤æ–· |
| **ä¿ç•™åƒ¹å€¼** | âŒ å…¨éƒ¨ä¸Ÿå¤± | âœ… ä¿ç•™ core æ±ºç­– |

---

## æ›´æ–°å¾Œçš„æ•´åˆå»ºè­°

### å·²å®Œæˆ âœ…ï¼ˆç¨‹å¼ç¢¼ + å·²åœ¨ä½¿ç”¨ï¼‰

1. **StatusLine Token Savings** - ç”¨æˆ¶å¯è¦‹çš„ ROI æŒ‡æ¨™
2. **Per-Session Statistics** - ç²¾ç¢ºçš„ session ç´šè¿½è¹¤ï¼ˆ`/api/stats/session/:id`ï¼‰
3. **Context Economics** - é‡åŒ–è¨˜æ†¶ç³»çµ±åƒ¹å€¼
4. **FTS5 æ··åˆæœå°‹** - Vector + å…¨æ–‡æœå°‹é›™è»Œï¼ˆobservations_fts, session_summaries_fts, user_prompts_ftsï¼‰
5. **Import API** - è¨˜æ†¶å°å…¥åŠŸèƒ½ï¼ˆ`POST /api/import`ï¼‰

### å·²å®Œæˆ âœ…ï¼ˆç¨‹å¼ç¢¼å®Œæˆï¼Œå°šæœªè§¸ç™¼ä½¿ç”¨ï¼‰

6. **PreCompact Hook æ¡†æ¶** - `precompact-hook.js` å·²éƒ¨ç½²ï¼Œç­‰å¾… Claude Code è§¸ç™¼
7. **Handoff Observation é¡å‹** - schema å·²æ”¯æ´ 'handoff' é¡å‹ï¼ŒAPI endpoint å·²å°±ç·’

### ä¸‹ä¸€æ­¥ ğŸ”œ

1. **Git å…ƒæ•¸æ“šé€£çµ** - å°‡ observation é—œè¯åˆ° commitï¼ˆéœ€æ–°å¢ `git_commit_hash`, `git_branch` æ¬„ä½ï¼‰
2. **Export API** - è¨˜æ†¶å°å‡ºåŠŸèƒ½ï¼ˆç›®å‰åªæœ‰ Importï¼Œç„¡ Exportï¼‰

### é•·æœŸæ¢ç´¢ ğŸ”­

1. **Agent Token è¿½è¹¤** - åˆ†é›¢ä¸» session vs subagent æ¶ˆè€—ï¼ˆéœ€æ–°å¢ `parent_session_id` æ¬„ä½ï¼‰
2. **å°ˆæ¡ˆç´šè¨­å®š** - æ”¯æ´ `.claude-mem/` ç›®éŒ„è¦†è“‹
3. **Tracing ç³»çµ±** - ç´°ç·»çš„æ•ˆèƒ½åˆ†æ
