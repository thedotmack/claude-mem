---
title: "Endless Mode User Guide"
description: "Comprehensive guide to using Endless Mode for indefinite Claude Code sessions"
---

# Endless Mode User Guide

**Version**: 1.0
**Feature Status**: Experimental (Ready for Testing)
**Claude-Mem Version**: 6.0.9+

---

## What is Endless Mode?

Endless Mode is a revolutionary feature that enables Claude Code sessions to run indefinitely by compressing tool outputs in real-time. Instead of filling the context window with full tool responses, Endless Mode replaces them with AI-compressed observations, achieving **80-95% token reduction**.

### The Problem

Claude Code's context window has a finite size. After many tool executions (reads, searches, bash commands), the window fills up with tool outputs, eventually preventing Claude from continuing work. This limits how much you can accomplish in a single session.

### The Solution

Endless Mode intercepts tool executions and:
1. **Waits** for the tool output to be compressed by the Claude Agent SDK
2. **Replaces** the full output in the transcript with a concise observation
3. **Preserves** context quality while freeing up 80-95% of the tokens

Result: Sessions can run indefinitely without hitting token limits.

---

## How It Works

### Normal Mode (Before Endless Mode)

```
User â†’ Tool executes â†’ Full output in transcript â†’ Context window fills up
```

After 30-50 tool uses, Claude runs out of context space.

### Endless Mode (After)

```
User â†’ Tool executes â†’ Hook blocks â†’ SDK compresses â†’ Replace in transcript â†’ Claude resumes
```

Each tool output is compressed before Claude sees it, freeing up ~90% of tokens.

### Example Transformation

**Original output (3,247 tokens)**:
```
[Full file contents of a 500-line TypeScript file...]
```

**Compressed observation (245 tokens)**:
```markdown
# Read TypeScript Hook Implementation

**File: src/hooks/save-hook.ts**

Core implementation of PostToolUse hook that captures tool execution observations
and sends them to the worker service for compression.

**Key Facts:**
- Handles tool_use_id extraction from transcript
- Implements Endless Mode blocking with 90s timeout
- Transforms transcript with compressed observations
- Skips meta-tools (SlashCommand, Skill, TodoWrite)

**Files Modified**: save-hook.ts (375 lines)

---
*[Compressed by Endless Mode]*
```

**Token savings**: 92.5%

---

## Installation & Setup

### Step 1: Enable Endless Mode

Create or edit `~/.claude-mem/settings.json`:

```json
{
  "model": "claude-sonnet-4-5",
  "workerPort": 37777,
  "enableMemoryStorage": true,
  "enableContextInjection": true,
  "contextDepth": 7,
  "env": {
    "CLAUDE_MEM_ENDLESS_MODE": true
  }
}
```

### Step 2: Restart Claude Code

Close and reopen your Claude Code session. Endless Mode is now active.

### Step 3: Verify It's Working

Execute a tool command:
```
Read package.json
```

You should notice:
1. **Slight delay** (10-60s) as the observation is created
2. **Worker logs** showing compression stats
3. **Compressed output** in the transcript

---

## Configuration Options

### Enable/Disable

**Enable**:
```json
{
  "env": {
    "CLAUDE_MEM_ENDLESS_MODE": true
  }
}
```

**Disable**:
```json
{
  "env": {
    "CLAUDE_MEM_ENDLESS_MODE": false
  }
}
```

### Model Selection

Choose the AI model for compression:

```json
{
  "model": "claude-sonnet-4-5"
}
```

Options:
- `claude-sonnet-4-5` - Best balance (default)
- `claude-haiku-4-5` - Faster, cheaper (good for testing)
- `claude-opus-4-5` - Highest quality (slower, expensive)

### Timeout (Advanced)

The default 90s timeout works for most cases. To modify (requires code change):

Edit `src/services/worker-service.ts`:
```typescript
const TIMEOUT_MS = 120000; // 120 seconds
```

---

## Monitoring

### Check If Endless Mode Is Active

```bash
# View configuration
cat ~/.claude-mem/settings.json

# Check silent debug log
tail -20 ~/.claude-mem/silent.log | grep "Endless Mode Check"
```

Look for:
```json
{
  "configEnabled": true,
  "hasToolUseId": true,
  "hasTranscriptPath": true,
  "isEndlessModeEnabled": true
}
```

### View Compression Stats

```bash
# Worker logs (real-time)
pm2 logs claude-mem-worker

# Recent compressions
npm run endless-mode:metrics
```

Output:
```
ðŸ“Š Endless Mode Performance Metrics
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“ˆ Summary (Last 25 observations)

   Observations Created: 25
   Transcripts Compressed: 25
   Timeouts: 0
   Success Rate: 100.0%

â±ï¸  Observation Creation Times

   Min: 8.2s
   Max: 45.7s
   Avg: 23.4s
   P50: 21.8s
   P95: 42.3s âœ…

ðŸ—œï¸  Compression Ratios

   Min: 78%
   Max: 96%
   Avg: 87% âœ…
   P50: 88%
   P95: 94%
```

### View Compressed Transcript

```bash
# Find latest session
SESSION_ID=$(ls -t ~/.claude/sessions | head -1)

# View transcript
cat ~/.claude/sessions/$SESSION_ID/transcript.jsonl | grep "Compressed by Endless Mode"
```

---

## What Gets Compressed

### Compressed Tools

These tools benefit from Endless Mode:
- âœ… **Read** - File contents
- âœ… **Bash** - Command outputs
- âœ… **Grep** - Search results
- âœ… **List** - Directory listings
- âœ… **Custom tools** - Any tool execution

### Skipped Tools

These tools are NOT compressed (low value or meta-operations):
- âŒ **SlashCommand** - Command invocations
- âŒ **Skill** - Skill invocations
- âŒ **TodoWrite** - Task management
- âŒ **ListMcpResourcesTool** - Infrastructure
- âŒ **AskUserQuestion** - User interaction

---

## Expected Behavior

### Normal Operation

1. **Execute tool**: `Read src/hooks/save-hook.ts`
2. **Hook blocks**: 10-60 seconds (you'll see "thinking" indicator)
3. **Compression completes**: Worker logs show stats
4. **Claude resumes**: With compressed observation in context

### Timeout Fallback

If compression takes >90s:
1. **Hook times out**: After exactly 90 seconds
2. **Full output preserved**: Claude gets the original response
3. **Background compression**: Observation still created for future reference
4. **Warning logged**: Check worker logs

This is a **graceful degradation** - your session continues normally.

---

## Performance Impact

### Latency

- **Added delay**: 10-60 seconds per tool execution
- **User experience**: Minimal impact (Claude was "thinking" anyway)
- **Benefit**: Unlimited session length

### Token Savings

| Tool | Original Tokens | Compressed Tokens | Savings |
|------|----------------|-------------------|---------|
| Read (large file) | 5,000 | 300 | 94% |
| Bash (log output) | 2,500 | 200 | 92% |
| Grep (results) | 1,800 | 180 | 90% |
| List (directory) | 800 | 120 | 85% |

**Average savings**: 87%

### Context Window Math

Without Endless Mode:
- Tool uses before limit: ~50
- Session length: 30-60 minutes

With Endless Mode:
- Tool uses before limit: **~400+**
- Session length: **Indefinite**

---

## Troubleshooting

### Issue: Tools taking too long

**Symptom**: Every tool blocks for 90s and times out

**Cause**: Worker not processing observations

**Solution**:
```bash
# Check worker status
pm2 status

# Check worker logs
pm2 logs claude-mem-worker --lines 50

# Restart if needed
pm2 restart claude-mem-worker
```

---

### Issue: No compression happening

**Symptom**: Transcript shows full outputs, no `[Compressed by Endless Mode]` markers

**Cause**: Endless Mode not enabled or misconfigured

**Solution**:
```bash
# 1. Verify configuration
cat ~/.claude-mem/settings.json

# 2. Check for CLAUDE_MEM_ENDLESS_MODE=true

# 3. Restart Claude Code

# 4. Check debug logs
tail -f ~/.claude-mem/silent.log | grep "Endless Mode"
```

---

### Issue: Compressed output quality poor

**Symptom**: Claude seems confused by compressed observations

**Cause**: Model may be struggling with compression prompts

**Solution**:
1. **Upgrade model**: Switch to `claude-sonnet-4-5` or `claude-opus-4-5`
2. **Check compression**: Run `npm run endless-mode:metrics` to see ratios
3. **Report issue**: Include example tool output and compressed result

---

### Issue: Session still hitting context limits

**Symptom**: Claude reports context window full despite Endless Mode

**Cause**: User messages and Claude's responses still consume context

**Solution**:
- Endless Mode only compresses **tool outputs**
- Long conversations will still fill context
- Use `/clear` to reset context while preserving session
- Consider shorter user prompts

---

## Best Practices

### 1. Use for Long Sessions

Endless Mode shines when you're doing heavy tool-based work:
- Reading many files
- Running lots of bash commands
- Extensive code searches
- Long debugging sessions

### 2. Monitor Performance

Periodically check metrics:
```bash
npm run endless-mode:metrics
```

Look for:
- Avg compression &gt;80% âœ…
- P95 creation time &lt;60s âœ…
- Timeout rate &lt;5% âœ…

### 3. Disable for Simple Sessions

For quick tasks with few tools, Endless Mode adds unnecessary latency:
```json
{
  "env": {
    "CLAUDE_MEM_ENDLESS_MODE": false
  }
}
```

### 4. Watch for Timeouts

If you see frequent timeouts:
- Check worker health: `pm2 status`
- Check API quota: Model may be rate-limited
- Consider simpler model: `claude-haiku-4-5` for faster processing

---

## Advanced Usage

### Custom Timeout

For very large outputs or slow networks, increase timeout:

**File**: `src/services/worker-service.ts`
```typescript
const TIMEOUT_MS = 120000; // 120s instead of 90s
```

Rebuild:
```bash
npm run build
npm run sync-marketplace
npm run worker:restart
```

### Selective Tool Compression

To skip specific tools, add to SKIP_TOOLS:

**File**: `src/hooks/save-hook.ts`
```typescript
const SKIP_TOOLS = new Set([
  'ListMcpResourcesTool',
  'SlashCommand',
  'Skill',
  'TodoWrite',
  'AskUserQuestion',
  'YourCustomTool'  // Add here
]);
```

Rebuild:
```bash
npm run build
npm run sync-marketplace
```

### Debug Logging

Enable verbose logging:

**File**: `src/hooks/save-hook.ts`
```typescript
import { silentDebug } from '../utils/silent-debug.js';

// Add wherever you need diagnostics
silentDebug('My debug message', { data: someValue });
```

View logs:
```bash
tail -f ~/.claude-mem/silent.log
```

---

## FAQ

### Q: Does Endless Mode work with all Claude models?

**A**: Yes, but compression quality varies:
- **Recommended**: claude-sonnet-4-5, claude-opus-4-5
- **Not recommended**: claude-haiku-3-5 (older model, lower quality)

---

### Q: Can I use Endless Mode with MCP servers?

**A**: Yes, Endless Mode works with any tool Claude Code executes, including MCP tools.

---

### Q: What happens if I disable Endless Mode mid-session?

**A**: New tools will use full output. Already-compressed observations remain compressed in the transcript. No corruption occurs.

---

### Q: Does this work with Code editing tools?

**A**: Yes, but compression is most valuable for **read-heavy** operations. Edit operations typically have small outputs anyway.

---

### Q: Can I see what was compressed?

**A**: Yes! Observations are stored in the database:
```bash
sqlite3 ~/.claude-mem/claude-mem.db "SELECT title, subtitle, narrative FROM observations ORDER BY created_at_epoch DESC LIMIT 5;"
```

Or use the web viewer:
```
http://localhost:37777
```

---

## Feedback & Support

### Report Issues

If you encounter problems:
1. **Collect logs**: `pm2 logs claude-mem-worker --lines 100 > endless-mode-logs.txt`
2. **Run metrics**: `npm run endless-mode:metrics > metrics.txt`
3. **Include config**: `cat ~/.claude-mem/settings.json > config.txt`
4. **File issue**: https://github.com/thedotmack/claude-mem/issues

### Share Results

Help improve Endless Mode by sharing your metrics:
- Compression ratios achieved
- Session lengths (before/after)
- Tool types used most
- Any timeout patterns

---

## Technical Details

For developers and advanced users, see the internal documentation in `docs/context/endless-mode/`:

- **Architecture & Status**: See `docs/context/endless-mode/status.md`
- **Test Plan**: See `docs/context/endless-mode/test-plan.md`
- **Implementation**: See `src/hooks/save-hook.ts` and `src/services/worker-service.ts`

---

**Last Updated**: 2025-11-19  
**Status**: Experimental - ready for beta testing  
**Next**: Performance benchmarking with real workloads
