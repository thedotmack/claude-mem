#!/usr/bin/env node
import Mc from"path";import{stdin as Fs}from"process";import dn from"better-sqlite3";import{join as Ve,dirname as nn,basename as Wc}from"path";import{homedir as Ia}from"os";import{existsSync as ed,mkdirSync as on}from"fs";import{fileURLToPath as ln}from"url";function un(){return typeof __dirname<"u"?__dirname:nn(ln(import.meta.url))}var cn=un(),cr=process.env.CLAUDE_MEM_DATA_DIR||Ve(Ia(),".claude-mem"),zt=process.env.CLAUDE_CONFIG_DIR||Ve(Ia(),".claude"),td=Ve(cr,"archives"),ad=Ve(cr,"logs"),sd=Ve(cr,"trash"),nd=Ve(cr,"backups"),id=Ve(cr,"settings.json"),Na=Ve(cr,"claude-mem.db"),od=Ve(cr,"vector-db"),ld=Ve(zt,"settings.json"),ud=Ve(zt,"commands"),cd=Ve(zt,"CLAUDE.md");function ka(s){on(s,{recursive:!0})}function Aa(){return Ve(cn,"..","..")}var Vt=(i=>(i[i.DEBUG=0]="DEBUG",i[i.INFO=1]="INFO",i[i.WARN=2]="WARN",i[i.ERROR=3]="ERROR",i[i.SILENT=4]="SILENT",i))(Vt||{}),Zt=class{level;useColor;constructor(){let r=process.env.CLAUDE_MEM_LOG_LEVEL?.toUpperCase()||"INFO";this.level=Vt[r]??1,this.useColor=process.stdout.isTTY??!1}correlationId(r,a){return`obs-${r}-${a}`}sessionId(r){return`session-${r}`}formatData(r){if(r==null)return"";if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return r.toString();if(typeof r=="object"){if(r instanceof Error)return this.level===0?`${r.message}
${r.stack}`:r.message;if(Array.isArray(r))return`[${r.length} items]`;let a=Object.keys(r);return a.length===0?"{}":a.length<=3?JSON.stringify(r):`{${a.length} keys: ${a.slice(0,3).join(", ")}...}`}return String(r)}formatTool(r,a){if(!a)return r;try{let e=typeof a=="string"?JSON.parse(a):a;if(r==="Bash"&&e.command){let n=e.command.length>50?e.command.substring(0,50)+"...":e.command;return`${r}(${n})`}if(r==="Read"&&e.file_path){let n=e.file_path.split("/").pop()||e.file_path;return`${r}(${n})`}if(r==="Edit"&&e.file_path){let n=e.file_path.split("/").pop()||e.file_path;return`${r}(${n})`}if(r==="Write"&&e.file_path){let n=e.file_path.split("/").pop()||e.file_path;return`${r}(${n})`}return r}catch{return r}}log(r,a,e,n,i){if(r<this.level)return;let t=new Date().toISOString().replace("T"," ").substring(0,23),o=Vt[r].padEnd(5),d=a.padEnd(6),u="";n?.correlationId?u=`[${n.correlationId}] `:n?.sessionId&&(u=`[session-${n.sessionId}] `);let p="";i!=null&&(this.level===0&&typeof i=="object"?p=`
`+JSON.stringify(i,null,2):p=" "+this.formatData(i));let _="";if(n){let{sessionId:m,sdkSessionId:E,correlationId:c,...h}=n;Object.keys(h).length>0&&(_=` {${Object.entries(h).map(([v,R])=>`${v}=${R}`).join(", ")}}`)}let y=`[${t}] [${o}] [${d}] ${u}${e}${_}${p}`;r===3?console.error(y):console.log(y)}debug(r,a,e,n){this.log(0,r,a,e,n)}info(r,a,e,n){this.log(1,r,a,e,n)}warn(r,a,e,n){this.log(2,r,a,e,n)}error(r,a,e,n){this.log(3,r,a,e,n)}dataIn(r,a,e,n){this.info(r,`\u2192 ${a}`,e,n)}dataOut(r,a,e,n){this.info(r,`\u2190 ${a}`,e,n)}success(r,a,e,n){this.info(r,`\u2713 ${a}`,e,n)}failure(r,a,e,n){this.error(r,`\u2717 ${a}`,e,n)}timing(r,a,e,n){this.info(r,`\u23F1 ${a}`,n,{duration:`${e}ms`})}},Da=new Zt;var Pt=class{db;constructor(){ka(cr),this.db=new dn(Na),this.db.pragma("journal_mode = WAL"),this.db.pragma("synchronous = NORMAL"),this.db.pragma("foreign_keys = ON"),this.initializeSchema(),this.ensureWorkerPortColumn(),this.ensurePromptTrackingColumns(),this.removeSessionSummariesUniqueConstraint(),this.addObservationHierarchicalFields(),this.makeObservationsTextNullable(),this.createUserPromptsTable()}initializeSchema(){try{this.db.exec(`
        CREATE TABLE IF NOT EXISTS schema_versions (
          id INTEGER PRIMARY KEY,
          version INTEGER UNIQUE NOT NULL,
          applied_at TEXT NOT NULL
        )
      `);let r=this.db.prepare("SELECT version FROM schema_versions ORDER BY version").all();(r.length>0?Math.max(...r.map(e=>e.version)):0)===0&&(console.error("[SessionStore] Initializing fresh database with migration004..."),this.db.exec(`
          CREATE TABLE IF NOT EXISTS sdk_sessions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT UNIQUE NOT NULL,
            sdk_session_id TEXT UNIQUE,
            project TEXT NOT NULL,
            user_prompt TEXT,
            started_at TEXT NOT NULL,
            started_at_epoch INTEGER NOT NULL,
            completed_at TEXT,
            completed_at_epoch INTEGER,
            status TEXT CHECK(status IN ('active', 'completed', 'failed')) NOT NULL DEFAULT 'active'
          );

          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_claude_id ON sdk_sessions(claude_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_sdk_id ON sdk_sessions(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_project ON sdk_sessions(project);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_status ON sdk_sessions(status);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_started ON sdk_sessions(started_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS observations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT NOT NULL,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery')),
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_observations_project ON observations(project);
          CREATE INDEX IF NOT EXISTS idx_observations_type ON observations(type);
          CREATE INDEX IF NOT EXISTS idx_observations_created ON observations(created_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS session_summaries (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT UNIQUE NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.prepare("INSERT INTO schema_versions (version, applied_at) VALUES (?, ?)").run(4,new Date().toISOString()),console.error("[SessionStore] Migration004 applied successfully"))}catch(r){throw console.error("[SessionStore] Schema initialization error:",r.message),r}}ensureWorkerPortColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(5))return;this.db.pragma("table_info(sdk_sessions)").some(n=>n.name==="worker_port")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN worker_port INTEGER"),console.error("[SessionStore] Added worker_port column to sdk_sessions table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(5,new Date().toISOString())}catch(r){console.error("[SessionStore] Migration error:",r.message)}}ensurePromptTrackingColumns(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(6))return;this.db.pragma("table_info(sdk_sessions)").some(d=>d.name==="prompt_counter")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN prompt_counter INTEGER DEFAULT 0"),console.error("[SessionStore] Added prompt_counter column to sdk_sessions table")),this.db.pragma("table_info(observations)").some(d=>d.name==="prompt_number")||(this.db.exec("ALTER TABLE observations ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to observations table")),this.db.pragma("table_info(session_summaries)").some(d=>d.name==="prompt_number")||(this.db.exec("ALTER TABLE session_summaries ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to session_summaries table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(6,new Date().toISOString())}catch(r){console.error("[SessionStore] Prompt tracking migration error:",r.message)}}removeSessionSummariesUniqueConstraint(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(7))return;if(!this.db.pragma("index_list(session_summaries)").some(n=>n.unique===1)){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString());return}console.error("[SessionStore] Removing UNIQUE constraint from session_summaries.sdk_session_id..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE session_summaries_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO session_summaries_new
          SELECT id, sdk_session_id, project, request, investigated, learned,
                 completed, next_steps, files_read, files_edited, notes,
                 prompt_number, created_at, created_at_epoch
          FROM session_summaries
        `),this.db.exec("DROP TABLE session_summaries"),this.db.exec("ALTER TABLE session_summaries_new RENAME TO session_summaries"),this.db.exec(`
          CREATE INDEX idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString()),console.error("[SessionStore] Successfully removed UNIQUE constraint from session_summaries.sdk_session_id")}catch(n){throw this.db.exec("ROLLBACK"),n}}catch(r){console.error("[SessionStore] Migration error (remove UNIQUE constraint):",r.message)}}addObservationHierarchicalFields(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(8))return;if(this.db.pragma("table_info(observations)").some(n=>n.name==="title")){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString());return}console.error("[SessionStore] Adding hierarchical fields to observations table..."),this.db.exec(`
        ALTER TABLE observations ADD COLUMN title TEXT;
        ALTER TABLE observations ADD COLUMN subtitle TEXT;
        ALTER TABLE observations ADD COLUMN facts TEXT;
        ALTER TABLE observations ADD COLUMN narrative TEXT;
        ALTER TABLE observations ADD COLUMN concepts TEXT;
        ALTER TABLE observations ADD COLUMN files_read TEXT;
        ALTER TABLE observations ADD COLUMN files_modified TEXT;
      `),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString()),console.error("[SessionStore] Successfully added hierarchical fields to observations table")}catch(r){console.error("[SessionStore] Migration error (add hierarchical fields):",r.message)}}makeObservationsTextNullable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(9))return;let e=this.db.pragma("table_info(observations)").find(n=>n.name==="text");if(!e||e.notnull===0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString());return}console.error("[SessionStore] Making observations.text nullable..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE observations_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery', 'change')),
            title TEXT,
            subtitle TEXT,
            facts TEXT,
            narrative TEXT,
            concepts TEXT,
            files_read TEXT,
            files_modified TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO observations_new
          SELECT id, sdk_session_id, project, text, type, title, subtitle, facts,
                 narrative, concepts, files_read, files_modified, prompt_number,
                 created_at, created_at_epoch
          FROM observations
        `),this.db.exec("DROP TABLE observations"),this.db.exec("ALTER TABLE observations_new RENAME TO observations"),this.db.exec(`
          CREATE INDEX idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX idx_observations_project ON observations(project);
          CREATE INDEX idx_observations_type ON observations(type);
          CREATE INDEX idx_observations_created ON observations(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString()),console.error("[SessionStore] Successfully made observations.text nullable")}catch(n){throw this.db.exec("ROLLBACK"),n}}catch(r){console.error("[SessionStore] Migration error (make text nullable):",r.message)}}createUserPromptsTable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(10))return;if(this.db.pragma("table_info(user_prompts)").length>0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString());return}console.error("[SessionStore] Creating user_prompts table with FTS5 support..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE user_prompts (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT NOT NULL,
            prompt_number INTEGER NOT NULL,
            prompt_text TEXT NOT NULL,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(claude_session_id) REFERENCES sdk_sessions(claude_session_id) ON DELETE CASCADE
          );

          CREATE INDEX idx_user_prompts_claude_session ON user_prompts(claude_session_id);
          CREATE INDEX idx_user_prompts_created ON user_prompts(created_at_epoch DESC);
          CREATE INDEX idx_user_prompts_prompt_number ON user_prompts(prompt_number);
        `),this.db.exec(`
          CREATE VIRTUAL TABLE user_prompts_fts USING fts5(
            prompt_text,
            content='user_prompts',
            content_rowid='id'
          );
        `),this.db.exec(`
          CREATE TRIGGER user_prompts_ai AFTER INSERT ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;

          CREATE TRIGGER user_prompts_ad AFTER DELETE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
          END;

          CREATE TRIGGER user_prompts_au AFTER UPDATE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString()),console.error("[SessionStore] Successfully created user_prompts table with FTS5 support")}catch(e){throw this.db.exec("ROLLBACK"),e}}catch(r){console.error("[SessionStore] Migration error (create user_prompts table):",r.message)}}getRecentSummaries(r,a=10){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(r,a)}getRecentSummariesWithSessionInfo(r,a=3){return this.db.prepare(`
      SELECT
        sdk_session_id, request, learned, completed, next_steps,
        prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(r,a)}getRecentObservations(r,a=20){return this.db.prepare(`
      SELECT type, text, prompt_number, created_at
      FROM observations
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(r,a)}getAllRecentObservations(r=100){return this.db.prepare(`
      SELECT id, type, title, subtitle, text, project, prompt_number, created_at, created_at_epoch
      FROM observations
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(r)}getAllRecentSummaries(r=50){return this.db.prepare(`
      SELECT id, request, investigated, learned, completed, next_steps,
             files_read, files_edited, notes, project, prompt_number,
             created_at, created_at_epoch
      FROM session_summaries
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(r)}getAllRecentUserPrompts(r=100){return this.db.prepare(`
      SELECT
        up.id,
        up.claude_session_id,
        s.project,
        up.prompt_number,
        up.prompt_text,
        up.created_at,
        up.created_at_epoch
      FROM user_prompts up
      LEFT JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      ORDER BY up.created_at_epoch DESC
      LIMIT ?
    `).all(r)}getAllProjects(){return this.db.prepare(`
      SELECT DISTINCT project
      FROM sdk_sessions
      WHERE project IS NOT NULL AND project != ''
      ORDER BY project ASC
    `).all().map(e=>e.project)}getRecentSessionsWithStatus(r,a=3){return this.db.prepare(`
      SELECT * FROM (
        SELECT
          s.sdk_session_id,
          s.status,
          s.started_at,
          s.started_at_epoch,
          s.user_prompt,
          CASE WHEN sum.sdk_session_id IS NOT NULL THEN 1 ELSE 0 END as has_summary
        FROM sdk_sessions s
        LEFT JOIN session_summaries sum ON s.sdk_session_id = sum.sdk_session_id
        WHERE s.project = ? AND s.sdk_session_id IS NOT NULL
        GROUP BY s.sdk_session_id
        ORDER BY s.started_at_epoch DESC
        LIMIT ?
      )
      ORDER BY started_at_epoch ASC
    `).all(r,a)}getObservationsForSession(r){return this.db.prepare(`
      SELECT title, subtitle, type, prompt_number
      FROM observations
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch ASC
    `).all(r)}getObservationById(r){return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id = ?
    `).get(r)||null}getObservationsByIds(r,a={}){if(r.length===0)return[];let{orderBy:e="date_desc",limit:n}=a,i=e==="date_asc"?"ASC":"DESC",t=n?`LIMIT ${n}`:"",o=r.map(()=>"?").join(",");return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id IN (${o})
      ORDER BY created_at_epoch ${i}
      ${t}
    `).all(...r)}getSummaryForSession(r){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch DESC
      LIMIT 1
    `).get(r)||null}getFilesForSession(r){let e=this.db.prepare(`
      SELECT files_read, files_modified
      FROM observations
      WHERE sdk_session_id = ?
    `).all(r),n=new Set,i=new Set;for(let t of e){if(t.files_read)try{let o=JSON.parse(t.files_read);Array.isArray(o)&&o.forEach(d=>n.add(d))}catch{}if(t.files_modified)try{let o=JSON.parse(t.files_modified);Array.isArray(o)&&o.forEach(d=>i.add(d))}catch{}}return{filesRead:Array.from(n),filesModified:Array.from(i)}}getSessionById(r){return this.db.prepare(`
      SELECT id, claude_session_id, sdk_session_id, project, user_prompt
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(r)||null}findActiveSDKSession(r){return this.db.prepare(`
      SELECT id, sdk_session_id, project, worker_port
      FROM sdk_sessions
      WHERE claude_session_id = ? AND status = 'active'
      LIMIT 1
    `).get(r)||null}findAnySDKSession(r){return this.db.prepare(`
      SELECT id
      FROM sdk_sessions
      WHERE claude_session_id = ?
      LIMIT 1
    `).get(r)||null}reactivateSession(r,a){this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'active', user_prompt = ?, worker_port = NULL
      WHERE id = ?
    `).run(a,r)}incrementPromptCounter(r){return this.db.prepare(`
      UPDATE sdk_sessions
      SET prompt_counter = COALESCE(prompt_counter, 0) + 1
      WHERE id = ?
    `).run(r),this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(r)?.prompt_counter||1}getPromptCounter(r){return this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(r)?.prompt_counter||0}createSDKSession(r,a,e){let n=new Date,i=n.getTime(),o=this.db.prepare(`
      INSERT OR IGNORE INTO sdk_sessions
      (claude_session_id, sdk_session_id, project, user_prompt, started_at, started_at_epoch, status)
      VALUES (?, ?, ?, ?, ?, ?, 'active')
    `).run(r,r,a,e,n.toISOString(),i);return o.lastInsertRowid===0||o.changes===0?this.db.prepare(`
        SELECT id FROM sdk_sessions WHERE claude_session_id = ? LIMIT 1
      `).get(r).id:o.lastInsertRowid}updateSDKSessionId(r,a){return this.db.prepare(`
      UPDATE sdk_sessions
      SET sdk_session_id = ?
      WHERE id = ? AND sdk_session_id IS NULL
    `).run(a,r).changes===0?(Da.debug("DB","sdk_session_id already set, skipping update",{sessionId:r,sdkSessionId:a}),!1):!0}setWorkerPort(r,a){this.db.prepare(`
      UPDATE sdk_sessions
      SET worker_port = ?
      WHERE id = ?
    `).run(a,r)}getWorkerPort(r){return this.db.prepare(`
      SELECT worker_port
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(r)?.worker_port||null}saveUserPrompt(r,a,e){let n=new Date,i=n.getTime();return this.db.prepare(`
      INSERT INTO user_prompts
      (claude_session_id, prompt_number, prompt_text, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?)
    `).run(r,a,e,n.toISOString(),i).lastInsertRowid}storeObservation(r,a,e,n){let i=new Date,t=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(r)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(r,r,a,i.toISOString(),t),console.error(`[SessionStore] Auto-created session record for session_id: ${r}`));let p=this.db.prepare(`
      INSERT INTO observations
      (sdk_session_id, project, type, title, subtitle, facts, narrative, concepts,
       files_read, files_modified, prompt_number, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,a,e.type,e.title,e.subtitle,JSON.stringify(e.facts),e.narrative,JSON.stringify(e.concepts),JSON.stringify(e.files_read),JSON.stringify(e.files_modified),n||null,i.toISOString(),t);return{id:Number(p.lastInsertRowid),createdAtEpoch:t}}storeSummary(r,a,e,n){let i=new Date,t=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(r)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(r,r,a,i.toISOString(),t),console.error(`[SessionStore] Auto-created session record for session_id: ${r}`));let p=this.db.prepare(`
      INSERT INTO session_summaries
      (sdk_session_id, project, request, investigated, learned, completed,
       next_steps, notes, prompt_number, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,a,e.request,e.investigated,e.learned,e.completed,e.next_steps,e.notes,n||null,i.toISOString(),t);return{id:Number(p.lastInsertRowid),createdAtEpoch:t}}markSessionCompleted(r){let a=new Date,e=a.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'completed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(a.toISOString(),e,r)}markSessionFailed(r){let a=new Date,e=a.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'failed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(a.toISOString(),e,r)}getSessionSummariesByIds(r,a={}){if(r.length===0)return[];let{orderBy:e="date_desc",limit:n}=a,i=e==="date_asc"?"ASC":"DESC",t=n?`LIMIT ${n}`:"",o=r.map(()=>"?").join(",");return this.db.prepare(`
      SELECT * FROM session_summaries
      WHERE id IN (${o})
      ORDER BY created_at_epoch ${i}
      ${t}
    `).all(...r)}getUserPromptsByIds(r,a={}){if(r.length===0)return[];let{orderBy:e="date_desc",limit:n}=a,i=e==="date_asc"?"ASC":"DESC",t=n?`LIMIT ${n}`:"",o=r.map(()=>"?").join(",");return this.db.prepare(`
      SELECT
        up.*,
        s.project,
        s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.id IN (${o})
      ORDER BY up.created_at_epoch ${i}
      ${t}
    `).all(...r)}getTimelineAroundTimestamp(r,a=10,e=10,n){return this.getTimelineAroundObservation(null,r,a,e,n)}getTimelineAroundObservation(r,a,e=10,n=10,i){let t=i?"AND project = ?":"",o=i?[i]:[],d,u;if(r!==null){let m=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id <= ? ${t}
        ORDER BY id DESC
        LIMIT ?
      `,E=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id >= ? ${t}
        ORDER BY id ASC
        LIMIT ?
      `;try{let c=this.db.prepare(m).all(r,...o,e+1),h=this.db.prepare(E).all(r,...o,n+1);if(c.length===0&&h.length===0)return{observations:[],sessions:[],prompts:[]};d=c.length>0?c[c.length-1].created_at_epoch:a,u=h.length>0?h[h.length-1].created_at_epoch:a}catch(c){return console.error("[SessionStore] Error getting boundary observations:",c.message),{observations:[],sessions:[],prompts:[]}}}else{let m=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch <= ? ${t}
        ORDER BY created_at_epoch DESC
        LIMIT ?
      `,E=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch >= ? ${t}
        ORDER BY created_at_epoch ASC
        LIMIT ?
      `;try{let c=this.db.prepare(m).all(a,...o,e),h=this.db.prepare(E).all(a,...o,n+1);if(c.length===0&&h.length===0)return{observations:[],sessions:[],prompts:[]};d=c.length>0?c[c.length-1].created_at_epoch:a,u=h.length>0?h[h.length-1].created_at_epoch:a}catch(c){return console.error("[SessionStore] Error getting boundary timestamps:",c.message),{observations:[],sessions:[],prompts:[]}}}let p=`
      SELECT *
      FROM observations
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${t}
      ORDER BY created_at_epoch ASC
    `,_=`
      SELECT *
      FROM session_summaries
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${t}
      ORDER BY created_at_epoch ASC
    `,y=`
      SELECT up.*, s.project, s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.created_at_epoch >= ? AND up.created_at_epoch <= ? ${t.replace("project","s.project")}
      ORDER BY up.created_at_epoch ASC
    `;try{let m=this.db.prepare(p).all(d,u,...o),E=this.db.prepare(_).all(d,u,...o),c=this.db.prepare(y).all(d,u,...o);return{observations:m,sessions:E.map(h=>({id:h.id,sdk_session_id:h.sdk_session_id,project:h.project,request:h.request,completed:h.completed,next_steps:h.next_steps,created_at:h.created_at,created_at_epoch:h.created_at_epoch})),prompts:c.map(h=>({id:h.id,claude_session_id:h.claude_session_id,project:h.project,prompt:h.prompt_text,created_at:h.created_at,created_at_epoch:h.created_at_epoch}))}}catch(m){return console.error("[SessionStore] Error querying timeline records:",m.message),{observations:[],sessions:[],prompts:[]}}}close(){this.db.close()}};function fn(s,r,a){return s==="PreCompact"?r?{continue:!0,suppressOutput:!0}:{continue:!1,stopReason:a.reason||"Pre-compact operation failed",suppressOutput:!0}:s==="SessionStart"?r&&a.context?{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:a.context}}:{continue:!0,suppressOutput:!0}:s==="UserPromptSubmit"?r&&a.context?{continue:!0,suppressOutput:!0,hookSpecificOutput:{hookEventName:"UserPromptSubmit",additionalContext:a.context}}:{continue:!0,suppressOutput:!0}:s==="PostToolUse"?{continue:!0,suppressOutput:!0}:s==="Stop"?{continue:!0,suppressOutput:!0}:{continue:r,suppressOutput:!0,...a.reason&&!r?{stopReason:a.reason}:{}}}function Bt(s,r,a={}){let e=fn(s,r,a);return JSON.stringify(e)}import Gt from"path";import{homedir as hn}from"os";import{existsSync as pn,readFileSync as mn}from"fs";import{execSync as vn}from"child_process";var gn=100,_n=100,yn=1e4;function Xt(){try{let s=Gt.join(hn(),".claude-mem","settings.json");if(pn(s)){let r=JSON.parse(mn(s,"utf-8")),a=parseInt(r.env?.CLAUDE_MEM_WORKER_PORT,10);if(!isNaN(a))return a}}catch{}return parseInt(process.env.CLAUDE_MEM_WORKER_PORT||"37777",10)}async function $a(){try{let s=Xt();return(await fetch(`http://127.0.0.1:${s}/health`,{signal:AbortSignal.timeout(gn)})).ok}catch{return!1}}async function En(){let s=Date.now();for(;Date.now()-s<yn;){if(await $a())return!0;await new Promise(r=>setTimeout(r,_n))}return!1}async function La(){if(await $a())return;let s=Aa(),r=Gt.join(s,"node_modules",".bin","pm2"),a=Gt.join(s,"ecosystem.config.cjs");if(vn(`"${r}" start "${a}"`,{cwd:s,stdio:"pipe"}),!await En())throw new Error("Worker failed to become healthy after restart")}import{homedir as bn}from"os";import Sn from"path";import{existsSync as Tn,readFileSync as Pn}from"fs";function ja(){try{let s=Sn.join(bn(),".claude","settings.json");if(Tn(s))return JSON.parse(Pn(s,"utf-8"))}catch{}return null}function Ma(){let s=ja();if(s?.env?.CLAUDE_MEM_CONTEXT_OBSERVATIONS){let r=parseInt(s.env.CLAUDE_MEM_CONTEXT_OBSERVATIONS,10);if(!isNaN(r)&&r>0)return r}return parseInt(process.env.CLAUDE_MEM_CONTEXT_OBSERVATIONS||"50",10)}function Fa(){let s=ja();if(s?.env?.CLAUDE_MEM_JIT_CONTEXT_ENABLED!==void 0){let a=s.env.CLAUDE_MEM_JIT_CONTEXT_ENABLED.toLowerCase();return a==="true"||a==="1"}let r=process.env.CLAUDE_MEM_JIT_CONTEXT_ENABLED?.toLowerCase();return r==="true"||r==="1"}import{join as Va}from"path";import{fileURLToPath as di}from"url";import{setMaxListeners as fi}from"events";import{spawn as pi}from"child_process";import{createInterface as mi}from"readline";import*as te from"fs";import{stat as vi}from"fs/promises";import{join as ul}from"path";import{homedir as cl}from"os";import{dirname as ra,join as fs}from"path";import{cwd as Ka}from"process";import{randomUUID as fl}from"crypto";var Rn=Object.create,wn=Object.getPrototypeOf,Kt=Object.defineProperty,xn=Object.getOwnPropertyNames,On=Object.prototype.hasOwnProperty,Cn=(s,r,a)=>{a=s!=null?Rn(wn(s)):{};let e=r||!s||!s.__esModule?Kt(a,"default",{value:s,enumerable:!0}):a;for(let n of xn(s))On.call(e,n)||Kt(e,n,{get:()=>s[n],enumerable:!0});return e},se=(s,r)=>()=>(r||s((r={exports:{}}).exports,r),r.exports),In=(s,r)=>{for(var a in r)Kt(s,a,{get:r[a],enumerable:!0,configurable:!0,set:e=>r[a]=()=>e})},Nn=se((s,r)=>{(function(a,e){typeof s=="object"&&typeof r<"u"?e(s):typeof define=="function"&&define.amd?define(["exports"],e):e(a.URI=a.URI||{})})(s,function(a){function e(){for(var g=arguments.length,f=Array(g),b=0;b<g;b++)f[b]=arguments[b];if(f.length>1){f[0]=f[0].slice(0,-1);for(var C=f.length-1,N=1;N<C;++N)f[N]=f[N].slice(1,-1);return f[C]=f[C].slice(1),f.join("")}else return f[0]}function n(g){return"(?:"+g+")"}function i(g){return g===void 0?"undefined":g===null?"null":Object.prototype.toString.call(g).split(" ").pop().split("]").shift().toLowerCase()}function t(g){return g.toUpperCase()}function o(g){return g!=null?g instanceof Array?g:typeof g.length!="number"||g.split||g.setInterval||g.call?[g]:Array.prototype.slice.call(g):[]}function d(g,f){var b=g;if(f)for(var C in f)b[C]=f[C];return b}function u(g){var f="[A-Za-z]",b="[\\x0D]",C="[0-9]",N="[\\x22]",B=e(C,"[A-Fa-f]"),ue="[\\x0A]",me="[\\x20]",ye=n(n("%[EFef]"+B+"%"+B+B+"%"+B+B)+"|"+n("%[89A-Fa-f]"+B+"%"+B+B)+"|"+n("%"+B+B)),Ie="[\\:\\/\\?\\#\\[\\]\\@]",fe="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",we=e(Ie,fe),Ne=g?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Re=g?"[\\uE000-\\uF8FF]":"[]",ge=e(f,C,"[\\-\\.\\_\\~]",Ne),xe=n(f+e(f,C,"[\\+\\-\\.]")+"*"),Ee=n(n(ye+"|"+e(ge,fe,"[\\:]"))+"*"),Er=n(n("25[0-5]")+"|"+n("2[0-4]"+C)+"|"+n("1"+C+C)+"|"+n("[1-9]"+C)+"|"+C),He=n(n("25[0-5]")+"|"+n("2[0-4]"+C)+"|"+n("1"+C+C)+"|"+n("0?[1-9]"+C)+"|0?0?"+C),Xe=n(He+"\\."+He+"\\."+He+"\\."+He),be=n(B+"{1,4}"),ze=n(n(be+"\\:"+be)+"|"+Xe),Qe=n(n(be+"\\:")+"{6}"+ze),ar=n("\\:\\:"+n(be+"\\:")+"{5}"+ze),br=n(n(be)+"?\\:\\:"+n(be+"\\:")+"{4}"+ze),or=n(n(n(be+"\\:")+"{0,1}"+be)+"?\\:\\:"+n(be+"\\:")+"{3}"+ze),ot=n(n(n(be+"\\:")+"{0,2}"+be)+"?\\:\\:"+n(be+"\\:")+"{2}"+ze),bt=n(n(n(be+"\\:")+"{0,3}"+be)+"?\\:\\:"+be+"\\:"+ze),St=n(n(n(be+"\\:")+"{0,4}"+be)+"?\\:\\:"+ze),qr=n(n(n(be+"\\:")+"{0,5}"+be)+"?\\:\\:"+be),Hr=n(n(n(be+"\\:")+"{0,6}"+be)+"?\\:\\:"),lr=n([Qe,ar,br,or,ot,bt,St,qr,Hr].join("|")),zr=n(n(ge+"|"+ye)+"+"),qt=n(lr+"\\%25"+zr),Sr=n(lr+n("\\%25|\\%(?!"+B+"{2})")+zr),Js=n("[vV]"+B+"+\\."+e(ge,fe,"[\\:]")+"+"),Ys=n("\\["+n(Sr+"|"+lr+"|"+Js)+"\\]"),wa=n(n(ye+"|"+e(ge,fe))+"*"),lt=n(Ys+"|"+Xe+"(?!"+wa+")|"+wa),ut=n(C+"*"),xa=n(n(Ee+"@")+"?"+lt+n("\\:"+ut)+"?"),ct=n(ye+"|"+e(ge,fe,"[\\:\\@]")),en=n(ct+"*"),Oa=n(ct+"+"),rn=n(n(ye+"|"+e(ge,fe,"[\\@]"))+"+"),ur=n(n("\\/"+en)+"*"),Vr=n("\\/"+n(Oa+ur)+"?"),Ht=n(rn+ur),Tt=n(Oa+ur),Zr="(?!"+ct+")",qc=n(ur+"|"+Vr+"|"+Ht+"|"+Tt+"|"+Zr),Br=n(n(ct+"|"+e("[\\/\\?]",Re))+"*"),dt=n(n(ct+"|[\\/\\?]")+"*"),Ca=n(n("\\/\\/"+xa+ur)+"|"+Vr+"|"+Tt+"|"+Zr),tn=n(xe+"\\:"+Ca+n("\\?"+Br)+"?"+n("\\#"+dt)+"?"),an=n(n("\\/\\/"+xa+ur)+"|"+Vr+"|"+Ht+"|"+Zr),sn=n(an+n("\\?"+Br)+"?"+n("\\#"+dt)+"?"),Hc=n(tn+"|"+sn),zc=n(xe+"\\:"+Ca+n("\\?"+Br)+"?"),Vc="^("+xe+")\\:"+n(n("\\/\\/("+n("("+Ee+")@")+"?("+lt+")"+n("\\:("+ut+")")+"?)")+"?("+ur+"|"+Vr+"|"+Tt+"|"+Zr+")")+n("\\?("+Br+")")+"?"+n("\\#("+dt+")")+"?$",Zc="^(){0}"+n(n("\\/\\/("+n("("+Ee+")@")+"?("+lt+")"+n("\\:("+ut+")")+"?)")+"?("+ur+"|"+Vr+"|"+Ht+"|"+Zr+")")+n("\\?("+Br+")")+"?"+n("\\#("+dt+")")+"?$",Bc="^("+xe+")\\:"+n(n("\\/\\/("+n("("+Ee+")@")+"?("+lt+")"+n("\\:("+ut+")")+"?)")+"?("+ur+"|"+Vr+"|"+Tt+"|"+Zr+")")+n("\\?("+Br+")")+"?$",Gc="^"+n("\\#("+dt+")")+"?$",Xc="^"+n("("+Ee+")@")+"?("+lt+")"+n("\\:("+ut+")")+"?$";return{NOT_SCHEME:new RegExp(e("[^]",f,C,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(e("[^\\%\\:]",ge,fe),"g"),NOT_HOST:new RegExp(e("[^\\%\\[\\]\\:]",ge,fe),"g"),NOT_PATH:new RegExp(e("[^\\%\\/\\:\\@]",ge,fe),"g"),NOT_PATH_NOSCHEME:new RegExp(e("[^\\%\\/\\@]",ge,fe),"g"),NOT_QUERY:new RegExp(e("[^\\%]",ge,fe,"[\\:\\@\\/\\?]",Re),"g"),NOT_FRAGMENT:new RegExp(e("[^\\%]",ge,fe,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(e("[^]",ge,fe),"g"),UNRESERVED:new RegExp(ge,"g"),OTHER_CHARS:new RegExp(e("[^\\%]",ge,we),"g"),PCT_ENCODED:new RegExp(ye,"g"),IPV4ADDRESS:new RegExp("^("+Xe+")$"),IPV6ADDRESS:new RegExp("^\\[?("+lr+")"+n(n("\\%25|\\%(?!"+B+"{2})")+"("+zr+")")+"?\\]?$")}}var p=u(!1),_=u(!0),y=(function(){function g(f,b){var C=[],N=!0,B=!1,ue=void 0;try{for(var me=f[Symbol.iterator](),ye;!(N=(ye=me.next()).done)&&(C.push(ye.value),!(b&&C.length===b));N=!0);}catch(Ie){B=!0,ue=Ie}finally{try{!N&&me.return&&me.return()}finally{if(B)throw ue}}return C}return function(f,b){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f))return g(f,b);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),m=function(g){if(Array.isArray(g)){for(var f=0,b=Array(g.length);f<g.length;f++)b[f]=g[f];return b}else return Array.from(g)},E=2147483647,c=36,h=1,S=26,v=38,R=700,$=72,I=128,w="-",O=/^xn--/,k=/[^\0-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,j={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=c-h,P=Math.floor,T=String.fromCharCode;function L(g){throw new RangeError(j[g])}function F(g,f){for(var b=[],C=g.length;C--;)b[C]=f(g[C]);return b}function H(g,f){var b=g.split("@"),C="";b.length>1&&(C=b[0]+"@",g=b[1]),g=g.replace(D,".");var N=g.split("."),B=F(N,f).join(".");return C+B}function Z(g){for(var f=[],b=0,C=g.length;b<C;){var N=g.charCodeAt(b++);if(N>=55296&&N<=56319&&b<C){var B=g.charCodeAt(b++);(B&64512)==56320?f.push(((N&1023)<<10)+(B&1023)+65536):(f.push(N),b--)}else f.push(N)}return f}var oe=function(f){return String.fromCodePoint.apply(String,m(f))},J=function(f){return f-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c},Q=function(f,b){return f+22+75*(f<26)-((b!=0)<<5)},K=function(f,b,C){var N=0;for(f=C?P(f/R):f>>1,f+=P(f/b);f>A*S>>1;N+=c)f=P(f/A);return P(N+(A+1)*f/(f+v))},Y=function(f){var b=[],C=f.length,N=0,B=I,ue=$,me=f.lastIndexOf(w);me<0&&(me=0);for(var ye=0;ye<me;++ye)f.charCodeAt(ye)>=128&&L("not-basic"),b.push(f.charCodeAt(ye));for(var Ie=me>0?me+1:0;Ie<C;){for(var fe=N,we=1,Ne=c;;Ne+=c){Ie>=C&&L("invalid-input");var Re=J(f.charCodeAt(Ie++));(Re>=c||Re>P((E-N)/we))&&L("overflow"),N+=Re*we;var ge=Ne<=ue?h:Ne>=ue+S?S:Ne-ue;if(Re<ge)break;var xe=c-ge;we>P(E/xe)&&L("overflow"),we*=xe}var Ee=b.length+1;ue=K(N-fe,Ee,fe==0),P(N/Ee)>E-B&&L("overflow"),B+=P(N/Ee),N%=Ee,b.splice(N++,0,B)}return String.fromCodePoint.apply(String,b)},ke=function(f){var b=[];f=Z(f);var C=f.length,N=I,B=0,ue=$,me=!0,ye=!1,Ie=void 0;try{for(var fe=f[Symbol.iterator](),we;!(me=(we=fe.next()).done);me=!0){var Ne=we.value;Ne<128&&b.push(T(Ne))}}catch(Sr){ye=!0,Ie=Sr}finally{try{!me&&fe.return&&fe.return()}finally{if(ye)throw Ie}}var Re=b.length,ge=Re;for(Re&&b.push(w);ge<C;){var xe=E,Ee=!0,Er=!1,He=void 0;try{for(var Xe=f[Symbol.iterator](),be;!(Ee=(be=Xe.next()).done);Ee=!0){var ze=be.value;ze>=N&&ze<xe&&(xe=ze)}}catch(Sr){Er=!0,He=Sr}finally{try{!Ee&&Xe.return&&Xe.return()}finally{if(Er)throw He}}var Qe=ge+1;xe-N>P((E-B)/Qe)&&L("overflow"),B+=(xe-N)*Qe,N=xe;var ar=!0,br=!1,or=void 0;try{for(var ot=f[Symbol.iterator](),bt;!(ar=(bt=ot.next()).done);ar=!0){var St=bt.value;if(St<N&&++B>E&&L("overflow"),St==N){for(var qr=B,Hr=c;;Hr+=c){var lr=Hr<=ue?h:Hr>=ue+S?S:Hr-ue;if(qr<lr)break;var zr=qr-lr,qt=c-lr;b.push(T(Q(lr+zr%qt,0))),qr=P(zr/qt)}b.push(T(Q(qr,0))),ue=K(B,Qe,ge==Re),B=0,++ge}}}catch(Sr){br=!0,or=Sr}finally{try{!ar&&ot.return&&ot.return()}finally{if(br)throw or}}++B,++N}return b.join("")},Ae=function(f){return H(f,function(b){return O.test(b)?Y(b.slice(4).toLowerCase()):b})},Ce=function(f){return H(f,function(b){return k.test(b)?"xn--"+ke(b):b})},pe={version:"2.1.0",ucs2:{decode:Z,encode:oe},decode:Y,encode:ke,toASCII:Ce,toUnicode:Ae},_e={};function x(g){var f=g.charCodeAt(0),b=void 0;return f<16?b="%0"+f.toString(16).toUpperCase():f<128?b="%"+f.toString(16).toUpperCase():f<2048?b="%"+(f>>6|192).toString(16).toUpperCase()+"%"+(f&63|128).toString(16).toUpperCase():b="%"+(f>>12|224).toString(16).toUpperCase()+"%"+(f>>6&63|128).toString(16).toUpperCase()+"%"+(f&63|128).toString(16).toUpperCase(),b}function M(g){for(var f="",b=0,C=g.length;b<C;){var N=parseInt(g.substr(b+1,2),16);if(N<128)f+=String.fromCharCode(N),b+=3;else if(N>=194&&N<224){if(C-b>=6){var B=parseInt(g.substr(b+4,2),16);f+=String.fromCharCode((N&31)<<6|B&63)}else f+=g.substr(b,6);b+=6}else if(N>=224){if(C-b>=9){var ue=parseInt(g.substr(b+4,2),16),me=parseInt(g.substr(b+7,2),16);f+=String.fromCharCode((N&15)<<12|(ue&63)<<6|me&63)}else f+=g.substr(b,9);b+=9}else f+=g.substr(b,3),b+=3}return f}function X(g,f){function b(C){var N=M(C);return N.match(f.UNRESERVED)?N:C}return g.scheme&&(g.scheme=String(g.scheme).replace(f.PCT_ENCODED,b).toLowerCase().replace(f.NOT_SCHEME,"")),g.userinfo!==void 0&&(g.userinfo=String(g.userinfo).replace(f.PCT_ENCODED,b).replace(f.NOT_USERINFO,x).replace(f.PCT_ENCODED,t)),g.host!==void 0&&(g.host=String(g.host).replace(f.PCT_ENCODED,b).toLowerCase().replace(f.NOT_HOST,x).replace(f.PCT_ENCODED,t)),g.path!==void 0&&(g.path=String(g.path).replace(f.PCT_ENCODED,b).replace(g.scheme?f.NOT_PATH:f.NOT_PATH_NOSCHEME,x).replace(f.PCT_ENCODED,t)),g.query!==void 0&&(g.query=String(g.query).replace(f.PCT_ENCODED,b).replace(f.NOT_QUERY,x).replace(f.PCT_ENCODED,t)),g.fragment!==void 0&&(g.fragment=String(g.fragment).replace(f.PCT_ENCODED,b).replace(f.NOT_FRAGMENT,x).replace(f.PCT_ENCODED,t)),g}function ne(g){return g.replace(/^0*(.*)/,"$1")||"0"}function U(g,f){var b=g.match(f.IPV4ADDRESS)||[],C=y(b,2),N=C[1];return N?N.split(".").map(ne).join("."):g}function z(g,f){var b=g.match(f.IPV6ADDRESS)||[],C=y(b,3),N=C[1],B=C[2];if(N){for(var ue=N.toLowerCase().split("::").reverse(),me=y(ue,2),ye=me[0],Ie=me[1],fe=Ie?Ie.split(":").map(ne):[],we=ye.split(":").map(ne),Ne=f.IPV4ADDRESS.test(we[we.length-1]),Re=Ne?7:8,ge=we.length-Re,xe=Array(Re),Ee=0;Ee<Re;++Ee)xe[Ee]=fe[Ee]||we[ge+Ee]||"";Ne&&(xe[Re-1]=U(xe[Re-1],f));var Er=xe.reduce(function(Qe,ar,br){if(!ar||ar==="0"){var or=Qe[Qe.length-1];or&&or.index+or.length===br?or.length++:Qe.push({index:br,length:1})}return Qe},[]),He=Er.sort(function(Qe,ar){return ar.length-Qe.length})[0],Xe=void 0;if(He&&He.length>1){var be=xe.slice(0,He.index),ze=xe.slice(He.index+He.length);Xe=be.join(":")+"::"+ze.join(":")}else Xe=xe.join(":");return B&&(Xe+="%"+B),Xe}else return g}var ce=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,de="".match(/(){0}/)[1]===void 0;function ae(g){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b={},C=f.iri!==!1?_:p;f.reference==="suffix"&&(g=(f.scheme?f.scheme+":":"")+"//"+g);var N=g.match(ce);if(N){de?(b.scheme=N[1],b.userinfo=N[3],b.host=N[4],b.port=parseInt(N[5],10),b.path=N[6]||"",b.query=N[7],b.fragment=N[8],isNaN(b.port)&&(b.port=N[5])):(b.scheme=N[1]||void 0,b.userinfo=g.indexOf("@")!==-1?N[3]:void 0,b.host=g.indexOf("//")!==-1?N[4]:void 0,b.port=parseInt(N[5],10),b.path=N[6]||"",b.query=g.indexOf("?")!==-1?N[7]:void 0,b.fragment=g.indexOf("#")!==-1?N[8]:void 0,isNaN(b.port)&&(b.port=g.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?N[4]:void 0)),b.host&&(b.host=z(U(b.host,C),C)),b.scheme===void 0&&b.userinfo===void 0&&b.host===void 0&&b.port===void 0&&!b.path&&b.query===void 0?b.reference="same-document":b.scheme===void 0?b.reference="relative":b.fragment===void 0?b.reference="absolute":b.reference="uri",f.reference&&f.reference!=="suffix"&&f.reference!==b.reference&&(b.error=b.error||"URI is not a "+f.reference+" reference.");var B=_e[(f.scheme||b.scheme||"").toLowerCase()];if(!f.unicodeSupport&&(!B||!B.unicodeSupport)){if(b.host&&(f.domainHost||B&&B.domainHost))try{b.host=pe.toASCII(b.host.replace(C.PCT_ENCODED,M).toLowerCase())}catch(ue){b.error=b.error||"Host's domain name can not be converted to ASCII via punycode: "+ue}X(b,p)}else X(b,C);B&&B.parse&&B.parse(b,f)}else b.error=b.error||"URI can not be parsed.";return b}function Se(g,f){var b=f.iri!==!1?_:p,C=[];return g.userinfo!==void 0&&(C.push(g.userinfo),C.push("@")),g.host!==void 0&&C.push(z(U(String(g.host),b),b).replace(b.IPV6ADDRESS,function(N,B,ue){return"["+B+(ue?"%25"+ue:"")+"]"})),(typeof g.port=="number"||typeof g.port=="string")&&(C.push(":"),C.push(String(g.port))),C.length?C.join(""):void 0}var Te=/^\.\.?\//,ve=/^\/\.(\/|$)/,$e=/^\/\.\.(\/|$)/,Oe=/^\/?(?:.|\n)*?(?=\/|$)/;function je(g){for(var f=[];g.length;)if(g.match(Te))g=g.replace(Te,"");else if(g.match(ve))g=g.replace(ve,"/");else if(g.match($e))g=g.replace($e,"/"),f.pop();else if(g==="."||g==="..")g="";else{var b=g.match(Oe);if(b){var C=b[0];g=g.slice(C.length),f.push(C)}else throw new Error("Unexpected dot segment condition")}return f.join("")}function Pe(g){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b=f.iri?_:p,C=[],N=_e[(f.scheme||g.scheme||"").toLowerCase()];if(N&&N.serialize&&N.serialize(g,f),g.host&&!b.IPV6ADDRESS.test(g.host)){if(f.domainHost||N&&N.domainHost)try{g.host=f.iri?pe.toUnicode(g.host):pe.toASCII(g.host.replace(b.PCT_ENCODED,M).toLowerCase())}catch(me){g.error=g.error||"Host's domain name can not be converted to "+(f.iri?"Unicode":"ASCII")+" via punycode: "+me}}X(g,b),f.reference!=="suffix"&&g.scheme&&(C.push(g.scheme),C.push(":"));var B=Se(g,f);if(B!==void 0&&(f.reference!=="suffix"&&C.push("//"),C.push(B),g.path&&g.path.charAt(0)!=="/"&&C.push("/")),g.path!==void 0){var ue=g.path;!f.absolutePath&&(!N||!N.absolutePath)&&(ue=je(ue)),B===void 0&&(ue=ue.replace(/^\/\//,"/%2F")),C.push(ue)}return g.query!==void 0&&(C.push("?"),C.push(g.query)),g.fragment!==void 0&&(C.push("#"),C.push(g.fragment)),C.join("")}function De(g,f){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},C=arguments[3],N={};return C||(g=ae(Pe(g,b),b),f=ae(Pe(f,b),b)),b=b||{},!b.tolerant&&f.scheme?(N.scheme=f.scheme,N.userinfo=f.userinfo,N.host=f.host,N.port=f.port,N.path=je(f.path||""),N.query=f.query):(f.userinfo!==void 0||f.host!==void 0||f.port!==void 0?(N.userinfo=f.userinfo,N.host=f.host,N.port=f.port,N.path=je(f.path||""),N.query=f.query):(f.path?(f.path.charAt(0)==="/"?N.path=je(f.path):((g.userinfo!==void 0||g.host!==void 0||g.port!==void 0)&&!g.path?N.path="/"+f.path:g.path?N.path=g.path.slice(0,g.path.lastIndexOf("/")+1)+f.path:N.path=f.path,N.path=je(N.path)),N.query=f.query):(N.path=g.path,f.query!==void 0?N.query=f.query:N.query=g.query),N.userinfo=g.userinfo,N.host=g.host,N.port=g.port),N.scheme=g.scheme),N.fragment=f.fragment,N}function Ge(g,f,b){var C=d({scheme:"null"},b);return Pe(De(ae(g,C),ae(f,C),C,!0),C)}function qe(g,f){return typeof g=="string"?g=Pe(ae(g,f),f):i(g)==="object"&&(g=ae(Pe(g,f),f)),g}function Et(g,f,b){return typeof g=="string"?g=Pe(ae(g,b),b):i(g)==="object"&&(g=Pe(g,b)),typeof f=="string"?f=Pe(ae(f,b),b):i(f)==="object"&&(f=Pe(f,b)),g===f}function Ft(g,f){return g&&g.toString().replace(!f||!f.iri?p.ESCAPE:_.ESCAPE,x)}function er(g,f){return g&&g.toString().replace(!f||!f.iri?p.PCT_ENCODED:_.PCT_ENCODED,M)}var nt={scheme:"http",domainHost:!0,parse:function(f,b){return f.host||(f.error=f.error||"HTTP URIs must have a host."),f},serialize:function(f,b){var C=String(f.scheme).toLowerCase()==="https";return(f.port===(C?443:80)||f.port==="")&&(f.port=void 0),f.path||(f.path="/"),f}},_a={scheme:"https",domainHost:nt.domainHost,parse:nt.parse,serialize:nt.serialize};function ya(g){return typeof g.secure=="boolean"?g.secure:String(g.scheme).toLowerCase()==="wss"}var it={scheme:"ws",domainHost:!0,parse:function(f,b){var C=f;return C.secure=ya(C),C.resourceName=(C.path||"/")+(C.query?"?"+C.query:""),C.path=void 0,C.query=void 0,C},serialize:function(f,b){if((f.port===(ya(f)?443:80)||f.port==="")&&(f.port=void 0),typeof f.secure=="boolean"&&(f.scheme=f.secure?"wss":"ws",f.secure=void 0),f.resourceName){var C=f.resourceName.split("?"),N=y(C,2),B=N[0],ue=N[1];f.path=B&&B!=="/"?B:void 0,f.query=ue,f.resourceName=void 0}return f.fragment=void 0,f}},Ea={scheme:"wss",domainHost:it.domainHost,parse:it.parse,serialize:it.serialize},Us={},qs=!0,ba="[A-Za-z0-9\\-\\.\\_\\~"+(qs?"\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF":"")+"]",tr="[0-9A-Fa-f]",Hs=n(n("%[EFef]"+tr+"%"+tr+tr+"%"+tr+tr)+"|"+n("%[89A-Fa-f]"+tr+"%"+tr+tr)+"|"+n("%"+tr+tr)),zs="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Vs="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Zs=e(Vs,'[\\"\\\\]'),Bs="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Gs=new RegExp(ba,"g"),Ur=new RegExp(Hs,"g"),Xs=new RegExp(e("[^]",zs,"[\\.]",'[\\"]',Zs),"g"),Sa=new RegExp(e("[^]",ba,Bs),"g"),Qs=Sa;function Ut(g){var f=M(g);return f.match(Gs)?f:g}var Ta={scheme:"mailto",parse:function(f,b){var C=f,N=C.to=C.path?C.path.split(","):[];if(C.path=void 0,C.query){for(var B=!1,ue={},me=C.query.split("&"),ye=0,Ie=me.length;ye<Ie;++ye){var fe=me[ye].split("=");switch(fe[0]){case"to":for(var we=fe[1].split(","),Ne=0,Re=we.length;Ne<Re;++Ne)N.push(we[Ne]);break;case"subject":C.subject=er(fe[1],b);break;case"body":C.body=er(fe[1],b);break;default:B=!0,ue[er(fe[0],b)]=er(fe[1],b);break}}B&&(C.headers=ue)}C.query=void 0;for(var ge=0,xe=N.length;ge<xe;++ge){var Ee=N[ge].split("@");if(Ee[0]=er(Ee[0]),b.unicodeSupport)Ee[1]=er(Ee[1],b).toLowerCase();else try{Ee[1]=pe.toASCII(er(Ee[1],b).toLowerCase())}catch(Er){C.error=C.error||"Email address's domain name can not be converted to ASCII via punycode: "+Er}N[ge]=Ee.join("@")}return C},serialize:function(f,b){var C=f,N=o(f.to);if(N){for(var B=0,ue=N.length;B<ue;++B){var me=String(N[B]),ye=me.lastIndexOf("@"),Ie=me.slice(0,ye).replace(Ur,Ut).replace(Ur,t).replace(Xs,x),fe=me.slice(ye+1);try{fe=b.iri?pe.toUnicode(fe):pe.toASCII(er(fe,b).toLowerCase())}catch(ge){C.error=C.error||"Email address's domain name can not be converted to "+(b.iri?"Unicode":"ASCII")+" via punycode: "+ge}N[B]=Ie+"@"+fe}C.path=N.join(",")}var we=f.headers=f.headers||{};f.subject&&(we.subject=f.subject),f.body&&(we.body=f.body);var Ne=[];for(var Re in we)we[Re]!==Us[Re]&&Ne.push(Re.replace(Ur,Ut).replace(Ur,t).replace(Sa,x)+"="+we[Re].replace(Ur,Ut).replace(Ur,t).replace(Qs,x));return Ne.length&&(C.query=Ne.join("&")),C}},Ws=/^([^\:]+)\:(.*)/,Pa={scheme:"urn",parse:function(f,b){var C=f.path&&f.path.match(Ws),N=f;if(C){var B=b.scheme||N.scheme||"urn",ue=C[1].toLowerCase(),me=C[2],ye=B+":"+(b.nid||ue),Ie=_e[ye];N.nid=ue,N.nss=me,N.path=void 0,Ie&&(N=Ie.parse(N,b))}else N.error=N.error||"URN can not be parsed.";return N},serialize:function(f,b){var C=b.scheme||f.scheme||"urn",N=f.nid,B=C+":"+(b.nid||N),ue=_e[B];ue&&(f=ue.serialize(f,b));var me=f,ye=f.nss;return me.path=(N||b.nid)+":"+ye,me}},Ks=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Ra={scheme:"urn:uuid",parse:function(f,b){var C=f;return C.uuid=C.nss,C.nss=void 0,!b.tolerant&&(!C.uuid||!C.uuid.match(Ks))&&(C.error=C.error||"UUID is not valid."),C},serialize:function(f,b){var C=f;return C.nss=(f.uuid||"").toLowerCase(),C}};_e[nt.scheme]=nt,_e[_a.scheme]=_a,_e[it.scheme]=it,_e[Ea.scheme]=Ea,_e[Ta.scheme]=Ta,_e[Pa.scheme]=Pa,_e[Ra.scheme]=Ra,a.SCHEMES=_e,a.pctEncChar=x,a.pctDecChars=M,a.parse=ae,a.removeDotSegments=je,a.serialize=Pe,a.resolveComponents=De,a.resolve=Ge,a.normalize=qe,a.equal=Et,a.escapeComponent=Ft,a.unescapeComponent=er,Object.defineProperty(a,"__esModule",{value:!0})})}),la=se((s,r)=>{r.exports=function a(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var i,t,o;if(Array.isArray(e)){if(i=e.length,i!=n.length)return!1;for(t=i;t--!==0;)if(!a(e[t],n[t]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(n).length)return!1;for(t=i;t--!==0;)if(!Object.prototype.hasOwnProperty.call(n,o[t]))return!1;for(t=i;t--!==0;){var d=o[t];if(!a(e[d],n[d]))return!1}return!0}return e!==e&&n!==n}}),kn=se((s,r)=>{r.exports=function(e){for(var n=0,i=e.length,t=0,o;t<i;)n++,o=e.charCodeAt(t++),o>=55296&&o<=56319&&t<i&&(o=e.charCodeAt(t),(o&64512)==56320&&t++);return n}}),rt=se((s,r)=>{r.exports={copy:a,checkDataType:e,checkDataTypes:n,coerceToTypes:t,toHash:o,getProperty:p,escapeQuotes:_,equal:la(),ucs2length:kn(),varOccurences:y,varReplace:m,schemaHasRules:E,schemaHasRulesExcept:c,schemaUnknownRules:h,toQuotedString:S,getPathExpr:v,getPath:R,getData:w,unescapeFragment:k,unescapeJsonPointer:A,escapeFragment:D,escapeJsonPointer:j};function a(P,T){T=T||{};for(var L in P)T[L]=P[L];return T}function e(P,T,L,F){var H=F?" !== ":" === ",Z=F?" || ":" && ",oe=F?"!":"",J=F?"":"!";switch(P){case"null":return T+H+"null";case"array":return oe+"Array.isArray("+T+")";case"object":return"("+oe+T+Z+"typeof "+T+H+'"object"'+Z+J+"Array.isArray("+T+"))";case"integer":return"(typeof "+T+H+'"number"'+Z+J+"("+T+" % 1)"+Z+T+H+T+(L?Z+oe+"isFinite("+T+")":"")+")";case"number":return"(typeof "+T+H+'"'+P+'"'+(L?Z+oe+"isFinite("+T+")":"")+")";default:return"typeof "+T+H+'"'+P+'"'}}function n(P,T,L){switch(P.length){case 1:return e(P[0],T,L,!0);default:var F="",H=o(P);H.array&&H.object&&(F=H.null?"(":"(!"+T+" || ",F+="typeof "+T+' !== "object")',delete H.null,delete H.array,delete H.object),H.number&&delete H.integer;for(var Z in H)F+=(F?" && ":"")+e(Z,T,L,!0);return F}}var i=o(["string","number","integer","boolean","null"]);function t(P,T){if(Array.isArray(T)){for(var L=[],F=0;F<T.length;F++){var H=T[F];(i[H]||P==="array"&&H==="array")&&(L[L.length]=H)}if(L.length)return L}else{if(i[T])return[T];if(P==="array"&&T==="array")return["array"]}}function o(P){for(var T={},L=0;L<P.length;L++)T[P[L]]=!0;return T}var d=/^[a-z$_][a-z$_0-9]*$/i,u=/'|\\/g;function p(P){return typeof P=="number"?"["+P+"]":d.test(P)?"."+P:"['"+_(P)+"']"}function _(P){return P.replace(u,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function y(P,T){T+="[^0-9]";var L=P.match(new RegExp(T,"g"));return L?L.length:0}function m(P,T,L){return T+="([^0-9])",L=L.replace(/\$/g,"$$$$"),P.replace(new RegExp(T,"g"),L+"$1")}function E(P,T){if(typeof P=="boolean")return!P;for(var L in P)if(T[L])return!0}function c(P,T,L){if(typeof P=="boolean")return!P&&L!="not";for(var F in P)if(F!=L&&T[F])return!0}function h(P,T){if(typeof P!="boolean"){for(var L in P)if(!T[L])return L}}function S(P){return"'"+_(P)+"'"}function v(P,T,L,F){var H=L?"'/' + "+T+(F?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):F?"'[' + "+T+" + ']'":"'[\\'' + "+T+" + '\\']'";return O(P,H)}function R(P,T,L){var F=S(L?"/"+j(T):p(T));return O(P,F)}var $=/^\/(?:[^~]|~0|~1)*$/,I=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function w(P,T,L){var F,H,Z,oe;if(P==="")return"rootData";if(P[0]=="/"){if(!$.test(P))throw new Error("Invalid JSON-pointer: "+P);H=P,Z="rootData"}else{if(oe=P.match(I),!oe)throw new Error("Invalid JSON-pointer: "+P);if(F=+oe[1],H=oe[2],H=="#"){if(F>=T)throw new Error("Cannot access property/index "+F+" levels up, current level is "+T);return L[T-F]}if(F>T)throw new Error("Cannot access data "+F+" levels up, current level is "+T);if(Z="data"+(T-F||""),!H)return Z}for(var J=Z,Q=H.split("/"),K=0;K<Q.length;K++){var Y=Q[K];Y&&(Z+=p(A(Y)),J+=" && "+Z)}return J}function O(P,T){return P=='""'?T:(P+" + "+T).replace(/([^\\])' \+ '/g,"$1")}function k(P){return A(decodeURIComponent(P))}function D(P){return encodeURIComponent(j(P))}function j(P){return P.replace(/~/g,"~0").replace(/\//g,"~1")}function A(P){return P.replace(/~1/g,"/").replace(/~0/g,"~")}}),ts=se((s,r)=>{var a=rt();r.exports=e;function e(n){a.copy(n,this)}}),An=se((s,r)=>{var a=r.exports=function(i,t,o){typeof t=="function"&&(o=t,t={}),o=t.cb||o;var d=typeof o=="function"?o:o.pre||function(){},u=o.post||function(){};e(t,d,u,i,"",i)};a.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},a.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},a.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},a.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(i,t,o,d,u,p,_,y,m,E){if(d&&typeof d=="object"&&!Array.isArray(d)){t(d,u,p,_,y,m,E);for(var c in d){var h=d[c];if(Array.isArray(h)){if(c in a.arrayKeywords)for(var S=0;S<h.length;S++)e(i,t,o,h[S],u+"/"+c+"/"+S,p,u,c,d,S)}else if(c in a.propsKeywords){if(h&&typeof h=="object")for(var v in h)e(i,t,o,h[v],u+"/"+c+"/"+n(v),p,u,c,d,v)}else(c in a.keywords||i.allKeys&&!(c in a.skipKeywords))&&e(i,t,o,h,u+"/"+c,p,u,c,d)}o(d,u,p,_,y,m,E)}}function n(i){return i.replace(/~/g,"~0").replace(/\//g,"~1")}}),ua=se((s,r)=>{var a=Nn(),e=la(),n=rt(),i=ts(),t=An();r.exports=o,o.normalizeId=R,o.fullPath=h,o.url=$,o.ids=I,o.inlineRef=m,o.schema=d;function o(w,O,k){var D=this._refs[k];if(typeof D=="string")if(this._refs[D])D=this._refs[D];else return o.call(this,w,O,D);if(D=D||this._schemas[k],D instanceof i)return m(D.schema,this._opts.inlineRefs)?D.schema:D.validate||this._compile(D);var j=d.call(this,O,k),A,P,T;return j&&(A=j.schema,O=j.root,T=j.baseId),A instanceof i?P=A.validate||w.call(this,A.schema,O,void 0,T):A!==void 0&&(P=m(A,this._opts.inlineRefs)?A:w.call(this,A,O,void 0,T)),P}function d(w,O){var k=a.parse(O),D=S(k),j=h(this._getId(w.schema));if(Object.keys(w.schema).length===0||D!==j){var A=R(D),P=this._refs[A];if(typeof P=="string")return u.call(this,w,P,k);if(P instanceof i)P.validate||this._compile(P),w=P;else if(P=this._schemas[A],P instanceof i){if(P.validate||this._compile(P),A==R(O))return{schema:P,root:w,baseId:j};w=P}else return;if(!w.schema)return;j=h(this._getId(w.schema))}return _.call(this,k,j,w.schema,w)}function u(w,O,k){var D=d.call(this,w,O);if(D){var j=D.schema,A=D.baseId;w=D.root;var P=this._getId(j);return P&&(A=$(A,P)),_.call(this,k,A,j,w)}}var p=n.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function _(w,O,k,D){if(w.fragment=w.fragment||"",w.fragment.slice(0,1)=="/"){for(var j=w.fragment.split("/"),A=1;A<j.length;A++){var P=j[A];if(P){if(P=n.unescapeFragment(P),k=k[P],k===void 0)break;var T;if(!p[P]&&(T=this._getId(k),T&&(O=$(O,T)),k.$ref)){var L=$(O,k.$ref),F=d.call(this,D,L);F&&(k=F.schema,D=F.root,O=F.baseId)}}}if(k!==void 0&&k!==D.schema)return{schema:k,root:D,baseId:O}}}var y=n.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function m(w,O){if(O===!1)return!1;if(O===void 0||O===!0)return E(w);if(O)return c(w)<=O}function E(w){var O;if(Array.isArray(w)){for(var k=0;k<w.length;k++)if(O=w[k],typeof O=="object"&&!E(O))return!1}else for(var D in w)if(D=="$ref"||(O=w[D],typeof O=="object"&&!E(O)))return!1;return!0}function c(w){var O=0,k;if(Array.isArray(w)){for(var D=0;D<w.length;D++)if(k=w[D],typeof k=="object"&&(O+=c(k)),O==1/0)return 1/0}else for(var j in w){if(j=="$ref")return 1/0;if(y[j])O++;else if(k=w[j],typeof k=="object"&&(O+=c(k)+1),O==1/0)return 1/0}return O}function h(w,O){O!==!1&&(w=R(w));var k=a.parse(w);return S(k)}function S(w){return a.serialize(w).split("#")[0]+"#"}var v=/#\/?$/;function R(w){return w?w.replace(v,""):""}function $(w,O){return O=R(O),a.resolve(w,O)}function I(w){var O=R(this._getId(w)),k={"":O},D={"":h(O,!1)},j={},A=this;return t(w,{allKeys:!0},function(P,T,L,F,H,Z,oe){if(T!==""){var J=A._getId(P),Q=k[F],K=D[F]+"/"+H;if(oe!==void 0&&(K+="/"+(typeof oe=="number"?oe:n.escapeFragment(oe))),typeof J=="string"){J=Q=R(Q?a.resolve(Q,J):J);var Y=A._refs[J];if(typeof Y=="string"&&(Y=A._refs[Y]),Y&&Y.schema){if(!e(P,Y.schema))throw new Error('id "'+J+'" resolves to more than one schema')}else if(J!=R(K))if(J[0]=="#"){if(j[J]&&!e(P,j[J]))throw new Error('id "'+J+'" resolves to more than one schema');j[J]=P}else A._refs[J]=K}k[T]=Q,D[T]=K}}),j}}),ca=se((s,r)=>{var a=ua();r.exports={Validation:i(e),MissingRef:i(n)};function e(t){this.message="validation failed",this.errors=t,this.ajv=this.validation=!0}n.message=function(t,o){return"can't resolve reference "+o+" from id "+t};function n(t,o,d){this.message=d||n.message(t,o),this.missingRef=a.url(t,o),this.missingSchema=a.normalizeId(a.fullPath(this.missingRef))}function i(t){return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}}),as=se((s,r)=>{r.exports=function(a,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var n=typeof e.cycles=="boolean"?e.cycles:!1,i=e.cmp&&(function(o){return function(d){return function(u,p){var _={key:u,value:d[u]},y={key:p,value:d[p]};return o(_,y)}}})(e.cmp),t=[];return(function o(d){if(d&&d.toJSON&&typeof d.toJSON=="function"&&(d=d.toJSON()),d!==void 0){if(typeof d=="number")return isFinite(d)?""+d:"null";if(typeof d!="object")return JSON.stringify(d);var u,p;if(Array.isArray(d)){for(p="[",u=0;u<d.length;u++)u&&(p+=","),p+=o(d[u])||"null";return p+"]"}if(d===null)return"null";if(t.indexOf(d)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var _=t.push(d)-1,y=Object.keys(d).sort(i&&i(d));for(p="",u=0;u<y.length;u++){var m=y[u],E=o(d[m]);E&&(p&&(p+=","),p+=JSON.stringify(m)+":"+E)}return t.splice(_,1),"{"+p+"}"}})(a)}}),ss=se((s,r)=>{r.exports=function(e,n,i){var t="",o=e.schema.$async===!0,d=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),u=e.self._getId(e.schema);if(e.opts.strictKeywords){var p=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(p){var _="unknown keyword: "+p;if(e.opts.strictKeywords==="log")e.logger.warn(_);else throw new Error(_)}}if(e.isTop&&(t+=" var validate = ",o&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",u&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" "+("/*# sourceURL="+u+" */")+" ")),typeof e.schema=="boolean"||!(d||e.schema.$ref)){var n="false schema",y=e.level,m=e.dataLevel,E=e.schema[n],c=e.schemaPath+e.util.getProperty(n),h=e.errSchemaPath+"/"+n,O=!e.opts.allErrors,j,S="data"+(m||""),w="valid"+y;if(e.schema===!1){e.isTop?O=!0:t+=" var "+w+" = false; ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(j||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+S+" "),t+=" } "):t+=" {} ";var R=t;t=v.pop(),!e.compositeRule&&O?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?o?t+=" return data; ":t+=" validate.errors = null; return true; ":t+=" var "+w+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var $=e.isTop,y=e.level=0,m=e.dataLevel=0,S="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var I="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(I);else throw new Error(I)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{var{level:y,dataLevel:m}=e,S="data"+(m||"");if(u&&(e.baseId=e.resolve.url(e.baseId,u)),o&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+y+" = errors;"}var w="valid"+y,O=!e.opts.allErrors,k="",D="",j,A=e.schema.type,P=Array.isArray(A);if(A&&e.opts.nullable&&e.schema.nullable===!0&&(P?A.indexOf("null")==-1&&(A=A.concat("null")):A!="null"&&(A=[A,"null"],P=!0)),P&&A.length==1&&(A=A[0],P=!1),e.schema.$ref&&d){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(d=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),A){if(e.opts.coerceTypes)var T=e.util.coerceToTypes(e.opts.coerceTypes,A);var L=e.RULES.types[A];if(T||P||L===!0||L&&!Oe(L)){var c=e.schemaPath+".type",h=e.errSchemaPath+"/type",c=e.schemaPath+".type",h=e.errSchemaPath+"/type",F=P?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[F](A,S,e.opts.strictNumbers,!0)+") { ",T){var H="dataType"+y,Z="coerced"+y;t+=" var "+H+" = typeof "+S+"; var "+Z+" = undefined; ",e.opts.coerceTypes=="array"&&(t+=" if ("+H+" == 'object' && Array.isArray("+S+") && "+S+".length == 1) { "+S+" = "+S+"[0]; "+H+" = typeof "+S+"; if ("+e.util.checkDataType(e.schema.type,S,e.opts.strictNumbers)+") "+Z+" = "+S+"; } "),t+=" if ("+Z+" !== undefined) ; ";var oe=T;if(oe)for(var J,Q=-1,K=oe.length-1;Q<K;)J=oe[Q+=1],J=="string"?t+=" else if ("+H+" == 'number' || "+H+" == 'boolean') "+Z+" = '' + "+S+"; else if ("+S+" === null) "+Z+" = ''; ":J=="number"||J=="integer"?(t+=" else if ("+H+" == 'boolean' || "+S+" === null || ("+H+" == 'string' && "+S+" && "+S+" == +"+S+" ",J=="integer"&&(t+=" && !("+S+" % 1)"),t+=")) "+Z+" = +"+S+"; "):J=="boolean"?t+=" else if ("+S+" === 'false' || "+S+" === 0 || "+S+" === null) "+Z+" = false; else if ("+S+" === 'true' || "+S+" === 1) "+Z+" = true; ":J=="null"?t+=" else if ("+S+" === '' || "+S+" === 0 || "+S+" === false) "+Z+" = null; ":e.opts.coerceTypes=="array"&&J=="array"&&(t+=" else if ("+H+" == 'string' || "+H+" == 'number' || "+H+" == 'boolean' || "+S+" == null) "+Z+" = ["+S+"]; ");t+=" else {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",P?t+=""+A.join(","):t+=""+A,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",P?t+=""+A.join(","):t+=""+A,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+S+" "),t+=" } "):t+=" {} ";var R=t;t=v.pop(),!e.compositeRule&&O?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+Z+" !== undefined) {  ";var Y=m?"data"+(m-1||""):"parentData",ke=m?e.dataPathArr[m]:"parentDataProperty";t+=" "+S+" = "+Z+"; ",m||(t+="if ("+Y+" !== undefined)"),t+=" "+Y+"["+ke+"] = "+Z+"; } "}else{var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",P?t+=""+A.join(","):t+=""+A,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",P?t+=""+A.join(","):t+=""+A,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+S+" "),t+=" } "):t+=" {} ";var R=t;t=v.pop(),!e.compositeRule&&O?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!d)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",O&&(t+=" } if (errors === ",$?t+="0":t+="errs_"+y,t+=") { ",D+="}");else{var Ae=e.RULES;if(Ae){for(var L,Ce=-1,pe=Ae.length-1;Ce<pe;)if(L=Ae[Ce+=1],Oe(L)){if(L.type&&(t+=" if ("+e.util.checkDataType(L.type,S,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(L.type=="object"&&e.schema.properties){var E=e.schema.properties,_e=Object.keys(E),x=_e;if(x)for(var M,X=-1,ne=x.length-1;X<ne;){M=x[X+=1];var U=E[M];if(U.default!==void 0){var z=S+e.util.getProperty(M);if(e.compositeRule){if(e.opts.strictDefaults){var I="default is ignored for: "+z;if(e.opts.strictDefaults==="log")e.logger.warn(I);else throw new Error(I)}}else t+=" if ("+z+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+z+" === null || "+z+" === '' "),t+=" ) "+z+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(U.default)+" ":t+=" "+JSON.stringify(U.default)+" ",t+="; "}}}else if(L.type=="array"&&Array.isArray(e.schema.items)){var ce=e.schema.items;if(ce){for(var U,Q=-1,de=ce.length-1;Q<de;)if(U=ce[Q+=1],U.default!==void 0){var z=S+"["+Q+"]";if(e.compositeRule){if(e.opts.strictDefaults){var I="default is ignored for: "+z;if(e.opts.strictDefaults==="log")e.logger.warn(I);else throw new Error(I)}}else t+=" if ("+z+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+z+" === null || "+z+" === '' "),t+=" ) "+z+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(U.default)+" ":t+=" "+JSON.stringify(U.default)+" ",t+="; "}}}}var ae=L.rules;if(ae){for(var Se,Te=-1,ve=ae.length-1;Te<ve;)if(Se=ae[Te+=1],je(Se)){var $e=Se.code(e,Se.keyword,L.type);$e&&(t+=" "+$e+" ",O&&(k+="}"))}}if(O&&(t+=" "+k+" ",k=""),L.type&&(t+=" } ",A&&A===L.type&&!T)){t+=" else { ";var c=e.schemaPath+".type",h=e.errSchemaPath+"/type",v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(h)+" , params: { type: '",P?t+=""+A.join(","):t+=""+A,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",P?t+=""+A.join(","):t+=""+A,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+S+" "),t+=" } "):t+=" {} ";var R=t;t=v.pop(),!e.compositeRule&&O?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}O&&(t+=" if (errors === ",$?t+="0":t+="errs_"+y,t+=") { ",D+="}")}}}O&&(t+=" "+D+" "),$?(o?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+w+" = errors === errs_"+y+";";function Oe(De){for(var Ge=De.rules,qe=0;qe<Ge.length;qe++)if(je(Ge[qe]))return!0}function je(De){return e.schema[De.keyword]!==void 0||De.implements&&Pe(De)}function Pe(De){for(var Ge=De.implements,qe=0;qe<Ge.length;qe++)if(e.schema[Ge[qe]]!==void 0)return!0}return t}}),Dn=se((s,r)=>{var a=ua(),e=rt(),n=ca(),i=as(),t=ss(),o=e.ucs2length,d=la(),u=n.Validation;r.exports=p;function p(R,$,I,w){var O=this,k=this._opts,D=[void 0],j={},A=[],P={},T=[],L={},F=[];$=$||{schema:R,refVal:D,refs:j};var H=_.call(this,R,$,w),Z=this._compilations[H.index];if(H.compiling)return Z.callValidate=Y;var oe=this._formats,J=this.RULES;try{var Q=ke(R,$,I,w);Z.validate=Q;var K=Z.callValidate;return K&&(K.schema=Q.schema,K.errors=null,K.refs=Q.refs,K.refVal=Q.refVal,K.root=Q.root,K.$async=Q.$async,k.sourceCode&&(K.source=Q.source)),Q}finally{y.call(this,R,$,w)}function Y(){var U=Z.validate,z=U.apply(this,arguments);return Y.errors=U.errors,z}function ke(U,z,ce,de){var ae=!z||z&&z.schema==U;if(z.schema!=$.schema)return p.call(O,U,z,ce,de);var Se=U.$async===!0,Te=t({isTop:!0,schema:U,isRoot:ae,baseId:de,root:z,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:n.MissingRef,RULES:J,validate:t,util:e,resolve:a,resolveRef:Ae,usePattern:M,useDefault:X,useCustomRule:ne,opts:k,formats:oe,logger:O.logger,self:O});Te=v(D,h)+v(A,E)+v(T,c)+v(F,S)+Te,k.processCode&&(Te=k.processCode(Te,U));var ve;try{var $e=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",Te);ve=$e(O,J,oe,$,D,T,F,d,o,u),D[0]=ve}catch(Oe){throw O.logger.error("Error compiling schema, function code:",Te),Oe}return ve.schema=U,ve.errors=null,ve.refs=j,ve.refVal=D,ve.root=ae?ve:z,Se&&(ve.$async=!0),k.sourceCode===!0&&(ve.source={code:Te,patterns:A,defaults:T}),ve}function Ae(U,z,ce){z=a.url(U,z);var de=j[z],ae,Se;if(de!==void 0)return ae=D[de],Se="refVal["+de+"]",x(ae,Se);if(!ce&&$.refs){var Te=$.refs[z];if(Te!==void 0)return ae=$.refVal[Te],Se=Ce(z,ae),x(ae,Se)}Se=Ce(z);var ve=a.call(O,ke,$,z);if(ve===void 0){var $e=I&&I[z];$e&&(ve=a.inlineRef($e,k.inlineRefs)?$e:p.call(O,$e,$,I,U))}if(ve===void 0)pe(z);else return _e(z,ve),x(ve,Se)}function Ce(U,z){var ce=D.length;return D[ce]=z,j[U]=ce,"refVal"+ce}function pe(U){delete j[U]}function _e(U,z){var ce=j[U];D[ce]=z}function x(U,z){return typeof U=="object"||typeof U=="boolean"?{code:z,schema:U,inline:!0}:{code:z,$async:U&&!!U.$async}}function M(U){var z=P[U];return z===void 0&&(z=P[U]=A.length,A[z]=U),"pattern"+z}function X(U){switch(typeof U){case"boolean":case"number":return""+U;case"string":return e.toQuotedString(U);case"object":if(U===null)return"null";var z=i(U),ce=L[z];return ce===void 0&&(ce=L[z]=T.length,T[ce]=U),"default"+ce}}function ne(U,z,ce,de){if(O._opts.validateSchema!==!1){var ae=U.definition.dependencies;if(ae&&!ae.every(function(Ge){return Object.prototype.hasOwnProperty.call(ce,Ge)}))throw new Error("parent schema must have all required keywords: "+ae.join(","));var Se=U.definition.validateSchema;if(Se){var Te=Se(z);if(!Te){var ve="keyword schema is invalid: "+O.errorsText(Se.errors);if(O._opts.validateSchema=="log")O.logger.error(ve);else throw new Error(ve)}}}var $e=U.definition.compile,Oe=U.definition.inline,je=U.definition.macro,Pe;if($e)Pe=$e.call(O,z,ce,de);else if(je)Pe=je.call(O,z,ce,de),k.validateSchema!==!1&&O.validateSchema(Pe,!0);else if(Oe)Pe=Oe.call(O,de,U.keyword,z,ce);else if(Pe=U.definition.validate,!Pe)return;if(Pe===void 0)throw new Error('custom keyword "'+U.keyword+'"failed to compile');var De=F.length;return F[De]=Pe,{code:"customRule"+De,validate:Pe}}}function _(R,$,I){var w=m.call(this,R,$,I);return w>=0?{index:w,compiling:!0}:(w=this._compilations.length,this._compilations[w]={schema:R,root:$,baseId:I},{index:w,compiling:!1})}function y(R,$,I){var w=m.call(this,R,$,I);w>=0&&this._compilations.splice(w,1)}function m(R,$,I){for(var w=0;w<this._compilations.length;w++){var O=this._compilations[w];if(O.schema==R&&O.root==$&&O.baseId==I)return w}return-1}function E(R,$){return"var pattern"+R+" = new RegExp("+e.toQuotedString($[R])+");"}function c(R){return"var default"+R+" = defaults["+R+"];"}function h(R,$){return $[R]===void 0?"":"var refVal"+R+" = refVal["+R+"];"}function S(R){return"var customRule"+R+" = customRules["+R+"];"}function v(R,$){if(!R.length)return"";for(var I="",w=0;w<R.length;w++)I+=$(w,R);return I}}),$n=se((s,r)=>{var a=r.exports=function(){this._cache={}};a.prototype.put=function(n,i){this._cache[n]=i},a.prototype.get=function(n){return this._cache[n]},a.prototype.del=function(n){delete this._cache[n]},a.prototype.clear=function(){this._cache={}}}),Ln=se((s,r)=>{var a=rt(),e=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,n=[0,31,28,31,30,31,30,31,31,30,31,30,31],i=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,t=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,o=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,d=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,u=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,p=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,_=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,y=/^(?:\/(?:[^~/]|~0|~1)*)*$/,m=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,E=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;r.exports=c;function c(D){return D=D=="full"?"full":"fast",a.copy(c[D])}c.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":u,url:p,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:t,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:k,uuid:_,"json-pointer":y,"json-pointer-uri-fragment":m,"relative-json-pointer":E},c.full={date:S,time:v,"date-time":$,uri:w,"uri-reference":d,"uri-template":u,url:p,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:t,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:k,uuid:_,"json-pointer":y,"json-pointer-uri-fragment":m,"relative-json-pointer":E};function h(D){return D%4===0&&(D%100!==0||D%400===0)}function S(D){var j=D.match(e);if(!j)return!1;var A=+j[1],P=+j[2],T=+j[3];return P>=1&&P<=12&&T>=1&&T<=(P==2&&h(A)?29:n[P])}function v(D,j){var A=D.match(i);if(!A)return!1;var P=A[1],T=A[2],L=A[3],F=A[5];return(P<=23&&T<=59&&L<=59||P==23&&T==59&&L==60)&&(!j||F)}var R=/t|\s/i;function $(D){var j=D.split(R);return j.length==2&&S(j[0])&&v(j[1],!0)}var I=/\/|:/;function w(D){return I.test(D)&&o.test(D)}var O=/[^\\]\\Z/;function k(D){if(O.test(D))return!1;try{return new RegExp(D),!0}catch{return!1}}}),jn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.errSchemaPath+"/"+n,_=!e.opts.allErrors,y="data"+(d||""),m="valid"+o,E,c;if(u=="#"||u=="#/")e.isRoot?(E=e.async,c="validate"):(E=e.root.schema.$async===!0,c="root.refVal[0]");else{var h=e.resolveRef(e.baseId,u,e.isRoot);if(h===void 0){var S=e.MissingRefError.message(e.baseId,u);if(e.opts.missingRefs=="fail"){e.logger.error(S);var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { ref: '"+e.util.escapeQuotes(u)+"' } ",e.opts.messages!==!1&&(t+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(u)+"' "),e.opts.verbose&&(t+=" , schema: "+e.util.toQuotedString(u)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),t+=" } "):t+=" {} ";var R=t;t=v.pop(),!e.compositeRule&&_?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",_&&(t+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(S),_&&(t+=" if (true) { ");else throw new e.MissingRefError(e.baseId,u,S)}else if(h.inline){var $=e.util.copy(e);$.level++;var I="valid"+$.level;$.schema=h.schema,$.schemaPath="",$.errSchemaPath=u;var w=e.validate($).replace(/validate\.schema/g,h.code);t+=" "+w+" ",_&&(t+=" if ("+I+") { ")}else E=h.$async===!0||e.async&&h.$async!==!1,c=h.code}if(c){var v=v||[];v.push(t),t="",e.opts.passContext?t+=" "+c+".call(this, ":t+=" "+c+"( ",t+=" "+y+", (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var O=d?"data"+(d-1||""):"parentData",k=d?e.dataPathArr[d]:"parentDataProperty";t+=" , "+O+" , "+k+", rootData)  ";var D=t;if(t=v.pop(),E){if(!e.async)throw new Error("async schema referenced by sync schema");_&&(t+=" var "+m+"; "),t+=" try { await "+D+"; ",_&&(t+=" "+m+" = true; "),t+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",_&&(t+=" "+m+" = false; "),t+=" } ",_&&(t+=" if ("+m+") { ")}else t+=" if (!"+D+") { if (vErrors === null) vErrors = "+c+".errors; else vErrors = vErrors.concat("+c+".errors); errors = vErrors.length; } ",_&&(t+=" else { ")}return t}}),Mn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.schema[n],d=e.schemaPath+e.util.getProperty(n),u=e.errSchemaPath+"/"+n,p=!e.opts.allErrors,_=e.util.copy(e),y="";_.level++;var m="valid"+_.level,E=_.baseId,c=!0,h=o;if(h)for(var S,v=-1,R=h.length-1;v<R;)S=h[v+=1],(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all))&&(c=!1,_.schema=S,_.schemaPath=d+"["+v+"]",_.errSchemaPath=u+"/"+v,t+="  "+e.validate(_)+" ",_.baseId=E,p&&(t+=" if ("+m+") { ",y+="}"));return p&&(c?t+=" if (true) { ":t+=" "+y.slice(0,-1)+" "),t}}),Fn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c="errs__"+o,h=e.util.copy(e),S="";h.level++;var v="valid"+h.level,R=u.every(function(j){return e.opts.strictKeywords?typeof j=="object"&&Object.keys(j).length>0||j===!1:e.util.schemaHasRules(j,e.RULES.all)});if(R){var $=h.baseId;t+=" var "+c+" = errors; var "+E+" = false;  ";var I=e.compositeRule;e.compositeRule=h.compositeRule=!0;var w=u;if(w)for(var O,k=-1,D=w.length-1;k<D;)O=w[k+=1],h.schema=O,h.schemaPath=p+"["+k+"]",h.errSchemaPath=_+"/"+k,t+="  "+e.validate(h)+" ",h.baseId=$,t+=" "+E+" = "+E+" || "+v+"; if (!"+E+") { ",S+="}";e.compositeRule=h.compositeRule=I,t+=" "+S+" if (!"+E+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&y&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" } else {  errors = "+c+"; if (vErrors !== null) { if ("+c+") vErrors.length = "+c+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else y&&(t+=" if (true) { ");return t}}),Un=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.schema[n],d=e.errSchemaPath+"/"+n,u=!e.opts.allErrors,p=e.util.toQuotedString(o);return e.opts.$comment===!0?t+=" console.log("+p+");":typeof e.opts.$comment=="function"&&(t+=" self._opts.$comment("+p+", "+e.util.toQuotedString(d)+", validate.root.schema);"),t}}),qn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c=e.opts.$data&&u&&u.$data,h;c?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",h="schema"+o):h=u,c||(t+=" var schema"+o+" = validate.schema"+p+";"),t+="var "+E+" = equal("+m+", schema"+o+"); if (!"+E+") {   ";var S=S||[];S.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { allowedValue: schema"+o+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to constant' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var v=t;return t=S.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+v+"]); ":t+=" validate.errors = ["+v+"]; return false; ":t+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",y&&(t+=" else { "),t}}),Hn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c="errs__"+o,h=e.util.copy(e),S="";h.level++;var v="valid"+h.level,R="i"+o,$=h.dataLevel=e.dataLevel+1,I="data"+$,w=e.baseId,O=e.opts.strictKeywords?typeof u=="object"&&Object.keys(u).length>0||u===!1:e.util.schemaHasRules(u,e.RULES.all);if(t+="var "+c+" = errors;var "+E+";",O){var k=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=u,h.schemaPath=p,h.errSchemaPath=_,t+=" var "+v+" = false; for (var "+R+" = 0; "+R+" < "+m+".length; "+R+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,R,e.opts.jsonPointers,!0);var D=m+"["+R+"]";h.dataPathArr[$]=R;var j=e.validate(h);h.baseId=w,e.util.varOccurences(j,I)<2?t+=" "+e.util.varReplace(j,I,D)+" ":t+=" var "+I+" = "+D+"; "+j+" ",t+=" if ("+v+") break; }  ",e.compositeRule=h.compositeRule=k,t+=" "+S+" if (!"+v+") {"}else t+=" if ("+m+".length == 0) {";var A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should contain a valid item' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var P=t;return t=A.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+P+"]); ":t+=" validate.errors = ["+P+"]; return false; ":t+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { ",O&&(t+="  errors = "+c+"; if (vErrors !== null) { if ("+c+") vErrors.length = "+c+"; else vErrors = null; } "),e.opts.allErrors&&(t+=" } "),t}}),zn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="errs__"+o,c=e.util.copy(e),h="";c.level++;var S="valid"+c.level,v={},R={},$=e.opts.ownProperties;for(k in u)if(k!="__proto__"){var I=u[k],w=Array.isArray(I)?R:v;w[k]=I}t+="var "+E+" = errors;";var O=e.errorPath;t+="var missing"+o+";";for(var k in R)if(w=R[k],w.length){if(t+=" if ( "+m+e.util.getProperty(k)+" !== undefined ",$&&(t+=" && Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(k)+"') "),y){t+=" && ( ";var D=w;if(D)for(var j,A=-1,P=D.length-1;A<P;){j=D[A+=1],A&&(t+=" || ");var T=e.util.getProperty(j),L=m+T;t+=" ( ( "+L+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(j)+"') "),t+=") && (missing"+o+" = "+e.util.toQuotedString(e.opts.jsonPointers?j:T)+") ) "}t+=")) {  ";var F="missing"+o,H="' + "+F+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(O,F,!0):O+" + "+F);var Z=Z||[];Z.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { property: '"+e.util.escapeQuotes(k)+"', missingProperty: '"+H+"', depsCount: "+w.length+", deps: '"+e.util.escapeQuotes(w.length==1?w[0]:w.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",w.length==1?t+="property "+e.util.escapeQuotes(w[0]):t+="properties "+e.util.escapeQuotes(w.join(", ")),t+=" when property "+e.util.escapeQuotes(k)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var oe=t;t=Z.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+oe+"]); ":t+=" validate.errors = ["+oe+"]; return false; ":t+=" var err = "+oe+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{t+=" ) { ";var J=w;if(J)for(var j,Q=-1,K=J.length-1;Q<K;){j=J[Q+=1];var T=e.util.getProperty(j),H=e.util.escapeQuotes(j),L=m+T;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(O,j,e.opts.jsonPointers)),t+=" if ( "+L+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(j)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { property: '"+e.util.escapeQuotes(k)+"', missingProperty: '"+H+"', depsCount: "+w.length+", deps: '"+e.util.escapeQuotes(w.length==1?w[0]:w.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",w.length==1?t+="property "+e.util.escapeQuotes(w[0]):t+="properties "+e.util.escapeQuotes(w.join(", ")),t+=" when property "+e.util.escapeQuotes(k)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}t+=" }   ",y&&(h+="}",t+=" else { ")}e.errorPath=O;var Y=c.baseId;for(var k in v){var I=v[k];(e.opts.strictKeywords?typeof I=="object"&&Object.keys(I).length>0||I===!1:e.util.schemaHasRules(I,e.RULES.all))&&(t+=" "+S+" = true; if ( "+m+e.util.getProperty(k)+" !== undefined ",$&&(t+=" && Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(k)+"') "),t+=") { ",c.schema=I,c.schemaPath=p+e.util.getProperty(k),c.errSchemaPath=_+"/"+e.util.escapeFragment(k),t+="  "+e.validate(c)+" ",c.baseId=Y,t+=" }  ",y&&(t+=" if ("+S+") { ",h+="}"))}return y&&(t+="   "+h+" if ("+E+" == errors) {"),t}}),Vn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c=e.opts.$data&&u&&u.$data,h;c?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",h="schema"+o):h=u;var S="i"+o,v="schema"+o;c||(t+=" var "+v+" = validate.schema"+p+";"),t+="var "+E+";",c&&(t+=" if (schema"+o+" === undefined) "+E+" = true; else if (!Array.isArray(schema"+o+")) "+E+" = false; else {"),t+=""+E+" = false;for (var "+S+"=0; "+S+"<"+v+".length; "+S+"++) if (equal("+m+", "+v+"["+S+"])) { "+E+" = true; break; }",c&&(t+="  }  "),t+=" if (!"+E+") {   ";var R=R||[];R.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { allowedValues: schema"+o+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var $=t;return t=R.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+$+"]); ":t+=" validate.errors = ["+$+"]; return false; ":t+=" var err = "+$+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",y&&(t+=" else { "),t}}),Zn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||"");if(e.opts.format===!1)return y&&(t+=" if (true) { "),t;var E=e.opts.$data&&u&&u.$data,c;E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u;var h=e.opts.unknownFormats,S=Array.isArray(h);if(E){var v="format"+o,R="isObject"+o,$="formatType"+o;t+=" var "+v+" = formats["+c+"]; var "+R+" = typeof "+v+" == 'object' && !("+v+" instanceof RegExp) && "+v+".validate; var "+$+" = "+R+" && "+v+".type || 'string'; if ("+R+") { ",e.async&&(t+=" var async"+o+" = "+v+".async; "),t+=" "+v+" = "+v+".validate; } if (  ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'string') || "),t+=" (",h!="ignore"&&(t+=" ("+c+" && !"+v+" ",S&&(t+=" && self._opts.unknownFormats.indexOf("+c+") == -1 "),t+=") || "),t+=" ("+v+" && "+$+" == '"+i+"' && !(typeof "+v+" == 'function' ? ",e.async?t+=" (async"+o+" ? await "+v+"("+m+") : "+v+"("+m+")) ":t+=" "+v+"("+m+") ",t+=" : "+v+".test("+m+"))))) {"}else{var v=e.formats[u];if(!v){if(h=="ignore")return e.logger.warn('unknown format "'+u+'" ignored in schema at path "'+e.errSchemaPath+'"'),y&&(t+=" if (true) { "),t;if(S&&h.indexOf(u)>=0)return y&&(t+=" if (true) { "),t;throw new Error('unknown format "'+u+'" is used in schema at path "'+e.errSchemaPath+'"')}var R=typeof v=="object"&&!(v instanceof RegExp)&&v.validate,$=R&&v.type||"string";if(R){var I=v.async===!0;v=v.validate}if($!=i)return y&&(t+=" if (true) { "),t;if(I){if(!e.async)throw new Error("async format in sync schema");var w="formats"+e.util.getProperty(u)+".validate";t+=" if (!(await "+w+"("+m+"))) { "}else{t+=" if (! ";var w="formats"+e.util.getProperty(u);R&&(w+=".validate"),typeof v=="function"?t+=" "+w+"("+m+") ":t+=" "+w+".test("+m+") ",t+=") { "}}var O=O||[];O.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { format:  ",E?t+=""+c:t+=""+e.util.toQuotedString(u),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match format "`,E?t+="' + "+c+" + '":t+=""+e.util.escapeQuotes(u),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+e.util.toQuotedString(u),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var k=t;return t=O.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+k+"]); ":t+=" validate.errors = ["+k+"]; return false; ":t+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",y&&(t+=" else { "),t}}),Bn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c="errs__"+o,h=e.util.copy(e);h.level++;var S="valid"+h.level,v=e.schema.then,R=e.schema.else,$=v!==void 0&&(e.opts.strictKeywords?typeof v=="object"&&Object.keys(v).length>0||v===!1:e.util.schemaHasRules(v,e.RULES.all)),I=R!==void 0&&(e.opts.strictKeywords?typeof R=="object"&&Object.keys(R).length>0||R===!1:e.util.schemaHasRules(R,e.RULES.all)),w=h.baseId;if($||I){var O;h.createErrors=!1,h.schema=u,h.schemaPath=p,h.errSchemaPath=_,t+=" var "+c+" = errors; var "+E+" = true;  ";var k=e.compositeRule;e.compositeRule=h.compositeRule=!0,t+="  "+e.validate(h)+" ",h.baseId=w,h.createErrors=!0,t+="  errors = "+c+"; if (vErrors !== null) { if ("+c+") vErrors.length = "+c+"; else vErrors = null; }  ",e.compositeRule=h.compositeRule=k,$?(t+=" if ("+S+") {  ",h.schema=e.schema.then,h.schemaPath=e.schemaPath+".then",h.errSchemaPath=e.errSchemaPath+"/then",t+="  "+e.validate(h)+" ",h.baseId=w,t+=" "+E+" = "+S+"; ",$&&I?(O="ifClause"+o,t+=" var "+O+" = 'then'; "):O="'then'",t+=" } ",I&&(t+=" else { ")):t+=" if (!"+S+") { ",I&&(h.schema=e.schema.else,h.schemaPath=e.schemaPath+".else",h.errSchemaPath=e.errSchemaPath+"/else",t+="  "+e.validate(h)+" ",h.baseId=w,t+=" "+E+" = "+S+"; ",$&&I?(O="ifClause"+o,t+=" var "+O+" = 'else'; "):O="'else'",t+=" } "),t+=" if (!"+E+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { failingKeyword: "+O+" } ",e.opts.messages!==!1&&(t+=` , message: 'should match "' + `+O+` + '" schema' `),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&y&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" }   ",y&&(t+=" else { ")}else y&&(t+=" if (true) { ");return t}}),Gn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c="errs__"+o,h=e.util.copy(e),S="";h.level++;var v="valid"+h.level,R="i"+o,$=h.dataLevel=e.dataLevel+1,I="data"+$,w=e.baseId;if(t+="var "+c+" = errors;var "+E+";",Array.isArray(u)){var O=e.schema.additionalItems;if(O===!1){t+=" "+E+" = "+m+".length <= "+u.length+"; ";var k=_;_=e.errSchemaPath+"/additionalItems",t+="  if (!"+E+") {   ";var D=D||[];D.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { limit: "+u.length+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have more than "+u.length+" items' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var j=t;t=D.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+j+"]); ":t+=" validate.errors = ["+j+"]; return false; ":t+=" var err = "+j+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",_=k,y&&(S+="}",t+=" else { ")}var A=u;if(A){for(var P,T=-1,L=A.length-1;T<L;)if(P=A[T+=1],e.opts.strictKeywords?typeof P=="object"&&Object.keys(P).length>0||P===!1:e.util.schemaHasRules(P,e.RULES.all)){t+=" "+v+" = true; if ("+m+".length > "+T+") { ";var F=m+"["+T+"]";h.schema=P,h.schemaPath=p+"["+T+"]",h.errSchemaPath=_+"/"+T,h.errorPath=e.util.getPathExpr(e.errorPath,T,e.opts.jsonPointers,!0),h.dataPathArr[$]=T;var H=e.validate(h);h.baseId=w,e.util.varOccurences(H,I)<2?t+=" "+e.util.varReplace(H,I,F)+" ":t+=" var "+I+" = "+F+"; "+H+" ",t+=" }  ",y&&(t+=" if ("+v+") { ",S+="}")}}if(typeof O=="object"&&(e.opts.strictKeywords?typeof O=="object"&&Object.keys(O).length>0||O===!1:e.util.schemaHasRules(O,e.RULES.all))){h.schema=O,h.schemaPath=e.schemaPath+".additionalItems",h.errSchemaPath=e.errSchemaPath+"/additionalItems",t+=" "+v+" = true; if ("+m+".length > "+u.length+") {  for (var "+R+" = "+u.length+"; "+R+" < "+m+".length; "+R+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,R,e.opts.jsonPointers,!0);var F=m+"["+R+"]";h.dataPathArr[$]=R;var H=e.validate(h);h.baseId=w,e.util.varOccurences(H,I)<2?t+=" "+e.util.varReplace(H,I,F)+" ":t+=" var "+I+" = "+F+"; "+H+" ",y&&(t+=" if (!"+v+") break; "),t+=" } }  ",y&&(t+=" if ("+v+") { ",S+="}")}}else if(e.opts.strictKeywords?typeof u=="object"&&Object.keys(u).length>0||u===!1:e.util.schemaHasRules(u,e.RULES.all)){h.schema=u,h.schemaPath=p,h.errSchemaPath=_,t+="  for (var "+R+" = 0; "+R+" < "+m+".length; "+R+"++) { ",h.errorPath=e.util.getPathExpr(e.errorPath,R,e.opts.jsonPointers,!0);var F=m+"["+R+"]";h.dataPathArr[$]=R;var H=e.validate(h);h.baseId=w,e.util.varOccurences(H,I)<2?t+=" "+e.util.varReplace(H,I,F)+" ":t+=" var "+I+" = "+F+"; "+H+" ",y&&(t+=" if (!"+v+") break; "),t+=" }"}return y&&(t+=" "+S+" if ("+c+" == errors) {"),t}}),Ua=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,w,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u;var h=n=="maximum",S=h?"exclusiveMaximum":"exclusiveMinimum",v=e.schema[S],R=e.opts.$data&&v&&v.$data,$=h?"<":">",I=h?">":"<",w=void 0;if(!(E||typeof u=="number"||u===void 0))throw new Error(n+" must be number");if(!(R||v===void 0||typeof v=="number"||typeof v=="boolean"))throw new Error(S+" must be number or boolean");if(R){var O=e.util.getData(v.$data,d,e.dataPathArr),k="exclusive"+o,D="exclType"+o,j="exclIsNumber"+o,A="op"+o,P="' + "+A+" + '";t+=" var schemaExcl"+o+" = "+O+"; ",O="schemaExcl"+o,t+=" var "+k+"; var "+D+" = typeof "+O+"; if ("+D+" != 'boolean' && "+D+" != 'undefined' && "+D+" != 'number') { ";var w=S,T=T||[];T.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(w||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: '"+S+" should be boolean' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var L=t;t=T.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+L+"]); ":t+=" validate.errors = ["+L+"]; return false; ":t+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),t+=" "+D+" == 'number' ? ( ("+k+" = "+c+" === undefined || "+O+" "+$+"= "+c+") ? "+m+" "+I+"= "+O+" : "+m+" "+I+" "+c+" ) : ( ("+k+" = "+O+" === true) ? "+m+" "+I+"= "+c+" : "+m+" "+I+" "+c+" ) || "+m+" !== "+m+") { var op"+o+" = "+k+" ? '"+$+"' : '"+$+"='; ",u===void 0&&(w=S,_=e.errSchemaPath+"/"+S,c=O,E=R)}else{var j=typeof v=="number",P=$;if(j&&E){var A="'"+P+"'";t+=" if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),t+=" ( "+c+" === undefined || "+v+" "+$+"= "+c+" ? "+m+" "+I+"= "+v+" : "+m+" "+I+" "+c+" ) || "+m+" !== "+m+") { "}else{j&&u===void 0?(k=!0,w=S,_=e.errSchemaPath+"/"+S,c=v,I+="="):(j&&(c=Math[h?"min":"max"](v,u)),v===(j?c:!0)?(k=!0,w=S,_=e.errSchemaPath+"/"+S,I+="="):(k=!1,P+="="));var A="'"+P+"'";t+=" if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),t+=" "+m+" "+I+" "+c+" || "+m+" !== "+m+") { "}}w=w||n;var T=T||[];T.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(w||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { comparison: "+A+", limit: "+c+", exclusive: "+k+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be "+P+" ",E?t+="' + "+c:t+=""+c+"'"),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var L=t;return t=T.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+L+"]); ":t+=" validate.errors = ["+L+"]; return false; ":t+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",y&&(t+=" else { "),t}}),qa=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,S,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;if(E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u,!(E||typeof u=="number"))throw new Error(n+" must be number");var h=n=="maxItems"?">":"<";t+="if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),t+=" "+m+".length "+h+" "+c+") { ";var S=n,v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(S||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { limit: "+c+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",n=="maxItems"?t+="more":t+="fewer",t+=" than ",E?t+="' + "+c+" + '":t+=""+u,t+=" items' "),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var R=t;return t=v.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",y&&(t+=" else { "),t}}),Ha=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,S,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;if(E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u,!(E||typeof u=="number"))throw new Error(n+" must be number");var h=n=="maxLength"?">":"<";t+="if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),e.opts.unicode===!1?t+=" "+m+".length ":t+=" ucs2length("+m+") ",t+=" "+h+" "+c+") { ";var S=n,v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(S||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { limit: "+c+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be ",n=="maxLength"?t+="longer":t+="shorter",t+=" than ",E?t+="' + "+c+" + '":t+=""+u,t+=" characters' "),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var R=t;return t=v.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",y&&(t+=" else { "),t}}),za=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,S,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;if(E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u,!(E||typeof u=="number"))throw new Error(n+" must be number");var h=n=="maxProperties"?">":"<";t+="if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'number') || "),t+=" Object.keys("+m+").length "+h+" "+c+") { ";var S=n,v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(S||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { limit: "+c+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",n=="maxProperties"?t+="more":t+="fewer",t+=" than ",E?t+="' + "+c+" + '":t+=""+u,t+=" properties' "),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var R=t;return t=v.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",y&&(t+=" else { "),t}}),Xn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;if(E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u,!(E||typeof u=="number"))throw new Error(n+" must be number");t+="var division"+o+";if (",E&&(t+=" "+c+" !== undefined && ( typeof "+c+" != 'number' || "),t+=" (division"+o+" = "+m+" / "+c+", ",e.opts.multipleOfPrecision?t+=" Math.abs(Math.round(division"+o+") - division"+o+") > 1e-"+e.opts.multipleOfPrecision+" ":t+=" division"+o+" !== parseInt(division"+o+") ",t+=" ) ",E&&(t+="  )  "),t+=" ) {   ";var h=h||[];h.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { multipleOf: "+c+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be multiple of ",E?t+="' + "+c:t+=""+c+"'"),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var S=t;return t=h.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",y&&(t+=" else { "),t}}),Qn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="errs__"+o,c=e.util.copy(e);c.level++;var h="valid"+c.level;if(e.opts.strictKeywords?typeof u=="object"&&Object.keys(u).length>0||u===!1:e.util.schemaHasRules(u,e.RULES.all)){c.schema=u,c.schemaPath=p,c.errSchemaPath=_,t+=" var "+E+" = errors;  ";var S=e.compositeRule;e.compositeRule=c.compositeRule=!0,c.createErrors=!1;var v;c.opts.allErrors&&(v=c.opts.allErrors,c.opts.allErrors=!1),t+=" "+e.validate(c)+" ",c.createErrors=!0,v&&(c.opts.allErrors=v),e.compositeRule=c.compositeRule=S,t+=" if ("+h+") {   ";var R=R||[];R.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var $=t;t=R.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+$+"]); ":t+=" validate.errors = ["+$+"]; return false; ":t+=" var err = "+$+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  errors = "+E+"; if (vErrors !== null) { if ("+E+") vErrors.length = "+E+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else t+="  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",y&&(t+=" if (false) { ");return t}}),Wn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c="errs__"+o,h=e.util.copy(e),S="";h.level++;var v="valid"+h.level,R=h.baseId,$="prevValid"+o,I="passingSchemas"+o;t+="var "+c+" = errors , "+$+" = false , "+E+" = false , "+I+" = null; ";var w=e.compositeRule;e.compositeRule=h.compositeRule=!0;var O=u;if(O)for(var k,D=-1,j=O.length-1;D<j;)k=O[D+=1],(e.opts.strictKeywords?typeof k=="object"&&Object.keys(k).length>0||k===!1:e.util.schemaHasRules(k,e.RULES.all))?(h.schema=k,h.schemaPath=p+"["+D+"]",h.errSchemaPath=_+"/"+D,t+="  "+e.validate(h)+" ",h.baseId=R):t+=" var "+v+" = true; ",D&&(t+=" if ("+v+" && "+$+") { "+E+" = false; "+I+" = ["+I+", "+D+"]; } else { ",S+="}"),t+=" if ("+v+") { "+E+" = "+$+" = true; "+I+" = "+D+"; }";return e.compositeRule=h.compositeRule=w,t+=""+S+"if (!"+E+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { passingSchemas: "+I+" } ",e.opts.messages!==!1&&(t+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&y&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+="} else {  errors = "+c+"; if (vErrors !== null) { if ("+c+") vErrors.length = "+c+"; else vErrors = null; }",e.opts.allErrors&&(t+=" } "),t}}),Kn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E=e.opts.$data&&u&&u.$data,c;E?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",c="schema"+o):c=u;var h=E?"(new RegExp("+c+"))":e.usePattern(u);t+="if ( ",E&&(t+=" ("+c+" !== undefined && typeof "+c+" != 'string') || "),t+=" !"+h+".test("+m+") ) {   ";var S=S||[];S.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { pattern:  ",E?t+=""+c:t+=""+e.util.toQuotedString(u),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match pattern "`,E?t+="' + "+c+" + '":t+=""+e.util.escapeQuotes(u),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",E?t+="validate.schema"+p:t+=""+e.util.toQuotedString(u),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var v=t;return t=S.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+v+"]); ":t+=" validate.errors = ["+v+"]; return false; ":t+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",y&&(t+=" else { "),t}}),Jn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="errs__"+o,c=e.util.copy(e),h="";c.level++;var S="valid"+c.level,v="key"+o,R="idx"+o,$=c.dataLevel=e.dataLevel+1,I="data"+$,w="dataProperties"+o,O=Object.keys(u||{}).filter(Q),k=e.schema.patternProperties||{},D=Object.keys(k).filter(Q),j=e.schema.additionalProperties,A=O.length||D.length,P=j===!1,T=typeof j=="object"&&Object.keys(j).length,L=e.opts.removeAdditional,F=P||T||L,H=e.opts.ownProperties,Z=e.baseId,oe=e.schema.required;if(oe&&!(e.opts.$data&&oe.$data)&&oe.length<e.opts.loopRequired)var J=e.util.toHash(oe);function Q(er){return er!=="__proto__"}if(t+="var "+E+" = errors;var "+S+" = true;",H&&(t+=" var "+w+" = undefined;"),F){if(H?t+=" "+w+" = "+w+" || Object.keys("+m+"); for (var "+R+"=0; "+R+"<"+w+".length; "+R+"++) { var "+v+" = "+w+"["+R+"]; ":t+=" for (var "+v+" in "+m+") { ",A){if(t+=" var isAdditional"+o+" = !(false ",O.length)if(O.length>8)t+=" || validate.schema"+p+".hasOwnProperty("+v+") ";else{var K=O;if(K)for(var Y,ke=-1,Ae=K.length-1;ke<Ae;)Y=K[ke+=1],t+=" || "+v+" == "+e.util.toQuotedString(Y)+" "}if(D.length){var Ce=D;if(Ce)for(var pe,_e=-1,x=Ce.length-1;_e<x;)pe=Ce[_e+=1],t+=" || "+e.usePattern(pe)+".test("+v+") "}t+=" ); if (isAdditional"+o+") { "}if(L=="all")t+=" delete "+m+"["+v+"]; ";else{var M=e.errorPath,X="' + "+v+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers)),P)if(L)t+=" delete "+m+"["+v+"]; ";else{t+=" "+S+" = false; ";var ne=_;_=e.errSchemaPath+"/additionalProperties";var U=U||[];U.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { additionalProperty: '"+X+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is an invalid additional property":t+="should NOT have additional properties",t+="' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var z=t;t=U.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+z+"]); ":t+=" validate.errors = ["+z+"]; return false; ":t+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",_=ne,y&&(t+=" break; ")}else if(T)if(L=="failing"){t+=" var "+E+" = errors;  ";var ce=e.compositeRule;e.compositeRule=c.compositeRule=!0,c.schema=j,c.schemaPath=e.schemaPath+".additionalProperties",c.errSchemaPath=e.errSchemaPath+"/additionalProperties",c.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers);var de=m+"["+v+"]";c.dataPathArr[$]=v;var ae=e.validate(c);c.baseId=Z,e.util.varOccurences(ae,I)<2?t+=" "+e.util.varReplace(ae,I,de)+" ":t+=" var "+I+" = "+de+"; "+ae+" ",t+=" if (!"+S+") { errors = "+E+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+m+"["+v+"]; }  ",e.compositeRule=c.compositeRule=ce}else{c.schema=j,c.schemaPath=e.schemaPath+".additionalProperties",c.errSchemaPath=e.errSchemaPath+"/additionalProperties",c.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers);var de=m+"["+v+"]";c.dataPathArr[$]=v;var ae=e.validate(c);c.baseId=Z,e.util.varOccurences(ae,I)<2?t+=" "+e.util.varReplace(ae,I,de)+" ":t+=" var "+I+" = "+de+"; "+ae+" ",y&&(t+=" if (!"+S+") break; ")}e.errorPath=M}A&&(t+=" } "),t+=" }  ",y&&(t+=" if ("+S+") { ",h+="}")}var Se=e.opts.useDefaults&&!e.compositeRule;if(O.length){var Te=O;if(Te)for(var Y,ve=-1,$e=Te.length-1;ve<$e;){Y=Te[ve+=1];var Oe=u[Y];if(e.opts.strictKeywords?typeof Oe=="object"&&Object.keys(Oe).length>0||Oe===!1:e.util.schemaHasRules(Oe,e.RULES.all)){var je=e.util.getProperty(Y),de=m+je,Pe=Se&&Oe.default!==void 0;c.schema=Oe,c.schemaPath=p+je,c.errSchemaPath=_+"/"+e.util.escapeFragment(Y),c.errorPath=e.util.getPath(e.errorPath,Y,e.opts.jsonPointers),c.dataPathArr[$]=e.util.toQuotedString(Y);var ae=e.validate(c);if(c.baseId=Z,e.util.varOccurences(ae,I)<2){ae=e.util.varReplace(ae,I,de);var De=de}else{var De=I;t+=" var "+I+" = "+de+"; "}if(Pe)t+=" "+ae+" ";else{if(J&&J[Y]){t+=" if ( "+De+" === undefined ",H&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(Y)+"') "),t+=") { "+S+" = false; ";var M=e.errorPath,ne=_,Ge=e.util.escapeQuotes(Y);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(M,Y,e.opts.jsonPointers)),_=e.errSchemaPath+"/required";var U=U||[];U.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+Ge+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+Ge+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var z=t;t=U.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+z+"]); ":t+=" validate.errors = ["+z+"]; return false; ":t+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",_=ne,e.errorPath=M,t+=" } else { "}else y?(t+=" if ( "+De+" === undefined ",H&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(Y)+"') "),t+=") { "+S+" = true; } else { "):(t+=" if ("+De+" !== undefined ",H&&(t+=" &&   Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(Y)+"') "),t+=" ) { ");t+=" "+ae+" } "}}y&&(t+=" if ("+S+") { ",h+="}")}}if(D.length){var qe=D;if(qe)for(var pe,Et=-1,Ft=qe.length-1;Et<Ft;){pe=qe[Et+=1];var Oe=k[pe];if(e.opts.strictKeywords?typeof Oe=="object"&&Object.keys(Oe).length>0||Oe===!1:e.util.schemaHasRules(Oe,e.RULES.all)){c.schema=Oe,c.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(pe),c.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(pe),H?t+=" "+w+" = "+w+" || Object.keys("+m+"); for (var "+R+"=0; "+R+"<"+w+".length; "+R+"++) { var "+v+" = "+w+"["+R+"]; ":t+=" for (var "+v+" in "+m+") { ",t+=" if ("+e.usePattern(pe)+".test("+v+")) { ",c.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers);var de=m+"["+v+"]";c.dataPathArr[$]=v;var ae=e.validate(c);c.baseId=Z,e.util.varOccurences(ae,I)<2?t+=" "+e.util.varReplace(ae,I,de)+" ":t+=" var "+I+" = "+de+"; "+ae+" ",y&&(t+=" if (!"+S+") break; "),t+=" } ",y&&(t+=" else "+S+" = true; "),t+=" }  ",y&&(t+=" if ("+S+") { ",h+="}")}}}return y&&(t+=" "+h+" if ("+E+" == errors) {"),t}}),Yn=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="errs__"+o,c=e.util.copy(e),h="";c.level++;var S="valid"+c.level;if(t+="var "+E+" = errors;",e.opts.strictKeywords?typeof u=="object"&&Object.keys(u).length>0||u===!1:e.util.schemaHasRules(u,e.RULES.all)){c.schema=u,c.schemaPath=p,c.errSchemaPath=_;var v="key"+o,R="idx"+o,$="i"+o,I="' + "+v+" + '",w=c.dataLevel=e.dataLevel+1,O="data"+w,k="dataProperties"+o,D=e.opts.ownProperties,j=e.baseId;D&&(t+=" var "+k+" = undefined; "),D?t+=" "+k+" = "+k+" || Object.keys("+m+"); for (var "+R+"=0; "+R+"<"+k+".length; "+R+"++) { var "+v+" = "+k+"["+R+"]; ":t+=" for (var "+v+" in "+m+") { ",t+=" var startErrs"+o+" = errors; ";var A=v,P=e.compositeRule;e.compositeRule=c.compositeRule=!0;var T=e.validate(c);c.baseId=j,e.util.varOccurences(T,O)<2?t+=" "+e.util.varReplace(T,O,A)+" ":t+=" var "+O+" = "+A+"; "+T+" ",e.compositeRule=c.compositeRule=P,t+=" if (!"+S+") { for (var "+$+"=startErrs"+o+"; "+$+"<errors; "+$+"++) { vErrors["+$+"].propertyName = "+v+"; }   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { propertyName: '"+I+"' } ",e.opts.messages!==!1&&(t+=" , message: 'property name \\'"+I+"\\' is invalid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&y&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),y&&(t+=" break; "),t+=" } }"}return y&&(t+=" "+h+" if ("+E+" == errors) {"),t}}),ei=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c=e.opts.$data&&u&&u.$data,h;c?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",h="schema"+o):h=u;var S="schema"+o;if(!c)if(u.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var v=[],R=u;if(R)for(var $,I=-1,w=R.length-1;I<w;){$=R[I+=1];var O=e.schema.properties[$];O&&(e.opts.strictKeywords?typeof O=="object"&&Object.keys(O).length>0||O===!1:e.util.schemaHasRules(O,e.RULES.all))||(v[v.length]=$)}}else var v=u;if(c||v.length){var k=e.errorPath,D=c||v.length>=e.opts.loopRequired,j=e.opts.ownProperties;if(y)if(t+=" var missing"+o+"; ",D){c||(t+=" var "+S+" = validate.schema"+p+"; ");var A="i"+o,P="schema"+o+"["+A+"]",T="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(k,P,e.opts.jsonPointers)),t+=" var "+E+" = true; ",c&&(t+=" if (schema"+o+" === undefined) "+E+" = true; else if (!Array.isArray(schema"+o+")) "+E+" = false; else {"),t+=" for (var "+A+" = 0; "+A+" < "+S+".length; "+A+"++) { "+E+" = "+m+"["+S+"["+A+"]] !== undefined ",j&&(t+=" &&   Object.prototype.hasOwnProperty.call("+m+", "+S+"["+A+"]) "),t+="; if (!"+E+") break; } ",c&&(t+="  }  "),t+="  if (!"+E+") {   ";var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+T+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+T+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var F=t;t=L.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+F+"]); ":t+=" validate.errors = ["+F+"]; return false; ":t+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else{t+=" if ( ";var H=v;if(H)for(var Z,A=-1,oe=H.length-1;A<oe;){Z=H[A+=1],A&&(t+=" || ");var J=e.util.getProperty(Z),Q=m+J;t+=" ( ( "+Q+" === undefined ",j&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(Z)+"') "),t+=") && (missing"+o+" = "+e.util.toQuotedString(e.opts.jsonPointers?Z:J)+") ) "}t+=") {  ";var P="missing"+o,T="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(k,P,!0):k+" + "+P);var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+T+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+T+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var F=t;t=L.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+F+"]); ":t+=" validate.errors = ["+F+"]; return false; ":t+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else if(D){c||(t+=" var "+S+" = validate.schema"+p+"; ");var A="i"+o,P="schema"+o+"["+A+"]",T="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(k,P,e.opts.jsonPointers)),c&&(t+=" if ("+S+" && !Array.isArray("+S+")) {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+T+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+T+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+S+" !== undefined) { "),t+=" for (var "+A+" = 0; "+A+" < "+S+".length; "+A+"++) { if ("+m+"["+S+"["+A+"]] === undefined ",j&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", "+S+"["+A+"]) "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+T+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+T+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",c&&(t+="  }  ")}else{var K=v;if(K)for(var Z,Y=-1,ke=K.length-1;Y<ke;){Z=K[Y+=1];var J=e.util.getProperty(Z),T=e.util.escapeQuotes(Z),Q=m+J;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(k,Z,e.opts.jsonPointers)),t+=" if ( "+Q+" === undefined ",j&&(t+=" || ! Object.prototype.hasOwnProperty.call("+m+", '"+e.util.escapeQuotes(Z)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { missingProperty: '"+T+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+T+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=k}else y&&(t+=" if (true) {");return t}}),ri=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m="data"+(d||""),E="valid"+o,c=e.opts.$data&&u&&u.$data,h;if(c?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",h="schema"+o):h=u,(u||c)&&e.opts.uniqueItems!==!1){c&&(t+=" var "+E+"; if ("+h+" === false || "+h+" === undefined) "+E+" = true; else if (typeof "+h+" != 'boolean') "+E+" = false; else { "),t+=" var i = "+m+".length , "+E+" = true , j; if (i > 1) { ";var S=e.schema.items&&e.schema.items.type,v=Array.isArray(S);if(!S||S=="object"||S=="array"||v&&(S.indexOf("object")>=0||S.indexOf("array")>=0))t+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+m+"[i], "+m+"[j])) { "+E+" = false; break outer; } } } ";else{t+=" var itemIndices = {}, item; for (;i--;) { var item = "+m+"[i]; ";var R="checkDataType"+(v?"s":"");t+=" if ("+e.util[R](S,"item",e.opts.strictNumbers,!0)+") continue; ",v&&(t+=` if (typeof item == 'string') item = '"' + item; `),t+=" if (typeof itemIndices[item] == 'number') { "+E+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}t+=" } ",c&&(t+="  }  "),t+=" if (!"+E+") {   ";var $=$||[];$.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(t+=" , schema:  ",c?t+="validate.schema"+p:t+=""+u,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var I=t;t=$.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+I+"]); ":t+=" validate.errors = ["+I+"]; return false; ":t+=" var err = "+I+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",y&&(t+=" else { ")}else y&&(t+=" if (true) { ");return t}}),ti=se((s,r)=>{r.exports={$ref:jn(),allOf:Mn(),anyOf:Fn(),$comment:Un(),const:qn(),contains:Hn(),dependencies:zn(),enum:Vn(),format:Zn(),if:Bn(),items:Gn(),maximum:Ua(),minimum:Ua(),maxItems:qa(),minItems:qa(),maxLength:Ha(),minLength:Ha(),maxProperties:za(),minProperties:za(),multipleOf:Xn(),not:Qn(),oneOf:Wn(),pattern:Kn(),properties:Jn(),propertyNames:Yn(),required:ei(),uniqueItems:ri(),validate:ss()}}),ai=se((s,r)=>{var a=ti(),e=rt().toHash;r.exports=function(){var i=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"],o=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],d=["number","integer","string","array","object","boolean","null"];return i.all=e(t),i.types=e(d),i.forEach(function(u){u.rules=u.rules.map(function(p){var _;if(typeof p=="object"){var y=Object.keys(p)[0];_=p[y],p=y,_.forEach(function(E){t.push(E),i.all[E]=!0})}t.push(p);var m=i.all[p]={keyword:p,code:a[p],implements:_};return m}),i.all.$comment={keyword:"$comment",code:a.$comment},u.type&&(i.types[u.type]=u)}),i.keywords=e(t.concat(o)),i.custom={},i}}),si=se((s,r)=>{var a=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];r.exports=function(e,n){for(var i=0;i<n.length;i++){e=JSON.parse(JSON.stringify(e));var t=n[i].split("/"),o=e,d;for(d=1;d<t.length;d++)o=o[t[d]];for(d=0;d<a.length;d++){var u=a[d],p=o[u];p&&(o[u]={anyOf:[p,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return e}}),ni=se((s,r)=>{var a=ca().MissingRef;r.exports=e;function e(n,i,t){var o=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof i=="function"&&(t=i,i=void 0);var d=u(n).then(function(){var _=o._addSchema(n,void 0,i);return _.validate||p(_)});return t&&d.then(function(_){t(null,_)},t),d;function u(_){var y=_.$schema;return y&&!o.getSchema(y)?e.call(o,{$ref:y},!0):Promise.resolve()}function p(_){try{return o._compile(_)}catch(m){if(m instanceof a)return y(m);throw m}function y(m){var E=m.missingSchema;if(S(E))throw new Error("Schema "+E+" is loaded but "+m.missingRef+" cannot be resolved");var c=o._loadingSchemas[E];return c||(c=o._loadingSchemas[E]=o._opts.loadSchema(E),c.then(h,h)),c.then(function(v){if(!S(E))return u(v).then(function(){S(E)||o.addSchema(v,E,void 0,i)})}).then(function(){return p(_)});function h(){delete o._loadingSchemas[E]}function S(v){return o._refs[v]||o._schemas[v]}}}}}),ii=se((s,r)=>{r.exports=function(e,n,i){var t=" ",o=e.level,d=e.dataLevel,u=e.schema[n],p=e.schemaPath+e.util.getProperty(n),_=e.errSchemaPath+"/"+n,y=!e.opts.allErrors,m,E="data"+(d||""),c="valid"+o,h="errs__"+o,S=e.opts.$data&&u&&u.$data,v;S?(t+=" var schema"+o+" = "+e.util.getData(u.$data,d,e.dataPathArr)+"; ",v="schema"+o):v=u;var R=this,$="definition"+o,I=R.definition,w="",O,k,D,j,A;if(S&&I.$data){A="keywordValidate"+o;var P=I.validateSchema;t+=" var "+$+" = RULES.custom['"+n+"'].definition; var "+A+" = "+$+".validate;"}else{if(j=e.useCustomRule(R,u,e.schema,e),!j)return;v="validate.schema"+p,A=j.code,O=I.compile,k=I.inline,D=I.macro}var T=A+".errors",L="i"+o,F="ruleErr"+o,H=I.async;if(H&&!e.async)throw new Error("async keyword in sync schema");if(k||D||(t+=""+T+" = null;"),t+="var "+h+" = errors;var "+c+";",S&&I.$data&&(w+="}",t+=" if ("+v+" === undefined) { "+c+" = true; } else { ",P&&(w+="}",t+=" "+c+" = "+$+".validateSchema("+v+"); if ("+c+") { ")),k)I.statements?t+=" "+j.validate+" ":t+=" "+c+" = "+j.validate+"; ";else if(D){var Z=e.util.copy(e),w="";Z.level++;var oe="valid"+Z.level;Z.schema=j.validate,Z.schemaPath="";var J=e.compositeRule;e.compositeRule=Z.compositeRule=!0;var Q=e.validate(Z).replace(/validate\.schema/g,A);e.compositeRule=Z.compositeRule=J,t+=" "+Q}else{var K=K||[];K.push(t),t="",t+="  "+A+".call( ",e.opts.passContext?t+="this":t+="self",O||I.schema===!1?t+=" , "+E+" ":t+=" , "+v+" , "+E+" , validate.schema"+e.schemaPath+" ",t+=" , (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var Y=d?"data"+(d-1||""):"parentData",ke=d?e.dataPathArr[d]:"parentDataProperty";t+=" , "+Y+" , "+ke+" , rootData )  ";var Ae=t;t=K.pop(),I.errors===!1?(t+=" "+c+" = ",H&&(t+="await "),t+=""+Ae+"; "):H?(T="customErrors"+o,t+=" var "+T+" = null; try { "+c+" = await "+Ae+"; } catch (e) { "+c+" = false; if (e instanceof ValidationError) "+T+" = e.errors; else throw e; } "):t+=" "+T+" = null; "+c+" = "+Ae+"; "}if(I.modifying&&(t+=" if ("+Y+") "+E+" = "+Y+"["+ke+"];"),t+=""+w,I.valid)y&&(t+=" if (true) { ");else{t+=" if ( ",I.valid===void 0?(t+=" !",D?t+=""+oe:t+=""+c):t+=" "+!I.valid+" ",t+=") { ",m=R.keyword;var K=K||[];K.push(t),t="";var K=K||[];K.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(m||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { keyword: '"+R.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+R.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+E+" "),t+=" } "):t+=" {} ";var Ce=t;t=K.pop(),!e.compositeRule&&y?e.async?t+=" throw new ValidationError(["+Ce+"]); ":t+=" validate.errors = ["+Ce+"]; return false; ":t+=" var err = "+Ce+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var pe=t;t=K.pop(),k?I.errors?I.errors!="full"&&(t+="  for (var "+L+"="+h+"; "+L+"<errors; "+L+"++) { var "+F+" = vErrors["+L+"]; if ("+F+".dataPath === undefined) "+F+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+F+".schemaPath === undefined) { "+F+'.schemaPath = "'+_+'"; } ',e.opts.verbose&&(t+=" "+F+".schema = "+v+"; "+F+".data = "+E+"; "),t+=" } "):I.errors===!1?t+=" "+pe+" ":(t+=" if ("+h+" == errors) { "+pe+" } else {  for (var "+L+"="+h+"; "+L+"<errors; "+L+"++) { var "+F+" = vErrors["+L+"]; if ("+F+".dataPath === undefined) "+F+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+F+".schemaPath === undefined) { "+F+'.schemaPath = "'+_+'"; } ',e.opts.verbose&&(t+=" "+F+".schema = "+v+"; "+F+".data = "+E+"; "),t+=" } } "):D?(t+="   var err =   ",e.createErrors!==!1?(t+=" { keyword: '"+(m||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { keyword: '"+R.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+R.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+E+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&y&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; ")):I.errors===!1?t+=" "+pe+" ":(t+=" if (Array.isArray("+T+")) { if (vErrors === null) vErrors = "+T+"; else vErrors = vErrors.concat("+T+"); errors = vErrors.length;  for (var "+L+"="+h+"; "+L+"<errors; "+L+"++) { var "+F+" = vErrors["+L+"]; if ("+F+".dataPath === undefined) "+F+".dataPath = (dataPath || '') + "+e.errorPath+";  "+F+'.schemaPath = "'+_+'";  ',e.opts.verbose&&(t+=" "+F+".schema = "+v+"; "+F+".data = "+E+"; "),t+=" } } else { "+pe+" } "),t+=" } ",y&&(t+=" else { ")}return t}}),ns=se((s,r)=>{r.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}}),oi=se((s,r)=>{var a=ns();r.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:a.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:a.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}}),li=se((s,r)=>{var a=/^[a-z_$][a-z0-9_$-]*$/i,e=ii(),n=oi();r.exports={add:i,get:t,remove:o,validate:d};function i(u,p){var _=this.RULES;if(_.keywords[u])throw new Error("Keyword "+u+" is already defined");if(!a.test(u))throw new Error("Keyword "+u+" is not a valid identifier");if(p){this.validateKeyword(p,!0);var y=p.type;if(Array.isArray(y))for(var m=0;m<y.length;m++)c(u,y[m],p);else c(u,y,p);var E=p.metaSchema;E&&(p.$data&&this._opts.$data&&(E={anyOf:[E,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),p.validateSchema=this.compile(E,!0))}_.keywords[u]=_.all[u]=!0;function c(h,S,v){for(var R,$=0;$<_.length;$++){var I=_[$];if(I.type==S){R=I;break}}R||(R={type:S,rules:[]},_.push(R));var w={keyword:h,definition:v,custom:!0,code:e,implements:v.implements};R.rules.push(w),_.custom[h]=w}return this}function t(u){var p=this.RULES.custom[u];return p?p.definition:this.RULES.keywords[u]||!1}function o(u){var p=this.RULES;delete p.keywords[u],delete p.all[u],delete p.custom[u];for(var _=0;_<p.length;_++)for(var y=p[_].rules,m=0;m<y.length;m++)if(y[m].keyword==u){y.splice(m,1);break}return this}function d(u,p){d.errors=null;var _=this._validateKeyword=this._validateKeyword||this.compile(n,!0);if(_(u))return!0;if(d.errors=_.errors,p)throw new Error("custom keyword definition is invalid: "+this.errorsText(_.errors));return!1}}),ui=se((s,r)=>{r.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}}),ci=se((s,r)=>{var a=Dn(),e=ua(),n=$n(),i=ts(),t=as(),o=Ln(),d=ai(),u=si(),p=rt();r.exports=h,h.prototype.validate=S,h.prototype.compile=v,h.prototype.addSchema=R,h.prototype.addMetaSchema=$,h.prototype.validateSchema=I,h.prototype.getSchema=O,h.prototype.removeSchema=j,h.prototype.addFormat=J,h.prototype.errorsText=oe,h.prototype._addSchema=P,h.prototype._compile=T,h.prototype.compileAsync=ni();var _=li();h.prototype.addKeyword=_.add,h.prototype.getKeyword=_.get,h.prototype.removeKeyword=_.remove,h.prototype.validateKeyword=_.validate;var y=ca();h.ValidationError=y.Validation,h.MissingRefError=y.MissingRef,h.$dataMetaSchema=u;var m="http://json-schema.org/draft-07/schema",E=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],c=["/properties"];function h(x){if(!(this instanceof h))return new h(x);x=this._opts=p.copy(x)||{},pe(this),this._schemas={},this._refs={},this._fragments={},this._formats=o(x.format),this._cache=x.cache||new n,this._loadingSchemas={},this._compilations=[],this.RULES=d(),this._getId=L(x),x.loopRequired=x.loopRequired||1/0,x.errorDataPath=="property"&&(x._errorDataPathProperty=!0),x.serialize===void 0&&(x.serialize=t),this._metaOpts=Ce(this),x.formats&&Y(this),x.keywords&&ke(this),Q(this),typeof x.meta=="object"&&this.addMetaSchema(x.meta),x.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),K(this)}function S(x,M){var X;if(typeof x=="string"){if(X=this.getSchema(x),!X)throw new Error('no schema with key or ref "'+x+'"')}else{var ne=this._addSchema(x);X=ne.validate||this._compile(ne)}var U=X(M);return X.$async!==!0&&(this.errors=X.errors),U}function v(x,M){var X=this._addSchema(x,void 0,M);return X.validate||this._compile(X)}function R(x,M,X,ne){if(Array.isArray(x)){for(var U=0;U<x.length;U++)this.addSchema(x[U],void 0,X,ne);return this}var z=this._getId(x);if(z!==void 0&&typeof z!="string")throw new Error("schema id must be string");return M=e.normalizeId(M||z),Ae(this,M),this._schemas[M]=this._addSchema(x,X,ne,!0),this}function $(x,M,X){return this.addSchema(x,M,X,!0),this}function I(x,M){var X=x.$schema;if(X!==void 0&&typeof X!="string")throw new Error("$schema must be a string");if(X=X||this._opts.defaultMeta||w(this),!X)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var ne=this.validate(X,x);if(!ne&&M){var U="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(U);else throw new Error(U)}return ne}function w(x){var M=x._opts.meta;return x._opts.defaultMeta=typeof M=="object"?x._getId(M)||M:x.getSchema(m)?m:void 0,x._opts.defaultMeta}function O(x){var M=D(this,x);switch(typeof M){case"object":return M.validate||this._compile(M);case"string":return this.getSchema(M);case"undefined":return k(this,x)}}function k(x,M){var X=e.schema.call(x,{schema:{}},M);if(X){var{schema:ne,root:U,baseId:z}=X,ce=a.call(x,ne,U,void 0,z);return x._fragments[M]=new i({ref:M,fragment:!0,schema:ne,root:U,baseId:z,validate:ce}),ce}}function D(x,M){return M=e.normalizeId(M),x._schemas[M]||x._refs[M]||x._fragments[M]}function j(x){if(x instanceof RegExp)return A(this,this._schemas,x),A(this,this._refs,x),this;switch(typeof x){case"undefined":return A(this,this._schemas),A(this,this._refs),this._cache.clear(),this;case"string":var M=D(this,x);return M&&this._cache.del(M.cacheKey),delete this._schemas[x],delete this._refs[x],this;case"object":var X=this._opts.serialize,ne=X?X(x):x;this._cache.del(ne);var U=this._getId(x);U&&(U=e.normalizeId(U),delete this._schemas[U],delete this._refs[U])}return this}function A(x,M,X){for(var ne in M){var U=M[ne];!U.meta&&(!X||X.test(ne))&&(x._cache.del(U.cacheKey),delete M[ne])}}function P(x,M,X,ne){if(typeof x!="object"&&typeof x!="boolean")throw new Error("schema should be object or boolean");var U=this._opts.serialize,z=U?U(x):x,ce=this._cache.get(z);if(ce)return ce;ne=ne||this._opts.addUsedSchema!==!1;var de=e.normalizeId(this._getId(x));de&&ne&&Ae(this,de);var ae=this._opts.validateSchema!==!1&&!M,Se;ae&&!(Se=de&&de==e.normalizeId(x.$schema))&&this.validateSchema(x,!0);var Te=e.ids.call(this,x),ve=new i({id:de,schema:x,localRefs:Te,cacheKey:z,meta:X});return de[0]!="#"&&ne&&(this._refs[de]=ve),this._cache.put(z,ve),ae&&Se&&this.validateSchema(x,!0),ve}function T(x,M){if(x.compiling)return x.validate=U,U.schema=x.schema,U.errors=null,U.root=M||U,x.schema.$async===!0&&(U.$async=!0),U;x.compiling=!0;var X;x.meta&&(X=this._opts,this._opts=this._metaOpts);var ne;try{ne=a.call(this,x.schema,M,x.localRefs)}catch(z){throw delete x.validate,z}finally{x.compiling=!1,x.meta&&(this._opts=X)}return x.validate=ne,x.refs=ne.refs,x.refVal=ne.refVal,x.root=ne.root,ne;function U(){var z=x.validate,ce=z.apply(this,arguments);return U.errors=z.errors,ce}}function L(x){switch(x.schemaId){case"auto":return Z;case"id":return F;default:return H}}function F(x){return x.$id&&this.logger.warn("schema $id ignored",x.$id),x.id}function H(x){return x.id&&this.logger.warn("schema id ignored",x.id),x.$id}function Z(x){if(x.$id&&x.id&&x.$id!=x.id)throw new Error("schema $id is different from id");return x.$id||x.id}function oe(x,M){if(x=x||this.errors,!x)return"No errors";M=M||{};for(var X=M.separator===void 0?", ":M.separator,ne=M.dataVar===void 0?"data":M.dataVar,U="",z=0;z<x.length;z++){var ce=x[z];ce&&(U+=ne+ce.dataPath+" "+ce.message+X)}return U.slice(0,-X.length)}function J(x,M){return typeof M=="string"&&(M=new RegExp(M)),this._formats[x]=M,this}function Q(x){var M;if(x._opts.$data&&(M=ui(),x.addMetaSchema(M,M.$id,!0)),x._opts.meta!==!1){var X=ns();x._opts.$data&&(X=u(X,c)),x.addMetaSchema(X,m,!0),x._refs["http://json-schema.org/schema"]=m}}function K(x){var M=x._opts.schemas;if(M)if(Array.isArray(M))x.addSchema(M);else for(var X in M)x.addSchema(M[X],X)}function Y(x){for(var M in x._opts.formats){var X=x._opts.formats[M];x.addFormat(M,X)}}function ke(x){for(var M in x._opts.keywords){var X=x._opts.keywords[M];x.addKeyword(M,X)}}function Ae(x,M){if(x._schemas[M]||x._refs[M])throw new Error('schema with key or id "'+M+'" already exists')}function Ce(x){for(var M=p.copy(x._opts),X=0;X<E.length;X++)delete M[E[X]];return M}function pe(x){var M=x._opts.logger;if(M===!1)x.logger={log:_e,warn:_e,error:_e};else{if(M===void 0&&(M=console),!(typeof M=="object"&&M.log&&M.warn&&M.error))throw new Error("logger must implement log, warn and error methods");x.logger=M}}function _e(){}}),hi=50;function is(s=hi){let r=new AbortController;return fi(s,r.signal),r}var gi={cwd(){return process.cwd()},existsSync(s){return te.existsSync(s)},async stat(s){return vi(s)},statSync(s){return te.statSync(s)},readFileSync(s,r){return te.readFileSync(s,{encoding:r.encoding})},readFileBytesSync(s){return te.readFileSync(s)},readSync(s,r){let a;try{a=te.openSync(s,"r");let e=Buffer.alloc(r.length),n=te.readSync(a,e,0,r.length,0);return{buffer:e,bytesRead:n}}finally{a&&te.closeSync(a)}},writeFileSync(s,r,a){if(!a.flush){let n={encoding:a.encoding};a.mode!==void 0&&(n.mode=a.mode),te.writeFileSync(s,r,n);return}let e;try{let n=a.mode!==void 0?a.mode:void 0;e=te.openSync(s,"w",n),te.writeFileSync(e,r,{encoding:a.encoding}),te.fsyncSync(e)}finally{e&&te.closeSync(e)}},appendFileSync(s,r){te.appendFileSync(s,r)},copyFileSync(s,r){te.copyFileSync(s,r)},unlinkSync(s){te.unlinkSync(s)},renameSync(s,r){te.renameSync(s,r)},linkSync(s,r){te.linkSync(s,r)},symlinkSync(s,r){te.symlinkSync(s,r)},readlinkSync(s){return te.readlinkSync(s)},realpathSync(s){return te.realpathSync(s)},mkdirSync(s){te.existsSync(s)||te.mkdirSync(s,{recursive:!0,mode:448})},readdirSync(s){return te.readdirSync(s,{withFileTypes:!0})},readdirStringSync(s){return te.readdirSync(s)},isDirEmptySync(s){return this.readdirSync(s).length===0},rmdirSync(s){te.rmdirSync(s)},rmSync(s,r){te.rmSync(s,r)},createWriteStream(s){return te.createWriteStream(s)}},_i=gi;function pr(){return _i}var Tr=class extends Error{};function os(){return process.versions.bun!==void 0}var Jt=class{options;child;childStdin;childStdout;ready=!1;abortController;exitError;exitListeners=[];processExitHandler;abortHandler;constructor(r){this.options=r,this.abortController=r.abortController||is(),this.initialize()}initialize(){try{let{additionalDirectories:r=[],agents:a,cwd:e,executable:n=os()?"bun":"node",executableArgs:i=[],extraArgs:t={},pathToClaudeCodeExecutable:o,env:d={...process.env},stderr:u,customSystemPrompt:p,appendSystemPrompt:_,maxThinkingTokens:y,maxTurns:m,model:E,fallbackModel:c,permissionMode:h,allowDangerouslySkipPermissions:S,permissionPromptToolName:v,continueConversation:R,resume:$,settingSources:I,allowedTools:w=[],disallowedTools:O=[],mcpServers:k,strictMcpConfig:D,canUseTool:j,includePartialMessages:A,plugins:P}=this.options,T=["--output-format","stream-json","--verbose","--input-format","stream-json"];if(typeof p=="string"&&T.push("--system-prompt",p),_&&T.push("--append-system-prompt",_),y!==void 0&&T.push("--max-thinking-tokens",y.toString()),m&&T.push("--max-turns",m.toString()),E&&T.push("--model",E),d.DEBUG&&T.push("--debug-to-stderr"),j){if(v)throw new Error("canUseTool callback cannot be used with permissionPromptToolName. Please use one or the other.");T.push("--permission-prompt-tool","stdio")}else v&&T.push("--permission-prompt-tool",v);if(R&&T.push("--continue"),$&&T.push("--resume",$),w.length>0&&T.push("--allowedTools",w.join(",")),O.length>0&&T.push("--disallowedTools",O.join(",")),k&&Object.keys(k).length>0&&T.push("--mcp-config",JSON.stringify({mcpServers:k})),a&&Object.keys(a).length>0&&T.push("--agents",JSON.stringify(a)),I&&T.push("--setting-sources",I.join(",")),D&&T.push("--strict-mcp-config"),h&&T.push("--permission-mode",h),S&&T.push("--allow-dangerously-skip-permissions"),c){if(E&&c===E)throw new Error("Fallback model cannot be the same as the main model. Please specify a different model for fallbackModel option.");T.push("--fallback-model",c)}A&&T.push("--include-partial-messages");for(let Q of r)T.push("--add-dir",Q);if(P&&P.length>0)for(let Q of P)if(Q.type==="local")T.push("--plugin-dir",Q.path);else throw new Error(`Unsupported plugin type: ${Q.type}`);this.options.forkSession&&T.push("--fork-session"),this.options.resumeSessionAt&&T.push("--resume-session-at",this.options.resumeSessionAt);for(let[Q,K]of Object.entries(t))K===null?T.push(`--${Q}`):T.push(`--${Q}`,K);if(d.CLAUDE_CODE_ENTRYPOINT||(d.CLAUDE_CODE_ENTRYPOINT="sdk-ts"),!pr().existsSync(o)){let Q=Za(o)?`Claude Code native binary not found at ${o}. Please ensure Claude Code is installed via native installer or specify a valid path with options.pathToClaudeCodeExecutable.`:`Claude Code executable not found at ${o}. Is options.pathToClaudeCodeExecutable set?`;throw new ReferenceError(Q)}let F=Za(o),H=F?o:n,Z=F?[...i,...T]:[...i,o,...T];this.logForDebugging(F?`Spawning Claude Code native binary: ${H} ${Z.join(" ")}`:`Spawning Claude Code process: ${H} ${Z.join(" ")}`);let oe=d.DEBUG||u?"pipe":"ignore";this.child=pi(H,Z,{cwd:e,stdio:["pipe","pipe",oe],signal:this.abortController.signal,env:d}),this.childStdin=this.child.stdin,this.childStdout=this.child.stdout,(d.DEBUG||u)&&this.child.stderr.on("data",Q=>{this.logForDebugging(Q.toString())});let J=()=>{this.child&&!this.child.killed&&this.child.kill("SIGTERM")};this.processExitHandler=J,this.abortHandler=J,process.on("exit",this.processExitHandler),this.abortController.signal.addEventListener("abort",this.abortHandler),this.child.on("error",Q=>{this.ready=!1,this.abortController.signal.aborted?this.exitError=new Tr("Claude Code process aborted by user"):(this.exitError=new Error(`Failed to spawn Claude Code process: ${Q.message}`),this.logForDebugging(this.exitError.message))}),this.child.on("close",(Q,K)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new Tr("Claude Code process aborted by user");else{let Y=this.getProcessExitError(Q,K);Y&&(this.exitError=Y,this.logForDebugging(Y.message))}}),this.ready=!0}catch(r){throw this.ready=!1,r}}getProcessExitError(r,a){if(r!==0&&r!==null)return new Error(`Claude Code process exited with code ${r}`);if(a)return new Error(`Claude Code process terminated by signal ${a}`)}logForDebugging(r){process.env.DEBUG&&process.stderr.write(`${r}
`),this.options.stderr&&this.options.stderr(r)}write(r){if(this.abortController.signal.aborted)throw new Tr("Operation aborted");if(!this.ready||!this.childStdin)throw new Error("ProcessTransport is not ready for writing");if(this.child?.killed||this.child?.exitCode!==null)throw new Error("Cannot write to terminated process");if(this.exitError)throw new Error(`Cannot write to process that exited with error: ${this.exitError.message}`);process.env.DEBUG_SDK&&process.stderr.write(`[ProcessTransport] Writing to stdin: ${r.substring(0,100)}
`);try{!this.childStdin.write(r)&&process.env.DEBUG_SDK&&console.warn("[ProcessTransport] Write buffer full, data queued")}catch(a){throw this.ready=!1,new Error(`Failed to write to process stdin: ${a.message}`)}}close(){this.childStdin&&(this.childStdin.end(),this.childStdin=void 0),this.processExitHandler&&(process.off("exit",this.processExitHandler),this.processExitHandler=void 0),this.abortHandler&&(this.abortController.signal.removeEventListener("abort",this.abortHandler),this.abortHandler=void 0);for(let{handler:r}of this.exitListeners)this.child?.off("exit",r);this.exitListeners=[],this.child&&!this.child.killed&&(this.child.kill("SIGTERM"),setTimeout(()=>{this.child&&!this.child.killed&&this.child.kill("SIGKILL")},5e3)),this.ready=!1}isReady(){return this.ready}async*readMessages(){if(!this.childStdout)throw new Error("ProcessTransport output stream not available");let r=mi({input:this.childStdout});try{for await(let a of r)a.trim()&&(yield JSON.parse(a));await this.waitForExit()}catch(a){throw a}finally{r.close()}}endInput(){this.childStdin&&this.childStdin.end()}getInputStream(){return this.childStdin}onExit(r){if(!this.child)return()=>{};let a=(e,n)=>{let i=this.getProcessExitError(e,n);r(i)};return this.child.on("exit",a),this.exitListeners.push({callback:r,handler:a}),()=>{this.child&&this.child.off("exit",a);let e=this.exitListeners.findIndex(n=>n.handler===a);e!==-1&&this.exitListeners.splice(e,1)}}async waitForExit(){if(!this.child){if(this.exitError)throw this.exitError;return}if(this.child.exitCode!==null||this.child.killed){if(this.exitError)throw this.exitError;return}return new Promise((r,a)=>{let e=(i,t)=>{if(this.abortController.signal.aborted){a(new Tr("Operation aborted"));return}let o=this.getProcessExitError(i,t);o?a(o):r()};this.child.once("exit",e);let n=i=>{this.child.off("exit",e),a(i)};this.child.once("error",n),this.child.once("exit",()=>{this.child.off("error",n)})})}};function Za(s){return![".js",".mjs",".tsx",".ts",".jsx"].some(a=>s.endsWith(a))}var Yt=class{returned;queue=[];readResolve;readReject;isDone=!1;hasError;started=!1;constructor(r){this.returned=r}[Symbol.asyncIterator](){if(this.started)throw new Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((r,a)=>{this.readResolve=r,this.readReject=a})}enqueue(r){if(this.readResolve){let a=this.readResolve;this.readResolve=void 0,this.readReject=void 0,a({done:!1,value:r})}else this.queue.push(r)}done(){if(this.isDone=!0,this.readResolve){let r=this.readResolve;this.readResolve=void 0,this.readReject=void 0,r({done:!0,value:void 0})}}error(r){if(this.hasError=r,this.readReject){let a=this.readReject;this.readResolve=void 0,this.readReject=void 0,a(r)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}},ea=class{sendMcpMessage;isClosed=!1;constructor(r){this.sendMcpMessage=r}onclose;onerror;onmessage;async start(){}async send(r){if(this.isClosed)throw new Error("Transport is closed");this.sendMcpMessage(r)}async close(){this.isClosed||(this.isClosed=!0,this.onclose?.())}},yi=typeof global=="object"&&global&&global.Object===Object&&global,Ei=yi,bi=typeof self=="object"&&self&&self.Object===Object&&self,Si=Ei||bi||Function("return this")(),da=Si,Ti=da.Symbol,wt=Ti,ls=Object.prototype,Pi=ls.hasOwnProperty,Ri=ls.toString,ft=wt?wt.toStringTag:void 0;function wi(s){var r=Pi.call(s,ft),a=s[ft];try{s[ft]=void 0;var e=!0}catch{}var n=Ri.call(s);return e&&(r?s[ft]=a:delete s[ft]),n}var xi=wi,Oi=Object.prototype,Ci=Oi.toString;function Ii(s){return Ci.call(s)}var Ni=Ii,ki="[object Null]",Ai="[object Undefined]",Ba=wt?wt.toStringTag:void 0;function Di(s){return s==null?s===void 0?Ai:ki:Ba&&Ba in Object(s)?xi(s):Ni(s)}var $i=Di;function Li(s){var r=typeof s;return s!=null&&(r=="object"||r=="function")}var us=Li,ji="[object AsyncFunction]",Mi="[object Function]",Fi="[object GeneratorFunction]",Ui="[object Proxy]";function qi(s){if(!us(s))return!1;var r=$i(s);return r==Mi||r==Fi||r==ji||r==Ui}var Hi=qi,zi=da["__core-js_shared__"],Qt=zi,Ga=(function(){var s=/[^.]+$/.exec(Qt&&Qt.keys&&Qt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""})();function Vi(s){return!!Ga&&Ga in s}var Zi=Vi,Bi=Function.prototype,Gi=Bi.toString;function Xi(s){if(s!=null){try{return Gi.call(s)}catch{}try{return s+""}catch{}}return""}var Qi=Xi,Wi=/[\\^$.*+?()[\]{}|]/g,Ki=/^\[object .+?Constructor\]$/,Ji=Function.prototype,Yi=Object.prototype,eo=Ji.toString,ro=Yi.hasOwnProperty,to=RegExp("^"+eo.call(ro).replace(Wi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ao(s){if(!us(s)||Zi(s))return!1;var r=Hi(s)?to:Ki;return r.test(Qi(s))}var so=ao;function no(s,r){return s?.[r]}var io=no;function oo(s,r){var a=io(s,r);return so(a)?a:void 0}var cs=oo;function lo(s,r){return s===r||s!==s&&r!==r}var uo=lo,co=cs(Object,"create"),ht=co;function fo(){this.__data__=ht?ht(null):{},this.size=0}var ho=fo;function po(s){var r=this.has(s)&&delete this.__data__[s];return this.size-=r?1:0,r}var mo=po,vo="__lodash_hash_undefined__",go=Object.prototype,_o=go.hasOwnProperty;function yo(s){var r=this.__data__;if(ht){var a=r[s];return a===vo?void 0:a}return _o.call(r,s)?r[s]:void 0}var Eo=yo,bo=Object.prototype,So=bo.hasOwnProperty;function To(s){var r=this.__data__;return ht?r[s]!==void 0:So.call(r,s)}var Po=To,Ro="__lodash_hash_undefined__";function wo(s,r){var a=this.__data__;return this.size+=this.has(s)?0:1,a[s]=ht&&r===void 0?Ro:r,this}var xo=wo;function tt(s){var r=-1,a=s==null?0:s.length;for(this.clear();++r<a;){var e=s[r];this.set(e[0],e[1])}}tt.prototype.clear=ho;tt.prototype.delete=mo;tt.prototype.get=Eo;tt.prototype.has=Po;tt.prototype.set=xo;var Xa=tt;function Oo(){this.__data__=[],this.size=0}var Co=Oo;function Io(s,r){for(var a=s.length;a--;)if(uo(s[a][0],r))return a;return-1}var At=Io,No=Array.prototype,ko=No.splice;function Ao(s){var r=this.__data__,a=At(r,s);if(a<0)return!1;var e=r.length-1;return a==e?r.pop():ko.call(r,a,1),--this.size,!0}var Do=Ao;function $o(s){var r=this.__data__,a=At(r,s);return a<0?void 0:r[a][1]}var Lo=$o;function jo(s){return At(this.__data__,s)>-1}var Mo=jo;function Fo(s,r){var a=this.__data__,e=At(a,s);return e<0?(++this.size,a.push([s,r])):a[e][1]=r,this}var Uo=Fo;function at(s){var r=-1,a=s==null?0:s.length;for(this.clear();++r<a;){var e=s[r];this.set(e[0],e[1])}}at.prototype.clear=Co;at.prototype.delete=Do;at.prototype.get=Lo;at.prototype.has=Mo;at.prototype.set=Uo;var qo=at,Ho=cs(da,"Map"),zo=Ho;function Vo(){this.size=0,this.__data__={hash:new Xa,map:new(zo||qo),string:new Xa}}var Zo=Vo;function Bo(s){var r=typeof s;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?s!=="__proto__":s===null}var Go=Bo;function Xo(s,r){var a=s.__data__;return Go(r)?a[typeof r=="string"?"string":"hash"]:a.map}var Dt=Xo;function Qo(s){var r=Dt(this,s).delete(s);return this.size-=r?1:0,r}var Wo=Qo;function Ko(s){return Dt(this,s).get(s)}var Jo=Ko;function Yo(s){return Dt(this,s).has(s)}var el=Yo;function rl(s,r){var a=Dt(this,s),e=a.size;return a.set(s,r),this.size+=a.size==e?0:1,this}var tl=rl;function st(s){var r=-1,a=s==null?0:s.length;for(this.clear();++r<a;){var e=s[r];this.set(e[0],e[1])}}st.prototype.clear=Zo;st.prototype.delete=Wo;st.prototype.get=Jo;st.prototype.has=el;st.prototype.set=tl;var ds=st,al="Expected a function";function fa(s,r){if(typeof s!="function"||r!=null&&typeof r!="function")throw new TypeError(al);var a=function(){var e=arguments,n=r?r.apply(this,e):e[0],i=a.cache;if(i.has(n))return i.get(n);var t=s.apply(this,e);return a.cache=i.set(n,t)||i,t};return a.cache=new(fa.Cache||ds),a}fa.Cache=ds;var gt=fa,Qa=2e3;function sl(s){for(let r=0;r<s.length;r+=Qa)process.stderr.write(s.substring(r,r+Qa))}var nl=gt(s=>{if(!s||s.trim()==="")return null;let r=s.split(",").map(i=>i.trim()).filter(Boolean);if(r.length===0)return null;let a=r.some(i=>i.startsWith("!")),e=r.some(i=>!i.startsWith("!"));if(a&&e)return null;let n=r.map(i=>i.replace(/^!/,"").toLowerCase());return{include:a?[]:n,exclude:a?n:[],isExclusive:a}});function il(s){let r=[],a=s.match(/^MCP server ["']([^"']+)["']/);if(a&&a[1])r.push("mcp"),r.push(a[1].toLowerCase());else{let i=s.match(/^([^:[]+):/);i&&i[1]&&r.push(i[1].trim().toLowerCase())}let e=s.match(/^\[([^\]]+)]/);e&&e[1]&&r.push(e[1].trim().toLowerCase()),s.toLowerCase().includes("statsig event:")&&r.push("statsig");let n=s.match(/:\s*([^:]+?)(?:\s+(?:type|mode|status|event))?:/);if(n&&n[1]){let i=n[1].trim().toLowerCase();i.length<30&&!i.includes(" ")&&r.push(i)}return Array.from(new Set(r))}function ol(s,r){return r?s.length===0?!1:r.isExclusive?!s.some(a=>r.exclude.includes(a)):s.some(a=>r.include.includes(a)):!0}function ll(s,r){if(!r)return!0;let a=il(s);return ol(a,r)}function dl(){return process.env.CLAUDE_CONFIG_DIR??ul(cl(),".claude")}function Wa(s){if(!s)return!1;if(typeof s=="boolean")return s;let r=s.toLowerCase().trim();return["1","true","yes","on"].includes(r)}var hl={name:"BASH_MAX_OUTPUT_LENGTH",default:3e4,validate:s=>{if(!s)return{effective:3e4,status:"valid"};let e=parseInt(s,10);return isNaN(e)||e<=0?{effective:3e4,status:"invalid",message:`Invalid value "${s}" (using default: 30000)`}:e>15e4?{effective:15e4,status:"capped",message:`Capped from ${e} to 150000`}:{effective:e,status:"valid"}}},pl={name:"CLAUDE_CODE_MAX_OUTPUT_TOKENS",default:32e3,validate:s=>{if(!s)return{effective:32e3,status:"valid"};let r=parseInt(s,10);return isNaN(r)||r<=0?{effective:32e3,status:"invalid",message:`Invalid value "${s}" (using default: 32000)`}:r>32e3?{effective:32e3,status:"capped",message:`Capped from ${r} to 32000`}:{effective:r,status:"valid"}}};function ml(){return{originalCwd:Ka(),totalCostUSD:0,totalAPIDuration:0,totalAPIDurationWithoutRetries:0,totalToolDuration:0,startTime:Date.now(),lastInteractionTime:Date.now(),totalLinesAdded:0,totalLinesRemoved:0,hasUnknownModelCost:!1,cwd:Ka(),modelUsage:{},mainLoopModelOverride:void 0,maxRateLimitFallbackActive:!1,initialMainLoopModel:null,modelStrings:null,isNonInteractiveSession:!0,isInteractive:!1,clientType:"cli",sessionIngressToken:void 0,oauthTokenFromFd:void 0,apiKeyFromFd:void 0,flagSettingsPath:void 0,allowedSettingSources:["userSettings","projectSettings","localSettings","flagSettings","policySettings"],meter:null,sessionCounter:null,locCounter:null,prCounter:null,commitCounter:null,costCounter:null,tokenCounter:null,codeEditToolDecisionCounter:null,activeTimeCounter:null,sessionId:fl(),loggerProvider:null,eventLogger:null,meterProvider:null,tracerProvider:null,agentColorMap:new Map,agentColorIndex:0,envVarValidators:[hl,pl],lastAPIRequest:null,inMemoryErrorLog:[],inlinePlugins:[]}}var vl=ml();function gl(){return vl.sessionId}var Ud=gt(()=>Wa(process.env.DEBUG)||Wa(process.env.DEBUG_SDK)||process.argv.includes("--debug")||process.argv.includes("-d")||hs()||process.argv.some(s=>s.startsWith("--debug="))),_l=gt(()=>{let s=process.argv.find(a=>a.startsWith("--debug="));if(!s)return null;let r=s.substring(8);return nl(r)}),hs=gt(()=>process.argv.includes("--debug-to-stderr")||process.argv.includes("-d2e"));function yl(s){if(typeof process>"u"||typeof process.versions>"u"||typeof process.versions.node>"u")return!1;let r=_l();return ll(s,r)}var El=!1;function dr(s,{level:r}={level:"debug"}){if(!yl(s))return;El&&s.includes(`
`)&&(s=JSON.stringify(s));let a=`[${r.toUpperCase()}] ${s.trim()}
`;if(hs()){sl(a);return}pr().existsSync(ra(Rt()))||pr().mkdirSync(ra(Rt())),pr().appendFileSync(Rt(),a),bl()}function Rt(){return process.env.CLAUDE_CODE_DEBUG_LOGS_DIR??fs(dl(),"debug",`${gl()}.txt`)}var bl=gt(()=>{try{let s=Rt(),r=ra(s),a=fs(r,"latest");if(pr().existsSync(r)||pr().mkdirSync(r),pr().existsSync(a))try{pr().unlinkSync(a)}catch{}pr().symlinkSync(s,a)}catch{}}),ta=class{transport;isSingleUserTurn;canUseTool;hooks;abortController;pendingControlResponses=new Map;cleanupPerformed=!1;sdkMessages;inputStream=new Yt;initialization;cancelControllers=new Map;hookCallbacks=new Map;nextCallbackId=0;sdkMcpTransports=new Map;pendingMcpResponses=new Map;firstResultReceivedPromise;firstResultReceivedResolve;constructor(r,a,e,n,i,t=new Map){this.transport=r,this.isSingleUserTurn=a,this.canUseTool=e,this.hooks=n,this.abortController=i;for(let[o,d]of t){let u=new ea(p=>this.sendMcpServerMessageToCli(o,p));this.sdkMcpTransports.set(o,u),d.connect(u)}this.sdkMessages=this.readSdkMessages(),this.firstResultReceivedPromise=new Promise(o=>{this.firstResultReceivedResolve=o}),this.readMessages(),this.initialization=this.initialize(),this.initialization.catch(()=>{})}setError(r){this.inputStream.error(r)}cleanup(r){if(!this.cleanupPerformed){this.cleanupPerformed=!0;try{this.transport.close(),this.pendingControlResponses.clear(),this.pendingMcpResponses.clear(),r?this.inputStream.error(r):this.inputStream.done()}catch{}}}next(...[r]){return this.sdkMessages.next(r)}return(r){return this.sdkMessages.return(r)}throw(r){return this.sdkMessages.throw(r)}[Symbol.asyncIterator](){return this.sdkMessages}[Symbol.asyncDispose](){return this.sdkMessages[Symbol.asyncDispose]()}async readMessages(){try{for await(let r of this.transport.readMessages()){if(r.type==="control_response"){let a=this.pendingControlResponses.get(r.response.request_id);a&&a(r.response);continue}else if(r.type==="control_request"){this.handleControlRequest(r);continue}else if(r.type==="control_cancel_request"){this.handleControlCancelRequest(r);continue}else if(r.type==="keep_alive")continue;r.type==="result"&&(this.firstResultReceivedResolve&&this.firstResultReceivedResolve(),this.isSingleUserTurn&&this.transport.endInput()),this.inputStream.enqueue(r)}this.inputStream.done(),this.cleanup()}catch(r){this.inputStream.error(r),this.cleanup(r)}}async handleControlRequest(r){let a=new AbortController;this.cancelControllers.set(r.request_id,a);try{let e=await this.processControlRequest(r,a.signal),n={type:"control_response",response:{subtype:"success",request_id:r.request_id,response:e}};await Promise.resolve(this.transport.write(JSON.stringify(n)+`
`))}catch(e){let n={type:"control_response",response:{subtype:"error",request_id:r.request_id,error:e.message||String(e)}};await Promise.resolve(this.transport.write(JSON.stringify(n)+`
`))}finally{this.cancelControllers.delete(r.request_id)}}handleControlCancelRequest(r){let a=this.cancelControllers.get(r.request_id);a&&(a.abort(),this.cancelControllers.delete(r.request_id))}async processControlRequest(r,a){if(r.request.subtype==="can_use_tool"){if(!this.canUseTool)throw new Error("canUseTool callback is not provided.");return this.canUseTool(r.request.tool_name,r.request.input,{signal:a,suggestions:r.request.permission_suggestions})}else{if(r.request.subtype==="hook_callback")return await this.handleHookCallbacks(r.request.callback_id,r.request.input,r.request.tool_use_id,a);if(r.request.subtype==="mcp_message"){let e=r.request,n=this.sdkMcpTransports.get(e.server_name);if(!n)throw new Error(`SDK MCP server not found: ${e.server_name}`);return"method"in e.message&&"id"in e.message&&e.message.id!==null?{mcp_response:await this.handleMcpControlRequest(e.server_name,e,n)}:(n.onmessage&&n.onmessage(e.message),{mcp_response:{jsonrpc:"2.0",result:{},id:0}})}}throw new Error("Unsupported control request subtype: "+r.request.subtype)}async*readSdkMessages(){for await(let r of this.inputStream)yield r}async initialize(){let r;if(this.hooks){r={};for(let[i,t]of Object.entries(this.hooks))t.length>0&&(r[i]=t.map(o=>{let d=[];for(let u of o.hooks){let p=`hook_${this.nextCallbackId++}`;this.hookCallbacks.set(p,u),d.push(p)}return{matcher:o.matcher,hookCallbackIds:d}}))}let a=this.sdkMcpTransports.size>0?Array.from(this.sdkMcpTransports.keys()):void 0,e={subtype:"initialize",hooks:r,sdkMcpServers:a};return(await this.request(e)).response}async interrupt(){await this.request({subtype:"interrupt"})}async setPermissionMode(r){await this.request({subtype:"set_permission_mode",mode:r})}async setModel(r){await this.request({subtype:"set_model",model:r})}async setMaxThinkingTokens(r){await this.request({subtype:"set_max_thinking_tokens",max_thinking_tokens:r})}request(r){let a=Math.random().toString(36).substring(2,15),e={request_id:a,type:"control_request",request:r};return new Promise((n,i)=>{this.pendingControlResponses.set(a,t=>{t.subtype==="success"?n(t):i(new Error(t.error))}),Promise.resolve(this.transport.write(JSON.stringify(e)+`
`))})}async supportedCommands(){return(await this.initialization).commands}async supportedModels(){return(await this.initialization).models}async mcpServerStatus(){return(await this.request({subtype:"mcp_status"})).response.mcpServers}async accountInfo(){return(await this.initialization).account}async streamInput(r){dr("[Query.streamInput] Starting to process input stream"),dr(`[Query.streamInput] this.sdkMcpTransports.size = ${this.sdkMcpTransports.size}`);try{let a=0;for await(let e of r){if(a++,dr(`[Query.streamInput] Processing message ${a}: ${e.type}`),this.abortController?.signal.aborted)break;await Promise.resolve(this.transport.write(JSON.stringify(e)+`
`))}if(dr(`[Query.streamInput] Finished processing ${a} messages from input stream`),dr(`[Query.streamInput] About to check MCP servers. this.sdkMcpTransports.size = ${this.sdkMcpTransports.size}`),this.sdkMcpTransports.size>0&&this.firstResultReceivedPromise){dr("[Query.streamInput] Entering Promise.race to wait for result");let e=1e4,n;await Promise.race([this.firstResultReceivedPromise.then(()=>{dr("[Query.streamInput] Received first result, closing input stream"),n&&clearTimeout(n)}),new Promise(i=>{n=setTimeout(()=>{dr("[Query.streamInput] Timed out waiting for first result, closing input stream"),i()},e)})]),n&&clearTimeout(n)}dr("[Query] Calling transport.endInput() to close stdin to CLI process"),this.transport.endInput()}catch(a){if(!(a instanceof Tr))throw a}}handleHookCallbacks(r,a,e,n){let i=this.hookCallbacks.get(r);if(!i)throw new Error(`No hook callback found for ID: ${r}`);return i(a,e,{signal:n})}sendMcpServerMessageToCli(r,a){if("id"in a&&a.id!==null&&a.id!==void 0){let e=`${r}:${a.id}`,n=this.pendingMcpResponses.get(e);if(n){n.resolve(a),this.pendingMcpResponses.delete(e);return}}throw new Error("No pending request found")}handleMcpControlRequest(r,a,e){let n="id"in a.message?a.message.id:null,i=`${r}:${n}`;return new Promise((t,o)=>{let d=null,u=()=>{d&&clearTimeout(d),this.pendingMcpResponses.delete(i)},p=y=>{u(),t(y)},_=y=>{u(),o(y)};if(this.pendingMcpResponses.set(i,{resolve:p,reject:_}),e.onmessage)e.onmessage(a.message);else{u(),o(new Error("No message handler registered"));return}d=setTimeout(()=>{this.pendingMcpResponses.has(i)&&(u(),o(new Error("Request timeout")))},3e4)})}},l={};In(l,{void:()=>nu,util:()=>he,unknown:()=>au,union:()=>uu,undefined:()=>eu,tuple:()=>fu,transformer:()=>es,symbol:()=>Yl,string:()=>Es,strictObject:()=>lu,setErrorMap:()=>Pl,set:()=>mu,record:()=>hu,quotelessJson:()=>Sl,promise:()=>bu,preprocess:()=>Pu,pipeline:()=>Ru,ostring:()=>wu,optional:()=>Su,onumber:()=>xu,oboolean:()=>Ou,objectUtil:()=>aa,object:()=>ou,number:()=>bs,nullable:()=>Tu,null:()=>ru,never:()=>su,nativeEnum:()=>Eu,nan:()=>Wl,map:()=>pu,makeIssue:()=>Ot,literal:()=>_u,lazy:()=>gu,late:()=>Xl,isValid:()=>Pr,isDirty:()=>na,isAsync:()=>pt,isAborted:()=>sa,intersection:()=>du,instanceof:()=>Ql,getParsedType:()=>hr,getErrorMap:()=>xt,function:()=>vu,enum:()=>yu,effect:()=>es,discriminatedUnion:()=>cu,defaultErrorMap:()=>Qr,datetimeRegex:()=>gs,date:()=>Jl,custom:()=>ys,coerce:()=>Cu,boolean:()=>Ss,bigint:()=>Kl,array:()=>iu,any:()=>tu,addIssueToContext:()=>V,ZodVoid:()=>Kr,ZodUnknown:()=>mr,ZodUnion:()=>Nr,ZodUndefined:()=>Cr,ZodType:()=>ie,ZodTuple:()=>sr,ZodTransformer:()=>Be,ZodSymbol:()=>Wr,ZodString:()=>gr,ZodSet:()=>Yr,ZodSchema:()=>ie,ZodRecord:()=>It,ZodReadonly:()=>Fr,ZodPromise:()=>yr,ZodPipeline:()=>vt,ZodParsedType:()=>G,ZodOptional:()=>We,ZodObject:()=>Fe,ZodNumber:()=>Rr,ZodNullable:()=>nr,ZodNull:()=>Ir,ZodNever:()=>rr,ZodNativeEnum:()=>Lr,ZodNaN:()=>et,ZodMap:()=>Jr,ZodLiteral:()=>Dr,ZodLazy:()=>Ar,ZodIssueCode:()=>q,ZodIntersection:()=>kr,ZodFunction:()=>Nt,ZodFirstPartyTypeKind:()=>re,ZodError:()=>Ze,ZodEnum:()=>$r,ZodEffects:()=>Be,ZodDiscriminatedUnion:()=>Ct,ZodDefault:()=>jr,ZodDate:()=>Or,ZodCatch:()=>Mr,ZodBranded:()=>mt,ZodBoolean:()=>xr,ZodBigInt:()=>wr,ZodArray:()=>vr,ZodAny:()=>_r,Schema:()=>ie,ParseStatus:()=>Le,OK:()=>Me,NEVER:()=>Iu,INVALID:()=>ee,EMPTY_PATH:()=>Rl,DIRTY:()=>Xr,BRAND:()=>Gl});var he;(function(s){s.assertEqual=n=>{};function r(n){}s.assertIs=r;function a(n){throw new Error}s.assertNever=a,s.arrayToEnum=n=>{let i={};for(let t of n)i[t]=t;return i},s.getValidEnumValues=n=>{let i=s.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),t={};for(let o of i)t[o]=n[o];return s.objectValues(t)},s.objectValues=n=>s.objectKeys(n).map(function(i){return n[i]}),s.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&i.push(t);return i},s.find=(n,i)=>{for(let t of n)if(i(t))return t},s.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function e(n,i=" | "){return n.map(t=>typeof t=="string"?`'${t}'`:t).join(i)}s.joinValues=e,s.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(he||(he={}));var aa;(function(s){s.mergeShapes=(r,a)=>({...r,...a})})(aa||(aa={}));var G=he.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),hr=s=>{switch(typeof s){case"undefined":return G.undefined;case"string":return G.string;case"number":return Number.isNaN(s)?G.nan:G.number;case"boolean":return G.boolean;case"function":return G.function;case"bigint":return G.bigint;case"symbol":return G.symbol;case"object":return Array.isArray(s)?G.array:s===null?G.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?G.promise:typeof Map<"u"&&s instanceof Map?G.map:typeof Set<"u"&&s instanceof Set?G.set:typeof Date<"u"&&s instanceof Date?G.date:G.object;default:return G.unknown}},q=he.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Sl=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:"),Ze=class s extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=r}format(r){let a=r||function(i){return i.message},e={_errors:[]},n=i=>{for(let t of i.issues)if(t.code==="invalid_union")t.unionErrors.map(n);else if(t.code==="invalid_return_type")n(t.returnTypeError);else if(t.code==="invalid_arguments")n(t.argumentsError);else if(t.path.length===0)e._errors.push(a(t));else{let o=e,d=0;for(;d<t.path.length;){let u=t.path[d];d===t.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(a(t))):o[u]=o[u]||{_errors:[]},o=o[u],d++}}};return n(this),e}static assert(r){if(!(r instanceof s))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,he.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=a=>a.message){let a={},e=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];a[i]=a[i]||[],a[i].push(r(n))}else e.push(r(n));return{formErrors:e,fieldErrors:a}}get formErrors(){return this.flatten()}};Ze.create=s=>new Ze(s);var Tl=(s,r)=>{let a;switch(s.code){case q.invalid_type:s.received===G.undefined?a="Required":a=`Expected ${s.expected}, received ${s.received}`;break;case q.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(s.expected,he.jsonStringifyReplacer)}`;break;case q.unrecognized_keys:a=`Unrecognized key(s) in object: ${he.joinValues(s.keys,", ")}`;break;case q.invalid_union:a="Invalid input";break;case q.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${he.joinValues(s.options)}`;break;case q.invalid_enum_value:a=`Invalid enum value. Expected ${he.joinValues(s.options)}, received '${s.received}'`;break;case q.invalid_arguments:a="Invalid function arguments";break;case q.invalid_return_type:a="Invalid function return type";break;case q.invalid_date:a="Invalid date";break;case q.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(a=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?a=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?a=`Invalid input: must end with "${s.validation.endsWith}"`:he.assertNever(s.validation):s.validation!=="regex"?a=`Invalid ${s.validation}`:a="Invalid";break;case q.too_small:s.type==="array"?a=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?a=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?a=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?a=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?a=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:a="Invalid input";break;case q.too_big:s.type==="array"?a=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?a=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?a=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?a=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?a=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:a="Invalid input";break;case q.custom:a="Invalid input";break;case q.invalid_intersection_types:a="Intersection results could not be merged";break;case q.not_multiple_of:a=`Number must be a multiple of ${s.multipleOf}`;break;case q.not_finite:a="Number must be finite";break;default:a=r.defaultError,he.assertNever(s)}return{message:a}},Qr=Tl,ps=Qr;function Pl(s){ps=s}function xt(){return ps}var Ot=s=>{let{data:r,path:a,errorMaps:e,issueData:n}=s,i=[...a,...n.path||[]],t={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="",d=e.filter(u=>!!u).slice().reverse();for(let u of d)o=u(t,{data:r,defaultError:o}).message;return{...n,path:i,message:o}},Rl=[];function V(s,r){let a=xt(),e=Ot({issueData:r,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,a,a===Qr?void 0:Qr].filter(n=>!!n)});s.common.issues.push(e)}var Le=class s{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,a){let e=[];for(let n of a){if(n.status==="aborted")return ee;n.status==="dirty"&&r.dirty(),e.push(n.value)}return{status:r.value,value:e}}static async mergeObjectAsync(r,a){let e=[];for(let n of a){let i=await n.key,t=await n.value;e.push({key:i,value:t})}return s.mergeObjectSync(r,e)}static mergeObjectSync(r,a){let e={};for(let n of a){let{key:i,value:t}=n;if(i.status==="aborted"||t.status==="aborted")return ee;i.status==="dirty"&&r.dirty(),t.status==="dirty"&&r.dirty(),i.value!=="__proto__"&&(typeof t.value<"u"||n.alwaysSet)&&(e[i.value]=t.value)}return{status:r.value,value:e}}},ee=Object.freeze({status:"aborted"}),Xr=s=>({status:"dirty",value:s}),Me=s=>({status:"valid",value:s}),sa=s=>s.status==="aborted",na=s=>s.status==="dirty",Pr=s=>s.status==="valid",pt=s=>typeof Promise<"u"&&s instanceof Promise,W;(function(s){s.errToObj=r=>typeof r=="string"?{message:r}:r||{},s.toString=r=>typeof r=="string"?r:r?.message})(W||(W={}));var Ke=class{constructor(r,a,e,n){this._cachedPath=[],this.parent=r,this.data=a,this._path=e,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ja=(s,r)=>{if(Pr(r))return{success:!0,data:r.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let a=new Ze(s.common.issues);return this._error=a,this._error}}};function le(s){if(!s)return{};let{errorMap:r,invalid_type_error:a,required_error:e,description:n}=s;if(r&&(a||e))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:n}:{errorMap:(t,o)=>{let{message:d}=s;return t.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:d??e??o.defaultError}:t.code!=="invalid_type"?{message:o.defaultError}:{message:d??a??o.defaultError}},description:n}}var ie=class{get description(){return this._def.description}_getType(r){return hr(r.data)}_getOrReturnCtx(r,a){return a||{common:r.parent.common,data:r.data,parsedType:hr(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new Le,ctx:{common:r.parent.common,data:r.data,parsedType:hr(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){let a=this._parse(r);if(pt(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(r){let a=this._parse(r);return Promise.resolve(a)}parse(r,a){let e=this.safeParse(r,a);if(e.success)return e.data;throw e.error}safeParse(r,a){let e={common:{issues:[],async:a?.async??!1,contextualErrorMap:a?.errorMap},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:hr(r)},n=this._parseSync({data:r,path:e.path,parent:e});return Ja(e,n)}"~validate"(r){let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:hr(r)};if(!this["~standard"].async)try{let e=this._parseSync({data:r,path:[],parent:a});return Pr(e)?{value:e.value}:{issues:a.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:a}).then(e=>Pr(e)?{value:e.value}:{issues:a.common.issues})}async parseAsync(r,a){let e=await this.safeParseAsync(r,a);if(e.success)return e.data;throw e.error}async safeParseAsync(r,a){let e={common:{issues:[],contextualErrorMap:a?.errorMap,async:!0},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:hr(r)},n=this._parse({data:r,path:e.path,parent:e}),i=await(pt(n)?n:Promise.resolve(n));return Ja(e,i)}refine(r,a){let e=n=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(n):a;return this._refinement((n,i)=>{let t=r(n),o=()=>i.addIssue({code:q.custom,...e(n)});return typeof Promise<"u"&&t instanceof Promise?t.then(d=>d?!0:(o(),!1)):t?!0:(o(),!1)})}refinement(r,a){return this._refinement((e,n)=>r(e)?!0:(n.addIssue(typeof a=="function"?a(e,n):a),!1))}_refinement(r){return new Be({schema:this,typeName:re.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return We.create(this,this._def)}nullable(){return nr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vr.create(this)}promise(){return yr.create(this,this._def)}or(r){return Nr.create([this,r],this._def)}and(r){return kr.create(this,r,this._def)}transform(r){return new Be({...le(this._def),schema:this,typeName:re.ZodEffects,effect:{type:"transform",transform:r}})}default(r){let a=typeof r=="function"?r:()=>r;return new jr({...le(this._def),innerType:this,defaultValue:a,typeName:re.ZodDefault})}brand(){return new mt({typeName:re.ZodBranded,type:this,...le(this._def)})}catch(r){let a=typeof r=="function"?r:()=>r;return new Mr({...le(this._def),innerType:this,catchValue:a,typeName:re.ZodCatch})}describe(r){let a=this.constructor;return new a({...this._def,description:r})}pipe(r){return vt.create(this,r)}readonly(){return Fr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},wl=/^c[^\s-]{8,}$/i,xl=/^[0-9a-z]+$/,Ol=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Cl=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Il=/^[a-z0-9_-]{21}$/i,Nl=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kl=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Al=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Dl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Wt,$l=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ll=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,jl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ml=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Fl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ul=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ms="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ql=new RegExp(`^${ms}$`);function vs(s){let r="[0-5]\\d";s.precision?r=`${r}\\.\\d{${s.precision}}`:s.precision==null&&(r=`${r}(\\.\\d+)?`);let a=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${r})${a}`}function Hl(s){return new RegExp(`^${vs(s)}$`)}function gs(s){let r=`${ms}T${vs(s)}`,a=[];return a.push(s.local?"Z?":"Z"),s.offset&&a.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${a.join("|")})`,new RegExp(`^${r}$`)}function zl(s,r){return!!((r==="v4"||!r)&&$l.test(s)||(r==="v6"||!r)&&jl.test(s))}function Vl(s,r){if(!Nl.test(s))return!1;try{let[a]=s.split(".");if(!a)return!1;let e=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),n=JSON.parse(atob(e));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||r&&n.alg!==r)}catch{return!1}}function Zl(s,r){return!!((r==="v4"||!r)&&Ll.test(s)||(r==="v6"||!r)&&Ml.test(s))}var gr=class s extends ie{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==G.string){let i=this._getOrReturnCtx(r);return V(i,{code:q.invalid_type,expected:G.string,received:i.parsedType}),ee}let e=new Le,n;for(let i of this._def.checks)if(i.kind==="min")r.data.length<i.value&&(n=this._getOrReturnCtx(r,n),V(n,{code:q.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),e.dirty());else if(i.kind==="max")r.data.length>i.value&&(n=this._getOrReturnCtx(r,n),V(n,{code:q.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),e.dirty());else if(i.kind==="length"){let t=r.data.length>i.value,o=r.data.length<i.value;(t||o)&&(n=this._getOrReturnCtx(r,n),t?V(n,{code:q.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&V(n,{code:q.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),e.dirty())}else if(i.kind==="email")Al.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"email",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="emoji")Wt||(Wt=new RegExp(Dl,"u")),Wt.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"emoji",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="uuid")Cl.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"uuid",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="nanoid")Il.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"nanoid",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="cuid")wl.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"cuid",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="cuid2")xl.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"cuid2",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="ulid")Ol.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"ulid",code:q.invalid_string,message:i.message}),e.dirty());else if(i.kind==="url")try{new URL(r.data)}catch{n=this._getOrReturnCtx(r,n),V(n,{validation:"url",code:q.invalid_string,message:i.message}),e.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"regex",code:q.invalid_string,message:i.message}),e.dirty())):i.kind==="trim"?r.data=r.data.trim():i.kind==="includes"?r.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),e.dirty()):i.kind==="toLowerCase"?r.data=r.data.toLowerCase():i.kind==="toUpperCase"?r.data=r.data.toUpperCase():i.kind==="startsWith"?r.data.startsWith(i.value)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:{startsWith:i.value},message:i.message}),e.dirty()):i.kind==="endsWith"?r.data.endsWith(i.value)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:{endsWith:i.value},message:i.message}),e.dirty()):i.kind==="datetime"?gs(i).test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:"datetime",message:i.message}),e.dirty()):i.kind==="date"?ql.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:"date",message:i.message}),e.dirty()):i.kind==="time"?Hl(i).test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{code:q.invalid_string,validation:"time",message:i.message}),e.dirty()):i.kind==="duration"?kl.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"duration",code:q.invalid_string,message:i.message}),e.dirty()):i.kind==="ip"?zl(r.data,i.version)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"ip",code:q.invalid_string,message:i.message}),e.dirty()):i.kind==="jwt"?Vl(r.data,i.alg)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"jwt",code:q.invalid_string,message:i.message}),e.dirty()):i.kind==="cidr"?Zl(r.data,i.version)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"cidr",code:q.invalid_string,message:i.message}),e.dirty()):i.kind==="base64"?Fl.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"base64",code:q.invalid_string,message:i.message}),e.dirty()):i.kind==="base64url"?Ul.test(r.data)||(n=this._getOrReturnCtx(r,n),V(n,{validation:"base64url",code:q.invalid_string,message:i.message}),e.dirty()):he.assertNever(i);return{status:e.value,value:r.data}}_regex(r,a,e){return this.refinement(n=>r.test(n),{validation:a,code:q.invalid_string,...W.errToObj(e)})}_addCheck(r){return new s({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...W.errToObj(r)})}url(r){return this._addCheck({kind:"url",...W.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...W.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...W.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...W.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...W.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...W.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...W.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...W.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...W.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...W.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...W.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...W.errToObj(r)})}datetime(r){return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof r?.precision>"u"?null:r?.precision,offset:r?.offset??!1,local:r?.local??!1,...W.errToObj(r?.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof r?.precision>"u"?null:r?.precision,...W.errToObj(r?.message)})}duration(r){return this._addCheck({kind:"duration",...W.errToObj(r)})}regex(r,a){return this._addCheck({kind:"regex",regex:r,...W.errToObj(a)})}includes(r,a){return this._addCheck({kind:"includes",value:r,position:a?.position,...W.errToObj(a?.message)})}startsWith(r,a){return this._addCheck({kind:"startsWith",value:r,...W.errToObj(a)})}endsWith(r,a){return this._addCheck({kind:"endsWith",value:r,...W.errToObj(a)})}min(r,a){return this._addCheck({kind:"min",value:r,...W.errToObj(a)})}max(r,a){return this._addCheck({kind:"max",value:r,...W.errToObj(a)})}length(r,a){return this._addCheck({kind:"length",value:r,...W.errToObj(a)})}nonempty(r){return this.min(1,W.errToObj(r))}trim(){return new s({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(let a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxLength(){let r=null;for(let a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}};gr.create=s=>new gr({checks:[],typeName:re.ZodString,coerce:s?.coerce??!1,...le(s)});function Bl(s,r){let a=(s.toString().split(".")[1]||"").length,e=(r.toString().split(".")[1]||"").length,n=a>e?a:e,i=Number.parseInt(s.toFixed(n).replace(".","")),t=Number.parseInt(r.toFixed(n).replace(".",""));return i%t/10**n}var Rr=class s extends ie{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==G.number){let i=this._getOrReturnCtx(r);return V(i,{code:q.invalid_type,expected:G.number,received:i.parsedType}),ee}let e,n=new Le;for(let i of this._def.checks)i.kind==="int"?he.isInteger(r.data)||(e=this._getOrReturnCtx(r,e),V(e,{code:q.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?r.data<i.value:r.data<=i.value)&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?r.data>i.value:r.data>=i.value)&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?Bl(r.data,i.value)!==0&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(r.data)||(e=this._getOrReturnCtx(r,e),V(e,{code:q.not_finite,message:i.message}),n.dirty()):he.assertNever(i);return{status:n.value,value:r.data}}gte(r,a){return this.setLimit("min",r,!0,W.toString(a))}gt(r,a){return this.setLimit("min",r,!1,W.toString(a))}lte(r,a){return this.setLimit("max",r,!0,W.toString(a))}lt(r,a){return this.setLimit("max",r,!1,W.toString(a))}setLimit(r,a,e,n){return new s({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:e,message:W.toString(n)}]})}_addCheck(r){return new s({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:W.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:W.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:W.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:W.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:W.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:W.toString(a)})}finite(r){return this._addCheck({kind:"finite",message:W.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:W.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:W.toString(r)})}get minValue(){let r=null;for(let a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(let a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&he.isInteger(r.value))}get isFinite(){let r=null,a=null;for(let e of this._def.checks){if(e.kind==="finite"||e.kind==="int"||e.kind==="multipleOf")return!0;e.kind==="min"?(a===null||e.value>a)&&(a=e.value):e.kind==="max"&&(r===null||e.value<r)&&(r=e.value)}return Number.isFinite(a)&&Number.isFinite(r)}};Rr.create=s=>new Rr({checks:[],typeName:re.ZodNumber,coerce:s?.coerce||!1,...le(s)});var wr=class s extends ie{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==G.bigint)return this._getInvalidInput(r);let e,n=new Le;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?r.data<i.value:r.data<=i.value)&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?r.data>i.value:r.data>=i.value)&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?r.data%i.value!==BigInt(0)&&(e=this._getOrReturnCtx(r,e),V(e,{code:q.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):he.assertNever(i);return{status:n.value,value:r.data}}_getInvalidInput(r){let a=this._getOrReturnCtx(r);return V(a,{code:q.invalid_type,expected:G.bigint,received:a.parsedType}),ee}gte(r,a){return this.setLimit("min",r,!0,W.toString(a))}gt(r,a){return this.setLimit("min",r,!1,W.toString(a))}lte(r,a){return this.setLimit("max",r,!0,W.toString(a))}lt(r,a){return this.setLimit("max",r,!1,W.toString(a))}setLimit(r,a,e,n){return new s({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:e,message:W.toString(n)}]})}_addCheck(r){return new s({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:W.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:W.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:W.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:W.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:W.toString(a)})}get minValue(){let r=null;for(let a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(let a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}};wr.create=s=>new wr({checks:[],typeName:re.ZodBigInt,coerce:s?.coerce??!1,...le(s)});var xr=class extends ie{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==G.boolean){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.boolean,received:e.parsedType}),ee}return Me(r.data)}};xr.create=s=>new xr({typeName:re.ZodBoolean,coerce:s?.coerce||!1,...le(s)});var Or=class s extends ie{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==G.date){let i=this._getOrReturnCtx(r);return V(i,{code:q.invalid_type,expected:G.date,received:i.parsedType}),ee}if(Number.isNaN(r.data.getTime())){let i=this._getOrReturnCtx(r);return V(i,{code:q.invalid_date}),ee}let e=new Le,n;for(let i of this._def.checks)i.kind==="min"?r.data.getTime()<i.value&&(n=this._getOrReturnCtx(r,n),V(n,{code:q.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),e.dirty()):i.kind==="max"?r.data.getTime()>i.value&&(n=this._getOrReturnCtx(r,n),V(n,{code:q.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),e.dirty()):he.assertNever(i);return{status:e.value,value:new Date(r.data.getTime())}}_addCheck(r){return new s({...this._def,checks:[...this._def.checks,r]})}min(r,a){return this._addCheck({kind:"min",value:r.getTime(),message:W.toString(a)})}max(r,a){return this._addCheck({kind:"max",value:r.getTime(),message:W.toString(a)})}get minDate(){let r=null;for(let a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(let a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r!=null?new Date(r):null}};Or.create=s=>new Or({checks:[],coerce:s?.coerce||!1,typeName:re.ZodDate,...le(s)});var Wr=class extends ie{_parse(r){if(this._getType(r)!==G.symbol){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.symbol,received:e.parsedType}),ee}return Me(r.data)}};Wr.create=s=>new Wr({typeName:re.ZodSymbol,...le(s)});var Cr=class extends ie{_parse(r){if(this._getType(r)!==G.undefined){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.undefined,received:e.parsedType}),ee}return Me(r.data)}};Cr.create=s=>new Cr({typeName:re.ZodUndefined,...le(s)});var Ir=class extends ie{_parse(r){if(this._getType(r)!==G.null){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.null,received:e.parsedType}),ee}return Me(r.data)}};Ir.create=s=>new Ir({typeName:re.ZodNull,...le(s)});var _r=class extends ie{constructor(){super(...arguments),this._any=!0}_parse(r){return Me(r.data)}};_r.create=s=>new _r({typeName:re.ZodAny,...le(s)});var mr=class extends ie{constructor(){super(...arguments),this._unknown=!0}_parse(r){return Me(r.data)}};mr.create=s=>new mr({typeName:re.ZodUnknown,...le(s)});var rr=class extends ie{_parse(r){let a=this._getOrReturnCtx(r);return V(a,{code:q.invalid_type,expected:G.never,received:a.parsedType}),ee}};rr.create=s=>new rr({typeName:re.ZodNever,...le(s)});var Kr=class extends ie{_parse(r){if(this._getType(r)!==G.undefined){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.void,received:e.parsedType}),ee}return Me(r.data)}};Kr.create=s=>new Kr({typeName:re.ZodVoid,...le(s)});var vr=class s extends ie{_parse(r){let{ctx:a,status:e}=this._processInputParams(r),n=this._def;if(a.parsedType!==G.array)return V(a,{code:q.invalid_type,expected:G.array,received:a.parsedType}),ee;if(n.exactLength!==null){let t=a.data.length>n.exactLength.value,o=a.data.length<n.exactLength.value;(t||o)&&(V(a,{code:t?q.too_big:q.too_small,minimum:o?n.exactLength.value:void 0,maximum:t?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),e.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(V(a,{code:q.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),e.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(V(a,{code:q.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),e.dirty()),a.common.async)return Promise.all([...a.data].map((t,o)=>n.type._parseAsync(new Ke(a,t,a.path,o)))).then(t=>Le.mergeArray(e,t));let i=[...a.data].map((t,o)=>n.type._parseSync(new Ke(a,t,a.path,o)));return Le.mergeArray(e,i)}get element(){return this._def.type}min(r,a){return new s({...this._def,minLength:{value:r,message:W.toString(a)}})}max(r,a){return new s({...this._def,maxLength:{value:r,message:W.toString(a)}})}length(r,a){return new s({...this._def,exactLength:{value:r,message:W.toString(a)}})}nonempty(r){return this.min(1,r)}};vr.create=(s,r)=>new vr({type:s,minLength:null,maxLength:null,exactLength:null,typeName:re.ZodArray,...le(r)});function Gr(s){if(s instanceof Fe){let r={};for(let a in s.shape){let e=s.shape[a];r[a]=We.create(Gr(e))}return new Fe({...s._def,shape:()=>r})}else return s instanceof vr?new vr({...s._def,type:Gr(s.element)}):s instanceof We?We.create(Gr(s.unwrap())):s instanceof nr?nr.create(Gr(s.unwrap())):s instanceof sr?sr.create(s.items.map(r=>Gr(r))):s}var Fe=class s extends ie{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let r=this._def.shape(),a=he.objectKeys(r);return this._cached={shape:r,keys:a},this._cached}_parse(r){if(this._getType(r)!==G.object){let u=this._getOrReturnCtx(r);return V(u,{code:q.invalid_type,expected:G.object,received:u.parsedType}),ee}let{status:e,ctx:n}=this._processInputParams(r),{shape:i,keys:t}=this._getCached(),o=[];if(!(this._def.catchall instanceof rr&&this._def.unknownKeys==="strip"))for(let u in n.data)t.includes(u)||o.push(u);let d=[];for(let u of t){let p=i[u],_=n.data[u];d.push({key:{status:"valid",value:u},value:p._parse(new Ke(n,_,n.path,u)),alwaysSet:u in n.data})}if(this._def.catchall instanceof rr){let u=this._def.unknownKeys;if(u==="passthrough")for(let p of o)d.push({key:{status:"valid",value:p},value:{status:"valid",value:n.data[p]}});else if(u==="strict")o.length>0&&(V(n,{code:q.unrecognized_keys,keys:o}),e.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let p of o){let _=n.data[p];d.push({key:{status:"valid",value:p},value:u._parse(new Ke(n,_,n.path,p)),alwaysSet:p in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let u=[];for(let p of d){let _=await p.key,y=await p.value;u.push({key:_,value:y,alwaysSet:p.alwaysSet})}return u}).then(u=>Le.mergeObjectSync(e,u)):Le.mergeObjectSync(e,d)}get shape(){return this._def.shape()}strict(r){return W.errToObj,new s({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(a,e)=>{let n=this._def.errorMap?.(a,e).message??e.defaultError;return a.code==="unrecognized_keys"?{message:W.errToObj(r).message??n}:{message:n}}}:{}})}strip(){return new s({...this._def,unknownKeys:"strip"})}passthrough(){return new s({...this._def,unknownKeys:"passthrough"})}extend(r){return new s({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new s({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:re.ZodObject})}setKey(r,a){return this.augment({[r]:a})}catchall(r){return new s({...this._def,catchall:r})}pick(r){let a={};for(let e of he.objectKeys(r))r[e]&&this.shape[e]&&(a[e]=this.shape[e]);return new s({...this._def,shape:()=>a})}omit(r){let a={};for(let e of he.objectKeys(this.shape))r[e]||(a[e]=this.shape[e]);return new s({...this._def,shape:()=>a})}deepPartial(){return Gr(this)}partial(r){let a={};for(let e of he.objectKeys(this.shape)){let n=this.shape[e];r&&!r[e]?a[e]=n:a[e]=n.optional()}return new s({...this._def,shape:()=>a})}required(r){let a={};for(let e of he.objectKeys(this.shape))if(r&&!r[e])a[e]=this.shape[e];else{let i=this.shape[e];for(;i instanceof We;)i=i._def.innerType;a[e]=i}return new s({...this._def,shape:()=>a})}keyof(){return _s(he.objectKeys(this.shape))}};Fe.create=(s,r)=>new Fe({shape:()=>s,unknownKeys:"strip",catchall:rr.create(),typeName:re.ZodObject,...le(r)});Fe.strictCreate=(s,r)=>new Fe({shape:()=>s,unknownKeys:"strict",catchall:rr.create(),typeName:re.ZodObject,...le(r)});Fe.lazycreate=(s,r)=>new Fe({shape:s,unknownKeys:"strip",catchall:rr.create(),typeName:re.ZodObject,...le(r)});var Nr=class extends ie{_parse(r){let{ctx:a}=this._processInputParams(r),e=this._def.options;function n(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return a.common.issues.push(...o.ctx.common.issues),o.result;let t=i.map(o=>new Ze(o.ctx.common.issues));return V(a,{code:q.invalid_union,unionErrors:t}),ee}if(a.common.async)return Promise.all(e.map(async i=>{let t={...a,common:{...a.common,issues:[]},parent:null};return{result:await i._parseAsync({data:a.data,path:a.path,parent:t}),ctx:t}})).then(n);{let i,t=[];for(let d of e){let u={...a,common:{...a.common,issues:[]},parent:null},p=d._parseSync({data:a.data,path:a.path,parent:u});if(p.status==="valid")return p;p.status==="dirty"&&!i&&(i={result:p,ctx:u}),u.common.issues.length&&t.push(u.common.issues)}if(i)return a.common.issues.push(...i.ctx.common.issues),i.result;let o=t.map(d=>new Ze(d));return V(a,{code:q.invalid_union,unionErrors:o}),ee}}get options(){return this._def.options}};Nr.create=(s,r)=>new Nr({options:s,typeName:re.ZodUnion,...le(r)});var fr=s=>s instanceof Ar?fr(s.schema):s instanceof Be?fr(s.innerType()):s instanceof Dr?[s.value]:s instanceof $r?s.options:s instanceof Lr?he.objectValues(s.enum):s instanceof jr?fr(s._def.innerType):s instanceof Cr?[void 0]:s instanceof Ir?[null]:s instanceof We?[void 0,...fr(s.unwrap())]:s instanceof nr?[null,...fr(s.unwrap())]:s instanceof mt||s instanceof Fr?fr(s.unwrap()):s instanceof Mr?fr(s._def.innerType):[],Ct=class s extends ie{_parse(r){let{ctx:a}=this._processInputParams(r);if(a.parsedType!==G.object)return V(a,{code:q.invalid_type,expected:G.object,received:a.parsedType}),ee;let e=this.discriminator,n=a.data[e],i=this.optionsMap.get(n);return i?a.common.async?i._parseAsync({data:a.data,path:a.path,parent:a}):i._parseSync({data:a.data,path:a.path,parent:a}):(V(a,{code:q.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[e]}),ee)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(r,a,e){let n=new Map;for(let i of a){let t=fr(i.shape[r]);if(!t.length)throw new Error(`A discriminator value for key \`${r}\` could not be extracted from all schema options`);for(let o of t){if(n.has(o))throw new Error(`Discriminator property ${String(r)} has duplicate value ${String(o)}`);n.set(o,i)}}return new s({typeName:re.ZodDiscriminatedUnion,discriminator:r,options:a,optionsMap:n,...le(e)})}};function ia(s,r){let a=hr(s),e=hr(r);if(s===r)return{valid:!0,data:s};if(a===G.object&&e===G.object){let n=he.objectKeys(r),i=he.objectKeys(s).filter(o=>n.indexOf(o)!==-1),t={...s,...r};for(let o of i){let d=ia(s[o],r[o]);if(!d.valid)return{valid:!1};t[o]=d.data}return{valid:!0,data:t}}else if(a===G.array&&e===G.array){if(s.length!==r.length)return{valid:!1};let n=[];for(let i=0;i<s.length;i++){let t=s[i],o=r[i],d=ia(t,o);if(!d.valid)return{valid:!1};n.push(d.data)}return{valid:!0,data:n}}else return a===G.date&&e===G.date&&+s==+r?{valid:!0,data:s}:{valid:!1}}var kr=class extends ie{_parse(r){let{status:a,ctx:e}=this._processInputParams(r),n=(i,t)=>{if(sa(i)||sa(t))return ee;let o=ia(i.value,t.value);return o.valid?((na(i)||na(t))&&a.dirty(),{status:a.value,value:o.data}):(V(e,{code:q.invalid_intersection_types}),ee)};return e.common.async?Promise.all([this._def.left._parseAsync({data:e.data,path:e.path,parent:e}),this._def.right._parseAsync({data:e.data,path:e.path,parent:e})]).then(([i,t])=>n(i,t)):n(this._def.left._parseSync({data:e.data,path:e.path,parent:e}),this._def.right._parseSync({data:e.data,path:e.path,parent:e}))}};kr.create=(s,r,a)=>new kr({left:s,right:r,typeName:re.ZodIntersection,...le(a)});var sr=class s extends ie{_parse(r){let{status:a,ctx:e}=this._processInputParams(r);if(e.parsedType!==G.array)return V(e,{code:q.invalid_type,expected:G.array,received:e.parsedType}),ee;if(e.data.length<this._def.items.length)return V(e,{code:q.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ee;!this._def.rest&&e.data.length>this._def.items.length&&(V(e,{code:q.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let i=[...e.data].map((t,o)=>{let d=this._def.items[o]||this._def.rest;return d?d._parse(new Ke(e,t,e.path,o)):null}).filter(t=>!!t);return e.common.async?Promise.all(i).then(t=>Le.mergeArray(a,t)):Le.mergeArray(a,i)}get items(){return this._def.items}rest(r){return new s({...this._def,rest:r})}};sr.create=(s,r)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new sr({items:s,typeName:re.ZodTuple,rest:null,...le(r)})};var It=class s extends ie{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){let{status:a,ctx:e}=this._processInputParams(r);if(e.parsedType!==G.object)return V(e,{code:q.invalid_type,expected:G.object,received:e.parsedType}),ee;let n=[],i=this._def.keyType,t=this._def.valueType;for(let o in e.data)n.push({key:i._parse(new Ke(e,o,e.path,o)),value:t._parse(new Ke(e,e.data[o],e.path,o)),alwaysSet:o in e.data});return e.common.async?Le.mergeObjectAsync(a,n):Le.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(r,a,e){return a instanceof ie?new s({keyType:r,valueType:a,typeName:re.ZodRecord,...le(e)}):new s({keyType:gr.create(),valueType:r,typeName:re.ZodRecord,...le(a)})}},Jr=class extends ie{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){let{status:a,ctx:e}=this._processInputParams(r);if(e.parsedType!==G.map)return V(e,{code:q.invalid_type,expected:G.map,received:e.parsedType}),ee;let n=this._def.keyType,i=this._def.valueType,t=[...e.data.entries()].map(([o,d],u)=>({key:n._parse(new Ke(e,o,e.path,[u,"key"])),value:i._parse(new Ke(e,d,e.path,[u,"value"]))}));if(e.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let d of t){let u=await d.key,p=await d.value;if(u.status==="aborted"||p.status==="aborted")return ee;(u.status==="dirty"||p.status==="dirty")&&a.dirty(),o.set(u.value,p.value)}return{status:a.value,value:o}})}else{let o=new Map;for(let d of t){let u=d.key,p=d.value;if(u.status==="aborted"||p.status==="aborted")return ee;(u.status==="dirty"||p.status==="dirty")&&a.dirty(),o.set(u.value,p.value)}return{status:a.value,value:o}}}};Jr.create=(s,r,a)=>new Jr({valueType:r,keyType:s,typeName:re.ZodMap,...le(a)});var Yr=class s extends ie{_parse(r){let{status:a,ctx:e}=this._processInputParams(r);if(e.parsedType!==G.set)return V(e,{code:q.invalid_type,expected:G.set,received:e.parsedType}),ee;let n=this._def;n.minSize!==null&&e.data.size<n.minSize.value&&(V(e,{code:q.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&e.data.size>n.maxSize.value&&(V(e,{code:q.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());let i=this._def.valueType;function t(d){let u=new Set;for(let p of d){if(p.status==="aborted")return ee;p.status==="dirty"&&a.dirty(),u.add(p.value)}return{status:a.value,value:u}}let o=[...e.data.values()].map((d,u)=>i._parse(new Ke(e,d,e.path,u)));return e.common.async?Promise.all(o).then(d=>t(d)):t(o)}min(r,a){return new s({...this._def,minSize:{value:r,message:W.toString(a)}})}max(r,a){return new s({...this._def,maxSize:{value:r,message:W.toString(a)}})}size(r,a){return this.min(r,a).max(r,a)}nonempty(r){return this.min(1,r)}};Yr.create=(s,r)=>new Yr({valueType:s,minSize:null,maxSize:null,typeName:re.ZodSet,...le(r)});var Nt=class s extends ie{constructor(){super(...arguments),this.validate=this.implement}_parse(r){let{ctx:a}=this._processInputParams(r);if(a.parsedType!==G.function)return V(a,{code:q.invalid_type,expected:G.function,received:a.parsedType}),ee;function e(o,d){return Ot({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,xt(),Qr].filter(u=>!!u),issueData:{code:q.invalid_arguments,argumentsError:d}})}function n(o,d){return Ot({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,xt(),Qr].filter(u=>!!u),issueData:{code:q.invalid_return_type,returnTypeError:d}})}let i={errorMap:a.common.contextualErrorMap},t=a.data;if(this._def.returns instanceof yr){let o=this;return Me(async function(...d){let u=new Ze([]),p=await o._def.args.parseAsync(d,i).catch(m=>{throw u.addIssue(e(d,m)),u}),_=await Reflect.apply(t,this,p);return await o._def.returns._def.type.parseAsync(_,i).catch(m=>{throw u.addIssue(n(_,m)),u})})}else{let o=this;return Me(function(...d){let u=o._def.args.safeParse(d,i);if(!u.success)throw new Ze([e(d,u.error)]);let p=Reflect.apply(t,this,u.data),_=o._def.returns.safeParse(p,i);if(!_.success)throw new Ze([n(p,_.error)]);return _.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...r){return new s({...this._def,args:sr.create(r).rest(mr.create())})}returns(r){return new s({...this._def,returns:r})}implement(r){return this.parse(r)}strictImplement(r){return this.parse(r)}static create(r,a,e){return new s({args:r||sr.create([]).rest(mr.create()),returns:a||mr.create(),typeName:re.ZodFunction,...le(e)})}},Ar=class extends ie{get schema(){return this._def.getter()}_parse(r){let{ctx:a}=this._processInputParams(r);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}};Ar.create=(s,r)=>new Ar({getter:s,typeName:re.ZodLazy,...le(r)});var Dr=class extends ie{_parse(r){if(r.data!==this._def.value){let a=this._getOrReturnCtx(r);return V(a,{received:a.data,code:q.invalid_literal,expected:this._def.value}),ee}return{status:"valid",value:r.data}}get value(){return this._def.value}};Dr.create=(s,r)=>new Dr({value:s,typeName:re.ZodLiteral,...le(r)});function _s(s,r){return new $r({values:s,typeName:re.ZodEnum,...le(r)})}var $r=class s extends ie{_parse(r){if(typeof r.data!="string"){let a=this._getOrReturnCtx(r),e=this._def.values;return V(a,{expected:he.joinValues(e),received:a.parsedType,code:q.invalid_type}),ee}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(r.data)){let a=this._getOrReturnCtx(r),e=this._def.values;return V(a,{received:a.data,code:q.invalid_enum_value,options:e}),ee}return Me(r.data)}get options(){return this._def.values}get enum(){let r={};for(let a of this._def.values)r[a]=a;return r}get Values(){let r={};for(let a of this._def.values)r[a]=a;return r}get Enum(){let r={};for(let a of this._def.values)r[a]=a;return r}extract(r,a=this._def){return s.create(r,{...this._def,...a})}exclude(r,a=this._def){return s.create(this.options.filter(e=>!r.includes(e)),{...this._def,...a})}};$r.create=_s;var Lr=class extends ie{_parse(r){let a=he.getValidEnumValues(this._def.values),e=this._getOrReturnCtx(r);if(e.parsedType!==G.string&&e.parsedType!==G.number){let n=he.objectValues(a);return V(e,{expected:he.joinValues(n),received:e.parsedType,code:q.invalid_type}),ee}if(this._cache||(this._cache=new Set(he.getValidEnumValues(this._def.values))),!this._cache.has(r.data)){let n=he.objectValues(a);return V(e,{received:e.data,code:q.invalid_enum_value,options:n}),ee}return Me(r.data)}get enum(){return this._def.values}};Lr.create=(s,r)=>new Lr({values:s,typeName:re.ZodNativeEnum,...le(r)});var yr=class extends ie{unwrap(){return this._def.type}_parse(r){let{ctx:a}=this._processInputParams(r);if(a.parsedType!==G.promise&&a.common.async===!1)return V(a,{code:q.invalid_type,expected:G.promise,received:a.parsedType}),ee;let e=a.parsedType===G.promise?a.data:Promise.resolve(a.data);return Me(e.then(n=>this._def.type.parseAsync(n,{path:a.path,errorMap:a.common.contextualErrorMap})))}};yr.create=(s,r)=>new yr({type:s,typeName:re.ZodPromise,...le(r)});var Be=class extends ie{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===re.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){let{status:a,ctx:e}=this._processInputParams(r),n=this._def.effect||null,i={addIssue:t=>{V(e,t),t.fatal?a.abort():a.dirty()},get path(){return e.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let t=n.transform(e.data,i);if(e.common.async)return Promise.resolve(t).then(async o=>{if(a.value==="aborted")return ee;let d=await this._def.schema._parseAsync({data:o,path:e.path,parent:e});return d.status==="aborted"?ee:d.status==="dirty"||a.value==="dirty"?Xr(d.value):d});{if(a.value==="aborted")return ee;let o=this._def.schema._parseSync({data:t,path:e.path,parent:e});return o.status==="aborted"?ee:o.status==="dirty"||a.value==="dirty"?Xr(o.value):o}}if(n.type==="refinement"){let t=o=>{let d=n.refinement(o,i);if(e.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(e.common.async===!1){let o=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});return o.status==="aborted"?ee:(o.status==="dirty"&&a.dirty(),t(o.value),{status:a.value,value:o.value})}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(o=>o.status==="aborted"?ee:(o.status==="dirty"&&a.dirty(),t(o.value).then(()=>({status:a.value,value:o.value}))))}if(n.type==="transform")if(e.common.async===!1){let t=this._def.schema._parseSync({data:e.data,path:e.path,parent:e});if(!Pr(t))return ee;let o=n.transform(t.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:o}}else return this._def.schema._parseAsync({data:e.data,path:e.path,parent:e}).then(t=>Pr(t)?Promise.resolve(n.transform(t.value,i)).then(o=>({status:a.value,value:o})):ee);he.assertNever(n)}};Be.create=(s,r,a)=>new Be({schema:s,typeName:re.ZodEffects,effect:r,...le(a)});Be.createWithPreprocess=(s,r,a)=>new Be({schema:r,effect:{type:"preprocess",transform:s},typeName:re.ZodEffects,...le(a)});var We=class extends ie{_parse(r){return this._getType(r)===G.undefined?Me(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};We.create=(s,r)=>new We({innerType:s,typeName:re.ZodOptional,...le(r)});var nr=class extends ie{_parse(r){return this._getType(r)===G.null?Me(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}};nr.create=(s,r)=>new nr({innerType:s,typeName:re.ZodNullable,...le(r)});var jr=class extends ie{_parse(r){let{ctx:a}=this._processInputParams(r),e=a.data;return a.parsedType===G.undefined&&(e=this._def.defaultValue()),this._def.innerType._parse({data:e,path:a.path,parent:a})}removeDefault(){return this._def.innerType}};jr.create=(s,r)=>new jr({innerType:s,typeName:re.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...le(r)});var Mr=class extends ie{_parse(r){let{ctx:a}=this._processInputParams(r),e={...a,common:{...a.common,issues:[]}},n=this._def.innerType._parse({data:e.data,path:e.path,parent:{...e}});return pt(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ze(e.common.issues)},input:e.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Ze(e.common.issues)},input:e.data})}}removeCatch(){return this._def.innerType}};Mr.create=(s,r)=>new Mr({innerType:s,typeName:re.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...le(r)});var et=class extends ie{_parse(r){if(this._getType(r)!==G.nan){let e=this._getOrReturnCtx(r);return V(e,{code:q.invalid_type,expected:G.nan,received:e.parsedType}),ee}return{status:"valid",value:r.data}}};et.create=s=>new et({typeName:re.ZodNaN,...le(s)});var Gl=Symbol("zod_brand"),mt=class extends ie{_parse(r){let{ctx:a}=this._processInputParams(r),e=a.data;return this._def.type._parse({data:e,path:a.path,parent:a})}unwrap(){return this._def.type}},vt=class s extends ie{_parse(r){let{status:a,ctx:e}=this._processInputParams(r);if(e.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:e.data,path:e.path,parent:e});return i.status==="aborted"?ee:i.status==="dirty"?(a.dirty(),Xr(i.value)):this._def.out._parseAsync({data:i.value,path:e.path,parent:e})})();{let n=this._def.in._parseSync({data:e.data,path:e.path,parent:e});return n.status==="aborted"?ee:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:e.path,parent:e})}}static create(r,a){return new s({in:r,out:a,typeName:re.ZodPipeline})}},Fr=class extends ie{_parse(r){let a=this._def.innerType._parse(r),e=n=>(Pr(n)&&(n.value=Object.freeze(n.value)),n);return pt(a)?a.then(n=>e(n)):e(a)}unwrap(){return this._def.innerType}};Fr.create=(s,r)=>new Fr({innerType:s,typeName:re.ZodReadonly,...le(r)});function Ya(s,r){let a=typeof s=="function"?s(r):typeof s=="string"?{message:s}:s;return typeof a=="string"?{message:a}:a}function ys(s,r={},a){return s?_r.create().superRefine((e,n)=>{let i=s(e);if(i instanceof Promise)return i.then(t=>{if(!t){let o=Ya(r,e),d=o.fatal??a??!0;n.addIssue({code:"custom",...o,fatal:d})}});if(!i){let t=Ya(r,e),o=t.fatal??a??!0;n.addIssue({code:"custom",...t,fatal:o})}}):_r.create()}var Xl={object:Fe.lazycreate},re;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(re||(re={}));var Ql=(s,r={message:`Input not instance of ${s.name}`})=>ys(a=>a instanceof s,r),Es=gr.create,bs=Rr.create,Wl=et.create,Kl=wr.create,Ss=xr.create,Jl=Or.create,Yl=Wr.create,eu=Cr.create,ru=Ir.create,tu=_r.create,au=mr.create,su=rr.create,nu=Kr.create,iu=vr.create,ou=Fe.create,lu=Fe.strictCreate,uu=Nr.create,cu=Ct.create,du=kr.create,fu=sr.create,hu=It.create,pu=Jr.create,mu=Yr.create,vu=Nt.create,gu=Ar.create,_u=Dr.create,yu=$r.create,Eu=Lr.create,bu=yr.create,es=Be.create,Su=We.create,Tu=nr.create,Pu=Be.createWithPreprocess,Ru=vt.create,wu=()=>Es().optional(),xu=()=>bs().optional(),Ou=()=>Ss().optional(),Cu={string:s=>gr.create({...s,coerce:!0}),number:s=>Rr.create({...s,coerce:!0}),boolean:s=>xr.create({...s,coerce:!0}),bigint:s=>wr.create({...s,coerce:!0}),date:s=>Or.create({...s,coerce:!0})},Iu=ee;var $t="2.0",Ts=l.union([l.string(),l.number().int()]),Ps=l.string(),Nu=l.object({progressToken:l.optional(Ts)}).passthrough(),Je=l.object({_meta:l.optional(Nu)}).passthrough(),Ue=l.object({method:l.string(),params:l.optional(Je)}),_t=l.object({_meta:l.optional(l.object({}).passthrough())}).passthrough(),ir=l.object({method:l.string(),params:l.optional(_t)}),Ye=l.object({_meta:l.optional(l.object({}).passthrough())}).passthrough(),Lt=l.union([l.string(),l.number().int()]),ku=l.object({jsonrpc:l.literal($t),id:Lt}).merge(Ue).strict();var Au=l.object({jsonrpc:l.literal($t)}).merge(ir).strict();var Du=l.object({jsonrpc:l.literal($t),id:Lt,result:Ye}).strict();var rs;(function(s){s[s.ConnectionClosed=-32e3]="ConnectionClosed",s[s.RequestTimeout=-32001]="RequestTimeout",s[s.ParseError=-32700]="ParseError",s[s.InvalidRequest=-32600]="InvalidRequest",s[s.MethodNotFound=-32601]="MethodNotFound",s[s.InvalidParams=-32602]="InvalidParams",s[s.InternalError=-32603]="InternalError"})(rs||(rs={}));var $u=l.object({jsonrpc:l.literal($t),id:Lt,error:l.object({code:l.number().int(),message:l.string(),data:l.optional(l.unknown())})}).strict();var qd=l.union([ku,Au,Du,$u]),Rs=Ye.strict(),ws=ir.extend({method:l.literal("notifications/cancelled"),params:_t.extend({requestId:Lt,reason:l.string().optional()})}),yt=l.object({name:l.string(),title:l.optional(l.string())}).passthrough(),xs=yt.extend({version:l.string()}),Lu=l.object({experimental:l.optional(l.object({}).passthrough()),sampling:l.optional(l.object({}).passthrough()),elicitation:l.optional(l.object({}).passthrough()),roots:l.optional(l.object({listChanged:l.optional(l.boolean())}).passthrough())}).passthrough(),ju=Ue.extend({method:l.literal("initialize"),params:Je.extend({protocolVersion:l.string(),capabilities:Lu,clientInfo:xs})}),Mu=l.object({experimental:l.optional(l.object({}).passthrough()),logging:l.optional(l.object({}).passthrough()),completions:l.optional(l.object({}).passthrough()),prompts:l.optional(l.object({listChanged:l.optional(l.boolean())}).passthrough()),resources:l.optional(l.object({subscribe:l.optional(l.boolean()),listChanged:l.optional(l.boolean())}).passthrough()),tools:l.optional(l.object({listChanged:l.optional(l.boolean())}).passthrough())}).passthrough(),Fu=Ye.extend({protocolVersion:l.string(),capabilities:Mu,serverInfo:xs,instructions:l.optional(l.string())}),Uu=ir.extend({method:l.literal("notifications/initialized")}),Os=Ue.extend({method:l.literal("ping")}),qu=l.object({progress:l.number(),total:l.optional(l.number()),message:l.optional(l.string())}).passthrough(),Cs=ir.extend({method:l.literal("notifications/progress"),params:_t.merge(qu).extend({progressToken:Ts})}),jt=Ue.extend({params:Je.extend({cursor:l.optional(Ps)}).optional()}),Mt=Ye.extend({nextCursor:l.optional(Ps)}),Is=l.object({uri:l.string(),mimeType:l.optional(l.string()),_meta:l.optional(l.object({}).passthrough())}).passthrough(),Ns=Is.extend({text:l.string()}),ha=l.string().refine(s=>{try{return atob(s),!0}catch{return!1}},{message:"Invalid Base64 string"}),ks=Is.extend({blob:ha}),As=yt.extend({uri:l.string(),description:l.optional(l.string()),mimeType:l.optional(l.string()),_meta:l.optional(l.object({}).passthrough())}),Hu=yt.extend({uriTemplate:l.string(),description:l.optional(l.string()),mimeType:l.optional(l.string()),_meta:l.optional(l.object({}).passthrough())}),zu=jt.extend({method:l.literal("resources/list")}),Vu=Mt.extend({resources:l.array(As)}),Zu=jt.extend({method:l.literal("resources/templates/list")}),Bu=Mt.extend({resourceTemplates:l.array(Hu)}),Gu=Ue.extend({method:l.literal("resources/read"),params:Je.extend({uri:l.string()})}),Xu=Ye.extend({contents:l.array(l.union([Ns,ks]))}),Qu=ir.extend({method:l.literal("notifications/resources/list_changed")}),Wu=Ue.extend({method:l.literal("resources/subscribe"),params:Je.extend({uri:l.string()})}),Ku=Ue.extend({method:l.literal("resources/unsubscribe"),params:Je.extend({uri:l.string()})}),Ju=ir.extend({method:l.literal("notifications/resources/updated"),params:_t.extend({uri:l.string()})}),Yu=l.object({name:l.string(),description:l.optional(l.string()),required:l.optional(l.boolean())}).passthrough(),ec=yt.extend({description:l.optional(l.string()),arguments:l.optional(l.array(Yu)),_meta:l.optional(l.object({}).passthrough())}),rc=jt.extend({method:l.literal("prompts/list")}),tc=Mt.extend({prompts:l.array(ec)}),ac=Ue.extend({method:l.literal("prompts/get"),params:Je.extend({name:l.string(),arguments:l.optional(l.record(l.string()))})}),pa=l.object({type:l.literal("text"),text:l.string(),_meta:l.optional(l.object({}).passthrough())}).passthrough(),ma=l.object({type:l.literal("image"),data:ha,mimeType:l.string(),_meta:l.optional(l.object({}).passthrough())}).passthrough(),va=l.object({type:l.literal("audio"),data:ha,mimeType:l.string(),_meta:l.optional(l.object({}).passthrough())}).passthrough(),sc=l.object({type:l.literal("resource"),resource:l.union([Ns,ks]),_meta:l.optional(l.object({}).passthrough())}).passthrough(),nc=As.extend({type:l.literal("resource_link")}),Ds=l.union([pa,ma,va,nc,sc]),ic=l.object({role:l.enum(["user","assistant"]),content:Ds}).passthrough(),oc=Ye.extend({description:l.optional(l.string()),messages:l.array(ic)}),lc=ir.extend({method:l.literal("notifications/prompts/list_changed")}),uc=l.object({title:l.optional(l.string()),readOnlyHint:l.optional(l.boolean()),destructiveHint:l.optional(l.boolean()),idempotentHint:l.optional(l.boolean()),openWorldHint:l.optional(l.boolean())}).passthrough(),cc=yt.extend({description:l.optional(l.string()),inputSchema:l.object({type:l.literal("object"),properties:l.optional(l.object({}).passthrough()),required:l.optional(l.array(l.string()))}).passthrough(),outputSchema:l.optional(l.object({type:l.literal("object"),properties:l.optional(l.object({}).passthrough()),required:l.optional(l.array(l.string()))}).passthrough()),annotations:l.optional(uc),_meta:l.optional(l.object({}).passthrough())}),dc=jt.extend({method:l.literal("tools/list")}),fc=Mt.extend({tools:l.array(cc)}),$s=Ye.extend({content:l.array(Ds).default([]),structuredContent:l.object({}).passthrough().optional(),isError:l.optional(l.boolean())}),Hd=$s.or(Ye.extend({toolResult:l.unknown()})),hc=Ue.extend({method:l.literal("tools/call"),params:Je.extend({name:l.string(),arguments:l.optional(l.record(l.unknown()))})}),pc=ir.extend({method:l.literal("notifications/tools/list_changed")}),Ls=l.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),mc=Ue.extend({method:l.literal("logging/setLevel"),params:Je.extend({level:Ls})}),vc=ir.extend({method:l.literal("notifications/message"),params:_t.extend({level:Ls,logger:l.optional(l.string()),data:l.unknown()})}),gc=l.object({name:l.string().optional()}).passthrough(),_c=l.object({hints:l.optional(l.array(gc)),costPriority:l.optional(l.number().min(0).max(1)),speedPriority:l.optional(l.number().min(0).max(1)),intelligencePriority:l.optional(l.number().min(0).max(1))}).passthrough(),yc=l.object({role:l.enum(["user","assistant"]),content:l.union([pa,ma,va])}).passthrough(),Ec=Ue.extend({method:l.literal("sampling/createMessage"),params:Je.extend({messages:l.array(yc),systemPrompt:l.optional(l.string()),includeContext:l.optional(l.enum(["none","thisServer","allServers"])),temperature:l.optional(l.number()),maxTokens:l.number().int(),stopSequences:l.optional(l.array(l.string())),metadata:l.optional(l.object({}).passthrough()),modelPreferences:l.optional(_c)})}),bc=Ye.extend({model:l.string(),stopReason:l.optional(l.enum(["endTurn","stopSequence","maxTokens"]).or(l.string())),role:l.enum(["user","assistant"]),content:l.discriminatedUnion("type",[pa,ma,va])}),Sc=l.object({type:l.literal("boolean"),title:l.optional(l.string()),description:l.optional(l.string()),default:l.optional(l.boolean())}).passthrough(),Tc=l.object({type:l.literal("string"),title:l.optional(l.string()),description:l.optional(l.string()),minLength:l.optional(l.number()),maxLength:l.optional(l.number()),format:l.optional(l.enum(["email","uri","date","date-time"]))}).passthrough(),Pc=l.object({type:l.enum(["number","integer"]),title:l.optional(l.string()),description:l.optional(l.string()),minimum:l.optional(l.number()),maximum:l.optional(l.number())}).passthrough(),Rc=l.object({type:l.literal("string"),title:l.optional(l.string()),description:l.optional(l.string()),enum:l.array(l.string()),enumNames:l.optional(l.array(l.string()))}).passthrough(),wc=l.union([Sc,Tc,Pc,Rc]),xc=Ue.extend({method:l.literal("elicitation/create"),params:Je.extend({message:l.string(),requestedSchema:l.object({type:l.literal("object"),properties:l.record(l.string(),wc),required:l.optional(l.array(l.string()))}).passthrough()})}),Oc=Ye.extend({action:l.enum(["accept","decline","cancel"]),content:l.optional(l.record(l.string(),l.unknown()))}),Cc=l.object({type:l.literal("ref/resource"),uri:l.string()}).passthrough(),Ic=l.object({type:l.literal("ref/prompt"),name:l.string()}).passthrough(),Nc=Ue.extend({method:l.literal("completion/complete"),params:Je.extend({ref:l.union([Ic,Cc]),argument:l.object({name:l.string(),value:l.string()}).passthrough(),context:l.optional(l.object({arguments:l.optional(l.record(l.string(),l.string()))}))})}),kc=Ye.extend({completion:l.object({values:l.array(l.string()).max(100),total:l.optional(l.number().int()),hasMore:l.optional(l.boolean())}).passthrough()}),Ac=l.object({uri:l.string().startsWith("file://"),name:l.optional(l.string()),_meta:l.optional(l.object({}).passthrough())}).passthrough(),Dc=Ue.extend({method:l.literal("roots/list")}),$c=Ye.extend({roots:l.array(Ac)}),Lc=ir.extend({method:l.literal("notifications/roots/list_changed")}),zd=l.union([Os,ju,Nc,mc,ac,rc,zu,Zu,Gu,Wu,Ku,hc,dc]),Vd=l.union([ws,Cs,Uu,Lc]),Zd=l.union([Rs,bc,Oc,$c]),Bd=l.union([Os,Ec,xc,Dc]),Gd=l.union([ws,Cs,vc,Ju,Qu,pc,lc]),Xd=l.union([Rs,Fu,kc,oc,tc,Vu,Bu,Xu,$s,fc]);var Qd=Cn(ci(),1);var Wd=Symbol("Let zodToJsonSchema decide on which parser to use");var Kd=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var oa;(function(s){s.Completable="McpCompletable"})(oa||(oa={}));var kt=class extends ie{_parse(r){let{ctx:a}=this._processInputParams(r),e=a.data;return this._def.type._parse({data:e,path:a.path,parent:a})}unwrap(){return this._def.type}};kt.create=(s,r)=>new kt({type:s,typeName:oa.Completable,complete:r.complete,...jc(r)});function jc(s){if(!s)return{};let{errorMap:r,invalid_type_error:a,required_error:e,description:n}=s;if(r&&(a||e))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:n}:{errorMap:(t,o)=>{var d,u;let{message:p}=s;return t.code==="invalid_enum_value"?{message:p??o.defaultError}:typeof o.data>"u"?{message:(d=p??e)!==null&&d!==void 0?d:o.defaultError}:t.code!=="invalid_type"?{message:o.defaultError}:{message:(u=p??a)!==null&&u!==void 0?u:o.defaultError}},description:n}}function js({prompt:s,options:r}){let{systemPrompt:a,settingSources:e,...n}=r??{},i,t;a===void 0?i="":typeof a=="string"?i=a:a.type==="preset"&&(t=a.append);let o=n.pathToClaudeCodeExecutable;if(!o){let pe=di(import.meta.url),_e=Va(pe,"..");o=Va(_e,"cli.js")}process.env.CLAUDE_AGENT_SDK_VERSION="0.1.27";let{abortController:d=is(),additionalDirectories:u=[],agents:p,allowedTools:_=[],canUseTool:y,continue:m,cwd:E,disallowedTools:c=[],env:h,executable:S=os()?"bun":"node",executableArgs:v=[],extraArgs:R={},fallbackModel:$,forkSession:I,hooks:w,includePartialMessages:O,maxThinkingTokens:k,maxTurns:D,mcpServers:j,model:A,permissionMode:P="default",allowDangerouslySkipPermissions:T=!1,permissionPromptToolName:L,plugins:F,resume:H,resumeSessionAt:Z,stderr:oe,strictMcpConfig:J}=n,Q=h;if(Q||(Q={...process.env}),Q.CLAUDE_CODE_ENTRYPOINT||(Q.CLAUDE_CODE_ENTRYPOINT="sdk-ts"),!o)throw new Error("pathToClaudeCodeExecutable is required");let K={},Y=new Map;if(j)for(let[pe,_e]of Object.entries(j))_e.type==="sdk"&&"instance"in _e?(Y.set(pe,_e.instance),K[pe]={type:"sdk",name:pe}):K[pe]=_e;let ke=typeof s=="string",Ae=new Jt({abortController:d,additionalDirectories:u,agents:p,cwd:E,executable:S,executableArgs:v,extraArgs:R,pathToClaudeCodeExecutable:o,env:Q,forkSession:I,stderr:oe,customSystemPrompt:i,appendSystemPrompt:t,maxThinkingTokens:k,maxTurns:D,model:A,fallbackModel:$,permissionMode:P,allowDangerouslySkipPermissions:T,permissionPromptToolName:L,continueConversation:m,resume:H,resumeSessionAt:Z,settingSources:e??[],allowedTools:_,disallowedTools:c,mcpServers:K,strictMcpConfig:J,canUseTool:!!y,hooks:!!w,includePartialMessages:O,plugins:F}),Ce=new ta(Ae,ke,y,w,d,Y);return typeof s=="string"?Ae.write(JSON.stringify({type:"user",session_id:"",message:{role:"user",content:[{type:"text",text:s}]},parent_tool_use_id:null})+`
`):Ce.streamInput(s),Ce}function Ms(s){return{bugfix:"\u{1F534}",feature:"\u{1F7E3}",refactor:"\u{1F504}",change:"\u2705",discovery:"\u{1F535}",decision:"\u{1F9E0}"}[s]||"\u{1F4DD}"}async function Fc(s,r,a){let e=Ma(),n=s.db.prepare(`
    SELECT
      id, type, title, subtitle, narrative,
      facts, concepts, files_modified, created_at
    FROM observations
    WHERE project = ?
    ORDER BY created_at_epoch DESC
    LIMIT ?
  `).all(r,e);if(n.length===0)return"\u{1F50D} **JIT Context**: No previous observations found for this project.";let i=n.map(y=>`${Ms(y.type)} #${y.id}: ${y.title||"Untitled"} (${y.type})`).join(`
`);async function*t(){yield{role:"user",content:`You are filtering past observations for relevance to a user's current question.

# Available observations (from session-start context):
${i}

# User's current question:
${a}

# Task:
Select the 3-5 most relevant observation IDs (just the numbers) that would help answer this question.
If nothing is relevant, respond with "NONE".

Respond ONLY with comma-separated IDs (e.g., "1234,5678,9012") or "NONE".`}}let o=js({prompt:t(),options:{model:process.env.CLAUDE_MEM_MODEL||"claude-haiku-4-5"}}),d="";for await(let y of o)if(y.type==="assistant"){let m=y.message.content,E=Array.isArray(m)?m.filter(c=>c.type==="text").map(c=>c.text).join(`
`):typeof m=="string"?m:"";d+=E}if(d=d.trim(),d==="NONE"||!d)return`\u{1F50D} **JIT Context**: Agent analyzed ${n.length} observations and found none directly relevant to your prompt.`;let u=d.split(",").map(y=>parseInt(y.trim(),10)).filter(y=>!isNaN(y));if(u.length===0)return`\u{1F50D} **JIT Context**: Agent response could not be parsed into valid observation IDs. Response: "${d}"`;let p=n.filter(y=>u.includes(y.id)),_=["# Related context from JIT filtering:",""];for(let y of p){let m=Ms(y.type);_.push(`## ${m} ${y.title||"Untitled"}`),y.subtitle&&(_.push(`**${y.subtitle}**`),_.push("")),y.narrative&&(_.push(y.narrative),_.push("")),y.facts&&(_.push("**Facts:**"),_.push(y.facts),_.push("")),y.files_modified&&(_.push(`**Files:** ${y.files_modified}`),_.push("")),_.push("---"),_.push("")}return _.join(`
`)}async function Uc(s){if(!s)throw new Error("newHook requires input");let{session_id:r,cwd:a,prompt:e}=s,n=Mc.basename(a);await La();let i=new Pt;try{let t=i.createSDKSession(r,n,e),o=i.incrementPromptCounter(t);i.saveUserPrompt(r,o,e),console.error(`[new-hook] Session ${t}, prompt #${o}`);let d=Xt(),u=await fetch(`http://127.0.0.1:${d}/sessions/${t}/init`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project:n,userPrompt:e}),signal:AbortSignal.timeout(5e3)});if(!u.ok){let _=await u.text();throw new Error(`Failed to initialize session: ${u.status} ${_}`)}let p=null;if(Fa())try{p=await Fc(i,n,e)}catch(_){console.error(`[new-hook] JIT context error: ${_.message}`),p=`\u{1F50D} **JIT Context**: Error occurred while filtering context: ${_.message}`}i.close(),console.log(p?Bt("UserPromptSubmit",!0,{context:p}):Bt("UserPromptSubmit",!0))}catch(t){throw i.close(),t.cause?.code==="ECONNREFUSED"||t.name==="TimeoutError"||t.message.includes("fetch failed")?new Error("There's a problem with the worker. If you just updated, type `pm2 restart claude-mem-worker` in your terminal to continue"):t}}var ga="";Fs.on("data",s=>ga+=s);Fs.on("end",async()=>{let s=ga?JSON.parse(ga):void 0;await Uc(s)});
