#!/usr/bin/env node
"use strict";var nu=Object.create;var Xs=Object.defineProperty;var ou=Object.getOwnPropertyDescriptor;var iu=Object.getOwnPropertyNames;var cu=Object.getPrototypeOf,lu=Object.prototype.hasOwnProperty;var G=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),uu=(s,e)=>{for(var r in e)Xs(s,r,{get:e[r],enumerable:!0})},du=(s,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of iu(e))!lu.call(s,t)&&t!==r&&Xs(s,t,{get:()=>e[t],enumerable:!(a=ou(e,t))||a.enumerable});return s};var Bt=(s,e,r)=>(r=s!=null?nu(cu(s)):{},du(e||!s||!s.__esModule?Xs(r,"default",{value:s,enumerable:!0}):r,s));var so=G((ps,ro)=>{(function(s,e){typeof ps=="object"&&typeof ro<"u"?e(ps):typeof define=="function"&&define.amd?define(["exports"],e):e(s.URI=s.URI||{})})(ps,(function(s){"use strict";function e(){for(var _=arguments.length,v=Array(_),b=0;b<_;b++)v[b]=arguments[b];if(v.length>1){v[0]=v[0].slice(0,-1);for(var P=v.length-1,$=1;$<P;++$)v[$]=v[$].slice(1,-1);return v[P]=v[P].slice(1),v.join("")}else return v[0]}function r(_){return"(?:"+_+")"}function a(_){return _===void 0?"undefined":_===null?"null":Object.prototype.toString.call(_).split(" ").pop().split("]").shift().toLowerCase()}function t(_){return _.toUpperCase()}function n(_){return _!=null?_ instanceof Array?_:typeof _.length!="number"||_.split||_.setInterval||_.call?[_]:Array.prototype.slice.call(_):[]}function i(_,v){var b=_;if(v)for(var P in v)b[P]=v[P];return b}function o(_){var v="[A-Za-z]",b="[\\x0D]",P="[0-9]",$="[\\x22]",V=e(P,"[A-Fa-f]"),te="[\\x0A]",le="[\\x20]",de=r(r("%[EFef]"+V+"%"+V+V+"%"+V+V)+"|"+r("%[89A-Fa-f]"+V+"%"+V+V)+"|"+r("%"+V+V)),we="[\\:\\/\\?\\#\\[\\]\\@]",ie="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",_e=e(we,ie),Oe=_?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",ve=_?"[\\uE000-\\uF8FF]":"[]",ue=e(v,P,"[\\-\\.\\_\\~]",Oe),be=r(v+e(v,P,"[\\+\\-\\.]")+"*"),fe=r(r(de+"|"+e(ue,ie,"[\\:]"))+"*"),Mt=r(r("25[0-5]")+"|"+r("2[0-4]"+P)+"|"+r("1"+P+P)+"|"+r("[1-9]"+P)+"|"+P),ze=r(r("25[0-5]")+"|"+r("2[0-4]"+P)+"|"+r("1"+P+P)+"|"+r("0?[1-9]"+P)+"|0?0?"+P),Xe=r(ze+"\\."+ze+"\\."+ze+"\\."+ze),he=r(V+"{1,4}"),Ze=r(r(he+"\\:"+he)+"|"+Xe),Qe=r(r(he+"\\:")+"{6}"+Ze),ut=r("\\:\\:"+r(he+"\\:")+"{5}"+Ze),Ut=r(r(he)+"?\\:\\:"+r(he+"\\:")+"{4}"+Ze),yt=r(r(r(he+"\\:")+"{0,1}"+he)+"?\\:\\:"+r(he+"\\:")+"{3}"+Ze),$r=r(r(r(he+"\\:")+"{0,2}"+he)+"?\\:\\:"+r(he+"\\:")+"{2}"+Ze),Wr=r(r(r(he+"\\:")+"{0,3}"+he)+"?\\:\\:"+he+"\\:"+Ze),Xr=r(r(r(he+"\\:")+"{0,4}"+he)+"?\\:\\:"+Ze),ur=r(r(r(he+"\\:")+"{0,5}"+he)+"?\\:\\:"+he),dr=r(r(r(he+"\\:")+"{0,6}"+he)+"?\\:\\:"),_t=r([Qe,ut,Ut,yt,$r,Wr,Xr,ur,dr].join("|")),pr=r(r(ue+"|"+de)+"+"),Gs=r(_t+"\\%25"+pr),qt=r(_t+r("\\%25|\\%(?!"+V+"{2})")+pr),Yl=r("[vV]"+V+"+\\."+e(ue,ie,"[\\:]")+"+"),Jl=r("\\["+r(qt+"|"+_t+"|"+Yl)+"\\]"),Rn=r(r(de+"|"+e(ue,ie))+"*"),Ar=r(Jl+"|"+Xe+"(?!"+Rn+")|"+Rn),Nr=r(P+"*"),wn=r(r(fe+"@")+"?"+Ar+r("\\:"+Nr)+"?"),Dr=r(de+"|"+e(ue,ie,"[\\:\\@]")),eu=r(Dr+"*"),On=r(Dr+"+"),tu=r(r(de+"|"+e(ue,ie,"[\\@]"))+"+"),bt=r(r("\\/"+eu)+"*"),fr=r("\\/"+r(On+bt)+"?"),Ws=r(tu+bt),Qr=r(On+bt),hr="(?!"+Dr+")",qh=r(bt+"|"+fr+"|"+Ws+"|"+Qr+"|"+hr),mr=r(r(Dr+"|"+e("[\\/\\?]",ve))+"*"),Cr=r(r(Dr+"|[\\/\\?]")+"*"),Pn=r(r("\\/\\/"+wn+bt)+"|"+fr+"|"+Qr+"|"+hr),ru=r(be+"\\:"+Pn+r("\\?"+mr)+"?"+r("\\#"+Cr)+"?"),su=r(r("\\/\\/"+wn+bt)+"|"+fr+"|"+Ws+"|"+hr),au=r(su+r("\\?"+mr)+"?"+r("\\#"+Cr)+"?"),Bh=r(ru+"|"+au),Vh=r(be+"\\:"+Pn+r("\\?"+mr)+"?"),Hh="^("+be+")\\:"+r(r("\\/\\/("+r("("+fe+")@")+"?("+Ar+")"+r("\\:("+Nr+")")+"?)")+"?("+bt+"|"+fr+"|"+Qr+"|"+hr+")")+r("\\?("+mr+")")+"?"+r("\\#("+Cr+")")+"?$",zh="^(){0}"+r(r("\\/\\/("+r("("+fe+")@")+"?("+Ar+")"+r("\\:("+Nr+")")+"?)")+"?("+bt+"|"+fr+"|"+Ws+"|"+hr+")")+r("\\?("+mr+")")+"?"+r("\\#("+Cr+")")+"?$",Zh="^("+be+")\\:"+r(r("\\/\\/("+r("("+fe+")@")+"?("+Ar+")"+r("\\:("+Nr+")")+"?)")+"?("+bt+"|"+fr+"|"+Qr+"|"+hr+")")+r("\\?("+mr+")")+"?$",Gh="^"+r("\\#("+Cr+")")+"?$",Wh="^"+r("("+fe+")@")+"?("+Ar+")"+r("\\:("+Nr+")")+"?$";return{NOT_SCHEME:new RegExp(e("[^]",v,P,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(e("[^\\%\\:]",ue,ie),"g"),NOT_HOST:new RegExp(e("[^\\%\\[\\]\\:]",ue,ie),"g"),NOT_PATH:new RegExp(e("[^\\%\\/\\:\\@]",ue,ie),"g"),NOT_PATH_NOSCHEME:new RegExp(e("[^\\%\\/\\@]",ue,ie),"g"),NOT_QUERY:new RegExp(e("[^\\%]",ue,ie,"[\\:\\@\\/\\?]",ve),"g"),NOT_FRAGMENT:new RegExp(e("[^\\%]",ue,ie,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(e("[^]",ue,ie),"g"),UNRESERVED:new RegExp(ue,"g"),OTHER_CHARS:new RegExp(e("[^\\%]",ue,_e),"g"),PCT_ENCODED:new RegExp(de,"g"),IPV4ADDRESS:new RegExp("^("+Xe+")$"),IPV6ADDRESS:new RegExp("^\\[?("+_t+")"+r(r("\\%25|\\%(?!"+V+"{2})")+"("+pr+")")+"?\\]?$")}}var l=o(!1),u=o(!0),d=(function(){function _(v,b){var P=[],$=!0,V=!1,te=void 0;try{for(var le=v[Symbol.iterator](),de;!($=(de=le.next()).done)&&(P.push(de.value),!(b&&P.length===b));$=!0);}catch(we){V=!0,te=we}finally{try{!$&&le.return&&le.return()}finally{if(V)throw te}}return P}return function(v,b){if(Array.isArray(v))return v;if(Symbol.iterator in Object(v))return _(v,b);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),f=function(_){if(Array.isArray(_)){for(var v=0,b=Array(_.length);v<_.length;v++)b[v]=_[v];return b}else return Array.from(_)},m=2147483647,p=36,y=1,h=26,g=38,S=700,O=72,E=128,T="-",w=/^xn--/,x=/[^\0-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,D={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=p-y,C=Math.floor,L=String.fromCharCode;function j(_){throw new RangeError(D[_])}function R(_,v){for(var b=[],P=_.length;P--;)b[P]=v(_[P]);return b}function I(_,v){var b=_.split("@"),P="";b.length>1&&(P=b[0]+"@",_=b[1]),_=_.replace(A,".");var $=_.split("."),V=R($,v).join(".");return P+V}function k(_){for(var v=[],b=0,P=_.length;b<P;){var $=_.charCodeAt(b++);if($>=55296&&$<=56319&&b<P){var V=_.charCodeAt(b++);(V&64512)==56320?v.push((($&1023)<<10)+(V&1023)+65536):(v.push($),b--)}else v.push($)}return v}var W=function(v){return String.fromCodePoint.apply(String,f(v))},X=function(v){return v-48<10?v-22:v-65<26?v-65:v-97<26?v-97:p},Y=function(v,b){return v+22+75*(v<26)-((b!=0)<<5)},H=function(v,b,P){var $=0;for(v=P?C(v/S):v>>1,v+=C(v/b);v>N*h>>1;$+=p)v=C(v/N);return C($+(N+1)*v/(v+g))},z=function(v){var b=[],P=v.length,$=0,V=E,te=O,le=v.lastIndexOf(T);le<0&&(le=0);for(var de=0;de<le;++de)v.charCodeAt(de)>=128&&j("not-basic"),b.push(v.charCodeAt(de));for(var we=le>0?le+1:0;we<P;){for(var ie=$,_e=1,Oe=p;;Oe+=p){we>=P&&j("invalid-input");var ve=X(v.charCodeAt(we++));(ve>=p||ve>C((m-$)/_e))&&j("overflow"),$+=ve*_e;var ue=Oe<=te?y:Oe>=te+h?h:Oe-te;if(ve<ue)break;var be=p-ue;_e>C(m/be)&&j("overflow"),_e*=be}var fe=b.length+1;te=H($-ie,fe,ie==0),C($/fe)>m-V&&j("overflow"),V+=C($/fe),$%=fe,b.splice($++,0,V)}return String.fromCodePoint.apply(String,b)},ae=function(v){var b=[];v=k(v);var P=v.length,$=E,V=0,te=O,le=!0,de=!1,we=void 0;try{for(var ie=v[Symbol.iterator](),_e;!(le=(_e=ie.next()).done);le=!0){var Oe=_e.value;Oe<128&&b.push(L(Oe))}}catch(qt){de=!0,we=qt}finally{try{!le&&ie.return&&ie.return()}finally{if(de)throw we}}var ve=b.length,ue=ve;for(ve&&b.push(T);ue<P;){var be=m,fe=!0,Mt=!1,ze=void 0;try{for(var Xe=v[Symbol.iterator](),he;!(fe=(he=Xe.next()).done);fe=!0){var Ze=he.value;Ze>=$&&Ze<be&&(be=Ze)}}catch(qt){Mt=!0,ze=qt}finally{try{!fe&&Xe.return&&Xe.return()}finally{if(Mt)throw ze}}var Qe=ue+1;be-$>C((m-V)/Qe)&&j("overflow"),V+=(be-$)*Qe,$=be;var ut=!0,Ut=!1,yt=void 0;try{for(var $r=v[Symbol.iterator](),Wr;!(ut=(Wr=$r.next()).done);ut=!0){var Xr=Wr.value;if(Xr<$&&++V>m&&j("overflow"),Xr==$){for(var ur=V,dr=p;;dr+=p){var _t=dr<=te?y:dr>=te+h?h:dr-te;if(ur<_t)break;var pr=ur-_t,Gs=p-_t;b.push(L(Y(_t+pr%Gs,0))),ur=C(pr/Gs)}b.push(L(Y(ur,0))),te=H(V,Qe,ue==ve),V=0,++ue}}}catch(qt){Ut=!0,yt=qt}finally{try{!ut&&$r.return&&$r.return()}finally{if(Ut)throw yt}}++V,++$}return b.join("")},pe=function(v){return I(v,function(b){return w.test(b)?z(b.slice(4).toLowerCase()):b})},Pe=function(v){return I(v,function(b){return x.test(b)?"xn--"+ae(b):b})},J={version:"2.1.0",ucs2:{decode:k,encode:W},decode:z,encode:ae,toASCII:Pe,toUnicode:pe},Ee={};function Se(_){var v=_.charCodeAt(0),b=void 0;return v<16?b="%0"+v.toString(16).toUpperCase():v<128?b="%"+v.toString(16).toUpperCase():v<2048?b="%"+(v>>6|192).toString(16).toUpperCase()+"%"+(v&63|128).toString(16).toUpperCase():b="%"+(v>>12|224).toString(16).toUpperCase()+"%"+(v>>6&63|128).toString(16).toUpperCase()+"%"+(v&63|128).toString(16).toUpperCase(),b}function Re(_){for(var v="",b=0,P=_.length;b<P;){var $=parseInt(_.substr(b+1,2),16);if($<128)v+=String.fromCharCode($),b+=3;else if($>=194&&$<224){if(P-b>=6){var V=parseInt(_.substr(b+4,2),16);v+=String.fromCharCode(($&31)<<6|V&63)}else v+=_.substr(b,6);b+=6}else if($>=224){if(P-b>=9){var te=parseInt(_.substr(b+4,2),16),le=parseInt(_.substr(b+7,2),16);v+=String.fromCharCode(($&15)<<12|(te&63)<<6|le&63)}else v+=_.substr(b,9);b+=9}else v+=_.substr(b,3),b+=3}return v}function Me(_,v){function b(P){var $=Re(P);return $.match(v.UNRESERVED)?$:P}return _.scheme&&(_.scheme=String(_.scheme).replace(v.PCT_ENCODED,b).toLowerCase().replace(v.NOT_SCHEME,"")),_.userinfo!==void 0&&(_.userinfo=String(_.userinfo).replace(v.PCT_ENCODED,b).replace(v.NOT_USERINFO,Se).replace(v.PCT_ENCODED,t)),_.host!==void 0&&(_.host=String(_.host).replace(v.PCT_ENCODED,b).toLowerCase().replace(v.NOT_HOST,Se).replace(v.PCT_ENCODED,t)),_.path!==void 0&&(_.path=String(_.path).replace(v.PCT_ENCODED,b).replace(_.scheme?v.NOT_PATH:v.NOT_PATH_NOSCHEME,Se).replace(v.PCT_ENCODED,t)),_.query!==void 0&&(_.query=String(_.query).replace(v.PCT_ENCODED,b).replace(v.NOT_QUERY,Se).replace(v.PCT_ENCODED,t)),_.fragment!==void 0&&(_.fragment=String(_.fragment).replace(v.PCT_ENCODED,b).replace(v.NOT_FRAGMENT,Se).replace(v.PCT_ENCODED,t)),_}function rt(_){return _.replace(/^0*(.*)/,"$1")||"0"}function ye(_,v){var b=_.match(v.IPV4ADDRESS)||[],P=d(b,2),$=P[1];return $?$.split(".").map(rt).join("."):_}function me(_,v){var b=_.match(v.IPV6ADDRESS)||[],P=d(b,3),$=P[1],V=P[2];if($){for(var te=$.toLowerCase().split("::").reverse(),le=d(te,2),de=le[0],we=le[1],ie=we?we.split(":").map(rt):[],_e=de.split(":").map(rt),Oe=v.IPV4ADDRESS.test(_e[_e.length-1]),ve=Oe?7:8,ue=_e.length-ve,be=Array(ve),fe=0;fe<ve;++fe)be[fe]=ie[fe]||_e[ue+fe]||"";Oe&&(be[ve-1]=ye(be[ve-1],v));var Mt=be.reduce(function(Qe,ut,Ut){if(!ut||ut==="0"){var yt=Qe[Qe.length-1];yt&&yt.index+yt.length===Ut?yt.length++:Qe.push({index:Ut,length:1})}return Qe},[]),ze=Mt.sort(function(Qe,ut){return ut.length-Qe.length})[0],Xe=void 0;if(ze&&ze.length>1){var he=be.slice(0,ze.index),Ze=be.slice(ze.index+ze.length);Xe=he.join(":")+"::"+Ze.join(":")}else Xe=be.join(":");return V&&(Xe+="%"+V),Xe}else return _}var vt=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Ie="".match(/(){0}/)[1]===void 0;function ce(_){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b={},P=v.iri!==!1?u:l;v.reference==="suffix"&&(_=(v.scheme?v.scheme+":":"")+"//"+_);var $=_.match(vt);if($){Ie?(b.scheme=$[1],b.userinfo=$[3],b.host=$[4],b.port=parseInt($[5],10),b.path=$[6]||"",b.query=$[7],b.fragment=$[8],isNaN(b.port)&&(b.port=$[5])):(b.scheme=$[1]||void 0,b.userinfo=_.indexOf("@")!==-1?$[3]:void 0,b.host=_.indexOf("//")!==-1?$[4]:void 0,b.port=parseInt($[5],10),b.path=$[6]||"",b.query=_.indexOf("?")!==-1?$[7]:void 0,b.fragment=_.indexOf("#")!==-1?$[8]:void 0,isNaN(b.port)&&(b.port=_.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?$[4]:void 0)),b.host&&(b.host=me(ye(b.host,P),P)),b.scheme===void 0&&b.userinfo===void 0&&b.host===void 0&&b.port===void 0&&!b.path&&b.query===void 0?b.reference="same-document":b.scheme===void 0?b.reference="relative":b.fragment===void 0?b.reference="absolute":b.reference="uri",v.reference&&v.reference!=="suffix"&&v.reference!==b.reference&&(b.error=b.error||"URI is not a "+v.reference+" reference.");var V=Ee[(v.scheme||b.scheme||"").toLowerCase()];if(!v.unicodeSupport&&(!V||!V.unicodeSupport)){if(b.host&&(v.domainHost||V&&V.domainHost))try{b.host=J.toASCII(b.host.replace(P.PCT_ENCODED,Re).toLowerCase())}catch(te){b.error=b.error||"Host's domain name can not be converted to ASCII via punycode: "+te}Me(b,l)}else Me(b,P);V&&V.parse&&V.parse(b,v)}else b.error=b.error||"URI can not be parsed.";return b}function wt(_,v){var b=v.iri!==!1?u:l,P=[];return _.userinfo!==void 0&&(P.push(_.userinfo),P.push("@")),_.host!==void 0&&P.push(me(ye(String(_.host),b),b).replace(b.IPV6ADDRESS,function($,V,te){return"["+V+(te?"%25"+te:"")+"]"})),(typeof _.port=="number"||typeof _.port=="string")&&(P.push(":"),P.push(String(_.port))),P.length?P.join(""):void 0}var gt=/^\.\.?\//,jt=/^\/\.(\/|$)/,Ft=/^\/\.\.(\/|$)/,Ae=/^\/?(?:.|\n)*?(?=\/|$)/;function We(_){for(var v=[];_.length;)if(_.match(gt))_=_.replace(gt,"");else if(_.match(jt))_=_.replace(jt,"/");else if(_.match(Ft))_=_.replace(Ft,"/"),v.pop();else if(_==="."||_==="..")_="";else{var b=_.match(Ae);if(b){var P=b[0];_=_.slice(P.length),v.push(P)}else throw new Error("Unexpected dot segment condition")}return v.join("")}function Ue(_){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b=v.iri?u:l,P=[],$=Ee[(v.scheme||_.scheme||"").toLowerCase()];if($&&$.serialize&&$.serialize(_,v),_.host&&!b.IPV6ADDRESS.test(_.host)){if(v.domainHost||$&&$.domainHost)try{_.host=v.iri?J.toUnicode(_.host):J.toASCII(_.host.replace(b.PCT_ENCODED,Re).toLowerCase())}catch(le){_.error=_.error||"Host's domain name can not be converted to "+(v.iri?"Unicode":"ASCII")+" via punycode: "+le}}Me(_,b),v.reference!=="suffix"&&_.scheme&&(P.push(_.scheme),P.push(":"));var V=wt(_,v);if(V!==void 0&&(v.reference!=="suffix"&&P.push("//"),P.push(V),_.path&&_.path.charAt(0)!=="/"&&P.push("/")),_.path!==void 0){var te=_.path;!v.absolutePath&&(!$||!$.absolutePath)&&(te=We(te)),V===void 0&&(te=te.replace(/^\/\//,"/%2F")),P.push(te)}return _.query!==void 0&&(P.push("?"),P.push(_.query)),_.fragment!==void 0&&(P.push("#"),P.push(_.fragment)),P.join("")}function Le(_,v){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments[3],$={};return P||(_=ce(Ue(_,b),b),v=ce(Ue(v,b),b)),b=b||{},!b.tolerant&&v.scheme?($.scheme=v.scheme,$.userinfo=v.userinfo,$.host=v.host,$.port=v.port,$.path=We(v.path||""),$.query=v.query):(v.userinfo!==void 0||v.host!==void 0||v.port!==void 0?($.userinfo=v.userinfo,$.host=v.host,$.port=v.port,$.path=We(v.path||""),$.query=v.query):(v.path?(v.path.charAt(0)==="/"?$.path=We(v.path):((_.userinfo!==void 0||_.host!==void 0||_.port!==void 0)&&!_.path?$.path="/"+v.path:_.path?$.path=_.path.slice(0,_.path.lastIndexOf("/")+1)+v.path:$.path=v.path,$.path=We($.path)),$.query=v.query):($.path=_.path,v.query!==void 0?$.query=v.query:$.query=_.query),$.userinfo=_.userinfo,$.host=_.host,$.port=_.port),$.scheme=_.scheme),$.fragment=v.fragment,$}function ct(_,v,b){var P=i({scheme:"null"},b);return Ue(Le(ce(_,P),ce(v,P),P,!0),P)}function He(_,v){return typeof _=="string"?_=Ue(ce(_,v),v):a(_)==="object"&&(_=ce(Ue(_,v),v)),_}function Gr(_,v,b){return typeof _=="string"?_=Ue(ce(_,b),b):a(_)==="object"&&(_=Ue(_,b)),typeof v=="string"?v=Ue(ce(v,b),b):a(v)==="object"&&(v=Ue(v,b)),_===v}function zs(_,v){return _&&_.toString().replace(!v||!v.iri?l.ESCAPE:u.ESCAPE,Se)}function st(_,v){return _&&_.toString().replace(!v||!v.iri?l.PCT_ENCODED:u.PCT_ENCODED,Re)}var Pr={scheme:"http",domainHost:!0,parse:function(v,b){return v.host||(v.error=v.error||"HTTP URIs must have a host."),v},serialize:function(v,b){var P=String(v.scheme).toLowerCase()==="https";return(v.port===(P?443:80)||v.port==="")&&(v.port=void 0),v.path||(v.path="/"),v}},gn={scheme:"https",domainHost:Pr.domainHost,parse:Pr.parse,serialize:Pr.serialize};function yn(_){return typeof _.secure=="boolean"?_.secure:String(_.scheme).toLowerCase()==="wss"}var Ir={scheme:"ws",domainHost:!0,parse:function(v,b){var P=v;return P.secure=yn(P),P.resourceName=(P.path||"/")+(P.query?"?"+P.query:""),P.path=void 0,P.query=void 0,P},serialize:function(v,b){if((v.port===(yn(v)?443:80)||v.port==="")&&(v.port=void 0),typeof v.secure=="boolean"&&(v.scheme=v.secure?"wss":"ws",v.secure=void 0),v.resourceName){var P=v.resourceName.split("?"),$=d(P,2),V=$[0],te=$[1];v.path=V&&V!=="/"?V:void 0,v.query=te,v.resourceName=void 0}return v.fragment=void 0,v}},_n={scheme:"wss",domainHost:Ir.domainHost,parse:Ir.parse,serialize:Ir.serialize},Ul={},ql=!0,bn="[A-Za-z0-9\\-\\.\\_\\~"+(ql?"\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF":"")+"]",lt="[0-9A-Fa-f]",Bl=r(r("%[EFef]"+lt+"%"+lt+lt+"%"+lt+lt)+"|"+r("%[89A-Fa-f]"+lt+"%"+lt+lt)+"|"+r("%"+lt+lt)),Vl="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Hl="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",zl=e(Hl,'[\\"\\\\]'),Zl="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Gl=new RegExp(bn,"g"),lr=new RegExp(Bl,"g"),Wl=new RegExp(e("[^]",Vl,"[\\.]",'[\\"]',zl),"g"),En=new RegExp(e("[^]",bn,Zl),"g"),Xl=En;function Zs(_){var v=Re(_);return v.match(Gl)?v:_}var Sn={scheme:"mailto",parse:function(v,b){var P=v,$=P.to=P.path?P.path.split(","):[];if(P.path=void 0,P.query){for(var V=!1,te={},le=P.query.split("&"),de=0,we=le.length;de<we;++de){var ie=le[de].split("=");switch(ie[0]){case"to":for(var _e=ie[1].split(","),Oe=0,ve=_e.length;Oe<ve;++Oe)$.push(_e[Oe]);break;case"subject":P.subject=st(ie[1],b);break;case"body":P.body=st(ie[1],b);break;default:V=!0,te[st(ie[0],b)]=st(ie[1],b);break}}V&&(P.headers=te)}P.query=void 0;for(var ue=0,be=$.length;ue<be;++ue){var fe=$[ue].split("@");if(fe[0]=st(fe[0]),b.unicodeSupport)fe[1]=st(fe[1],b).toLowerCase();else try{fe[1]=J.toASCII(st(fe[1],b).toLowerCase())}catch(Mt){P.error=P.error||"Email address's domain name can not be converted to ASCII via punycode: "+Mt}$[ue]=fe.join("@")}return P},serialize:function(v,b){var P=v,$=n(v.to);if($){for(var V=0,te=$.length;V<te;++V){var le=String($[V]),de=le.lastIndexOf("@"),we=le.slice(0,de).replace(lr,Zs).replace(lr,t).replace(Wl,Se),ie=le.slice(de+1);try{ie=b.iri?J.toUnicode(ie):J.toASCII(st(ie,b).toLowerCase())}catch(ue){P.error=P.error||"Email address's domain name can not be converted to "+(b.iri?"Unicode":"ASCII")+" via punycode: "+ue}$[V]=we+"@"+ie}P.path=$.join(",")}var _e=v.headers=v.headers||{};v.subject&&(_e.subject=v.subject),v.body&&(_e.body=v.body);var Oe=[];for(var ve in _e)_e[ve]!==Ul[ve]&&Oe.push(ve.replace(lr,Zs).replace(lr,t).replace(En,Se)+"="+_e[ve].replace(lr,Zs).replace(lr,t).replace(Xl,Se));return Oe.length&&(P.query=Oe.join("&")),P}},Ql=/^([^\:]+)\:(.*)/,xn={scheme:"urn",parse:function(v,b){var P=v.path&&v.path.match(Ql),$=v;if(P){var V=b.scheme||$.scheme||"urn",te=P[1].toLowerCase(),le=P[2],de=V+":"+(b.nid||te),we=Ee[de];$.nid=te,$.nss=le,$.path=void 0,we&&($=we.parse($,b))}else $.error=$.error||"URN can not be parsed.";return $},serialize:function(v,b){var P=b.scheme||v.scheme||"urn",$=v.nid,V=P+":"+(b.nid||$),te=Ee[V];te&&(v=te.serialize(v,b));var le=v,de=v.nss;return le.path=($||b.nid)+":"+de,le}},Kl=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Tn={scheme:"urn:uuid",parse:function(v,b){var P=v;return P.uuid=P.nss,P.nss=void 0,!b.tolerant&&(!P.uuid||!P.uuid.match(Kl))&&(P.error=P.error||"UUID is not valid."),P},serialize:function(v,b){var P=v;return P.nss=(v.uuid||"").toLowerCase(),P}};Ee[Pr.scheme]=Pr,Ee[gn.scheme]=gn,Ee[Ir.scheme]=Ir,Ee[_n.scheme]=_n,Ee[Sn.scheme]=Sn,Ee[xn.scheme]=xn,Ee[Tn.scheme]=Tn,s.SCHEMES=Ee,s.pctEncChar=Se,s.pctDecChars=Re,s.parse=ce,s.removeDotSegments=We,s.serialize=Ue,s.resolveComponents=Le,s.resolve=ct,s.normalize=He,s.equal=Gr,s.escapeComponent=zs,s.unescapeComponent=st,Object.defineProperty(s,"__esModule",{value:!0})}))});var fs=G((Dm,ao)=>{"use strict";ao.exports=function s(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var a,t,n;if(Array.isArray(e)){if(a=e.length,a!=r.length)return!1;for(t=a;t--!==0;)if(!s(e[t],r[t]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(n=Object.keys(e),a=n.length,a!==Object.keys(r).length)return!1;for(t=a;t--!==0;)if(!Object.prototype.hasOwnProperty.call(r,n[t]))return!1;for(t=a;t--!==0;){var i=n[t];if(!s(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var oo=G((Cm,no)=>{"use strict";no.exports=function(e){for(var r=0,a=e.length,t=0,n;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}});var nr=G((km,lo)=>{"use strict";lo.exports={copy:up,checkDataType:ba,checkDataTypes:dp,coerceToTypes:pp,toHash:Sa,getProperty:xa,escapeQuotes:Ta,equal:fs(),ucs2length:oo(),varOccurences:mp,varReplace:vp,schemaHasRules:gp,schemaHasRulesExcept:yp,schemaUnknownRules:_p,toQuotedString:Ea,getPathExpr:bp,getPath:Ep,getData:Tp,unescapeFragment:Rp,unescapeJsonPointer:wa,escapeFragment:wp,escapeJsonPointer:Ra};function up(s,e){e=e||{};for(var r in s)e[r]=s[r];return e}function ba(s,e,r,a){var t=a?" !== ":" === ",n=a?" || ":" && ",i=a?"!":"",o=a?"":"!";switch(s){case"null":return e+t+"null";case"array":return i+"Array.isArray("+e+")";case"object":return"("+i+e+n+"typeof "+e+t+'"object"'+n+o+"Array.isArray("+e+"))";case"integer":return"(typeof "+e+t+'"number"'+n+o+"("+e+" % 1)"+n+e+t+e+(r?n+i+"isFinite("+e+")":"")+")";case"number":return"(typeof "+e+t+'"'+s+'"'+(r?n+i+"isFinite("+e+")":"")+")";default:return"typeof "+e+t+'"'+s+'"'}}function dp(s,e,r){switch(s.length){case 1:return ba(s[0],e,r,!0);default:var a="",t=Sa(s);t.array&&t.object&&(a=t.null?"(":"(!"+e+" || ",a+="typeof "+e+' !== "object")',delete t.null,delete t.array,delete t.object),t.number&&delete t.integer;for(var n in t)a+=(a?" && ":"")+ba(n,e,r,!0);return a}}var io=Sa(["string","number","integer","boolean","null"]);function pp(s,e){if(Array.isArray(e)){for(var r=[],a=0;a<e.length;a++){var t=e[a];(io[t]||s==="array"&&t==="array")&&(r[r.length]=t)}if(r.length)return r}else{if(io[e])return[e];if(s==="array"&&e==="array")return["array"]}}function Sa(s){for(var e={},r=0;r<s.length;r++)e[s[r]]=!0;return e}var fp=/^[a-z$_][a-z$_0-9]*$/i,hp=/'|\\/g;function xa(s){return typeof s=="number"?"["+s+"]":fp.test(s)?"."+s:"['"+Ta(s)+"']"}function Ta(s){return s.replace(hp,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function mp(s,e){e+="[^0-9]";var r=s.match(new RegExp(e,"g"));return r?r.length:0}function vp(s,e,r){return e+="([^0-9])",r=r.replace(/\$/g,"$$$$"),s.replace(new RegExp(e,"g"),r+"$1")}function gp(s,e){if(typeof s=="boolean")return!s;for(var r in s)if(e[r])return!0}function yp(s,e,r){if(typeof s=="boolean")return!s&&r!="not";for(var a in s)if(a!=r&&e[a])return!0}function _p(s,e){if(typeof s!="boolean"){for(var r in s)if(!e[r])return r}}function Ea(s){return"'"+Ta(s)+"'"}function bp(s,e,r,a){var t=r?"'/' + "+e+(a?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):a?"'[' + "+e+" + ']'":"'[\\'' + "+e+" + '\\']'";return co(s,t)}function Ep(s,e,r){var a=Ea(r?"/"+Ra(e):xa(e));return co(s,a)}var Sp=/^\/(?:[^~]|~0|~1)*$/,xp=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Tp(s,e,r){var a,t,n,i;if(s==="")return"rootData";if(s[0]=="/"){if(!Sp.test(s))throw new Error("Invalid JSON-pointer: "+s);t=s,n="rootData"}else{if(i=s.match(xp),!i)throw new Error("Invalid JSON-pointer: "+s);if(a=+i[1],t=i[2],t=="#"){if(a>=e)throw new Error("Cannot access property/index "+a+" levels up, current level is "+e);return r[e-a]}if(a>e)throw new Error("Cannot access data "+a+" levels up, current level is "+e);if(n="data"+(e-a||""),!t)return n}for(var o=n,l=t.split("/"),u=0;u<l.length;u++){var d=l[u];d&&(n+=xa(wa(d)),o+=" && "+n)}return o}function co(s,e){return s=='""'?e:(s+" + "+e).replace(/([^\\])' \+ '/g,"$1")}function Rp(s){return wa(decodeURIComponent(s))}function wp(s){return encodeURIComponent(Ra(s))}function Ra(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}function wa(s){return s.replace(/~1/g,"/").replace(/~0/g,"~")}});var Oa=G((Lm,uo)=>{"use strict";var Op=nr();uo.exports=Pp;function Pp(s){Op.copy(s,this)}});var fo=G((jm,po)=>{"use strict";var At=po.exports=function(s,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var a=typeof r=="function"?r:r.pre||function(){},t=r.post||function(){};hs(e,a,t,s,"",s)};At.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0};At.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};At.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};At.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function hs(s,e,r,a,t,n,i,o,l,u){if(a&&typeof a=="object"&&!Array.isArray(a)){e(a,t,n,i,o,l,u);for(var d in a){var f=a[d];if(Array.isArray(f)){if(d in At.arrayKeywords)for(var m=0;m<f.length;m++)hs(s,e,r,f[m],t+"/"+d+"/"+m,n,t,d,a,m)}else if(d in At.propsKeywords){if(f&&typeof f=="object")for(var p in f)hs(s,e,r,f[p],t+"/"+d+"/"+Ip(p),n,t,d,a,p)}else(d in At.keywords||s.allKeys&&!(d in At.skipKeywords))&&hs(s,e,r,f,t+"/"+d,n,t,d,a)}r(a,t,n,i,o,l,u)}}function Ip(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}});var bs=G((Fm,go)=>{"use strict";var Vr=so(),ho=fs(),ys=nr(),ms=Oa(),$p=fo();go.exports=Dt;Dt.normalizeId=Nt;Dt.fullPath=vs;Dt.url=gs;Dt.ids=kp;Dt.inlineRef=Pa;Dt.schema=_s;function Dt(s,e,r){var a=this._refs[r];if(typeof a=="string")if(this._refs[a])a=this._refs[a];else return Dt.call(this,s,e,a);if(a=a||this._schemas[r],a instanceof ms)return Pa(a.schema,this._opts.inlineRefs)?a.schema:a.validate||this._compile(a);var t=_s.call(this,e,r),n,i,o;return t&&(n=t.schema,e=t.root,o=t.baseId),n instanceof ms?i=n.validate||s.call(this,n.schema,e,void 0,o):n!==void 0&&(i=Pa(n,this._opts.inlineRefs)?n:s.call(this,n,e,void 0,o)),i}function _s(s,e){var r=Vr.parse(e),a=vo(r),t=vs(this._getId(s.schema));if(Object.keys(s.schema).length===0||a!==t){var n=Nt(a),i=this._refs[n];if(typeof i=="string")return Ap.call(this,s,i,r);if(i instanceof ms)i.validate||this._compile(i),s=i;else if(i=this._schemas[n],i instanceof ms){if(i.validate||this._compile(i),n==Nt(e))return{schema:i,root:s,baseId:t};s=i}else return;if(!s.schema)return;t=vs(this._getId(s.schema))}return mo.call(this,r,t,s.schema,s)}function Ap(s,e,r){var a=_s.call(this,s,e);if(a){var t=a.schema,n=a.baseId;s=a.root;var i=this._getId(t);return i&&(n=gs(n,i)),mo.call(this,r,n,t,s)}}var Np=ys.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function mo(s,e,r,a){if(s.fragment=s.fragment||"",s.fragment.slice(0,1)=="/"){for(var t=s.fragment.split("/"),n=1;n<t.length;n++){var i=t[n];if(i){if(i=ys.unescapeFragment(i),r=r[i],r===void 0)break;var o;if(!Np[i]&&(o=this._getId(r),o&&(e=gs(e,o)),r.$ref)){var l=gs(e,r.$ref),u=_s.call(this,a,l);u&&(r=u.schema,a=u.root,e=u.baseId)}}}if(r!==void 0&&r!==a.schema)return{schema:r,root:a,baseId:e}}}var Dp=ys.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function Pa(s,e){if(e===!1)return!1;if(e===void 0||e===!0)return Ia(s);if(e)return $a(s)<=e}function Ia(s){var e;if(Array.isArray(s)){for(var r=0;r<s.length;r++)if(e=s[r],typeof e=="object"&&!Ia(e))return!1}else for(var a in s)if(a=="$ref"||(e=s[a],typeof e=="object"&&!Ia(e)))return!1;return!0}function $a(s){var e=0,r;if(Array.isArray(s)){for(var a=0;a<s.length;a++)if(r=s[a],typeof r=="object"&&(e+=$a(r)),e==1/0)return 1/0}else for(var t in s){if(t=="$ref")return 1/0;if(Dp[t])e++;else if(r=s[t],typeof r=="object"&&(e+=$a(r)+1),e==1/0)return 1/0}return e}function vs(s,e){e!==!1&&(s=Nt(s));var r=Vr.parse(s);return vo(r)}function vo(s){return Vr.serialize(s).split("#")[0]+"#"}var Cp=/#\/?$/;function Nt(s){return s?s.replace(Cp,""):""}function gs(s,e){return e=Nt(e),Vr.resolve(s,e)}function kp(s){var e=Nt(this._getId(s)),r={"":e},a={"":vs(e,!1)},t={},n=this;return $p(s,{allKeys:!0},function(i,o,l,u,d,f,m){if(o!==""){var p=n._getId(i),y=r[u],h=a[u]+"/"+d;if(m!==void 0&&(h+="/"+(typeof m=="number"?m:ys.escapeFragment(m))),typeof p=="string"){p=y=Nt(y?Vr.resolve(y,p):p);var g=n._refs[p];if(typeof g=="string"&&(g=n._refs[g]),g&&g.schema){if(!ho(i,g.schema))throw new Error('id "'+p+'" resolves to more than one schema')}else if(p!=Nt(h))if(p[0]=="#"){if(t[p]&&!ho(i,t[p]))throw new Error('id "'+p+'" resolves to more than one schema');t[p]=i}else n._refs[p]=h}r[o]=y,a[o]=h}}),t}});var Es=G((Mm,_o)=>{"use strict";var Aa=bs();_o.exports={Validation:yo(Lp),MissingRef:yo(Na)};function Lp(s){this.message="validation failed",this.errors=s,this.ajv=this.validation=!0}Na.message=function(s,e){return"can't resolve reference "+e+" from id "+s};function Na(s,e,r){this.message=r||Na.message(s,e),this.missingRef=Aa.url(s,e),this.missingSchema=Aa.normalizeId(Aa.fullPath(this.missingRef))}function yo(s){return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}});var Da=G((Um,bo)=>{"use strict";bo.exports=function(s,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var r=typeof e.cycles=="boolean"?e.cycles:!1,a=e.cmp&&(function(n){return function(i){return function(o,l){var u={key:o,value:i[o]},d={key:l,value:i[l]};return n(u,d)}}})(e.cmp),t=[];return(function n(i){if(i&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i!==void 0){if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);var o,l;if(Array.isArray(i)){for(l="[",o=0;o<i.length;o++)o&&(l+=","),l+=n(i[o])||"null";return l+"]"}if(i===null)return"null";if(t.indexOf(i)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=t.push(i)-1,d=Object.keys(i).sort(a&&a(i));for(l="",o=0;o<d.length;o++){var f=d[o],m=n(i[f]);m&&(l&&(l+=","),l+=JSON.stringify(f)+":"+m)}return t.splice(u,1),"{"+l+"}"}})(s)}});var Ca=G((qm,Eo)=>{"use strict";Eo.exports=function(e,r,a){var t="",n=e.schema.$async===!0,i=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.opts.strictKeywords){var l=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(l){var u="unknown keyword: "+l;if(e.opts.strictKeywords==="log")e.logger.warn(u);else throw new Error(u)}}if(e.isTop&&(t+=" var validate = ",n&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" "+("/*# sourceURL="+o+" */")+" ")),typeof e.schema=="boolean"||!(i||e.schema.$ref)){var r="false schema",d=e.level,f=e.dataLevel,m=e.schema[r],p=e.schemaPath+e.util.getProperty(r),y=e.errSchemaPath+"/"+r,w=!e.opts.allErrors,D,h="data"+(f||""),T="valid"+d;if(e.schema===!1){e.isTop?w=!0:t+=" var "+T+" = false; ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(D||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(y)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;t=g.pop(),!e.compositeRule&&w?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n?t+=" return data; ":t+=" validate.errors = null; return true; ":t+=" var "+T+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var O=e.isTop,d=e.level=0,f=e.dataLevel=0,h="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var E="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,f=e.dataLevel,h="data"+(f||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),n&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+d+" = errors;"}var T="valid"+d,w=!e.opts.allErrors,x="",A="",D,N=e.schema.type,C=Array.isArray(N);if(N&&e.opts.nullable&&e.schema.nullable===!0&&(C?N.indexOf("null")==-1&&(N=N.concat("null")):N!="null"&&(N=[N,"null"],C=!0)),C&&N.length==1&&(N=N[0],C=!1),e.schema.$ref&&i){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(i=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),N){if(e.opts.coerceTypes)var L=e.util.coerceToTypes(e.opts.coerceTypes,N);var j=e.RULES.types[N];if(L||C||j===!0||j&&!Ae(j)){var p=e.schemaPath+".type",y=e.errSchemaPath+"/type",p=e.schemaPath+".type",y=e.errSchemaPath+"/type",R=C?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[R](N,h,e.opts.strictNumbers,!0)+") { ",L){var I="dataType"+d,k="coerced"+d;t+=" var "+I+" = typeof "+h+"; var "+k+" = undefined; ",e.opts.coerceTypes=="array"&&(t+=" if ("+I+" == 'object' && Array.isArray("+h+") && "+h+".length == 1) { "+h+" = "+h+"[0]; "+I+" = typeof "+h+"; if ("+e.util.checkDataType(e.schema.type,h,e.opts.strictNumbers)+") "+k+" = "+h+"; } "),t+=" if ("+k+" !== undefined) ; ";var W=L;if(W)for(var X,Y=-1,H=W.length-1;Y<H;)X=W[Y+=1],X=="string"?t+=" else if ("+I+" == 'number' || "+I+" == 'boolean') "+k+" = '' + "+h+"; else if ("+h+" === null) "+k+" = ''; ":X=="number"||X=="integer"?(t+=" else if ("+I+" == 'boolean' || "+h+" === null || ("+I+" == 'string' && "+h+" && "+h+" == +"+h+" ",X=="integer"&&(t+=" && !("+h+" % 1)"),t+=")) "+k+" = +"+h+"; "):X=="boolean"?t+=" else if ("+h+" === 'false' || "+h+" === 0 || "+h+" === null) "+k+" = false; else if ("+h+" === 'true' || "+h+" === 1) "+k+" = true; ":X=="null"?t+=" else if ("+h+" === '' || "+h+" === 0 || "+h+" === false) "+k+" = null; ":e.opts.coerceTypes=="array"&&X=="array"&&(t+=" else if ("+I+" == 'string' || "+I+" == 'number' || "+I+" == 'boolean' || "+h+" == null) "+k+" = ["+h+"]; ");t+=" else {   ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(D||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(y)+" , params: { type: '",C?t+=""+N.join(","):t+=""+N,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",C?t+=""+N.join(","):t+=""+N,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;t=g.pop(),!e.compositeRule&&w?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+k+" !== undefined) {  ";var z=f?"data"+(f-1||""):"parentData",ae=f?e.dataPathArr[f]:"parentDataProperty";t+=" "+h+" = "+k+"; ",f||(t+="if ("+z+" !== undefined)"),t+=" "+z+"["+ae+"] = "+k+"; } "}else{var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(D||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(y)+" , params: { type: '",C?t+=""+N.join(","):t+=""+N,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",C?t+=""+N.join(","):t+=""+N,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;t=g.pop(),!e.compositeRule&&w?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!i)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",w&&(t+=" } if (errors === ",O?t+="0":t+="errs_"+d,t+=") { ",A+="}");else{var pe=e.RULES;if(pe){for(var j,Pe=-1,J=pe.length-1;Pe<J;)if(j=pe[Pe+=1],Ae(j)){if(j.type&&(t+=" if ("+e.util.checkDataType(j.type,h,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(j.type=="object"&&e.schema.properties){var m=e.schema.properties,Ee=Object.keys(m),Se=Ee;if(Se)for(var Re,Me=-1,rt=Se.length-1;Me<rt;){Re=Se[Me+=1];var ye=m[Re];if(ye.default!==void 0){var me=h+e.util.getProperty(Re);if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+me;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else t+=" if ("+me+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+me+" === null || "+me+" === '' "),t+=" ) "+me+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(ye.default)+" ":t+=" "+JSON.stringify(ye.default)+" ",t+="; "}}}else if(j.type=="array"&&Array.isArray(e.schema.items)){var vt=e.schema.items;if(vt){for(var ye,Y=-1,Ie=vt.length-1;Y<Ie;)if(ye=vt[Y+=1],ye.default!==void 0){var me=h+"["+Y+"]";if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+me;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else t+=" if ("+me+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+me+" === null || "+me+" === '' "),t+=" ) "+me+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(ye.default)+" ":t+=" "+JSON.stringify(ye.default)+" ",t+="; "}}}}var ce=j.rules;if(ce){for(var wt,gt=-1,jt=ce.length-1;gt<jt;)if(wt=ce[gt+=1],We(wt)){var Ft=wt.code(e,wt.keyword,j.type);Ft&&(t+=" "+Ft+" ",w&&(x+="}"))}}if(w&&(t+=" "+x+" ",x=""),j.type&&(t+=" } ",N&&N===j.type&&!L)){t+=" else { ";var p=e.schemaPath+".type",y=e.errSchemaPath+"/type",g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(D||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(y)+" , params: { type: '",C?t+=""+N.join(","):t+=""+N,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",C?t+=""+N.join(","):t+=""+N,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),t+=" } "):t+=" {} ";var S=t;t=g.pop(),!e.compositeRule&&w?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}w&&(t+=" if (errors === ",O?t+="0":t+="errs_"+d,t+=") { ",A+="}")}}}w&&(t+=" "+A+" "),O?(n?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+T+" = errors === errs_"+d+";";function Ae(Le){for(var ct=Le.rules,He=0;He<ct.length;He++)if(We(ct[He]))return!0}function We(Le){return e.schema[Le.keyword]!==void 0||Le.implements&&Ue(Le)}function Ue(Le){for(var ct=Le.implements,He=0;He<ct.length;He++)if(e.schema[ct[He]]!==void 0)return!0}return t}});var wo=G((Bm,Ro)=>{"use strict";var Ss=bs(),Ts=nr(),xo=Es(),jp=Da(),So=Ca(),Fp=Ts.ucs2length,Mp=fs(),Up=xo.Validation;Ro.exports=ka;function ka(s,e,r,a){var t=this,n=this._opts,i=[void 0],o={},l=[],u={},d=[],f={},m=[];e=e||{schema:s,refVal:i,refs:o};var p=qp.call(this,s,e,a),y=this._compilations[p.index];if(p.compiling)return y.callValidate=E;var h=this._formats,g=this.RULES;try{var S=T(s,e,r,a);y.validate=S;var O=y.callValidate;return O&&(O.schema=S.schema,O.errors=null,O.refs=S.refs,O.refVal=S.refVal,O.root=S.root,O.$async=S.$async,n.sourceCode&&(O.source=S.source)),S}finally{Bp.call(this,s,e,a)}function E(){var R=y.validate,I=R.apply(this,arguments);return E.errors=R.errors,I}function T(R,I,k,W){var X=!I||I&&I.schema==R;if(I.schema!=e.schema)return ka.call(t,R,I,k,W);var Y=R.$async===!0,H=So({isTop:!0,schema:R,isRoot:X,baseId:W,root:I,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:xo.MissingRef,RULES:g,validate:So,util:Ts,resolve:Ss,resolveRef:w,usePattern:C,useDefault:L,useCustomRule:j,opts:n,formats:h,logger:t.logger,self:t});H=xs(i,zp)+xs(l,Vp)+xs(d,Hp)+xs(m,Zp)+H,n.processCode&&(H=n.processCode(H,R));var z;try{var ae=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",H);z=ae(t,g,h,e,i,d,m,Mp,Fp,Up),i[0]=z}catch(pe){throw t.logger.error("Error compiling schema, function code:",H),pe}return z.schema=R,z.errors=null,z.refs=o,z.refVal=i,z.root=X?z:I,Y&&(z.$async=!0),n.sourceCode===!0&&(z.source={code:H,patterns:l,defaults:d}),z}function w(R,I,k){I=Ss.url(R,I);var W=o[I],X,Y;if(W!==void 0)return X=i[W],Y="refVal["+W+"]",N(X,Y);if(!k&&e.refs){var H=e.refs[I];if(H!==void 0)return X=e.refVal[H],Y=x(I,X),N(X,Y)}Y=x(I);var z=Ss.call(t,T,e,I);if(z===void 0){var ae=r&&r[I];ae&&(z=Ss.inlineRef(ae,n.inlineRefs)?ae:ka.call(t,ae,e,r,R))}if(z===void 0)A(I);else return D(I,z),N(z,Y)}function x(R,I){var k=i.length;return i[k]=I,o[R]=k,"refVal"+k}function A(R){delete o[R]}function D(R,I){var k=o[R];i[k]=I}function N(R,I){return typeof R=="object"||typeof R=="boolean"?{code:I,schema:R,inline:!0}:{code:I,$async:R&&!!R.$async}}function C(R){var I=u[R];return I===void 0&&(I=u[R]=l.length,l[I]=R),"pattern"+I}function L(R){switch(typeof R){case"boolean":case"number":return""+R;case"string":return Ts.toQuotedString(R);case"object":if(R===null)return"null";var I=jp(R),k=f[I];return k===void 0&&(k=f[I]=d.length,d[k]=R),"default"+k}}function j(R,I,k,W){if(t._opts.validateSchema!==!1){var X=R.definition.dependencies;if(X&&!X.every(function(Se){return Object.prototype.hasOwnProperty.call(k,Se)}))throw new Error("parent schema must have all required keywords: "+X.join(","));var Y=R.definition.validateSchema;if(Y){var H=Y(I);if(!H){var z="keyword schema is invalid: "+t.errorsText(Y.errors);if(t._opts.validateSchema=="log")t.logger.error(z);else throw new Error(z)}}}var ae=R.definition.compile,pe=R.definition.inline,Pe=R.definition.macro,J;if(ae)J=ae.call(t,I,k,W);else if(Pe)J=Pe.call(t,I,k,W),n.validateSchema!==!1&&t.validateSchema(J,!0);else if(pe)J=pe.call(t,W,R.keyword,I,k);else if(J=R.definition.validate,!J)return;if(J===void 0)throw new Error('custom keyword "'+R.keyword+'"failed to compile');var Ee=m.length;return m[Ee]=J,{code:"customRule"+Ee,validate:J}}}function qp(s,e,r){var a=To.call(this,s,e,r);return a>=0?{index:a,compiling:!0}:(a=this._compilations.length,this._compilations[a]={schema:s,root:e,baseId:r},{index:a,compiling:!1})}function Bp(s,e,r){var a=To.call(this,s,e,r);a>=0&&this._compilations.splice(a,1)}function To(s,e,r){for(var a=0;a<this._compilations.length;a++){var t=this._compilations[a];if(t.schema==s&&t.root==e&&t.baseId==r)return a}return-1}function Vp(s,e){return"var pattern"+s+" = new RegExp("+Ts.toQuotedString(e[s])+");"}function Hp(s){return"var default"+s+" = defaults["+s+"];"}function zp(s,e){return e[s]===void 0?"":"var refVal"+s+" = refVal["+s+"];"}function Zp(s){return"var customRule"+s+" = customRules["+s+"];"}function xs(s,e){if(!s.length)return"";for(var r="",a=0;a<s.length;a++)r+=e(a,s);return r}});var Po=G((Vm,Oo)=>{"use strict";var Rs=Oo.exports=function(){this._cache={}};Rs.prototype.put=function(e,r){this._cache[e]=r};Rs.prototype.get=function(e){return this._cache[e]};Rs.prototype.del=function(e){delete this._cache[e]};Rs.prototype.clear=function(){this._cache={}}});var Uo=G((Hm,Mo)=>{"use strict";var Gp=nr(),Wp=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Xp=[0,31,28,31,30,31,30,31,31,30,31,30,31],Qp=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Io=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Kp=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Yp=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,$o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Ao=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,No=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Do=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Co=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,ko=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;Mo.exports=ws;function ws(s){return s=s=="full"?"full":"fast",Gp.copy(ws[s])}ws.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":$o,url:Ao,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:Io,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Fo,uuid:No,"json-pointer":Do,"json-pointer-uri-fragment":Co,"relative-json-pointer":ko};ws.full={date:Lo,time:jo,"date-time":tf,uri:sf,"uri-reference":Yp,"uri-template":$o,url:Ao,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:Io,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Fo,uuid:No,"json-pointer":Do,"json-pointer-uri-fragment":Co,"relative-json-pointer":ko};function Jp(s){return s%4===0&&(s%100!==0||s%400===0)}function Lo(s){var e=s.match(Wp);if(!e)return!1;var r=+e[1],a=+e[2],t=+e[3];return a>=1&&a<=12&&t>=1&&t<=(a==2&&Jp(r)?29:Xp[a])}function jo(s,e){var r=s.match(Qp);if(!r)return!1;var a=r[1],t=r[2],n=r[3],i=r[5];return(a<=23&&t<=59&&n<=59||a==23&&t==59&&n==60)&&(!e||i)}var ef=/t|\s/i;function tf(s){var e=s.split(ef);return e.length==2&&Lo(e[0])&&jo(e[1],!0)}var rf=/\/|:/;function sf(s){return rf.test(s)&&Kp.test(s)}var af=/[^\\]\\Z/;function Fo(s){if(af.test(s))return!1;try{return new RegExp(s),!0}catch{return!1}}});var Bo=G((zm,qo)=>{"use strict";qo.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),f="valid"+n,m,p;if(o=="#"||o=="#/")e.isRoot?(m=e.async,p="validate"):(m=e.root.schema.$async===!0,p="root.refVal[0]");else{var y=e.resolveRef(e.baseId,o,e.isRoot);if(y===void 0){var h=e.MissingRefError.message(e.baseId,o);if(e.opts.missingRefs=="fail"){e.logger.error(h);var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(o)+"' } ",e.opts.messages!==!1&&(t+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(o)+"' "),e.opts.verbose&&(t+=" , schema: "+e.util.toQuotedString(o)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var S=t;t=g.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(t+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(h),u&&(t+=" if (true) { ");else throw new e.MissingRefError(e.baseId,o,h)}else if(y.inline){var O=e.util.copy(e);O.level++;var E="valid"+O.level;O.schema=y.schema,O.schemaPath="",O.errSchemaPath=o;var T=e.validate(O).replace(/validate\.schema/g,y.code);t+=" "+T+" ",u&&(t+=" if ("+E+") { ")}else m=y.$async===!0||e.async&&y.$async!==!1,p=y.code}if(p){var g=g||[];g.push(t),t="",e.opts.passContext?t+=" "+p+".call(this, ":t+=" "+p+"( ",t+=" "+d+", (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var w=i?"data"+(i-1||""):"parentData",x=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+w+" , "+x+", rootData)  ";var A=t;if(t=g.pop(),m){if(!e.async)throw new Error("async schema referenced by sync schema");u&&(t+=" var "+f+"; "),t+=" try { await "+A+"; ",u&&(t+=" "+f+" = true; "),t+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",u&&(t+=" "+f+" = false; "),t+=" } ",u&&(t+=" if ("+f+") { ")}else t+=" if (!"+A+") { if (vErrors === null) vErrors = "+p+".errors; else vErrors = vErrors.concat("+p+".errors); errors = vErrors.length; } ",u&&(t+=" else { ")}return t}});var Ho=G((Zm,Vo)=>{"use strict";Vo.exports=function(e,r,a){var t=" ",n=e.schema[r],i=e.schemaPath+e.util.getProperty(r),o=e.errSchemaPath+"/"+r,l=!e.opts.allErrors,u=e.util.copy(e),d="";u.level++;var f="valid"+u.level,m=u.baseId,p=!0,y=n;if(y)for(var h,g=-1,S=y.length-1;g<S;)h=y[g+=1],(e.opts.strictKeywords?typeof h=="object"&&Object.keys(h).length>0||h===!1:e.util.schemaHasRules(h,e.RULES.all))&&(p=!1,u.schema=h,u.schemaPath=i+"["+g+"]",u.errSchemaPath=o+"/"+g,t+="  "+e.validate(u)+" ",u.baseId=m,l&&(t+=" if ("+f+") { ",d+="}"));return l&&(p?t+=" if (true) { ":t+=" "+d.slice(0,-1)+" "),t}});var Zo=G((Gm,zo)=>{"use strict";zo.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p="errs__"+n,y=e.util.copy(e),h="";y.level++;var g="valid"+y.level,S=o.every(function(D){return e.opts.strictKeywords?typeof D=="object"&&Object.keys(D).length>0||D===!1:e.util.schemaHasRules(D,e.RULES.all)});if(S){var O=y.baseId;t+=" var "+p+" = errors; var "+m+" = false;  ";var E=e.compositeRule;e.compositeRule=y.compositeRule=!0;var T=o;if(T)for(var w,x=-1,A=T.length-1;x<A;)w=T[x+=1],y.schema=w,y.schemaPath=l+"["+x+"]",y.errSchemaPath=u+"/"+x,t+="  "+e.validate(y)+" ",y.baseId=O,t+=" "+m+" = "+m+" || "+g+"; if (!"+m+") { ",h+="}";e.compositeRule=y.compositeRule=E,t+=" "+h+" if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" } else {  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else d&&(t+=" if (true) { ");return t}});var Wo=G((Wm,Go)=>{"use strict";Go.exports=function(e,r,a){var t=" ",n=e.schema[r],i=e.errSchemaPath+"/"+r,o=!e.opts.allErrors,l=e.util.toQuotedString(n);return e.opts.$comment===!0?t+=" console.log("+l+");":typeof e.opts.$comment=="function"&&(t+=" self._opts.$comment("+l+", "+e.util.toQuotedString(i)+", validate.root.schema);"),t}});var Qo=G((Xm,Xo)=>{"use strict";Xo.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p=e.opts.$data&&o&&o.$data,y;p?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",y="schema"+n):y=o,p||(t+=" var schema"+n+" = validate.schema"+l+";"),t+="var "+m+" = equal("+f+", schema"+n+"); if (!"+m+") {   ";var h=h||[];h.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValue: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to constant' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;return t=h.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",d&&(t+=" else { "),t}});var Yo=G((Qm,Ko)=>{"use strict";Ko.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p="errs__"+n,y=e.util.copy(e),h="";y.level++;var g="valid"+y.level,S="i"+n,O=y.dataLevel=e.dataLevel+1,E="data"+O,T=e.baseId,w=e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all);if(t+="var "+p+" = errors;var "+m+";",w){var x=e.compositeRule;e.compositeRule=y.compositeRule=!0,y.schema=o,y.schemaPath=l,y.errSchemaPath=u,t+=" var "+g+" = false; for (var "+S+" = 0; "+S+" < "+f+".length; "+S+"++) { ",y.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers,!0);var A=f+"["+S+"]";y.dataPathArr[O]=S;var D=e.validate(y);y.baseId=T,e.util.varOccurences(D,E)<2?t+=" "+e.util.varReplace(D,E,A)+" ":t+=" var "+E+" = "+A+"; "+D+" ",t+=" if ("+g+") break; }  ",e.compositeRule=y.compositeRule=x,t+=" "+h+" if (!"+g+") {"}else t+=" if ("+f+".length == 0) {";var N=N||[];N.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should contain a valid item' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var C=t;return t=N.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+C+"]); ":t+=" validate.errors = ["+C+"]; return false; ":t+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { ",w&&(t+="  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } "),e.opts.allErrors&&(t+=" } "),t}});var ei=G((Km,Jo)=>{"use strict";Jo.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="errs__"+n,p=e.util.copy(e),y="";p.level++;var h="valid"+p.level,g={},S={},O=e.opts.ownProperties;for(x in o)if(x!="__proto__"){var E=o[x],T=Array.isArray(E)?S:g;T[x]=E}t+="var "+m+" = errors;";var w=e.errorPath;t+="var missing"+n+";";for(var x in S)if(T=S[x],T.length){if(t+=" if ( "+f+e.util.getProperty(x)+" !== undefined ",O&&(t+=" && Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(x)+"') "),d){t+=" && ( ";var A=T;if(A)for(var D,N=-1,C=A.length-1;N<C;){D=A[N+=1],N&&(t+=" || ");var L=e.util.getProperty(D),j=f+L;t+=" ( ( "+j+" === undefined ",O&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(D)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?D:L)+") ) "}t+=")) {  ";var R="missing"+n,I="' + "+R+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,R,!0):w+" + "+R);var k=k||[];k.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(x)+"', missingProperty: '"+I+"', depsCount: "+T.length+", deps: '"+e.util.escapeQuotes(T.length==1?T[0]:T.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",T.length==1?t+="property "+e.util.escapeQuotes(T[0]):t+="properties "+e.util.escapeQuotes(T.join(", ")),t+=" when property "+e.util.escapeQuotes(x)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var W=t;t=k.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+W+"]); ":t+=" validate.errors = ["+W+"]; return false; ":t+=" var err = "+W+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{t+=" ) { ";var X=T;if(X)for(var D,Y=-1,H=X.length-1;Y<H;){D=X[Y+=1];var L=e.util.getProperty(D),I=e.util.escapeQuotes(D),j=f+L;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,D,e.opts.jsonPointers)),t+=" if ( "+j+" === undefined ",O&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(D)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(x)+"', missingProperty: '"+I+"', depsCount: "+T.length+", deps: '"+e.util.escapeQuotes(T.length==1?T[0]:T.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",T.length==1?t+="property "+e.util.escapeQuotes(T[0]):t+="properties "+e.util.escapeQuotes(T.join(", ")),t+=" when property "+e.util.escapeQuotes(x)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}t+=" }   ",d&&(y+="}",t+=" else { ")}e.errorPath=w;var z=p.baseId;for(var x in g){var E=g[x];(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))&&(t+=" "+h+" = true; if ( "+f+e.util.getProperty(x)+" !== undefined ",O&&(t+=" && Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(x)+"') "),t+=") { ",p.schema=E,p.schemaPath=l+e.util.getProperty(x),p.errSchemaPath=u+"/"+e.util.escapeFragment(x),t+="  "+e.validate(p)+" ",p.baseId=z,t+=" }  ",d&&(t+=" if ("+h+") { ",y+="}"))}return d&&(t+="   "+y+" if ("+m+" == errors) {"),t}});var ri=G((Ym,ti)=>{"use strict";ti.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p=e.opts.$data&&o&&o.$data,y;p?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",y="schema"+n):y=o;var h="i"+n,g="schema"+n;p||(t+=" var "+g+" = validate.schema"+l+";"),t+="var "+m+";",p&&(t+=" if (schema"+n+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+n+")) "+m+" = false; else {"),t+=""+m+" = false;for (var "+h+"=0; "+h+"<"+g+".length; "+h+"++) if (equal("+f+", "+g+"["+h+"])) { "+m+" = true; break; }",p&&(t+="  }  "),t+=" if (!"+m+") {   ";var S=S||[];S.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValues: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var O=t;return t=S.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+O+"]); ":t+=" validate.errors = ["+O+"]; return false; ":t+=" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",d&&(t+=" else { "),t}});var ai=G((Jm,si)=>{"use strict";si.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||"");if(e.opts.format===!1)return d&&(t+=" if (true) { "),t;var m=e.opts.$data&&o&&o.$data,p;m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o;var y=e.opts.unknownFormats,h=Array.isArray(y);if(m){var g="format"+n,S="isObject"+n,O="formatType"+n;t+=" var "+g+" = formats["+p+"]; var "+S+" = typeof "+g+" == 'object' && !("+g+" instanceof RegExp) && "+g+".validate; var "+O+" = "+S+" && "+g+".type || 'string'; if ("+S+") { ",e.async&&(t+=" var async"+n+" = "+g+".async; "),t+=" "+g+" = "+g+".validate; } if (  ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'string') || "),t+=" (",y!="ignore"&&(t+=" ("+p+" && !"+g+" ",h&&(t+=" && self._opts.unknownFormats.indexOf("+p+") == -1 "),t+=") || "),t+=" ("+g+" && "+O+" == '"+a+"' && !(typeof "+g+" == 'function' ? ",e.async?t+=" (async"+n+" ? await "+g+"("+f+") : "+g+"("+f+")) ":t+=" "+g+"("+f+") ",t+=" : "+g+".test("+f+"))))) {"}else{var g=e.formats[o];if(!g){if(y=="ignore")return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),d&&(t+=" if (true) { "),t;if(h&&y.indexOf(o)>=0)return d&&(t+=" if (true) { "),t;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var S=typeof g=="object"&&!(g instanceof RegExp)&&g.validate,O=S&&g.type||"string";if(S){var E=g.async===!0;g=g.validate}if(O!=a)return d&&(t+=" if (true) { "),t;if(E){if(!e.async)throw new Error("async format in sync schema");var T="formats"+e.util.getProperty(o)+".validate";t+=" if (!(await "+T+"("+f+"))) { "}else{t+=" if (! ";var T="formats"+e.util.getProperty(o);S&&(T+=".validate"),typeof g=="function"?t+=" "+T+"("+f+") ":t+=" "+T+".test("+f+") ",t+=") { "}}var w=w||[];w.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { format:  ",m?t+=""+p:t+=""+e.util.toQuotedString(o),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match format "`,m?t+="' + "+p+" + '":t+=""+e.util.escapeQuotes(o),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+e.util.toQuotedString(o),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var x=t;return t=w.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+x+"]); ":t+=" validate.errors = ["+x+"]; return false; ":t+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { "),t}});var oi=G((ev,ni)=>{"use strict";ni.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p="errs__"+n,y=e.util.copy(e);y.level++;var h="valid"+y.level,g=e.schema.then,S=e.schema.else,O=g!==void 0&&(e.opts.strictKeywords?typeof g=="object"&&Object.keys(g).length>0||g===!1:e.util.schemaHasRules(g,e.RULES.all)),E=S!==void 0&&(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all)),T=y.baseId;if(O||E){var w;y.createErrors=!1,y.schema=o,y.schemaPath=l,y.errSchemaPath=u,t+=" var "+p+" = errors; var "+m+" = true;  ";var x=e.compositeRule;e.compositeRule=y.compositeRule=!0,t+="  "+e.validate(y)+" ",y.baseId=T,y.createErrors=!0,t+="  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; }  ",e.compositeRule=y.compositeRule=x,O?(t+=" if ("+h+") {  ",y.schema=e.schema.then,y.schemaPath=e.schemaPath+".then",y.errSchemaPath=e.errSchemaPath+"/then",t+="  "+e.validate(y)+" ",y.baseId=T,t+=" "+m+" = "+h+"; ",O&&E?(w="ifClause"+n,t+=" var "+w+" = 'then'; "):w="'then'",t+=" } ",E&&(t+=" else { ")):t+=" if (!"+h+") { ",E&&(y.schema=e.schema.else,y.schemaPath=e.schemaPath+".else",y.errSchemaPath=e.errSchemaPath+"/else",t+="  "+e.validate(y)+" ",y.baseId=T,t+=" "+m+" = "+h+"; ",O&&E?(w="ifClause"+n,t+=" var "+w+" = 'else'; "):w="'else'",t+=" } "),t+=" if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { failingKeyword: "+w+" } ",e.opts.messages!==!1&&(t+=` , message: 'should match "' + `+w+` + '" schema' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" }   ",d&&(t+=" else { ")}else d&&(t+=" if (true) { ");return t}});var ci=G((tv,ii)=>{"use strict";ii.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p="errs__"+n,y=e.util.copy(e),h="";y.level++;var g="valid"+y.level,S="i"+n,O=y.dataLevel=e.dataLevel+1,E="data"+O,T=e.baseId;if(t+="var "+p+" = errors;var "+m+";",Array.isArray(o)){var w=e.schema.additionalItems;if(w===!1){t+=" "+m+" = "+f+".length <= "+o.length+"; ";var x=u;u=e.errSchemaPath+"/additionalItems",t+="  if (!"+m+") {   ";var A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+o.length+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var D=t;t=A.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+D+"]); ":t+=" validate.errors = ["+D+"]; return false; ":t+=" var err = "+D+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",u=x,d&&(h+="}",t+=" else { ")}var N=o;if(N){for(var C,L=-1,j=N.length-1;L<j;)if(C=N[L+=1],e.opts.strictKeywords?typeof C=="object"&&Object.keys(C).length>0||C===!1:e.util.schemaHasRules(C,e.RULES.all)){t+=" "+g+" = true; if ("+f+".length > "+L+") { ";var R=f+"["+L+"]";y.schema=C,y.schemaPath=l+"["+L+"]",y.errSchemaPath=u+"/"+L,y.errorPath=e.util.getPathExpr(e.errorPath,L,e.opts.jsonPointers,!0),y.dataPathArr[O]=L;var I=e.validate(y);y.baseId=T,e.util.varOccurences(I,E)<2?t+=" "+e.util.varReplace(I,E,R)+" ":t+=" var "+E+" = "+R+"; "+I+" ",t+=" }  ",d&&(t+=" if ("+g+") { ",h+="}")}}if(typeof w=="object"&&(e.opts.strictKeywords?typeof w=="object"&&Object.keys(w).length>0||w===!1:e.util.schemaHasRules(w,e.RULES.all))){y.schema=w,y.schemaPath=e.schemaPath+".additionalItems",y.errSchemaPath=e.errSchemaPath+"/additionalItems",t+=" "+g+" = true; if ("+f+".length > "+o.length+") {  for (var "+S+" = "+o.length+"; "+S+" < "+f+".length; "+S+"++) { ",y.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers,!0);var R=f+"["+S+"]";y.dataPathArr[O]=S;var I=e.validate(y);y.baseId=T,e.util.varOccurences(I,E)<2?t+=" "+e.util.varReplace(I,E,R)+" ":t+=" var "+E+" = "+R+"; "+I+" ",d&&(t+=" if (!"+g+") break; "),t+=" } }  ",d&&(t+=" if ("+g+") { ",h+="}")}}else if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){y.schema=o,y.schemaPath=l,y.errSchemaPath=u,t+="  for (var "+S+" = 0; "+S+" < "+f+".length; "+S+"++) { ",y.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers,!0);var R=f+"["+S+"]";y.dataPathArr[O]=S;var I=e.validate(y);y.baseId=T,e.util.varOccurences(I,E)<2?t+=" "+e.util.varReplace(I,E,R)+" ":t+=" var "+E+" = "+R+"; "+I+" ",d&&(t+=" if (!"+g+") break; "),t+=" }"}return d&&(t+=" "+h+" if ("+p+" == errors) {"),t}});var La=G((rv,li)=>{"use strict";li.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,T,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o;var y=r=="maximum",h=y?"exclusiveMaximum":"exclusiveMinimum",g=e.schema[h],S=e.opts.$data&&g&&g.$data,O=y?"<":">",E=y?">":"<",T=void 0;if(!(m||typeof o=="number"||o===void 0))throw new Error(r+" must be number");if(!(S||g===void 0||typeof g=="number"||typeof g=="boolean"))throw new Error(h+" must be number or boolean");if(S){var w=e.util.getData(g.$data,i,e.dataPathArr),x="exclusive"+n,A="exclType"+n,D="exclIsNumber"+n,N="op"+n,C="' + "+N+" + '";t+=" var schemaExcl"+n+" = "+w+"; ",w="schemaExcl"+n,t+=" var "+x+"; var "+A+" = typeof "+w+"; if ("+A+" != 'boolean' && "+A+" != 'undefined' && "+A+" != 'number') { ";var T=h,L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(T||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: '"+h+" should be boolean' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var j=t;t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+j+"]); ":t+=" validate.errors = ["+j+"]; return false; ":t+=" var err = "+j+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),t+=" "+A+" == 'number' ? ( ("+x+" = "+p+" === undefined || "+w+" "+O+"= "+p+") ? "+f+" "+E+"= "+w+" : "+f+" "+E+" "+p+" ) : ( ("+x+" = "+w+" === true) ? "+f+" "+E+"= "+p+" : "+f+" "+E+" "+p+" ) || "+f+" !== "+f+") { var op"+n+" = "+x+" ? '"+O+"' : '"+O+"='; ",o===void 0&&(T=h,u=e.errSchemaPath+"/"+h,p=w,m=S)}else{var D=typeof g=="number",C=O;if(D&&m){var N="'"+C+"'";t+=" if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),t+=" ( "+p+" === undefined || "+g+" "+O+"= "+p+" ? "+f+" "+E+"= "+g+" : "+f+" "+E+" "+p+" ) || "+f+" !== "+f+") { "}else{D&&o===void 0?(x=!0,T=h,u=e.errSchemaPath+"/"+h,p=g,E+="="):(D&&(p=Math[y?"min":"max"](g,o)),g===(D?p:!0)?(x=!0,T=h,u=e.errSchemaPath+"/"+h,E+="="):(x=!1,C+="="));var N="'"+C+"'";t+=" if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),t+=" "+f+" "+E+" "+p+" || "+f+" !== "+f+") { "}}T=T||r;var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(T||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+N+", limit: "+p+", exclusive: "+x+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be "+C+" ",m?t+="' + "+p:t+=""+p+"'"),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var j=t;return t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+j+"]); ":t+=" validate.errors = ["+j+"]; return false; ":t+=" var err = "+j+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { "),t}});var ja=G((sv,ui)=>{"use strict";ui.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,h,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;if(m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o,!(m||typeof o=="number"))throw new Error(r+" must be number");var y=r=="maxItems"?">":"<";t+="if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),t+=" "+f+".length "+y+" "+p+") { ";var h=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(h||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+p+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxItems"?t+="more":t+="fewer",t+=" than ",m?t+="' + "+p+" + '":t+=""+o,t+=" items' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var S=t;return t=g.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}});var Fa=G((av,di)=>{"use strict";di.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,h,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;if(m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o,!(m||typeof o=="number"))throw new Error(r+" must be number");var y=r=="maxLength"?">":"<";t+="if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),e.opts.unicode===!1?t+=" "+f+".length ":t+=" ucs2length("+f+") ",t+=" "+y+" "+p+") { ";var h=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(h||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+p+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be ",r=="maxLength"?t+="longer":t+="shorter",t+=" than ",m?t+="' + "+p+" + '":t+=""+o,t+=" characters' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var S=t;return t=g.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}});var Ma=G((nv,pi)=>{"use strict";pi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,h,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;if(m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o,!(m||typeof o=="number"))throw new Error(r+" must be number");var y=r=="maxProperties"?">":"<";t+="if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'number') || "),t+=" Object.keys("+f+").length "+y+" "+p+") { ";var h=r,g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(h||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+p+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxProperties"?t+="more":t+="fewer",t+=" than ",m?t+="' + "+p+" + '":t+=""+o,t+=" properties' "),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var S=t;return t=g.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}});var hi=G((ov,fi)=>{"use strict";fi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;if(m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o,!(m||typeof o=="number"))throw new Error(r+" must be number");t+="var division"+n+";if (",m&&(t+=" "+p+" !== undefined && ( typeof "+p+" != 'number' || "),t+=" (division"+n+" = "+f+" / "+p+", ",e.opts.multipleOfPrecision?t+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":t+=" division"+n+" !== parseInt(division"+n+") ",t+=" ) ",m&&(t+="  )  "),t+=" ) {   ";var y=y||[];y.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+p+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be multiple of ",m?t+="' + "+p:t+=""+p+"'"),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var h=t;return t=y.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+h+"]); ":t+=" validate.errors = ["+h+"]; return false; ":t+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}});var vi=G((iv,mi)=>{"use strict";mi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="errs__"+n,p=e.util.copy(e);p.level++;var y="valid"+p.level;if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){p.schema=o,p.schemaPath=l,p.errSchemaPath=u,t+=" var "+m+" = errors;  ";var h=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.createErrors=!1;var g;p.opts.allErrors&&(g=p.opts.allErrors,p.opts.allErrors=!1),t+=" "+e.validate(p)+" ",p.createErrors=!0,g&&(p.opts.allErrors=g),e.compositeRule=p.compositeRule=h,t+=" if ("+y+") {   ";var S=S||[];S.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var O=t;t=S.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+O+"]); ":t+=" validate.errors = ["+O+"]; return false; ":t+=" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  errors = "+m+"; if (vErrors !== null) { if ("+m+") vErrors.length = "+m+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else t+="  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(t+=" if (false) { ");return t}});var yi=G((cv,gi)=>{"use strict";gi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p="errs__"+n,y=e.util.copy(e),h="";y.level++;var g="valid"+y.level,S=y.baseId,O="prevValid"+n,E="passingSchemas"+n;t+="var "+p+" = errors , "+O+" = false , "+m+" = false , "+E+" = null; ";var T=e.compositeRule;e.compositeRule=y.compositeRule=!0;var w=o;if(w)for(var x,A=-1,D=w.length-1;A<D;)x=w[A+=1],(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all))?(y.schema=x,y.schemaPath=l+"["+A+"]",y.errSchemaPath=u+"/"+A,t+="  "+e.validate(y)+" ",y.baseId=S):t+=" var "+g+" = true; ",A&&(t+=" if ("+g+" && "+O+") { "+m+" = false; "+E+" = ["+E+", "+A+"]; } else { ",h+="}"),t+=" if ("+g+") { "+m+" = "+O+" = true; "+E+" = "+A+"; }";return e.compositeRule=y.compositeRule=T,t+=""+h+"if (!"+m+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { passingSchemas: "+E+" } ",e.opts.messages!==!1&&(t+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+="} else {  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; }",e.opts.allErrors&&(t+=" } "),t}});var bi=G((lv,_i)=>{"use strict";_i.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m=e.opts.$data&&o&&o.$data,p;m?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",p="schema"+n):p=o;var y=m?"(new RegExp("+p+"))":e.usePattern(o);t+="if ( ",m&&(t+=" ("+p+" !== undefined && typeof "+p+" != 'string') || "),t+=" !"+y+".test("+f+") ) {   ";var h=h||[];h.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",m?t+=""+p:t+=""+e.util.toQuotedString(o),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match pattern "`,m?t+="' + "+p+" + '":t+=""+e.util.escapeQuotes(o),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",m?t+="validate.schema"+l:t+=""+e.util.toQuotedString(o),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;return t=h.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}});var Si=G((uv,Ei)=>{"use strict";Ei.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="errs__"+n,p=e.util.copy(e),y="";p.level++;var h="valid"+p.level,g="key"+n,S="idx"+n,O=p.dataLevel=e.dataLevel+1,E="data"+O,T="dataProperties"+n,w=Object.keys(o||{}).filter(Y),x=e.schema.patternProperties||{},A=Object.keys(x).filter(Y),D=e.schema.additionalProperties,N=w.length||A.length,C=D===!1,L=typeof D=="object"&&Object.keys(D).length,j=e.opts.removeAdditional,R=C||L||j,I=e.opts.ownProperties,k=e.baseId,W=e.schema.required;if(W&&!(e.opts.$data&&W.$data)&&W.length<e.opts.loopRequired)var X=e.util.toHash(W);function Y(st){return st!=="__proto__"}if(t+="var "+m+" = errors;var "+h+" = true;",I&&(t+=" var "+T+" = undefined;"),R){if(I?t+=" "+T+" = "+T+" || Object.keys("+f+"); for (var "+S+"=0; "+S+"<"+T+".length; "+S+"++) { var "+g+" = "+T+"["+S+"]; ":t+=" for (var "+g+" in "+f+") { ",N){if(t+=" var isAdditional"+n+" = !(false ",w.length)if(w.length>8)t+=" || validate.schema"+l+".hasOwnProperty("+g+") ";else{var H=w;if(H)for(var z,ae=-1,pe=H.length-1;ae<pe;)z=H[ae+=1],t+=" || "+g+" == "+e.util.toQuotedString(z)+" "}if(A.length){var Pe=A;if(Pe)for(var J,Ee=-1,Se=Pe.length-1;Ee<Se;)J=Pe[Ee+=1],t+=" || "+e.usePattern(J)+".test("+g+") "}t+=" ); if (isAdditional"+n+") { "}if(j=="all")t+=" delete "+f+"["+g+"]; ";else{var Re=e.errorPath,Me="' + "+g+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers)),C)if(j)t+=" delete "+f+"["+g+"]; ";else{t+=" "+h+" = false; ";var rt=u;u=e.errSchemaPath+"/additionalProperties";var ye=ye||[];ye.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { additionalProperty: '"+Me+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is an invalid additional property":t+="should NOT have additional properties",t+="' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var me=t;t=ye.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+me+"]); ":t+=" validate.errors = ["+me+"]; return false; ":t+=" var err = "+me+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=rt,d&&(t+=" break; ")}else if(L)if(j=="failing"){t+=" var "+m+" = errors;  ";var vt=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=D,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Ie=f+"["+g+"]";p.dataPathArr[O]=g;var ce=e.validate(p);p.baseId=k,e.util.varOccurences(ce,E)<2?t+=" "+e.util.varReplace(ce,E,Ie)+" ":t+=" var "+E+" = "+Ie+"; "+ce+" ",t+=" if (!"+h+") { errors = "+m+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+f+"["+g+"]; }  ",e.compositeRule=p.compositeRule=vt}else{p.schema=D,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Ie=f+"["+g+"]";p.dataPathArr[O]=g;var ce=e.validate(p);p.baseId=k,e.util.varOccurences(ce,E)<2?t+=" "+e.util.varReplace(ce,E,Ie)+" ":t+=" var "+E+" = "+Ie+"; "+ce+" ",d&&(t+=" if (!"+h+") break; ")}e.errorPath=Re}N&&(t+=" } "),t+=" }  ",d&&(t+=" if ("+h+") { ",y+="}")}var wt=e.opts.useDefaults&&!e.compositeRule;if(w.length){var gt=w;if(gt)for(var z,jt=-1,Ft=gt.length-1;jt<Ft;){z=gt[jt+=1];var Ae=o[z];if(e.opts.strictKeywords?typeof Ae=="object"&&Object.keys(Ae).length>0||Ae===!1:e.util.schemaHasRules(Ae,e.RULES.all)){var We=e.util.getProperty(z),Ie=f+We,Ue=wt&&Ae.default!==void 0;p.schema=Ae,p.schemaPath=l+We,p.errSchemaPath=u+"/"+e.util.escapeFragment(z),p.errorPath=e.util.getPath(e.errorPath,z,e.opts.jsonPointers),p.dataPathArr[O]=e.util.toQuotedString(z);var ce=e.validate(p);if(p.baseId=k,e.util.varOccurences(ce,E)<2){ce=e.util.varReplace(ce,E,Ie);var Le=Ie}else{var Le=E;t+=" var "+E+" = "+Ie+"; "}if(Ue)t+=" "+ce+" ";else{if(X&&X[z]){t+=" if ( "+Le+" === undefined ",I&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(z)+"') "),t+=") { "+h+" = false; ";var Re=e.errorPath,rt=u,ct=e.util.escapeQuotes(z);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(Re,z,e.opts.jsonPointers)),u=e.errSchemaPath+"/required";var ye=ye||[];ye.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+ct+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+ct+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var me=t;t=ye.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+me+"]); ":t+=" validate.errors = ["+me+"]; return false; ":t+=" var err = "+me+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=rt,e.errorPath=Re,t+=" } else { "}else d?(t+=" if ( "+Le+" === undefined ",I&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(z)+"') "),t+=") { "+h+" = true; } else { "):(t+=" if ("+Le+" !== undefined ",I&&(t+=" &&   Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(z)+"') "),t+=" ) { ");t+=" "+ce+" } "}}d&&(t+=" if ("+h+") { ",y+="}")}}if(A.length){var He=A;if(He)for(var J,Gr=-1,zs=He.length-1;Gr<zs;){J=He[Gr+=1];var Ae=x[J];if(e.opts.strictKeywords?typeof Ae=="object"&&Object.keys(Ae).length>0||Ae===!1:e.util.schemaHasRules(Ae,e.RULES.all)){p.schema=Ae,p.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(J),p.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(J),I?t+=" "+T+" = "+T+" || Object.keys("+f+"); for (var "+S+"=0; "+S+"<"+T+".length; "+S+"++) { var "+g+" = "+T+"["+S+"]; ":t+=" for (var "+g+" in "+f+") { ",t+=" if ("+e.usePattern(J)+".test("+g+")) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers);var Ie=f+"["+g+"]";p.dataPathArr[O]=g;var ce=e.validate(p);p.baseId=k,e.util.varOccurences(ce,E)<2?t+=" "+e.util.varReplace(ce,E,Ie)+" ":t+=" var "+E+" = "+Ie+"; "+ce+" ",d&&(t+=" if (!"+h+") break; "),t+=" } ",d&&(t+=" else "+h+" = true; "),t+=" }  ",d&&(t+=" if ("+h+") { ",y+="}")}}}return d&&(t+=" "+y+" if ("+m+" == errors) {"),t}});var Ti=G((dv,xi)=>{"use strict";xi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="errs__"+n,p=e.util.copy(e),y="";p.level++;var h="valid"+p.level;if(t+="var "+m+" = errors;",e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){p.schema=o,p.schemaPath=l,p.errSchemaPath=u;var g="key"+n,S="idx"+n,O="i"+n,E="' + "+g+" + '",T=p.dataLevel=e.dataLevel+1,w="data"+T,x="dataProperties"+n,A=e.opts.ownProperties,D=e.baseId;A&&(t+=" var "+x+" = undefined; "),A?t+=" "+x+" = "+x+" || Object.keys("+f+"); for (var "+S+"=0; "+S+"<"+x+".length; "+S+"++) { var "+g+" = "+x+"["+S+"]; ":t+=" for (var "+g+" in "+f+") { ",t+=" var startErrs"+n+" = errors; ";var N=g,C=e.compositeRule;e.compositeRule=p.compositeRule=!0;var L=e.validate(p);p.baseId=D,e.util.varOccurences(L,w)<2?t+=" "+e.util.varReplace(L,w,N)+" ":t+=" var "+w+" = "+N+"; "+L+" ",e.compositeRule=p.compositeRule=C,t+=" if (!"+h+") { for (var "+O+"=startErrs"+n+"; "+O+"<errors; "+O+"++) { vErrors["+O+"].propertyName = "+g+"; }   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { propertyName: '"+E+"' } ",e.opts.messages!==!1&&(t+=" , message: 'property name \\'"+E+"\\' is invalid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),d&&(t+=" break; "),t+=" } }"}return d&&(t+=" "+y+" if ("+m+" == errors) {"),t}});var wi=G((pv,Ri)=>{"use strict";Ri.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p=e.opts.$data&&o&&o.$data,y;p?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",y="schema"+n):y=o;var h="schema"+n;if(!p)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var g=[],S=o;if(S)for(var O,E=-1,T=S.length-1;E<T;){O=S[E+=1];var w=e.schema.properties[O];w&&(e.opts.strictKeywords?typeof w=="object"&&Object.keys(w).length>0||w===!1:e.util.schemaHasRules(w,e.RULES.all))||(g[g.length]=O)}}else var g=o;if(p||g.length){var x=e.errorPath,A=p||g.length>=e.opts.loopRequired,D=e.opts.ownProperties;if(d)if(t+=" var missing"+n+"; ",A){p||(t+=" var "+h+" = validate.schema"+l+"; ");var N="i"+n,C="schema"+n+"["+N+"]",L="' + "+C+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,C,e.opts.jsonPointers)),t+=" var "+m+" = true; ",p&&(t+=" if (schema"+n+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+n+")) "+m+" = false; else {"),t+=" for (var "+N+" = 0; "+N+" < "+h+".length; "+N+"++) { "+m+" = "+f+"["+h+"["+N+"]] !== undefined ",D&&(t+=" &&   Object.prototype.hasOwnProperty.call("+f+", "+h+"["+N+"]) "),t+="; if (!"+m+") break; } ",p&&(t+="  }  "),t+="  if (!"+m+") {   ";var j=j||[];j.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+L+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+L+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var R=t;t=j.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else{t+=" if ( ";var I=g;if(I)for(var k,N=-1,W=I.length-1;N<W;){k=I[N+=1],N&&(t+=" || ");var X=e.util.getProperty(k),Y=f+X;t+=" ( ( "+Y+" === undefined ",D&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(k)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?k:X)+") ) "}t+=") {  ";var C="missing"+n,L="' + "+C+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,C,!0):x+" + "+C);var j=j||[];j.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+L+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+L+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var R=t;t=j.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else if(A){p||(t+=" var "+h+" = validate.schema"+l+"; ");var N="i"+n,C="schema"+n+"["+N+"]",L="' + "+C+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,C,e.opts.jsonPointers)),p&&(t+=" if ("+h+" && !Array.isArray("+h+")) {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+L+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+L+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+h+" !== undefined) { "),t+=" for (var "+N+" = 0; "+N+" < "+h+".length; "+N+"++) { if ("+f+"["+h+"["+N+"]] === undefined ",D&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", "+h+"["+N+"]) "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+L+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+L+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",p&&(t+="  }  ")}else{var H=g;if(H)for(var k,z=-1,ae=H.length-1;z<ae;){k=H[z+=1];var X=e.util.getProperty(k),L=e.util.escapeQuotes(k),Y=f+X;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,k,e.opts.jsonPointers)),t+=" if ( "+Y+" === undefined ",D&&(t+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+e.util.escapeQuotes(k)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+L+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+L+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else d&&(t+=" if (true) {");return t}});var Pi=G((fv,Oi)=>{"use strict";Oi.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f="data"+(i||""),m="valid"+n,p=e.opts.$data&&o&&o.$data,y;if(p?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",y="schema"+n):y=o,(o||p)&&e.opts.uniqueItems!==!1){p&&(t+=" var "+m+"; if ("+y+" === false || "+y+" === undefined) "+m+" = true; else if (typeof "+y+" != 'boolean') "+m+" = false; else { "),t+=" var i = "+f+".length , "+m+" = true , j; if (i > 1) { ";var h=e.schema.items&&e.schema.items.type,g=Array.isArray(h);if(!h||h=="object"||h=="array"||g&&(h.indexOf("object")>=0||h.indexOf("array")>=0))t+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+f+"[i], "+f+"[j])) { "+m+" = false; break outer; } } } ";else{t+=" var itemIndices = {}, item; for (;i--;) { var item = "+f+"[i]; ";var S="checkDataType"+(g?"s":"");t+=" if ("+e.util[S](h,"item",e.opts.strictNumbers,!0)+") continue; ",g&&(t+=` if (typeof item == 'string') item = '"' + item; `),t+=" if (typeof itemIndices[item] == 'number') { "+m+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}t+=" } ",p&&(t+="  }  "),t+=" if (!"+m+") {   ";var O=O||[];O.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+l:t+=""+o,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var E=t;t=O.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+E+"]); ":t+=" validate.errors = ["+E+"]; return false; ":t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { ")}else d&&(t+=" if (true) { ");return t}});var $i=G((hv,Ii)=>{"use strict";Ii.exports={$ref:Bo(),allOf:Ho(),anyOf:Zo(),$comment:Wo(),const:Qo(),contains:Yo(),dependencies:ei(),enum:ri(),format:ai(),if:oi(),items:ci(),maximum:La(),minimum:La(),maxItems:ja(),minItems:ja(),maxLength:Fa(),minLength:Fa(),maxProperties:Ma(),minProperties:Ma(),multipleOf:hi(),not:vi(),oneOf:yi(),pattern:bi(),properties:Si(),propertyNames:Ti(),required:wi(),uniqueItems:Pi(),validate:Ca()}});var Di=G((mv,Ni)=>{"use strict";var Ai=$i(),Ua=nr().toHash;Ni.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],r=["type","$comment"],a=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],t=["number","integer","string","array","object","boolean","null"];return e.all=Ua(r),e.types=Ua(t),e.forEach(function(n){n.rules=n.rules.map(function(i){var o;if(typeof i=="object"){var l=Object.keys(i)[0];o=i[l],i=l,o.forEach(function(d){r.push(d),e.all[d]=!0})}r.push(i);var u=e.all[i]={keyword:i,code:Ai[i],implements:o};return u}),e.all.$comment={keyword:"$comment",code:Ai.$comment},n.type&&(e.types[n.type]=n)}),e.keywords=Ua(r.concat(a)),e.custom={},e}});var Li=G((vv,ki)=>{"use strict";var Ci=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];ki.exports=function(s,e){for(var r=0;r<e.length;r++){s=JSON.parse(JSON.stringify(s));var a=e[r].split("/"),t=s,n;for(n=1;n<a.length;n++)t=t[a[n]];for(n=0;n<Ci.length;n++){var i=Ci[n],o=t[i];o&&(t[i]={anyOf:[o,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return s}});var Mi=G((gv,Fi)=>{"use strict";var nf=Es().MissingRef;Fi.exports=ji;function ji(s,e,r){var a=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof e=="function"&&(r=e,e=void 0);var t=n(s).then(function(){var o=a._addSchema(s,void 0,e);return o.validate||i(o)});return r&&t.then(function(o){r(null,o)},r),t;function n(o){var l=o.$schema;return l&&!a.getSchema(l)?ji.call(a,{$ref:l},!0):Promise.resolve()}function i(o){try{return a._compile(o)}catch(u){if(u instanceof nf)return l(u);throw u}function l(u){var d=u.missingSchema;if(p(d))throw new Error("Schema "+d+" is loaded but "+u.missingRef+" cannot be resolved");var f=a._loadingSchemas[d];return f||(f=a._loadingSchemas[d]=a._opts.loadSchema(d),f.then(m,m)),f.then(function(y){if(!p(d))return n(y).then(function(){p(d)||a.addSchema(y,d,void 0,e)})}).then(function(){return i(o)});function m(){delete a._loadingSchemas[d]}function p(y){return a._refs[y]||a._schemas[y]}}}}});var qi=G((yv,Ui)=>{"use strict";Ui.exports=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,o=e.schema[r],l=e.schemaPath+e.util.getProperty(r),u=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f,m="data"+(i||""),p="valid"+n,y="errs__"+n,h=e.opts.$data&&o&&o.$data,g;h?(t+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",g="schema"+n):g=o;var S=this,O="definition"+n,E=S.definition,T="",w,x,A,D,N;if(h&&E.$data){N="keywordValidate"+n;var C=E.validateSchema;t+=" var "+O+" = RULES.custom['"+r+"'].definition; var "+N+" = "+O+".validate;"}else{if(D=e.useCustomRule(S,o,e.schema,e),!D)return;g="validate.schema"+l,N=D.code,w=E.compile,x=E.inline,A=E.macro}var L=N+".errors",j="i"+n,R="ruleErr"+n,I=E.async;if(I&&!e.async)throw new Error("async keyword in sync schema");if(x||A||(t+=""+L+" = null;"),t+="var "+y+" = errors;var "+p+";",h&&E.$data&&(T+="}",t+=" if ("+g+" === undefined) { "+p+" = true; } else { ",C&&(T+="}",t+=" "+p+" = "+O+".validateSchema("+g+"); if ("+p+") { ")),x)E.statements?t+=" "+D.validate+" ":t+=" "+p+" = "+D.validate+"; ";else if(A){var k=e.util.copy(e),T="";k.level++;var W="valid"+k.level;k.schema=D.validate,k.schemaPath="";var X=e.compositeRule;e.compositeRule=k.compositeRule=!0;var Y=e.validate(k).replace(/validate\.schema/g,N);e.compositeRule=k.compositeRule=X,t+=" "+Y}else{var H=H||[];H.push(t),t="",t+="  "+N+".call( ",e.opts.passContext?t+="this":t+="self",w||E.schema===!1?t+=" , "+m+" ":t+=" , "+g+" , "+m+" , validate.schema"+e.schemaPath+" ",t+=" , (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var z=i?"data"+(i-1||""):"parentData",ae=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+z+" , "+ae+" , rootData )  ";var pe=t;t=H.pop(),E.errors===!1?(t+=" "+p+" = ",I&&(t+="await "),t+=""+pe+"; "):I?(L="customErrors"+n,t+=" var "+L+" = null; try { "+p+" = await "+pe+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+L+" = e.errors; else throw e; } "):t+=" "+L+" = null; "+p+" = "+pe+"; "}if(E.modifying&&(t+=" if ("+z+") "+m+" = "+z+"["+ae+"];"),t+=""+T,E.valid)d&&(t+=" if (true) { ");else{t+=" if ( ",E.valid===void 0?(t+=" !",A?t+=""+W:t+=""+p):t+=" "+!E.valid+" ",t+=") { ",f=S.keyword;var H=H||[];H.push(t),t="";var H=H||[];H.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+S.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+S.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var Pe=t;t=H.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+Pe+"]); ":t+=" validate.errors = ["+Pe+"]; return false; ":t+=" var err = "+Pe+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var J=t;t=H.pop(),x?E.errors?E.errors!="full"&&(t+="  for (var "+j+"="+y+"; "+j+"<errors; "+j+"++) { var "+R+" = vErrors["+j+"]; if ("+R+".dataPath === undefined) "+R+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+R+".schemaPath === undefined) { "+R+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(t+=" "+R+".schema = "+g+"; "+R+".data = "+m+"; "),t+=" } "):E.errors===!1?t+=" "+J+" ":(t+=" if ("+y+" == errors) { "+J+" } else {  for (var "+j+"="+y+"; "+j+"<errors; "+j+"++) { var "+R+" = vErrors["+j+"]; if ("+R+".dataPath === undefined) "+R+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+R+".schemaPath === undefined) { "+R+'.schemaPath = "'+u+'"; } ',e.opts.verbose&&(t+=" "+R+".schema = "+g+"; "+R+".data = "+m+"; "),t+=" } } "):A?(t+="   var err =   ",e.createErrors!==!1?(t+=" { keyword: '"+(f||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { keyword: '"+S.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+S.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; ")):E.errors===!1?t+=" "+J+" ":(t+=" if (Array.isArray("+L+")) { if (vErrors === null) vErrors = "+L+"; else vErrors = vErrors.concat("+L+"); errors = vErrors.length;  for (var "+j+"="+y+"; "+j+"<errors; "+j+"++) { var "+R+" = vErrors["+j+"]; if ("+R+".dataPath === undefined) "+R+".dataPath = (dataPath || '') + "+e.errorPath+";  "+R+'.schemaPath = "'+u+'";  ',e.opts.verbose&&(t+=" "+R+".schema = "+g+"; "+R+".data = "+m+"; "),t+=" } } else { "+J+" } "),t+=" } ",d&&(t+=" else { ")}return t}});var qa=G((_v,of)=>{of.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Hi=G((bv,Vi)=>{"use strict";var Bi=qa();Vi.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:Bi.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:Bi.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}});var Zi=G((Ev,zi)=>{"use strict";var cf=/^[a-z_$][a-z0-9_$-]*$/i,lf=qi(),uf=Hi();zi.exports={add:df,get:pf,remove:ff,validate:Ba};function df(s,e){var r=this.RULES;if(r.keywords[s])throw new Error("Keyword "+s+" is already defined");if(!cf.test(s))throw new Error("Keyword "+s+" is not a valid identifier");if(e){this.validateKeyword(e,!0);var a=e.type;if(Array.isArray(a))for(var t=0;t<a.length;t++)i(s,a[t],e);else i(s,a,e);var n=e.metaSchema;n&&(e.$data&&this._opts.$data&&(n={anyOf:[n,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),e.validateSchema=this.compile(n,!0))}r.keywords[s]=r.all[s]=!0;function i(o,l,u){for(var d,f=0;f<r.length;f++){var m=r[f];if(m.type==l){d=m;break}}d||(d={type:l,rules:[]},r.push(d));var p={keyword:o,definition:u,custom:!0,code:lf,implements:u.implements};d.rules.push(p),r.custom[o]=p}return this}function pf(s){var e=this.RULES.custom[s];return e?e.definition:this.RULES.keywords[s]||!1}function ff(s){var e=this.RULES;delete e.keywords[s],delete e.all[s],delete e.custom[s];for(var r=0;r<e.length;r++)for(var a=e[r].rules,t=0;t<a.length;t++)if(a[t].keyword==s){a.splice(t,1);break}return this}function Ba(s,e){Ba.errors=null;var r=this._validateKeyword=this._validateKeyword||this.compile(uf,!0);if(r(s))return!0;if(Ba.errors=r.errors,e)throw new Error("custom keyword definition is invalid: "+this.errorsText(r.errors));return!1}});var Gi=G((Sv,hf)=>{hf.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Ha=G((xv,rc)=>{"use strict";var Xi=wo(),or=bs(),mf=Po(),Qi=Oa(),vf=Da(),gf=Uo(),yf=Di(),Ki=Li(),Yi=nr();rc.exports=xe;xe.prototype.validate=bf;xe.prototype.compile=Ef;xe.prototype.addSchema=Sf;xe.prototype.addMetaSchema=xf;xe.prototype.validateSchema=Tf;xe.prototype.getSchema=wf;xe.prototype.removeSchema=Pf;xe.prototype.addFormat=Lf;xe.prototype.errorsText=kf;xe.prototype._addSchema=If;xe.prototype._compile=$f;xe.prototype.compileAsync=Mi();var Is=Zi();xe.prototype.addKeyword=Is.add;xe.prototype.getKeyword=Is.get;xe.prototype.removeKeyword=Is.remove;xe.prototype.validateKeyword=Is.validate;var Ji=Es();xe.ValidationError=Ji.Validation;xe.MissingRefError=Ji.MissingRef;xe.$dataMetaSchema=Ki;var Ps="http://json-schema.org/draft-07/schema",Wi=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],_f=["/properties"];function xe(s){if(!(this instanceof xe))return new xe(s);s=this._opts=Yi.copy(s)||{},Bf(this),this._schemas={},this._refs={},this._fragments={},this._formats=gf(s.format),this._cache=s.cache||new mf,this._loadingSchemas={},this._compilations=[],this.RULES=yf(),this._getId=Af(s),s.loopRequired=s.loopRequired||1/0,s.errorDataPath=="property"&&(s._errorDataPathProperty=!0),s.serialize===void 0&&(s.serialize=vf),this._metaOpts=qf(this),s.formats&&Mf(this),s.keywords&&Uf(this),jf(this),typeof s.meta=="object"&&this.addMetaSchema(s.meta),s.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),Ff(this)}function bf(s,e){var r;if(typeof s=="string"){if(r=this.getSchema(s),!r)throw new Error('no schema with key or ref "'+s+'"')}else{var a=this._addSchema(s);r=a.validate||this._compile(a)}var t=r(e);return r.$async!==!0&&(this.errors=r.errors),t}function Ef(s,e){var r=this._addSchema(s,void 0,e);return r.validate||this._compile(r)}function Sf(s,e,r,a){if(Array.isArray(s)){for(var t=0;t<s.length;t++)this.addSchema(s[t],void 0,r,a);return this}var n=this._getId(s);if(n!==void 0&&typeof n!="string")throw new Error("schema id must be string");return e=or.normalizeId(e||n),tc(this,e),this._schemas[e]=this._addSchema(s,r,a,!0),this}function xf(s,e,r){return this.addSchema(s,e,r,!0),this}function Tf(s,e){var r=s.$schema;if(r!==void 0&&typeof r!="string")throw new Error("$schema must be a string");if(r=r||this._opts.defaultMeta||Rf(this),!r)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var a=this.validate(r,s);if(!a&&e){var t="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(t);else throw new Error(t)}return a}function Rf(s){var e=s._opts.meta;return s._opts.defaultMeta=typeof e=="object"?s._getId(e)||e:s.getSchema(Ps)?Ps:void 0,s._opts.defaultMeta}function wf(s){var e=ec(this,s);switch(typeof e){case"object":return e.validate||this._compile(e);case"string":return this.getSchema(e);case"undefined":return Of(this,s)}}function Of(s,e){var r=or.schema.call(s,{schema:{}},e);if(r){var a=r.schema,t=r.root,n=r.baseId,i=Xi.call(s,a,t,void 0,n);return s._fragments[e]=new Qi({ref:e,fragment:!0,schema:a,root:t,baseId:n,validate:i}),i}}function ec(s,e){return e=or.normalizeId(e),s._schemas[e]||s._refs[e]||s._fragments[e]}function Pf(s){if(s instanceof RegExp)return Os(this,this._schemas,s),Os(this,this._refs,s),this;switch(typeof s){case"undefined":return Os(this,this._schemas),Os(this,this._refs),this._cache.clear(),this;case"string":var e=ec(this,s);return e&&this._cache.del(e.cacheKey),delete this._schemas[s],delete this._refs[s],this;case"object":var r=this._opts.serialize,a=r?r(s):s;this._cache.del(a);var t=this._getId(s);t&&(t=or.normalizeId(t),delete this._schemas[t],delete this._refs[t])}return this}function Os(s,e,r){for(var a in e){var t=e[a];!t.meta&&(!r||r.test(a))&&(s._cache.del(t.cacheKey),delete e[a])}}function If(s,e,r,a){if(typeof s!="object"&&typeof s!="boolean")throw new Error("schema should be object or boolean");var t=this._opts.serialize,n=t?t(s):s,i=this._cache.get(n);if(i)return i;a=a||this._opts.addUsedSchema!==!1;var o=or.normalizeId(this._getId(s));o&&a&&tc(this,o);var l=this._opts.validateSchema!==!1&&!e,u;l&&!(u=o&&o==or.normalizeId(s.$schema))&&this.validateSchema(s,!0);var d=or.ids.call(this,s),f=new Qi({id:o,schema:s,localRefs:d,cacheKey:n,meta:r});return o[0]!="#"&&a&&(this._refs[o]=f),this._cache.put(n,f),l&&u&&this.validateSchema(s,!0),f}function $f(s,e){if(s.compiling)return s.validate=t,t.schema=s.schema,t.errors=null,t.root=e||t,s.schema.$async===!0&&(t.$async=!0),t;s.compiling=!0;var r;s.meta&&(r=this._opts,this._opts=this._metaOpts);var a;try{a=Xi.call(this,s.schema,e,s.localRefs)}catch(n){throw delete s.validate,n}finally{s.compiling=!1,s.meta&&(this._opts=r)}return s.validate=a,s.refs=a.refs,s.refVal=a.refVal,s.root=a.root,a;function t(){var n=s.validate,i=n.apply(this,arguments);return t.errors=n.errors,i}}function Af(s){switch(s.schemaId){case"auto":return Cf;case"id":return Nf;default:return Df}}function Nf(s){return s.$id&&this.logger.warn("schema $id ignored",s.$id),s.id}function Df(s){return s.id&&this.logger.warn("schema id ignored",s.id),s.$id}function Cf(s){if(s.$id&&s.id&&s.$id!=s.id)throw new Error("schema $id is different from id");return s.$id||s.id}function kf(s,e){if(s=s||this.errors,!s)return"No errors";e=e||{};for(var r=e.separator===void 0?", ":e.separator,a=e.dataVar===void 0?"data":e.dataVar,t="",n=0;n<s.length;n++){var i=s[n];i&&(t+=a+i.dataPath+" "+i.message+r)}return t.slice(0,-r.length)}function Lf(s,e){return typeof e=="string"&&(e=new RegExp(e)),this._formats[s]=e,this}function jf(s){var e;if(s._opts.$data&&(e=Gi(),s.addMetaSchema(e,e.$id,!0)),s._opts.meta!==!1){var r=qa();s._opts.$data&&(r=Ki(r,_f)),s.addMetaSchema(r,Ps,!0),s._refs["http://json-schema.org/schema"]=Ps}}function Ff(s){var e=s._opts.schemas;if(e)if(Array.isArray(e))s.addSchema(e);else for(var r in e)s.addSchema(e[r],r)}function Mf(s){for(var e in s._opts.formats){var r=s._opts.formats[e];s.addFormat(e,r)}}function Uf(s){for(var e in s._opts.keywords){var r=s._opts.keywords[e];s.addKeyword(e,r)}}function tc(s,e){if(s._schemas[e]||s._refs[e])throw new Error('schema with key or id "'+e+'" already exists')}function qf(s){for(var e=Yi.copy(s._opts),r=0;r<Wi.length;r++)delete e[Wi[r]];return e}function Bf(s){var e=s._opts.logger;if(e===!1)s.logger={log:Va,warn:Va,error:Va};else{if(e===void 0&&(e=console),!(typeof e=="object"&&e.log&&e.warn&&e.error))throw new Error("logger must implement log, warn and error methods");s.logger=e}}function Va(){}});var lc=G((Cv,cc)=>{cc.exports=ic;ic.sync=zf;var nc=require("fs");function Hf(s,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var a=0;a<r.length;a++){var t=r[a].toLowerCase();if(t&&s.substr(-t.length).toLowerCase()===t)return!0}return!1}function oc(s,e,r){return!s.isSymbolicLink()&&!s.isFile()?!1:Hf(e,r)}function ic(s,e,r){nc.stat(s,function(a,t){r(a,a?!1:oc(t,s,e))})}function zf(s,e){return oc(nc.statSync(s),s,e)}});var hc=G((kv,fc)=>{fc.exports=dc;dc.sync=Zf;var uc=require("fs");function dc(s,e,r){uc.stat(s,function(a,t){r(a,a?!1:pc(t,e))})}function Zf(s,e){return pc(uc.statSync(s),e)}function pc(s,e){return s.isFile()&&Gf(s,e)}function Gf(s,e){var r=s.mode,a=s.uid,t=s.gid,n=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),i=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),o=parseInt("100",8),l=parseInt("010",8),u=parseInt("001",8),d=o|l,f=r&u||r&l&&t===i||r&o&&a===n||r&d&&n===0;return f}});var vc=G((jv,mc)=>{var Lv=require("fs"),Cs;process.platform==="win32"||global.TESTING_WINDOWS?Cs=lc():Cs=hc();mc.exports=Za;Za.sync=Wf;function Za(s,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(a,t){Za(s,e||{},function(n,i){n?t(n):a(i)})})}Cs(s,e||{},function(a,t){a&&(a.code==="EACCES"||e&&e.ignoreErrors)&&(a=null,t=!1),r(a,t)})}function Wf(s,e){try{return Cs.sync(s,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var xc=G((Fv,Sc)=>{var wr=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",gc=require("path"),Xf=wr?";":":",yc=vc(),_c=s=>Object.assign(new Error(`not found: ${s}`),{code:"ENOENT"}),bc=(s,e)=>{let r=e.colon||Xf,a=s.match(/\//)||wr&&s.match(/\\/)?[""]:[...wr?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],t=wr?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",n=wr?t.split(r):[""];return wr&&s.indexOf(".")!==-1&&n[0]!==""&&n.unshift(""),{pathEnv:a,pathExt:n,pathExtExe:t}},Ec=(s,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:a,pathExt:t,pathExtExe:n}=bc(s,e),i=[],o=u=>new Promise((d,f)=>{if(u===a.length)return e.all&&i.length?d(i):f(_c(s));let m=a[u],p=/^".*"$/.test(m)?m.slice(1,-1):m,y=gc.join(p,s),h=!p&&/^\.[\\\/]/.test(s)?s.slice(0,2)+y:y;d(l(h,u,0))}),l=(u,d,f)=>new Promise((m,p)=>{if(f===t.length)return m(o(d+1));let y=t[f];yc(u+y,{pathExt:n},(h,g)=>{if(!h&&g)if(e.all)i.push(u+y);else return m(u+y);return m(l(u,d,f+1))})});return r?o(0).then(u=>r(null,u),r):o(0)},Qf=(s,e)=>{e=e||{};let{pathEnv:r,pathExt:a,pathExtExe:t}=bc(s,e),n=[];for(let i=0;i<r.length;i++){let o=r[i],l=/^".*"$/.test(o)?o.slice(1,-1):o,u=gc.join(l,s),d=!l&&/^\.[\\\/]/.test(s)?s.slice(0,2)+u:u;for(let f=0;f<a.length;f++){let m=d+a[f];try{if(yc.sync(m,{pathExt:t}))if(e.all)n.push(m);else return m}catch{}}}if(e.all&&n.length)return n;if(e.nothrow)return null;throw _c(s)};Sc.exports=Ec;Ec.sync=Qf});var Rc=G((Mv,Ga)=>{"use strict";var Tc=(s={})=>{let e=s.env||process.env;return(s.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(a=>a.toUpperCase()==="PATH")||"Path"};Ga.exports=Tc;Ga.exports.default=Tc});var Ic=G((Uv,Pc)=>{"use strict";var wc=require("path"),Kf=xc(),Yf=Rc();function Oc(s,e){let r=s.options.env||process.env,a=process.cwd(),t=s.options.cwd!=null,n=t&&process.chdir!==void 0&&!process.chdir.disabled;if(n)try{process.chdir(s.options.cwd)}catch{}let i;try{i=Kf.sync(s.command,{path:r[Yf({env:r})],pathExt:e?wc.delimiter:void 0})}catch{}finally{n&&process.chdir(a)}return i&&(i=wc.resolve(t?s.options.cwd:"",i)),i}function Jf(s){return Oc(s)||Oc(s,!0)}Pc.exports=Jf});var $c=G((qv,Xa)=>{"use strict";var Wa=/([()\][%!^"`<>&|;, *?])/g;function eh(s){return s=s.replace(Wa,"^$1"),s}function th(s,e){return s=`${s}`,s=s.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),s=s.replace(/(?=(\\+?)?)\1$/,"$1$1"),s=`"${s}"`,s=s.replace(Wa,"^$1"),e&&(s=s.replace(Wa,"^$1")),s}Xa.exports.command=eh;Xa.exports.argument=th});var Nc=G((Bv,Ac)=>{"use strict";Ac.exports=/^#!(.*)/});var Cc=G((Vv,Dc)=>{"use strict";var rh=Nc();Dc.exports=(s="")=>{let e=s.match(rh);if(!e)return null;let[r,a]=e[0].replace(/#! ?/,"").split(" "),t=r.split("/").pop();return t==="env"?a:a?`${t} ${a}`:t}});var Lc=G((Hv,kc)=>{"use strict";var Qa=require("fs"),sh=Cc();function ah(s){let r=Buffer.alloc(150),a;try{a=Qa.openSync(s,"r"),Qa.readSync(a,r,0,150,0),Qa.closeSync(a)}catch{}return sh(r.toString())}kc.exports=ah});var Uc=G((zv,Mc)=>{"use strict";var nh=require("path"),jc=Ic(),Fc=$c(),oh=Lc(),ih=process.platform==="win32",ch=/\.(?:com|exe)$/i,lh=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function uh(s){s.file=jc(s);let e=s.file&&oh(s.file);return e?(s.args.unshift(s.file),s.command=e,jc(s)):s.file}function dh(s){if(!ih)return s;let e=uh(s),r=!ch.test(e);if(s.options.forceShell||r){let a=lh.test(e);s.command=nh.normalize(s.command),s.command=Fc.command(s.command),s.args=s.args.map(n=>Fc.argument(n,a));let t=[s.command].concat(s.args).join(" ");s.args=["/d","/s","/c",`"${t}"`],s.command=process.env.comspec||"cmd.exe",s.options.windowsVerbatimArguments=!0}return s}function ph(s,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let a={command:s,args:e,options:r,file:void 0,original:{command:s,args:e}};return r.shell?a:dh(a)}Mc.exports=ph});var Vc=G((Zv,Bc)=>{"use strict";var Ka=process.platform==="win32";function Ya(s,e){return Object.assign(new Error(`${e} ${s.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${s.command}`,path:s.command,spawnargs:s.args})}function fh(s,e){if(!Ka)return;let r=s.emit;s.emit=function(a,t){if(a==="exit"){let n=qc(t,e);if(n)return r.call(s,"error",n)}return r.apply(s,arguments)}}function qc(s,e){return Ka&&s===1&&!e.file?Ya(e.original,"spawn"):null}function hh(s,e){return Ka&&s===1&&!e.file?Ya(e.original,"spawnSync"):null}Bc.exports={hookChildProcess:fh,verifyENOENT:qc,verifyENOENTSync:hh,notFoundError:Ya}});var Zc=G((Gv,Or)=>{"use strict";var Hc=require("child_process"),Ja=Uc(),en=Vc();function zc(s,e,r){let a=Ja(s,e,r),t=Hc.spawn(a.command,a.args,a.options);return en.hookChildProcess(t,a),t}function mh(s,e,r){let a=Ja(s,e,r),t=Hc.spawnSync(a.command,a.args,a.options);return t.error=t.error||en.verifyENOENTSync(t.status,a),t}Or.exports=zc;Or.exports.spawn=zc;Or.exports.sync=mh;Or.exports._parse=Ja;Or.exports._enoent=en});var c={};uu(c,{BRAND:()=>ju,DIRTY:()=>Vt,EMPTY_PATH:()=>mu,INVALID:()=>Q,NEVER:()=>Ed,OK:()=>De,ParseStatus:()=>Ne,Schema:()=>re,ZodAny:()=>It,ZodArray:()=>Tt,ZodBigInt:()=>zt,ZodBoolean:()=>Zt,ZodBranded:()=>Lr,ZodCatch:()=>sr,ZodDate:()=>Gt,ZodDefault:()=>rr,ZodDiscriminatedUnion:()=>Jr,ZodEffects:()=>Je,ZodEnum:()=>er,ZodError:()=>qe,ZodFirstPartyTypeKind:()=>M,ZodFunction:()=>ts,ZodIntersection:()=>Kt,ZodIssueCode:()=>F,ZodLazy:()=>Yt,ZodLiteral:()=>Jt,ZodMap:()=>Er,ZodNaN:()=>xr,ZodNativeEnum:()=>tr,ZodNever:()=>at,ZodNull:()=>Xt,ZodNullable:()=>ft,ZodNumber:()=>Ht,ZodObject:()=>Be,ZodOptional:()=>Ke,ZodParsedType:()=>q,ZodPipeline:()=>jr,ZodPromise:()=>$t,ZodReadonly:()=>ar,ZodRecord:()=>es,ZodSchema:()=>re,ZodSet:()=>Sr,ZodString:()=>Pt,ZodSymbol:()=>_r,ZodTransformer:()=>Je,ZodTuple:()=>pt,ZodType:()=>re,ZodUndefined:()=>Wt,ZodUnion:()=>Qt,ZodUnknown:()=>xt,ZodVoid:()=>br,addIssueToContext:()=>U,any:()=>Zu,array:()=>Qu,bigint:()=>qu,boolean:()=>Mn,coerce:()=>bd,custom:()=>Ln,date:()=>Bu,datetimeRegex:()=>Cn,defaultErrorMap:()=>Et,discriminatedUnion:()=>ed,effect:()=>pd,enum:()=>ld,function:()=>od,getErrorMap:()=>vr,getParsedType:()=>dt,instanceof:()=>Mu,intersection:()=>td,isAborted:()=>Kr,isAsync:()=>gr,isDirty:()=>Yr,isValid:()=>Ot,late:()=>Fu,lazy:()=>id,literal:()=>cd,makeIssue:()=>kr,map:()=>ad,nan:()=>Uu,nativeEnum:()=>ud,never:()=>Wu,null:()=>zu,nullable:()=>hd,number:()=>Fn,object:()=>Ku,objectUtil:()=>Qs,oboolean:()=>_d,onumber:()=>yd,optional:()=>fd,ostring:()=>gd,pipeline:()=>vd,preprocess:()=>md,promise:()=>dd,quotelessJson:()=>pu,record:()=>sd,set:()=>nd,setErrorMap:()=>hu,strictObject:()=>Yu,string:()=>jn,symbol:()=>Vu,transformer:()=>pd,tuple:()=>rd,undefined:()=>Hu,union:()=>Ju,unknown:()=>Gu,util:()=>se,void:()=>Xu});var se;(function(s){s.assertEqual=t=>{};function e(t){}s.assertIs=e;function r(t){throw new Error}s.assertNever=r,s.arrayToEnum=t=>{let n={};for(let i of t)n[i]=i;return n},s.getValidEnumValues=t=>{let n=s.objectKeys(t).filter(o=>typeof t[t[o]]!="number"),i={};for(let o of n)i[o]=t[o];return s.objectValues(i)},s.objectValues=t=>s.objectKeys(t).map(function(n){return t[n]}),s.objectKeys=typeof Object.keys=="function"?t=>Object.keys(t):t=>{let n=[];for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.push(i);return n},s.find=(t,n)=>{for(let i of t)if(n(i))return i},s.isInteger=typeof Number.isInteger=="function"?t=>Number.isInteger(t):t=>typeof t=="number"&&Number.isFinite(t)&&Math.floor(t)===t;function a(t,n=" | "){return t.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}s.joinValues=a,s.jsonStringifyReplacer=(t,n)=>typeof n=="bigint"?n.toString():n})(se||(se={}));var Qs;(function(s){s.mergeShapes=(e,r)=>({...e,...r})})(Qs||(Qs={}));var q=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),dt=s=>{switch(typeof s){case"undefined":return q.undefined;case"string":return q.string;case"number":return Number.isNaN(s)?q.nan:q.number;case"boolean":return q.boolean;case"function":return q.function;case"bigint":return q.bigint;case"symbol":return q.symbol;case"object":return Array.isArray(s)?q.array:s===null?q.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?q.promise:typeof Map<"u"&&s instanceof Map?q.map:typeof Set<"u"&&s instanceof Set?q.set:typeof Date<"u"&&s instanceof Date?q.date:q.object;default:return q.unknown}};var F=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pu=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:"),qe=class s extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(n){return n.message},a={_errors:[]},t=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(t);else if(i.code==="invalid_return_type")t(i.returnTypeError);else if(i.code==="invalid_arguments")t(i.argumentsError);else if(i.path.length===0)a._errors.push(r(i));else{let o=a,l=0;for(;l<i.path.length;){let u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(r(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return t(this),a}static assert(e){if(!(e instanceof s))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},a=[];for(let t of this.issues)if(t.path.length>0){let n=t.path[0];r[n]=r[n]||[],r[n].push(e(t))}else a.push(e(t));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}};qe.create=s=>new qe(s);var fu=(s,e)=>{let r;switch(s.code){case F.invalid_type:s.received===q.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case F.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,se.jsonStringifyReplacer)}`;break;case F.unrecognized_keys:r=`Unrecognized key(s) in object: ${se.joinValues(s.keys,", ")}`;break;case F.invalid_union:r="Invalid input";break;case F.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${se.joinValues(s.options)}`;break;case F.invalid_enum_value:r=`Invalid enum value. Expected ${se.joinValues(s.options)}, received '${s.received}'`;break;case F.invalid_arguments:r="Invalid function arguments";break;case F.invalid_return_type:r="Invalid function return type";break;case F.invalid_date:r="Invalid date";break;case F.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:se.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case F.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case F.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case F.custom:r="Invalid input";break;case F.invalid_intersection_types:r="Intersection results could not be merged";break;case F.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case F.not_finite:r="Number must be finite";break;default:r=e.defaultError,se.assertNever(s)}return{message:r}},Et=fu;var In=Et;function hu(s){In=s}function vr(){return In}var kr=s=>{let{data:e,path:r,errorMaps:a,issueData:t}=s,n=[...r,...t.path||[]],i={...t,path:n};if(t.message!==void 0)return{...t,path:n,message:t.message};let o="",l=a.filter(u=>!!u).slice().reverse();for(let u of l)o=u(i,{data:e,defaultError:o}).message;return{...t,path:n,message:o}},mu=[];function U(s,e){let r=vr(),a=kr({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===Et?void 0:Et].filter(t=>!!t)});s.common.issues.push(a)}var Ne=class s{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let a=[];for(let t of r){if(t.status==="aborted")return Q;t.status==="dirty"&&e.dirty(),a.push(t.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){let a=[];for(let t of r){let n=await t.key,i=await t.value;a.push({key:n,value:i})}return s.mergeObjectSync(e,a)}static mergeObjectSync(e,r){let a={};for(let t of r){let{key:n,value:i}=t;if(n.status==="aborted"||i.status==="aborted")return Q;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof i.value<"u"||t.alwaysSet)&&(a[n.value]=i.value)}return{status:e.value,value:a}}},Q=Object.freeze({status:"aborted"}),Vt=s=>({status:"dirty",value:s}),De=s=>({status:"valid",value:s}),Kr=s=>s.status==="aborted",Yr=s=>s.status==="dirty",Ot=s=>s.status==="valid",gr=s=>typeof Promise<"u"&&s instanceof Promise;var Z;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e?.message})(Z||(Z={}));var Ye=class{constructor(e,r,a,t){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=t}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},$n=(s,e)=>{if(Ot(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new qe(s.common.issues);return this._error=r,this._error}}};function ee(s){if(!s)return{};let{errorMap:e,invalid_type_error:r,required_error:a,description:t}=s;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:t}:{errorMap:(i,o)=>{let{message:l}=s;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??a??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:l??r??o.defaultError}},description:t}}var re=class{get description(){return this._def.description}_getType(e){return dt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(gr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){let a={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:dt(e)},t=this._parseSync({data:e,path:a.path,parent:a});return $n(a,t)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:dt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:r});return Ot(a)?{value:a.value}:{issues:r.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(a=>Ot(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(e,r){let a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){let a={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:dt(e)},t=this._parse({data:e,path:a.path,parent:a}),n=await(gr(t)?t:Promise.resolve(t));return $n(a,n)}refine(e,r){let a=t=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(t):r;return this._refinement((t,n)=>{let i=e(t),o=()=>n.addIssue({code:F.custom,...a(t)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,r){return this._refinement((a,t)=>e(a)?!0:(t.addIssue(typeof r=="function"?r(a,t):r),!1))}_refinement(e){return new Je({schema:this,typeName:M.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Ke.create(this,this._def)}nullable(){return ft.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Tt.create(this)}promise(){return $t.create(this,this._def)}or(e){return Qt.create([this,e],this._def)}and(e){return Kt.create(this,e,this._def)}transform(e){return new Je({...ee(this._def),schema:this,typeName:M.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new rr({...ee(this._def),innerType:this,defaultValue:r,typeName:M.ZodDefault})}brand(){return new Lr({typeName:M.ZodBranded,type:this,...ee(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new sr({...ee(this._def),innerType:this,catchValue:r,typeName:M.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return jr.create(this,e)}readonly(){return ar.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},vu=/^c[^\s-]{8,}$/i,gu=/^[0-9a-z]+$/,yu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_u=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bu=/^[a-z0-9_-]{21}$/i,Eu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Su=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Tu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ks,Ru=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ou=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Pu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Iu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$u=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Nn="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Au=new RegExp(`^${Nn}$`);function Dn(s){let e="[0-5]\\d";s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`);let r=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function Nu(s){return new RegExp(`^${Dn(s)}$`)}function Cn(s){let e=`${Nn}T${Dn(s)}`,r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Du(s,e){return!!((e==="v4"||!e)&&Ru.test(s)||(e==="v6"||!e)&&Ou.test(s))}function Cu(s,e){if(!Eu.test(s))return!1;try{let[r]=s.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),t=JSON.parse(atob(a));return!(typeof t!="object"||t===null||"typ"in t&&t?.typ!=="JWT"||!t.alg||e&&t.alg!==e)}catch{return!1}}function ku(s,e){return!!((e==="v4"||!e)&&wu.test(s)||(e==="v6"||!e)&&Pu.test(s))}var Pt=class s extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==q.string){let n=this._getOrReturnCtx(e);return U(n,{code:F.invalid_type,expected:q.string,received:n.parsedType}),Q}let a=new Ne,t;for(let n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(t=this._getOrReturnCtx(e,t),U(t,{code:F.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")e.data.length>n.value&&(t=this._getOrReturnCtx(e,t),U(t,{code:F.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){let i=e.data.length>n.value,o=e.data.length<n.value;(i||o)&&(t=this._getOrReturnCtx(e,t),i?U(t,{code:F.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):o&&U(t,{code:F.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")xu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"email",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Ks||(Ks=new RegExp(Tu,"u")),Ks.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"emoji",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")_u.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"uuid",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")bu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"nanoid",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")vu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"cuid",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")gu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"cuid2",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")yu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"ulid",code:F.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{t=this._getOrReturnCtx(e,t),U(t,{validation:"url",code:F.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"regex",code:F.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?Cn(n).test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?Au.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?Nu(n).test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{code:F.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?Su.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"duration",code:F.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?Du(e.data,n.version)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"ip",code:F.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?Cu(e.data,n.alg)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"jwt",code:F.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?ku(e.data,n.version)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"cidr",code:F.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?Iu.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"base64",code:F.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?$u.test(e.data)||(t=this._getOrReturnCtx(e,t),U(t,{validation:"base64url",code:F.invalid_string,message:n.message}),a.dirty()):se.assertNever(n);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(t=>e.test(t),{validation:r,code:F.invalid_string,...Z.errToObj(a)})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Z.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...Z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...Z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...Z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...Z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...Z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...Z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...Z.errToObj(r)})}nonempty(e){return this.min(1,Z.errToObj(e))}trim(){return new s({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new s({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Pt.create=s=>new Pt({checks:[],typeName:M.ZodString,coerce:s?.coerce??!1,...ee(s)});function Lu(s,e){let r=(s.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,t=r>a?r:a,n=Number.parseInt(s.toFixed(t).replace(".","")),i=Number.parseInt(e.toFixed(t).replace(".",""));return n%i/10**t}var Ht=class s extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==q.number){let n=this._getOrReturnCtx(e);return U(n,{code:F.invalid_type,expected:q.number,received:n.parsedType}),Q}let a,t=new Ne;for(let n of this._def.checks)n.kind==="int"?se.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),U(a,{code:F.invalid_type,expected:"integer",received:"float",message:n.message}),t.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="multipleOf"?Lu(e.data,n.value)!==0&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),U(a,{code:F.not_finite,message:n.message}),t.dirty()):se.assertNever(n);return{status:t.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,Z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Z.toString(r))}setLimit(e,r,a,t){return new s({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:Z.toString(t)}]})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:Z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Ht.create=s=>new Ht({checks:[],typeName:M.ZodNumber,coerce:s?.coerce||!1,...ee(s)});var zt=class s extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==q.bigint)return this._getInvalidInput(e);let a,t=new Ne;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),U(a,{code:F.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):se.assertNever(n);return{status:t.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return U(r,{code:F.invalid_type,expected:q.bigint,received:r.parsedType}),Q}gte(e,r){return this.setLimit("min",e,!0,Z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Z.toString(r))}setLimit(e,r,a,t){return new s({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:Z.toString(t)}]})}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};zt.create=s=>new zt({checks:[],typeName:M.ZodBigInt,coerce:s?.coerce??!1,...ee(s)});var Zt=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==q.boolean){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.boolean,received:a.parsedType}),Q}return De(e.data)}};Zt.create=s=>new Zt({typeName:M.ZodBoolean,coerce:s?.coerce||!1,...ee(s)});var Gt=class s extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==q.date){let n=this._getOrReturnCtx(e);return U(n,{code:F.invalid_type,expected:q.date,received:n.parsedType}),Q}if(Number.isNaN(e.data.getTime())){let n=this._getOrReturnCtx(e);return U(n,{code:F.invalid_date}),Q}let a=new Ne,t;for(let n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(t=this._getOrReturnCtx(e,t),U(t,{code:F.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(t=this._getOrReturnCtx(e,t),U(t,{code:F.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):se.assertNever(n);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new s({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:Z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:Z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Gt.create=s=>new Gt({checks:[],coerce:s?.coerce||!1,typeName:M.ZodDate,...ee(s)});var _r=class extends re{_parse(e){if(this._getType(e)!==q.symbol){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.symbol,received:a.parsedType}),Q}return De(e.data)}};_r.create=s=>new _r({typeName:M.ZodSymbol,...ee(s)});var Wt=class extends re{_parse(e){if(this._getType(e)!==q.undefined){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.undefined,received:a.parsedType}),Q}return De(e.data)}};Wt.create=s=>new Wt({typeName:M.ZodUndefined,...ee(s)});var Xt=class extends re{_parse(e){if(this._getType(e)!==q.null){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.null,received:a.parsedType}),Q}return De(e.data)}};Xt.create=s=>new Xt({typeName:M.ZodNull,...ee(s)});var It=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return De(e.data)}};It.create=s=>new It({typeName:M.ZodAny,...ee(s)});var xt=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return De(e.data)}};xt.create=s=>new xt({typeName:M.ZodUnknown,...ee(s)});var at=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return U(r,{code:F.invalid_type,expected:q.never,received:r.parsedType}),Q}};at.create=s=>new at({typeName:M.ZodNever,...ee(s)});var br=class extends re{_parse(e){if(this._getType(e)!==q.undefined){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.void,received:a.parsedType}),Q}return De(e.data)}};br.create=s=>new br({typeName:M.ZodVoid,...ee(s)});var Tt=class s extends re{_parse(e){let{ctx:r,status:a}=this._processInputParams(e),t=this._def;if(r.parsedType!==q.array)return U(r,{code:F.invalid_type,expected:q.array,received:r.parsedType}),Q;if(t.exactLength!==null){let i=r.data.length>t.exactLength.value,o=r.data.length<t.exactLength.value;(i||o)&&(U(r,{code:i?F.too_big:F.too_small,minimum:o?t.exactLength.value:void 0,maximum:i?t.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:t.exactLength.message}),a.dirty())}if(t.minLength!==null&&r.data.length<t.minLength.value&&(U(r,{code:F.too_small,minimum:t.minLength.value,type:"array",inclusive:!0,exact:!1,message:t.minLength.message}),a.dirty()),t.maxLength!==null&&r.data.length>t.maxLength.value&&(U(r,{code:F.too_big,maximum:t.maxLength.value,type:"array",inclusive:!0,exact:!1,message:t.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((i,o)=>t.type._parseAsync(new Ye(r,i,r.path,o)))).then(i=>Ne.mergeArray(a,i));let n=[...r.data].map((i,o)=>t.type._parseSync(new Ye(r,i,r.path,o)));return Ne.mergeArray(a,n)}get element(){return this._def.type}min(e,r){return new s({...this._def,minLength:{value:e,message:Z.toString(r)}})}max(e,r){return new s({...this._def,maxLength:{value:e,message:Z.toString(r)}})}length(e,r){return new s({...this._def,exactLength:{value:e,message:Z.toString(r)}})}nonempty(e){return this.min(1,e)}};Tt.create=(s,e)=>new Tt({type:s,minLength:null,maxLength:null,exactLength:null,typeName:M.ZodArray,...ee(e)});function yr(s){if(s instanceof Be){let e={};for(let r in s.shape){let a=s.shape[r];e[r]=Ke.create(yr(a))}return new Be({...s._def,shape:()=>e})}else return s instanceof Tt?new Tt({...s._def,type:yr(s.element)}):s instanceof Ke?Ke.create(yr(s.unwrap())):s instanceof ft?ft.create(yr(s.unwrap())):s instanceof pt?pt.create(s.items.map(e=>yr(e))):s}var Be=class s extends re{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=se.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==q.object){let u=this._getOrReturnCtx(e);return U(u,{code:F.invalid_type,expected:q.object,received:u.parsedType}),Q}let{status:a,ctx:t}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof at&&this._def.unknownKeys==="strip"))for(let u in t.data)i.includes(u)||o.push(u);let l=[];for(let u of i){let d=n[u],f=t.data[u];l.push({key:{status:"valid",value:u},value:d._parse(new Ye(t,f,t.path,u)),alwaysSet:u in t.data})}if(this._def.catchall instanceof at){let u=this._def.unknownKeys;if(u==="passthrough")for(let d of o)l.push({key:{status:"valid",value:d},value:{status:"valid",value:t.data[d]}});else if(u==="strict")o.length>0&&(U(t,{code:F.unrecognized_keys,keys:o}),a.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let d of o){let f=t.data[d];l.push({key:{status:"valid",value:d},value:u._parse(new Ye(t,f,t.path,d)),alwaysSet:d in t.data})}}return t.common.async?Promise.resolve().then(async()=>{let u=[];for(let d of l){let f=await d.key,m=await d.value;u.push({key:f,value:m,alwaysSet:d.alwaysSet})}return u}).then(u=>Ne.mergeObjectSync(a,u)):Ne.mergeObjectSync(a,l)}get shape(){return this._def.shape()}strict(e){return Z.errToObj,new s({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{let t=this._def.errorMap?.(r,a).message??a.defaultError;return r.code==="unrecognized_keys"?{message:Z.errToObj(e).message??t}:{message:t}}}:{}})}strip(){return new s({...this._def,unknownKeys:"strip"})}passthrough(){return new s({...this._def,unknownKeys:"passthrough"})}extend(e){return new s({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new s({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:M.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new s({...this._def,catchall:e})}pick(e){let r={};for(let a of se.objectKeys(e))e[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new s({...this._def,shape:()=>r})}omit(e){let r={};for(let a of se.objectKeys(this.shape))e[a]||(r[a]=this.shape[a]);return new s({...this._def,shape:()=>r})}deepPartial(){return yr(this)}partial(e){let r={};for(let a of se.objectKeys(this.shape)){let t=this.shape[a];e&&!e[a]?r[a]=t:r[a]=t.optional()}return new s({...this._def,shape:()=>r})}required(e){let r={};for(let a of se.objectKeys(this.shape))if(e&&!e[a])r[a]=this.shape[a];else{let n=this.shape[a];for(;n instanceof Ke;)n=n._def.innerType;r[a]=n}return new s({...this._def,shape:()=>r})}keyof(){return kn(se.objectKeys(this.shape))}};Be.create=(s,e)=>new Be({shape:()=>s,unknownKeys:"strip",catchall:at.create(),typeName:M.ZodObject,...ee(e)});Be.strictCreate=(s,e)=>new Be({shape:()=>s,unknownKeys:"strict",catchall:at.create(),typeName:M.ZodObject,...ee(e)});Be.lazycreate=(s,e)=>new Be({shape:s,unknownKeys:"strip",catchall:at.create(),typeName:M.ZodObject,...ee(e)});var Qt=class extends re{_parse(e){let{ctx:r}=this._processInputParams(e),a=this._def.options;function t(n){for(let o of n)if(o.result.status==="valid")return o.result;for(let o of n)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let i=n.map(o=>new qe(o.ctx.common.issues));return U(r,{code:F.invalid_union,unionErrors:i}),Q}if(r.common.async)return Promise.all(a.map(async n=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await n._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(t);{let n,i=[];for(let l of a){let u={...r,common:{...r.common,issues:[]},parent:null},d=l._parseSync({data:r.data,path:r.path,parent:u});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(n)return r.common.issues.push(...n.ctx.common.issues),n.result;let o=i.map(l=>new qe(l));return U(r,{code:F.invalid_union,unionErrors:o}),Q}}get options(){return this._def.options}};Qt.create=(s,e)=>new Qt({options:s,typeName:M.ZodUnion,...ee(e)});var St=s=>s instanceof Yt?St(s.schema):s instanceof Je?St(s.innerType()):s instanceof Jt?[s.value]:s instanceof er?s.options:s instanceof tr?se.objectValues(s.enum):s instanceof rr?St(s._def.innerType):s instanceof Wt?[void 0]:s instanceof Xt?[null]:s instanceof Ke?[void 0,...St(s.unwrap())]:s instanceof ft?[null,...St(s.unwrap())]:s instanceof Lr||s instanceof ar?St(s.unwrap()):s instanceof sr?St(s._def.innerType):[],Jr=class s extends re{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==q.object)return U(r,{code:F.invalid_type,expected:q.object,received:r.parsedType}),Q;let a=this.discriminator,t=r.data[a],n=this.optionsMap.get(t);return n?r.common.async?n._parseAsync({data:r.data,path:r.path,parent:r}):n._parseSync({data:r.data,path:r.path,parent:r}):(U(r,{code:F.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),Q)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,a){let t=new Map;for(let n of r){let i=St(n.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(t.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);t.set(o,n)}}return new s({typeName:M.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:t,...ee(a)})}};function Ys(s,e){let r=dt(s),a=dt(e);if(s===e)return{valid:!0,data:s};if(r===q.object&&a===q.object){let t=se.objectKeys(e),n=se.objectKeys(s).filter(o=>t.indexOf(o)!==-1),i={...s,...e};for(let o of n){let l=Ys(s[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(r===q.array&&a===q.array){if(s.length!==e.length)return{valid:!1};let t=[];for(let n=0;n<s.length;n++){let i=s[n],o=e[n],l=Ys(i,o);if(!l.valid)return{valid:!1};t.push(l.data)}return{valid:!0,data:t}}else return r===q.date&&a===q.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}var Kt=class extends re{_parse(e){let{status:r,ctx:a}=this._processInputParams(e),t=(n,i)=>{if(Kr(n)||Kr(i))return Q;let o=Ys(n.value,i.value);return o.valid?((Yr(n)||Yr(i))&&r.dirty(),{status:r.value,value:o.data}):(U(a,{code:F.invalid_intersection_types}),Q)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([n,i])=>t(n,i)):t(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};Kt.create=(s,e,r)=>new Kt({left:s,right:e,typeName:M.ZodIntersection,...ee(r)});var pt=class s extends re{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.array)return U(a,{code:F.invalid_type,expected:q.array,received:a.parsedType}),Q;if(a.data.length<this._def.items.length)return U(a,{code:F.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Q;!this._def.rest&&a.data.length>this._def.items.length&&(U(a,{code:F.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let n=[...a.data].map((i,o)=>{let l=this._def.items[o]||this._def.rest;return l?l._parse(new Ye(a,i,a.path,o)):null}).filter(i=>!!i);return a.common.async?Promise.all(n).then(i=>Ne.mergeArray(r,i)):Ne.mergeArray(r,n)}get items(){return this._def.items}rest(e){return new s({...this._def,rest:e})}};pt.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new pt({items:s,typeName:M.ZodTuple,rest:null,...ee(e)})};var es=class s extends re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.object)return U(a,{code:F.invalid_type,expected:q.object,received:a.parsedType}),Q;let t=[],n=this._def.keyType,i=this._def.valueType;for(let o in a.data)t.push({key:n._parse(new Ye(a,o,a.path,o)),value:i._parse(new Ye(a,a.data[o],a.path,o)),alwaysSet:o in a.data});return a.common.async?Ne.mergeObjectAsync(r,t):Ne.mergeObjectSync(r,t)}get element(){return this._def.valueType}static create(e,r,a){return r instanceof re?new s({keyType:e,valueType:r,typeName:M.ZodRecord,...ee(a)}):new s({keyType:Pt.create(),valueType:e,typeName:M.ZodRecord,...ee(r)})}},Er=class extends re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.map)return U(a,{code:F.invalid_type,expected:q.map,received:a.parsedType}),Q;let t=this._def.keyType,n=this._def.valueType,i=[...a.data.entries()].map(([o,l],u)=>({key:t._parse(new Ye(a,o,a.path,[u,"key"])),value:n._parse(new Ye(a,l,a.path,[u,"value"]))}));if(a.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let l of i){let u=await l.key,d=await l.value;if(u.status==="aborted"||d.status==="aborted")return Q;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),o.set(u.value,d.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let l of i){let u=l.key,d=l.value;if(u.status==="aborted"||d.status==="aborted")return Q;(u.status==="dirty"||d.status==="dirty")&&r.dirty(),o.set(u.value,d.value)}return{status:r.value,value:o}}}};Er.create=(s,e,r)=>new Er({valueType:e,keyType:s,typeName:M.ZodMap,...ee(r)});var Sr=class s extends re{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==q.set)return U(a,{code:F.invalid_type,expected:q.set,received:a.parsedType}),Q;let t=this._def;t.minSize!==null&&a.data.size<t.minSize.value&&(U(a,{code:F.too_small,minimum:t.minSize.value,type:"set",inclusive:!0,exact:!1,message:t.minSize.message}),r.dirty()),t.maxSize!==null&&a.data.size>t.maxSize.value&&(U(a,{code:F.too_big,maximum:t.maxSize.value,type:"set",inclusive:!0,exact:!1,message:t.maxSize.message}),r.dirty());let n=this._def.valueType;function i(l){let u=new Set;for(let d of l){if(d.status==="aborted")return Q;d.status==="dirty"&&r.dirty(),u.add(d.value)}return{status:r.value,value:u}}let o=[...a.data.values()].map((l,u)=>n._parse(new Ye(a,l,a.path,u)));return a.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,r){return new s({...this._def,minSize:{value:e,message:Z.toString(r)}})}max(e,r){return new s({...this._def,maxSize:{value:e,message:Z.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Sr.create=(s,e)=>new Sr({valueType:s,minSize:null,maxSize:null,typeName:M.ZodSet,...ee(e)});var ts=class s extends re{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==q.function)return U(r,{code:F.invalid_type,expected:q.function,received:r.parsedType}),Q;function a(o,l){return kr({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,vr(),Et].filter(u=>!!u),issueData:{code:F.invalid_arguments,argumentsError:l}})}function t(o,l){return kr({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,vr(),Et].filter(u=>!!u),issueData:{code:F.invalid_return_type,returnTypeError:l}})}let n={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof $t){let o=this;return De(async function(...l){let u=new qe([]),d=await o._def.args.parseAsync(l,n).catch(p=>{throw u.addIssue(a(l,p)),u}),f=await Reflect.apply(i,this,d);return await o._def.returns._def.type.parseAsync(f,n).catch(p=>{throw u.addIssue(t(f,p)),u})})}else{let o=this;return De(function(...l){let u=o._def.args.safeParse(l,n);if(!u.success)throw new qe([a(l,u.error)]);let d=Reflect.apply(i,this,u.data),f=o._def.returns.safeParse(d,n);if(!f.success)throw new qe([t(d,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new s({...this._def,args:pt.create(e).rest(xt.create())})}returns(e){return new s({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,a){return new s({args:e||pt.create([]).rest(xt.create()),returns:r||xt.create(),typeName:M.ZodFunction,...ee(a)})}},Yt=class extends re{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Yt.create=(s,e)=>new Yt({getter:s,typeName:M.ZodLazy,...ee(e)});var Jt=class extends re{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return U(r,{received:r.data,code:F.invalid_literal,expected:this._def.value}),Q}return{status:"valid",value:e.data}}get value(){return this._def.value}};Jt.create=(s,e)=>new Jt({value:s,typeName:M.ZodLiteral,...ee(e)});function kn(s,e){return new er({values:s,typeName:M.ZodEnum,...ee(e)})}var er=class s extends re{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),a=this._def.values;return U(r,{expected:se.joinValues(a),received:r.parsedType,code:F.invalid_type}),Q}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),a=this._def.values;return U(r,{received:r.data,code:F.invalid_enum_value,options:a}),Q}return De(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return s.create(e,{...this._def,...r})}exclude(e,r=this._def){return s.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}};er.create=kn;var tr=class extends re{_parse(e){let r=se.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==q.string&&a.parsedType!==q.number){let t=se.objectValues(r);return U(a,{expected:se.joinValues(t),received:a.parsedType,code:F.invalid_type}),Q}if(this._cache||(this._cache=new Set(se.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let t=se.objectValues(r);return U(a,{received:a.data,code:F.invalid_enum_value,options:t}),Q}return De(e.data)}get enum(){return this._def.values}};tr.create=(s,e)=>new tr({values:s,typeName:M.ZodNativeEnum,...ee(e)});var $t=class extends re{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==q.promise&&r.common.async===!1)return U(r,{code:F.invalid_type,expected:q.promise,received:r.parsedType}),Q;let a=r.parsedType===q.promise?r.data:Promise.resolve(r.data);return De(a.then(t=>this._def.type.parseAsync(t,{path:r.path,errorMap:r.common.contextualErrorMap})))}};$t.create=(s,e)=>new $t({type:s,typeName:M.ZodPromise,...ee(e)});var Je=class extends re{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===M.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:a}=this._processInputParams(e),t=this._def.effect||null,n={addIssue:i=>{U(a,i),i.fatal?r.abort():r.dirty()},get path(){return a.path}};if(n.addIssue=n.addIssue.bind(n),t.type==="preprocess"){let i=t.transform(a.data,n);if(a.common.async)return Promise.resolve(i).then(async o=>{if(r.value==="aborted")return Q;let l=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return l.status==="aborted"?Q:l.status==="dirty"?Vt(l.value):r.value==="dirty"?Vt(l.value):l});{if(r.value==="aborted")return Q;let o=this._def.schema._parseSync({data:i,path:a.path,parent:a});return o.status==="aborted"?Q:o.status==="dirty"?Vt(o.value):r.value==="dirty"?Vt(o.value):o}}if(t.type==="refinement"){let i=o=>{let l=t.refinement(o,n);if(a.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?Q:(o.status==="dirty"&&r.dirty(),i(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?Q:(o.status==="dirty"&&r.dirty(),i(o.value).then(()=>({status:r.value,value:o.value}))))}if(t.type==="transform")if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Ot(i))return Q;let o=t.transform(i.value,n);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>Ot(i)?Promise.resolve(t.transform(i.value,n)).then(o=>({status:r.value,value:o})):Q);se.assertNever(t)}};Je.create=(s,e,r)=>new Je({schema:s,typeName:M.ZodEffects,effect:e,...ee(r)});Je.createWithPreprocess=(s,e,r)=>new Je({schema:e,effect:{type:"preprocess",transform:s},typeName:M.ZodEffects,...ee(r)});var Ke=class extends re{_parse(e){return this._getType(e)===q.undefined?De(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ke.create=(s,e)=>new Ke({innerType:s,typeName:M.ZodOptional,...ee(e)});var ft=class extends re{_parse(e){return this._getType(e)===q.null?De(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ft.create=(s,e)=>new ft({innerType:s,typeName:M.ZodNullable,...ee(e)});var rr=class extends re{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return r.parsedType===q.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};rr.create=(s,e)=>new rr({innerType:s,typeName:M.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ee(e)});var sr=class extends re{_parse(e){let{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},t=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return gr(t)?t.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new qe(a.common.issues)},input:a.data})})):{status:"valid",value:t.status==="valid"?t.value:this._def.catchValue({get error(){return new qe(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};sr.create=(s,e)=>new sr({innerType:s,typeName:M.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ee(e)});var xr=class extends re{_parse(e){if(this._getType(e)!==q.nan){let a=this._getOrReturnCtx(e);return U(a,{code:F.invalid_type,expected:q.nan,received:a.parsedType}),Q}return{status:"valid",value:e.data}}};xr.create=s=>new xr({typeName:M.ZodNaN,...ee(s)});var ju=Symbol("zod_brand"),Lr=class extends re{_parse(e){let{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}},jr=class s extends re{_parse(e){let{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{let n=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?Q:n.status==="dirty"?(r.dirty(),Vt(n.value)):this._def.out._parseAsync({data:n.value,path:a.path,parent:a})})();{let t=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return t.status==="aborted"?Q:t.status==="dirty"?(r.dirty(),{status:"dirty",value:t.value}):this._def.out._parseSync({data:t.value,path:a.path,parent:a})}}static create(e,r){return new s({in:e,out:r,typeName:M.ZodPipeline})}},ar=class extends re{_parse(e){let r=this._def.innerType._parse(e),a=t=>(Ot(t)&&(t.value=Object.freeze(t.value)),t);return gr(r)?r.then(t=>a(t)):a(r)}unwrap(){return this._def.innerType}};ar.create=(s,e)=>new ar({innerType:s,typeName:M.ZodReadonly,...ee(e)});function An(s,e){let r=typeof s=="function"?s(e):typeof s=="string"?{message:s}:s;return typeof r=="string"?{message:r}:r}function Ln(s,e={},r){return s?It.create().superRefine((a,t)=>{let n=s(a);if(n instanceof Promise)return n.then(i=>{if(!i){let o=An(e,a),l=o.fatal??r??!0;t.addIssue({code:"custom",...o,fatal:l})}});if(!n){let i=An(e,a),o=i.fatal??r??!0;t.addIssue({code:"custom",...i,fatal:o})}}):It.create()}var Fu={object:Be.lazycreate},M;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(M||(M={}));var Mu=(s,e={message:`Input not instance of ${s.name}`})=>Ln(r=>r instanceof s,e),jn=Pt.create,Fn=Ht.create,Uu=xr.create,qu=zt.create,Mn=Zt.create,Bu=Gt.create,Vu=_r.create,Hu=Wt.create,zu=Xt.create,Zu=It.create,Gu=xt.create,Wu=at.create,Xu=br.create,Qu=Tt.create,Ku=Be.create,Yu=Be.strictCreate,Ju=Qt.create,ed=Jr.create,td=Kt.create,rd=pt.create,sd=es.create,ad=Er.create,nd=Sr.create,od=ts.create,id=Yt.create,cd=Jt.create,ld=er.create,ud=tr.create,dd=$t.create,pd=Je.create,fd=Ke.create,hd=ft.create,md=Je.createWithPreprocess,vd=jr.create,gd=()=>jn().optional(),yd=()=>Fn().optional(),_d=()=>Mn().optional(),bd={string:(s=>Pt.create({...s,coerce:!0})),number:(s=>Ht.create({...s,coerce:!0})),boolean:(s=>Zt.create({...s,coerce:!0})),bigint:(s=>zt.create({...s,coerce:!0})),date:(s=>Gt.create({...s,coerce:!0}))};var Ed=Q;var Fr="2025-06-18";var rs=[Fr,"2025-03-26","2024-11-05","2024-10-07"],ss="2.0",Un=c.union([c.string(),c.number().int()]),qn=c.string(),Sd=c.object({progressToken:c.optional(Un)}).passthrough(),et=c.object({_meta:c.optional(Sd)}).passthrough(),Ve=c.object({method:c.string(),params:c.optional(et)}),Mr=c.object({_meta:c.optional(c.object({}).passthrough())}).passthrough(),ht=c.object({method:c.string(),params:c.optional(Mr)}),tt=c.object({_meta:c.optional(c.object({}).passthrough())}).passthrough(),as=c.union([c.string(),c.number().int()]),Bn=c.object({jsonrpc:c.literal(ss),id:as}).merge(Ve).strict(),Vn=s=>Bn.safeParse(s).success,Hn=c.object({jsonrpc:c.literal(ss)}).merge(ht).strict(),zn=s=>Hn.safeParse(s).success,Zn=c.object({jsonrpc:c.literal(ss),id:as,result:tt}).strict(),Js=s=>Zn.safeParse(s).success,je;(function(s){s[s.ConnectionClosed=-32e3]="ConnectionClosed",s[s.RequestTimeout=-32001]="RequestTimeout",s[s.ParseError=-32700]="ParseError",s[s.InvalidRequest=-32600]="InvalidRequest",s[s.MethodNotFound=-32601]="MethodNotFound",s[s.InvalidParams=-32602]="InvalidParams",s[s.InternalError=-32603]="InternalError"})(je||(je={}));var Gn=c.object({jsonrpc:c.literal(ss),id:as,error:c.object({code:c.number().int(),message:c.string(),data:c.optional(c.unknown())})}).strict(),Wn=s=>Gn.safeParse(s).success,Xn=c.union([Bn,Hn,Zn,Gn]),Rt=tt.strict(),ns=ht.extend({method:c.literal("notifications/cancelled"),params:Mr.extend({requestId:as,reason:c.string().optional()})}),xd=c.object({src:c.string(),mimeType:c.optional(c.string()),sizes:c.optional(c.array(c.string()))}).passthrough(),Ur=c.object({icons:c.array(xd).optional()}).passthrough(),qr=c.object({name:c.string(),title:c.optional(c.string())}).passthrough(),Qn=qr.extend({version:c.string(),websiteUrl:c.optional(c.string())}).merge(Ur),Td=c.object({experimental:c.optional(c.object({}).passthrough()),sampling:c.optional(c.object({}).passthrough()),elicitation:c.optional(c.object({}).passthrough()),roots:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough())}).passthrough(),ea=Ve.extend({method:c.literal("initialize"),params:et.extend({protocolVersion:c.string(),capabilities:Td,clientInfo:Qn})});var Rd=c.object({experimental:c.optional(c.object({}).passthrough()),logging:c.optional(c.object({}).passthrough()),completions:c.optional(c.object({}).passthrough()),prompts:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough()),resources:c.optional(c.object({subscribe:c.optional(c.boolean()),listChanged:c.optional(c.boolean())}).passthrough()),tools:c.optional(c.object({listChanged:c.optional(c.boolean())}).passthrough())}).passthrough(),ta=tt.extend({protocolVersion:c.string(),capabilities:Rd,serverInfo:Qn,instructions:c.optional(c.string())}),ra=ht.extend({method:c.literal("notifications/initialized")});var os=Ve.extend({method:c.literal("ping")}),wd=c.object({progress:c.number(),total:c.optional(c.number()),message:c.optional(c.string())}).passthrough(),is=ht.extend({method:c.literal("notifications/progress"),params:Mr.merge(wd).extend({progressToken:Un})}),cs=Ve.extend({params:et.extend({cursor:c.optional(qn)}).optional()}),ls=tt.extend({nextCursor:c.optional(qn)}),Kn=c.object({uri:c.string(),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).passthrough(),Yn=Kn.extend({text:c.string()}),sa=c.string().refine(s=>{try{return atob(s),!0}catch{return!1}},{message:"Invalid Base64 string"}),Jn=Kn.extend({blob:sa}),eo=qr.extend({uri:c.string(),description:c.optional(c.string()),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).merge(Ur),Od=qr.extend({uriTemplate:c.string(),description:c.optional(c.string()),mimeType:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).merge(Ur),Pd=cs.extend({method:c.literal("resources/list")}),aa=ls.extend({resources:c.array(eo)}),Id=cs.extend({method:c.literal("resources/templates/list")}),na=ls.extend({resourceTemplates:c.array(Od)}),$d=Ve.extend({method:c.literal("resources/read"),params:et.extend({uri:c.string()})}),oa=tt.extend({contents:c.array(c.union([Yn,Jn]))}),Ad=ht.extend({method:c.literal("notifications/resources/list_changed")}),Nd=Ve.extend({method:c.literal("resources/subscribe"),params:et.extend({uri:c.string()})}),Dd=Ve.extend({method:c.literal("resources/unsubscribe"),params:et.extend({uri:c.string()})}),Cd=ht.extend({method:c.literal("notifications/resources/updated"),params:Mr.extend({uri:c.string()})}),kd=c.object({name:c.string(),description:c.optional(c.string()),required:c.optional(c.boolean())}).passthrough(),Ld=qr.extend({description:c.optional(c.string()),arguments:c.optional(c.array(kd)),_meta:c.optional(c.object({}).passthrough())}).merge(Ur),jd=cs.extend({method:c.literal("prompts/list")}),ia=ls.extend({prompts:c.array(Ld)}),Fd=Ve.extend({method:c.literal("prompts/get"),params:et.extend({name:c.string(),arguments:c.optional(c.record(c.string()))})}),ca=c.object({type:c.literal("text"),text:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),la=c.object({type:c.literal("image"),data:sa,mimeType:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),ua=c.object({type:c.literal("audio"),data:sa,mimeType:c.string(),_meta:c.optional(c.object({}).passthrough())}).passthrough(),Md=c.object({type:c.literal("resource"),resource:c.union([Yn,Jn]),_meta:c.optional(c.object({}).passthrough())}).passthrough(),Ud=eo.extend({type:c.literal("resource_link")}),to=c.union([ca,la,ua,Ud,Md]),qd=c.object({role:c.enum(["user","assistant"]),content:to}).passthrough(),da=tt.extend({description:c.optional(c.string()),messages:c.array(qd)}),Bd=ht.extend({method:c.literal("notifications/prompts/list_changed")}),Vd=c.object({title:c.optional(c.string()),readOnlyHint:c.optional(c.boolean()),destructiveHint:c.optional(c.boolean()),idempotentHint:c.optional(c.boolean()),openWorldHint:c.optional(c.boolean())}).passthrough(),Hd=qr.extend({description:c.optional(c.string()),inputSchema:c.object({type:c.literal("object"),properties:c.optional(c.object({}).passthrough()),required:c.optional(c.array(c.string()))}).passthrough(),outputSchema:c.optional(c.object({type:c.literal("object"),properties:c.optional(c.object({}).passthrough()),required:c.optional(c.array(c.string()))}).passthrough()),annotations:c.optional(Vd),_meta:c.optional(c.object({}).passthrough())}).merge(Ur),pa=cs.extend({method:c.literal("tools/list")}),fa=ls.extend({tools:c.array(Hd)}),us=tt.extend({content:c.array(to).default([]),structuredContent:c.object({}).passthrough().optional(),isError:c.optional(c.boolean())}),xm=us.or(tt.extend({toolResult:c.unknown()})),ha=Ve.extend({method:c.literal("tools/call"),params:et.extend({name:c.string(),arguments:c.optional(c.record(c.unknown()))})}),zd=ht.extend({method:c.literal("notifications/tools/list_changed")}),Br=c.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),ma=Ve.extend({method:c.literal("logging/setLevel"),params:et.extend({level:Br})}),Zd=ht.extend({method:c.literal("notifications/message"),params:Mr.extend({level:Br,logger:c.optional(c.string()),data:c.unknown()})}),Gd=c.object({name:c.string().optional()}).passthrough(),Wd=c.object({hints:c.optional(c.array(Gd)),costPriority:c.optional(c.number().min(0).max(1)),speedPriority:c.optional(c.number().min(0).max(1)),intelligencePriority:c.optional(c.number().min(0).max(1))}).passthrough(),Xd=c.object({role:c.enum(["user","assistant"]),content:c.union([ca,la,ua])}).passthrough(),Qd=Ve.extend({method:c.literal("sampling/createMessage"),params:et.extend({messages:c.array(Xd),systemPrompt:c.optional(c.string()),includeContext:c.optional(c.enum(["none","thisServer","allServers"])),temperature:c.optional(c.number()),maxTokens:c.number().int(),stopSequences:c.optional(c.array(c.string())),metadata:c.optional(c.object({}).passthrough()),modelPreferences:c.optional(Wd)})}),va=tt.extend({model:c.string(),stopReason:c.optional(c.enum(["endTurn","stopSequence","maxTokens"]).or(c.string())),role:c.enum(["user","assistant"]),content:c.discriminatedUnion("type",[ca,la,ua])}),Kd=c.object({type:c.literal("boolean"),title:c.optional(c.string()),description:c.optional(c.string()),default:c.optional(c.boolean())}).passthrough(),Yd=c.object({type:c.literal("string"),title:c.optional(c.string()),description:c.optional(c.string()),minLength:c.optional(c.number()),maxLength:c.optional(c.number()),format:c.optional(c.enum(["email","uri","date","date-time"]))}).passthrough(),Jd=c.object({type:c.enum(["number","integer"]),title:c.optional(c.string()),description:c.optional(c.string()),minimum:c.optional(c.number()),maximum:c.optional(c.number())}).passthrough(),ep=c.object({type:c.literal("string"),title:c.optional(c.string()),description:c.optional(c.string()),enum:c.array(c.string()),enumNames:c.optional(c.array(c.string()))}).passthrough(),tp=c.union([Kd,Yd,Jd,ep]),rp=Ve.extend({method:c.literal("elicitation/create"),params:et.extend({message:c.string(),requestedSchema:c.object({type:c.literal("object"),properties:c.record(c.string(),tp),required:c.optional(c.array(c.string()))}).passthrough()})}),ga=tt.extend({action:c.enum(["accept","decline","cancel"]),content:c.optional(c.record(c.string(),c.unknown()))}),sp=c.object({type:c.literal("ref/resource"),uri:c.string()}).passthrough();var ap=c.object({type:c.literal("ref/prompt"),name:c.string()}).passthrough(),np=Ve.extend({method:c.literal("completion/complete"),params:et.extend({ref:c.union([ap,sp]),argument:c.object({name:c.string(),value:c.string()}).passthrough(),context:c.optional(c.object({arguments:c.optional(c.record(c.string(),c.string()))}))})}),ya=tt.extend({completion:c.object({values:c.array(c.string()).max(100),total:c.optional(c.number().int()),hasMore:c.optional(c.boolean())}).passthrough()}),op=c.object({uri:c.string().startsWith("file://"),name:c.optional(c.string()),_meta:c.optional(c.object({}).passthrough())}).passthrough(),ip=Ve.extend({method:c.literal("roots/list")}),_a=tt.extend({roots:c.array(op)}),cp=ht.extend({method:c.literal("notifications/roots/list_changed")}),Tm=c.union([os,ea,np,ma,Fd,jd,Pd,Id,$d,Nd,Dd,ha,pa]),Rm=c.union([ns,is,ra,cp]),wm=c.union([Rt,va,ga,_a]),Om=c.union([os,Qd,rp,ip]),Pm=c.union([ns,is,Zd,Cd,Ad,zd,Bd]),Im=c.union([Rt,ta,ya,da,ia,aa,na,oa,us,fa]),Ce=class extends Error{constructor(e,r,a){super(`MCP error ${e}: ${r}`),this.code=e,this.data=a,this.name="McpError"}};var lp=6e4,Tr=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this.setNotificationHandler(ns,r=>{let a=this._requestHandlerAbortControllers.get(r.params.requestId);a?.abort(r.params.reason)}),this.setNotificationHandler(is,r=>{this._onprogress(r)}),this.setRequestHandler(os,r=>({}))}_setupTimeout(e,r,a,t,n=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(t,r),startTime:Date.now(),timeout:r,maxTotalTimeout:a,resetTimeoutOnProgress:n,onTimeout:t})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let a=Date.now()-r.startTime;if(r.maxTotalTimeout&&a>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),new Ce(je.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:a});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var r,a,t;this._transport=e;let n=(r=this.transport)===null||r===void 0?void 0:r.onclose;this._transport.onclose=()=>{n?.(),this._onclose()};let i=(a=this.transport)===null||a===void 0?void 0:a.onerror;this._transport.onerror=l=>{i?.(l),this._onerror(l)};let o=(t=this._transport)===null||t===void 0?void 0:t.onmessage;this._transport.onmessage=(l,u)=>{o?.(l,u),Js(l)||Wn(l)?this._onresponse(l):Vn(l)?this._onrequest(l,u):zn(l)?this._onnotification(l):this._onerror(new Error(`Unknown message type: ${JSON.stringify(l)}`))},await this._transport.start()}_onclose(){var e;let r=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._pendingDebouncedNotifications.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);let a=new Ce(je.ConnectionClosed,"Connection closed");for(let t of r.values())t(a)}_onerror(e){var r;(r=this.onerror)===null||r===void 0||r.call(this,e)}_onnotification(e){var r;let a=(r=this._notificationHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackNotificationHandler;a!==void 0&&Promise.resolve().then(()=>a(e)).catch(t=>this._onerror(new Error(`Uncaught error in notification handler: ${t}`)))}_onrequest(e,r){var a,t;let n=(a=this._requestHandlers.get(e.method))!==null&&a!==void 0?a:this.fallbackRequestHandler,i=this._transport;if(n===void 0){i?.send({jsonrpc:"2.0",id:e.id,error:{code:je.MethodNotFound,message:"Method not found"}}).catch(u=>this._onerror(new Error(`Failed to send an error response: ${u}`)));return}let o=new AbortController;this._requestHandlerAbortControllers.set(e.id,o);let l={signal:o.signal,sessionId:i?.sessionId,_meta:(t=e.params)===null||t===void 0?void 0:t._meta,sendNotification:u=>this.notification(u,{relatedRequestId:e.id}),sendRequest:(u,d,f)=>this.request(u,d,{...f,relatedRequestId:e.id}),authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo};Promise.resolve().then(()=>n(e,l)).then(u=>{if(!o.signal.aborted)return i?.send({result:u,jsonrpc:"2.0",id:e.id})},u=>{var d;if(!o.signal.aborted)return i?.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(u.code)?u.code:je.InternalError,message:(d=u.message)!==null&&d!==void 0?d:"Internal error"}})}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...a}=e.params,t=Number(r),n=this._progressHandlers.get(t);if(!n){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(t),o=this._timeoutInfo.get(t);if(o&&i&&o.resetTimeoutOnProgress)try{this._resetTimeout(t)}catch(l){i(l);return}n(a)}_onresponse(e){let r=Number(e.id),a=this._responseHandlers.get(r);if(a===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(r),this._progressHandlers.delete(r),this._cleanupTimeout(r),Js(e))a(e);else{let t=new Ce(e.error.code,e.error.message,e.error.data);a(t)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,r,a){let{relatedRequestId:t,resumptionToken:n,onresumptiontoken:i}=a??{};return new Promise((o,l)=>{var u,d,f,m,p,y;if(!this._transport){l(new Error("Not connected"));return}((u=this._options)===null||u===void 0?void 0:u.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(d=a?.signal)===null||d===void 0||d.throwIfAborted();let h=this._requestMessageId++,g={...e,jsonrpc:"2.0",id:h};a?.onprogress&&(this._progressHandlers.set(h,a.onprogress),g.params={...e.params,_meta:{...((f=e.params)===null||f===void 0?void 0:f._meta)||{},progressToken:h}});let S=T=>{var w;this._responseHandlers.delete(h),this._progressHandlers.delete(h),this._cleanupTimeout(h),(w=this._transport)===null||w===void 0||w.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:h,reason:String(T)}},{relatedRequestId:t,resumptionToken:n,onresumptiontoken:i}).catch(x=>this._onerror(new Error(`Failed to send cancellation: ${x}`))),l(T)};this._responseHandlers.set(h,T=>{var w;if(!(!((w=a?.signal)===null||w===void 0)&&w.aborted)){if(T instanceof Error)return l(T);try{let x=r.parse(T.result);o(x)}catch(x){l(x)}}}),(m=a?.signal)===null||m===void 0||m.addEventListener("abort",()=>{var T;S((T=a?.signal)===null||T===void 0?void 0:T.reason)});let O=(p=a?.timeout)!==null&&p!==void 0?p:lp,E=()=>S(new Ce(je.RequestTimeout,"Request timed out",{timeout:O}));this._setupTimeout(h,O,a?.maxTotalTimeout,E,(y=a?.resetTimeoutOnProgress)!==null&&y!==void 0?y:!1),this._transport.send(g,{relatedRequestId:t,resumptionToken:n,onresumptiontoken:i}).catch(T=>{this._cleanupTimeout(h),l(T)})})}async notification(e,r){var a,t;if(!this._transport)throw new Error("Not connected");if(this.assertNotificationCapability(e.method),((t=(a=this._options)===null||a===void 0?void 0:a.debouncedNotificationMethods)!==null&&t!==void 0?t:[]).includes(e.method)&&!e.params&&!r?.relatedRequestId){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{var l;if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let u={...e,jsonrpc:"2.0"};(l=this._transport)===null||l===void 0||l.send(u,r).catch(d=>this._onerror(d))});return}let o={...e,jsonrpc:"2.0"};await this._transport.send(o,r)}setRequestHandler(e,r){let a=e.shape.method.value;this.assertRequestHandlerCapability(a),this._requestHandlers.set(a,(t,n)=>Promise.resolve(r(e.parse(t),n)))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){this._notificationHandlers.set(e.shape.method.value,a=>Promise.resolve(r(e.parse(a))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}};function ds(s,e){return Object.entries(e).reduce((r,[a,t])=>(t&&typeof t=="object"?r[a]=r[a]?{...r[a],...t}:t:r[a]=t,r),{...s})}var sc=Bt(Ha(),1),$s=class extends Tr{constructor(e,r){var a;super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Br.options.map((t,n)=>[t,n])),this.isMessageIgnored=(t,n)=>{let i=this._loggingLevels.get(n);return i?this.LOG_LEVEL_SEVERITY.get(t)<this.LOG_LEVEL_SEVERITY.get(i):!1},this._capabilities=(a=r?.capabilities)!==null&&a!==void 0?a:{},this._instructions=r?.instructions,this.setRequestHandler(ea,t=>this._oninitialize(t)),this.setNotificationHandler(ra,()=>{var t;return(t=this.oninitialized)===null||t===void 0?void 0:t.call(this)}),this._capabilities.logging&&this.setRequestHandler(ma,async(t,n)=>{var i;let o=n.sessionId||((i=n.requestInfo)===null||i===void 0?void 0:i.headers["mcp-session-id"])||void 0,{level:l}=t.params,u=Br.safeParse(l);return u.success&&this._loggingLevels.set(o,u.data),{}})}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=ds(this._capabilities,e)}assertCapabilityForMethod(e){var r,a,t;switch(e){case"sampling/createMessage":if(!(!((r=this._clientCapabilities)===null||r===void 0)&&r.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!(!((a=this._clientCapabilities)===null||a===void 0)&&a.elicitation))throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!(!((t=this._clientCapabilities)===null||t===void 0)&&t.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Server does not support sampling (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"ping":case"initialize":break}}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:rs.includes(r)?r:Fr,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Rt)}async createMessage(e,r){return this.request({method:"sampling/createMessage",params:e},va,r)}async elicitInput(e,r){let a=await this.request({method:"elicitation/create",params:e},ga,r);if(a.action==="accept"&&a.content)try{let t=new sc.default,n=t.compile(e.requestedSchema);if(!n(a.content))throw new Ce(je.InvalidParams,`Elicitation response content does not match requested schema: ${t.errorsText(n.errors)}`)}catch(t){throw t instanceof Ce?t:new Ce(je.InternalError,`Error validating elicitation response: ${t}`)}return a}async listRoots(e,r){return this.request({method:"roots/list",params:e},_a,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var za=Bt(require("node:process"),1);var Rr=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Vf(r)}clear(){this._buffer=void 0}};function Vf(s){return Xn.parse(JSON.parse(s))}function As(s){return JSON.stringify(s)+`
`}var Ns=class{constructor(e=za.default.stdin,r=za.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new Rr,this._started=!1,this._ondata=a=>{this._readBuffer.append(a),this.processReadBuffer()},this._onerror=a=>{var t;(t=this.onerror)===null||t===void 0||t.call(this,a)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(var e,r;;)try{let a=this._readBuffer.readMessage();if(a===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,a)}catch(a){(r=this.onerror)===null||r===void 0||r.call(this,a)}}async close(){var e;this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),(e=this.onclose)===null||e===void 0||e.call(this)}send(e){return new Promise(r=>{let a=As(e);this._stdout.write(a)?r():this._stdout.once("drain",r)})}};var ac=Bt(Ha(),1),Ds=class extends Tr{constructor(e,r){var a;super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._capabilities=(a=r?.capabilities)!==null&&a!==void 0?a:{},this._ajv=new ac.default}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=ds(this._capabilities,e)}assertCapability(e,r){var a;if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a[e]))throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let a=await this.request({method:"initialize",params:{protocolVersion:Fr,capabilities:this._capabilities,clientInfo:this._clientInfo}},ta,r);if(a===void 0)throw new Error(`Server sent invalid initialize result: ${a}`);if(!rs.includes(a.protocolVersion))throw new Error(`Server's protocol version is not supported: ${a.protocolVersion}`);this._serverCapabilities=a.capabilities,this._serverVersion=a.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(a.protocolVersion),this._instructions=a.instructions,await this.notification({method:"notifications/initialized"})}catch(a){throw this.close(),a}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var r,a,t,n,i;switch(e){case"logging/setLevel":if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t.resources))throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(!((n=this._serverCapabilities)===null||n===void 0)&&n.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.completions))throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){var r;switch(e){case"notifications/roots/list_changed":if(!(!((r=this._capabilities.roots)===null||r===void 0)&&r.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"ping":break}}async ping(e){return this.request({method:"ping"},Rt,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},ya,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},Rt,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},da,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},ia,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},aa,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},na,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},oa,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},Rt,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},Rt,r)}async callTool(e,r=us,a){let t=await this.request({method:"tools/call",params:e},r,a),n=this.getToolOutputValidator(e.name);if(n){if(!t.structuredContent&&!t.isError)throw new Ce(je.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(t.structuredContent)try{if(!n(t.structuredContent))throw new Ce(je.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(n.errors)}`)}catch(i){throw i instanceof Ce?i:new Ce(je.InvalidParams,`Failed to validate structured content: ${i instanceof Error?i.message:String(i)}`)}}return t}cacheToolOutputSchemas(e){this._cachedToolOutputValidators.clear();for(let r of e)if(r.outputSchema)try{let a=this._ajv.compile(r.outputSchema);this._cachedToolOutputValidators.set(r.name,a)}catch{}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let a=await this.request({method:"tools/list",params:e},fa,r);return this.cacheToolOutputSchemas(a.tools),a}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}};var Gc=Bt(Zc(),1),Hr=Bt(require("node:process"),1),Wc=require("node:stream");var vh=Hr.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function gh(){let s={};for(let e of vh){let r=Hr.default.env[e];r!==void 0&&(r.startsWith("()")||(s[e]=r))}return s}var ks=class{constructor(e){this._abortController=new AbortController,this._readBuffer=new Rr,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new Wc.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{var a,t,n,i,o;this._process=(0,Gc.default)(this._serverParams.command,(a=this._serverParams.args)!==null&&a!==void 0?a:[],{env:{...gh(),...this._serverParams.env},stdio:["pipe","pipe",(t=this._serverParams.stderr)!==null&&t!==void 0?t:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:Hr.default.platform==="win32"&&yh(),cwd:this._serverParams.cwd}),this._process.on("error",l=>{var u,d;if(l.name==="AbortError"){(u=this.onclose)===null||u===void 0||u.call(this);return}r(l),(d=this.onerror)===null||d===void 0||d.call(this,l)}),this._process.on("spawn",()=>{e()}),this._process.on("close",l=>{var u;this._process=void 0,(u=this.onclose)===null||u===void 0||u.call(this)}),(n=this._process.stdin)===null||n===void 0||n.on("error",l=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,l)}),(i=this._process.stdout)===null||i===void 0||i.on("data",l=>{this._readBuffer.append(l),this.processReadBuffer()}),(o=this._process.stdout)===null||o===void 0||o.on("error",l=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,l)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var e,r;return this._stderrStream?this._stderrStream:(r=(e=this._process)===null||e===void 0?void 0:e.stderr)!==null&&r!==void 0?r:null}get pid(){var e,r;return(r=(e=this._process)===null||e===void 0?void 0:e.pid)!==null&&r!==void 0?r:null}processReadBuffer(){for(var e,r;;)try{let a=this._readBuffer.readMessage();if(a===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,a)}catch(a){(r=this.onerror)===null||r===void 0||r.call(this,a)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(e){return new Promise(r=>{var a;if(!(!((a=this._process)===null||a===void 0)&&a.stdin))throw new Error("Not connected");let t=As(e);this._process.stdin.write(t)?r():this._process.stdin.once("drain",r)})}};function yh(){return"type"in Hr.default}var Qc=Symbol("Let zodToJsonSchema decide on which parser to use");var Xc={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Kc=s=>typeof s=="string"?{...Xc,name:s}:{...Xc,...s};var Yc=s=>{let e=Kc(s),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([a,t])=>[t._def,{def:t._def,path:[...e.basePath,e.definitionPath,a],jsonSchema:void 0}]))}};function tn(s,e,r,a){a?.errorMessages&&r&&(s.errorMessage={...s.errorMessage,[e]:r})}function oe(s,e,r,a,t){s[e]=r,tn(s,e,a,t)}var Ls=(s,e)=>{let r=0;for(;r<s.length&&r<e.length&&s[r]===e[r];r++);return[(s.length-r).toString(),...e.slice(r)].join("/")};function ge(s){if(s.target!=="openAi")return{};let e=[...s.basePath,s.definitionPath,s.openAiAnyTypeName];return s.flags.hasReferencedOpenAiAnyType=!0,{$ref:s.$refStrategy==="relative"?Ls(e,s.currentPath):e.join("/")}}function Jc(s,e){let r={type:"array"};return s.type?._def&&s.type?._def?.typeName!==M.ZodAny&&(r.items=K(s.type._def,{...e,currentPath:[...e.currentPath,"items"]})),s.minLength&&oe(r,"minItems",s.minLength.value,s.minLength.message,e),s.maxLength&&oe(r,"maxItems",s.maxLength.value,s.maxLength.message,e),s.exactLength&&(oe(r,"minItems",s.exactLength.value,s.exactLength.message,e),oe(r,"maxItems",s.exactLength.value,s.exactLength.message,e)),r}function el(s,e){let r={type:"integer",format:"int64"};if(!s.checks)return r;for(let a of s.checks)switch(a.kind){case"min":e.target==="jsonSchema7"?a.inclusive?oe(r,"minimum",a.value,a.message,e):oe(r,"exclusiveMinimum",a.value,a.message,e):(a.inclusive||(r.exclusiveMinimum=!0),oe(r,"minimum",a.value,a.message,e));break;case"max":e.target==="jsonSchema7"?a.inclusive?oe(r,"maximum",a.value,a.message,e):oe(r,"exclusiveMaximum",a.value,a.message,e):(a.inclusive||(r.exclusiveMaximum=!0),oe(r,"maximum",a.value,a.message,e));break;case"multipleOf":oe(r,"multipleOf",a.value,a.message,e);break}return r}function tl(){return{type:"boolean"}}function js(s,e){return K(s.type._def,e)}var rl=(s,e)=>K(s.innerType._def,e);function rn(s,e,r){let a=r??e.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((t,n)=>rn(s,e,t))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return _h(s,e)}}var _h=(s,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let a of s.checks)switch(a.kind){case"min":oe(r,"minimum",a.value,a.message,e);break;case"max":oe(r,"maximum",a.value,a.message,e);break}return r};function sl(s,e){return{...K(s.innerType._def,e),default:s.defaultValue()}}function al(s,e){return e.effectStrategy==="input"?K(s.schema._def,e):ge(e)}function nl(s){return{type:"string",enum:Array.from(s.values)}}var bh=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function ol(s,e){let r=[K(s.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),K(s.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(n=>!!n),a=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,t=[];return r.forEach(n=>{if(bh(n))t.push(...n.allOf),n.unevaluatedProperties===void 0&&(a=void 0);else{let i=n;if("additionalProperties"in n&&n.additionalProperties===!1){let{additionalProperties:o,...l}=n;i=l}else a=void 0;t.push(i)}}),t.length?{allOf:t,...a}:void 0}function il(s,e){let r=typeof s.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(s.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[s.value]}:{type:r==="bigint"?"integer":r,const:s.value}}var sn,nt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(sn===void 0&&(sn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),sn),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Fs(s,e){let r={type:"string"};if(s.checks)for(let a of s.checks)switch(a.kind){case"min":oe(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e);break;case"max":oe(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ot(r,"email",a.message,e);break;case"format:idn-email":ot(r,"idn-email",a.message,e);break;case"pattern:zod":Fe(r,nt.email,a.message,e);break}break;case"url":ot(r,"uri",a.message,e);break;case"uuid":ot(r,"uuid",a.message,e);break;case"regex":Fe(r,a.regex,a.message,e);break;case"cuid":Fe(r,nt.cuid,a.message,e);break;case"cuid2":Fe(r,nt.cuid2,a.message,e);break;case"startsWith":Fe(r,RegExp(`^${an(a.value,e)}`),a.message,e);break;case"endsWith":Fe(r,RegExp(`${an(a.value,e)}$`),a.message,e);break;case"datetime":ot(r,"date-time",a.message,e);break;case"date":ot(r,"date",a.message,e);break;case"time":ot(r,"time",a.message,e);break;case"duration":ot(r,"duration",a.message,e);break;case"length":oe(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e),oe(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"includes":{Fe(r,RegExp(an(a.value,e)),a.message,e);break}case"ip":{a.version!=="v6"&&ot(r,"ipv4",a.message,e),a.version!=="v4"&&ot(r,"ipv6",a.message,e);break}case"base64url":Fe(r,nt.base64url,a.message,e);break;case"jwt":Fe(r,nt.jwt,a.message,e);break;case"cidr":{a.version!=="v6"&&Fe(r,nt.ipv4Cidr,a.message,e),a.version!=="v4"&&Fe(r,nt.ipv6Cidr,a.message,e);break}case"emoji":Fe(r,nt.emoji(),a.message,e);break;case"ulid":{Fe(r,nt.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{ot(r,"binary",a.message,e);break}case"contentEncoding:base64":{oe(r,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{Fe(r,nt.base64,a.message,e);break}}break}case"nanoid":Fe(r,nt.nanoid,a.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function an(s,e){return e.patternStrategy==="escape"?Sh(s):s}var Eh=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Sh(s){let e="";for(let r=0;r<s.length;r++)Eh.has(s[r])||(e+="\\"),e+=s[r];return e}function ot(s,e,r,a){s.format||s.anyOf?.some(t=>t.format)?(s.anyOf||(s.anyOf=[]),s.format&&(s.anyOf.push({format:s.format,...s.errorMessage&&a.errorMessages&&{errorMessage:{format:s.errorMessage.format}}}),delete s.format,s.errorMessage&&(delete s.errorMessage.format,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.anyOf.push({format:e,...r&&a.errorMessages&&{errorMessage:{format:r}}})):oe(s,"format",e,r,a)}function Fe(s,e,r,a){s.pattern||s.allOf?.some(t=>t.pattern)?(s.allOf||(s.allOf=[]),s.pattern&&(s.allOf.push({pattern:s.pattern,...s.errorMessage&&a.errorMessages&&{errorMessage:{pattern:s.errorMessage.pattern}}}),delete s.pattern,s.errorMessage&&(delete s.errorMessage.pattern,Object.keys(s.errorMessage).length===0&&delete s.errorMessage)),s.allOf.push({pattern:cl(e,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):oe(s,"pattern",cl(e,a),r,a)}function cl(s,e){if(!e.applyRegexFlags||!s.flags)return s.source;let r={i:s.flags.includes("i"),m:s.flags.includes("m"),s:s.flags.includes("s")},a=r.i?s.source.toLowerCase():s.source,t="",n=!1,i=!1,o=!1;for(let l=0;l<a.length;l++){if(n){t+=a[l],n=!1;continue}if(r.i){if(i){if(a[l].match(/[a-z]/)){o?(t+=a[l],t+=`${a[l-2]}-${a[l]}`.toUpperCase(),o=!1):a[l+1]==="-"&&a[l+2]?.match(/[a-z]/)?(t+=a[l],o=!0):t+=`${a[l]}${a[l].toUpperCase()}`;continue}}else if(a[l].match(/[a-z]/)){t+=`[${a[l]}${a[l].toUpperCase()}]`;continue}}if(r.m){if(a[l]==="^"){t+=`(^|(?<=[\r
]))`;continue}else if(a[l]==="$"){t+=`($|(?=[\r
]))`;continue}}if(r.s&&a[l]==="."){t+=i?`${a[l]}\r
`:`[${a[l]}\r
]`;continue}t+=a[l],a[l]==="\\"?n=!0:i&&a[l]==="]"?i=!1:!i&&a[l]==="["&&(i=!0)}try{new RegExp(t)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),s.source}return t}function Ms(s,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&s.keyType?._def.typeName===M.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((a,t)=>({...a,[t]:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"properties",t]})??ge(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(s.keyType?._def.typeName===M.ZodString&&s.keyType._def.checks?.length){let{type:a,...t}=Fs(s.keyType._def,e);return{...r,propertyNames:t}}else{if(s.keyType?._def.typeName===M.ZodEnum)return{...r,propertyNames:{enum:s.keyType._def.values}};if(s.keyType?._def.typeName===M.ZodBranded&&s.keyType._def.type._def.typeName===M.ZodString&&s.keyType._def.type._def.checks?.length){let{type:a,...t}=js(s.keyType._def,e);return{...r,propertyNames:t}}}return r}function ll(s,e){if(e.mapStrategy==="record")return Ms(s,e);let r=K(s.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ge(e),a=K(s.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ge(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,a],minItems:2,maxItems:2}}}function ul(s){let e=s.values,a=Object.keys(s.values).filter(n=>typeof e[e[n]]!="number").map(n=>e[n]),t=Array.from(new Set(a.map(n=>typeof n)));return{type:t.length===1?t[0]==="string"?"string":"number":["string","number"],enum:a}}function dl(s){return s.target==="openAi"?void 0:{not:ge({...s,currentPath:[...s.currentPath,"not"]})}}function pl(s){return s.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var zr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function hl(s,e){if(e.target==="openApi3")return fl(s,e);let r=s.options instanceof Map?Array.from(s.options.values()):s.options;if(r.every(a=>a._def.typeName in zr&&(!a._def.checks||!a._def.checks.length))){let a=r.reduce((t,n)=>{let i=zr[n._def.typeName];return i&&!t.includes(i)?[...t,i]:t},[]);return{type:a.length>1?a:a[0]}}else if(r.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){let a=r.reduce((t,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...t,i];case"bigint":return[...t,"integer"];case"object":if(n._def.value===null)return[...t,"null"];case"symbol":case"undefined":case"function":default:return t}},[]);if(a.length===r.length){let t=a.filter((n,i,o)=>o.indexOf(n)===i);return{type:t.length>1?t:t[0],enum:r.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(r.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((a,t)=>[...a,...t._def.values.filter(n=>!a.includes(n))],[])};return fl(s,e)}var fl=(s,e)=>{let r=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((a,t)=>K(a._def,{...e,currentPath:[...e.currentPath,"anyOf",`${t}`]})).filter(a=>!!a&&(!e.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return r.length?{anyOf:r}:void 0};function ml(s,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(s.innerType._def.typeName)&&(!s.innerType._def.checks||!s.innerType._def.checks.length))return e.target==="openApi3"?{type:zr[s.innerType._def.typeName],nullable:!0}:{type:[zr[s.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let a=K(s.innerType._def,{...e,currentPath:[...e.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}let r=K(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function vl(s,e){let r={type:"number"};if(!s.checks)return r;for(let a of s.checks)switch(a.kind){case"int":r.type="integer",tn(r,"type",a.message,e);break;case"min":e.target==="jsonSchema7"?a.inclusive?oe(r,"minimum",a.value,a.message,e):oe(r,"exclusiveMinimum",a.value,a.message,e):(a.inclusive||(r.exclusiveMinimum=!0),oe(r,"minimum",a.value,a.message,e));break;case"max":e.target==="jsonSchema7"?a.inclusive?oe(r,"maximum",a.value,a.message,e):oe(r,"exclusiveMaximum",a.value,a.message,e):(a.inclusive||(r.exclusiveMaximum=!0),oe(r,"maximum",a.value,a.message,e));break;case"multipleOf":oe(r,"multipleOf",a.value,a.message,e);break}return r}function gl(s,e){let r=e.target==="openAi",a={type:"object",properties:{}},t=[],n=s.shape();for(let o in n){let l=n[o];if(l===void 0||l._def===void 0)continue;let u=Th(l);u&&r&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);let d=K(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(a.properties[o]=d,u||t.push(o))}t.length&&(a.required=t);let i=xh(s,e);return i!==void 0&&(a.additionalProperties=i),a}function xh(s,e){if(s.catchall._def.typeName!=="ZodNever")return K(s.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(s.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Th(s){try{return s.isOptional()}catch{return!0}}var yl=(s,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return K(s.innerType._def,e);let r=K(s.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:ge(e)},r]}:ge(e)};var _l=(s,e)=>{if(e.pipeStrategy==="input")return K(s.in._def,e);if(e.pipeStrategy==="output")return K(s.out._def,e);let r=K(s.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),a=K(s.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(t=>t!==void 0)}};function bl(s,e){return K(s.type._def,e)}function El(s,e){let a={type:"array",uniqueItems:!0,items:K(s.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return s.minSize&&oe(a,"minItems",s.minSize.value,s.minSize.message,e),s.maxSize&&oe(a,"maxItems",s.maxSize.value,s.maxSize.message,e),a}function Sl(s,e){return s.rest?{type:"array",minItems:s.items.length,items:s.items.map((r,a)=>K(r._def,{...e,currentPath:[...e.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[]),additionalItems:K(s.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:s.items.length,maxItems:s.items.length,items:s.items.map((r,a)=>K(r._def,{...e,currentPath:[...e.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[])}}function xl(s){return{not:ge(s)}}function Tl(s){return ge(s)}var Rl=(s,e)=>K(s.innerType._def,e);var wl=(s,e,r)=>{switch(e){case M.ZodString:return Fs(s,r);case M.ZodNumber:return vl(s,r);case M.ZodObject:return gl(s,r);case M.ZodBigInt:return el(s,r);case M.ZodBoolean:return tl();case M.ZodDate:return rn(s,r);case M.ZodUndefined:return xl(r);case M.ZodNull:return pl(r);case M.ZodArray:return Jc(s,r);case M.ZodUnion:case M.ZodDiscriminatedUnion:return hl(s,r);case M.ZodIntersection:return ol(s,r);case M.ZodTuple:return Sl(s,r);case M.ZodRecord:return Ms(s,r);case M.ZodLiteral:return il(s,r);case M.ZodEnum:return nl(s);case M.ZodNativeEnum:return ul(s);case M.ZodNullable:return ml(s,r);case M.ZodOptional:return yl(s,r);case M.ZodMap:return ll(s,r);case M.ZodSet:return El(s,r);case M.ZodLazy:return()=>s.getter()._def;case M.ZodPromise:return bl(s,r);case M.ZodNaN:case M.ZodNever:return dl(r);case M.ZodEffects:return al(s,r);case M.ZodAny:return ge(r);case M.ZodUnknown:return Tl(r);case M.ZodDefault:return sl(s,r);case M.ZodBranded:return js(s,r);case M.ZodReadonly:return Rl(s,r);case M.ZodCatch:return rl(s,r);case M.ZodPipeline:return _l(s,r);case M.ZodFunction:case M.ZodVoid:case M.ZodSymbol:return;default:return(a=>{})(e)}};function K(s,e,r=!1){let a=e.seen.get(s);if(e.override){let o=e.override?.(s,e,a,r);if(o!==Qc)return o}if(a&&!r){let o=Rh(a,e);if(o!==void 0)return o}let t={def:s,path:e.currentPath,jsonSchema:void 0};e.seen.set(s,t);let n=wl(s,s.typeName,e),i=typeof n=="function"?K(n(),e):n;if(i&&wh(s,e,i),e.postProcess){let o=e.postProcess(i,s,e);return t.jsonSchema=i,o}return t.jsonSchema=i,i}var Rh=(s,e)=>{switch(e.$refStrategy){case"root":return{$ref:s.path.join("/")};case"relative":return{$ref:Ls(e.currentPath,s.path)};case"none":case"seen":return s.path.length<e.currentPath.length&&s.path.every((r,a)=>e.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ge(e)):e.$refStrategy==="seen"?ge(e):void 0}},wh=(s,e,r)=>(s.description&&(r.description=s.description,e.markdownDescription&&(r.markdownDescription=s.description)),r);var nn=(s,e)=>{let r=Yc(e),a=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,d])=>({...l,[u]:K(d._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??ge(r)}),{}):void 0,t=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,n=K(s._def,t===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,t]},!1)??ge(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let o=t===void 0?a?{...n,[r.definitionPath]:a}:n:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,t].join("/"),[r.definitionPath]:{...a,[t]:n}};return r.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var cr=require("path"),mn=require("os"),Lt=require("fs");var Il=Bt(require("better-sqlite3"),1);var ke=require("path"),on=require("os"),cn=require("fs");var Ol=require("url"),Ph={};function Oh(){return typeof __dirname<"u"?__dirname:(0,ke.dirname)((0,Ol.fileURLToPath)(Ph.url))}var B_=Oh(),it=process.env.CLAUDE_MEM_DATA_DIR||(0,ke.join)((0,on.homedir)(),".claude-mem"),ln=process.env.CLAUDE_CONFIG_DIR||(0,ke.join)((0,on.homedir)(),".claude"),V_=(0,ke.join)(it,"archives"),H_=(0,ke.join)(it,"logs"),z_=(0,ke.join)(it,"trash"),Z_=(0,ke.join)(it,"backups"),G_=(0,ke.join)(it,"settings.json"),Us=(0,ke.join)(it,"claude-mem.db"),Pl=(0,ke.join)(it,"vector-db"),W_=(0,ke.join)(ln,"settings.json"),X_=(0,ke.join)(ln,"commands"),Q_=(0,ke.join)(ln,"CLAUDE.md");function qs(s){(0,cn.mkdirSync)(s,{recursive:!0})}var Bs=class{db;constructor(e){e||(qs(it),e=Us),this.db=new Il.default(e),this.db.pragma("journal_mode = WAL"),this.ensureFTSTables()}ensureFTSTables(){try{if(this.db.prepare("SELECT name FROM sqlite_master WHERE type='table' AND name LIKE '%_fts'").all().some(a=>a.name==="observations_fts"||a.name==="session_summaries_fts"))return;console.error("[SessionSearch] Creating FTS5 tables..."),this.db.exec(`
        CREATE VIRTUAL TABLE IF NOT EXISTS observations_fts USING fts5(
          title,
          subtitle,
          narrative,
          text,
          facts,
          concepts,
          content='observations',
          content_rowid='id'
        );
      `),this.db.exec(`
        INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
        SELECT id, title, subtitle, narrative, text, facts, concepts
        FROM observations;
      `),this.db.exec(`
        CREATE TRIGGER IF NOT EXISTS observations_ai AFTER INSERT ON observations BEGIN
          INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES (new.id, new.title, new.subtitle, new.narrative, new.text, new.facts, new.concepts);
        END;

        CREATE TRIGGER IF NOT EXISTS observations_ad AFTER DELETE ON observations BEGIN
          INSERT INTO observations_fts(observations_fts, rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES('delete', old.id, old.title, old.subtitle, old.narrative, old.text, old.facts, old.concepts);
        END;

        CREATE TRIGGER IF NOT EXISTS observations_au AFTER UPDATE ON observations BEGIN
          INSERT INTO observations_fts(observations_fts, rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES('delete', old.id, old.title, old.subtitle, old.narrative, old.text, old.facts, old.concepts);
          INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES (new.id, new.title, new.subtitle, new.narrative, new.text, new.facts, new.concepts);
        END;
      `),this.db.exec(`
        CREATE VIRTUAL TABLE IF NOT EXISTS session_summaries_fts USING fts5(
          request,
          investigated,
          learned,
          completed,
          next_steps,
          notes,
          content='session_summaries',
          content_rowid='id'
        );
      `),this.db.exec(`
        INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
        SELECT id, request, investigated, learned, completed, next_steps, notes
        FROM session_summaries;
      `),this.db.exec(`
        CREATE TRIGGER IF NOT EXISTS session_summaries_ai AFTER INSERT ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES (new.id, new.request, new.investigated, new.learned, new.completed, new.next_steps, new.notes);
        END;

        CREATE TRIGGER IF NOT EXISTS session_summaries_ad AFTER DELETE ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(session_summaries_fts, rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES('delete', old.id, old.request, old.investigated, old.learned, old.completed, old.next_steps, old.notes);
        END;

        CREATE TRIGGER IF NOT EXISTS session_summaries_au AFTER UPDATE ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(session_summaries_fts, rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES('delete', old.id, old.request, old.investigated, old.learned, old.completed, old.next_steps, old.notes);
          INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES (new.id, new.request, new.investigated, new.learned, new.completed, new.next_steps, new.notes);
        END;
      `),console.error("[SessionSearch] FTS5 tables created successfully")}catch(e){console.error("[SessionSearch] FTS migration error:",e.message)}}buildFilterClause(e,r,a="o"){let t=[];if(e.project&&(t.push(`${a}.project = ?`),r.push(e.project)),e.type)if(Array.isArray(e.type)){let n=e.type.map(()=>"?").join(",");t.push(`${a}.type IN (${n})`),r.push(...e.type)}else t.push(`${a}.type = ?`),r.push(e.type);if(e.dateRange){let{start:n,end:i}=e.dateRange;if(n){let o=typeof n=="number"?n:new Date(n).getTime();t.push(`${a}.created_at_epoch >= ?`),r.push(o)}if(i){let o=typeof i=="number"?i:new Date(i).getTime();t.push(`${a}.created_at_epoch <= ?`),r.push(o)}}if(e.concepts){let n=Array.isArray(e.concepts)?e.concepts:[e.concepts],i=n.map(()=>`EXISTS (SELECT 1 FROM json_each(${a}.concepts) WHERE value = ?)`);i.length>0&&(t.push(`(${i.join(" OR ")})`),r.push(...n))}if(e.files){let n=Array.isArray(e.files)?e.files:[e.files],i=n.map(()=>`(
          EXISTS (SELECT 1 FROM json_each(${a}.files_read) WHERE value LIKE ?)
          OR EXISTS (SELECT 1 FROM json_each(${a}.files_modified) WHERE value LIKE ?)
        )`);i.length>0&&(t.push(`(${i.join(" OR ")})`),n.forEach(o=>{r.push(`%${o}%`,`%${o}%`)}))}return t.length>0?t.join(" AND "):""}buildOrderClause(e="relevance",r=!0,a="observations_fts"){switch(e){case"relevance":return r?`ORDER BY ${a}.rank ASC`:"ORDER BY o.created_at_epoch DESC";case"date_desc":return"ORDER BY o.created_at_epoch DESC";case"date_asc":return"ORDER BY o.created_at_epoch ASC";default:return"ORDER BY o.created_at_epoch DESC"}}searchObservations(e,r={}){let a=[],{limit:t=50,offset:n=0,orderBy:i="relevance",...o}=r;if(!e){let l=this.buildFilterClause(o,a,"o");if(!l)throw new Error("Either query or filters required for search");let u=this.buildOrderClause(i,!1),d=`
        SELECT o.*, o.discovery_tokens
        FROM observations o
        WHERE ${l}
        ${u}
        LIMIT ? OFFSET ?
      `;return a.push(t,n),this.db.prepare(d).all(...a)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}searchSessions(e,r={}){let a=[],{limit:t=50,offset:n=0,orderBy:i="relevance",...o}=r;if(!e){let l={...o};delete l.type;let u=this.buildFilterClause(l,a,"s");if(!u)throw new Error("Either query or filters required for search");let f=`
        SELECT s.*, s.discovery_tokens
        FROM session_summaries s
        WHERE ${u}
        ${i==="date_asc"?"ORDER BY s.created_at_epoch ASC":"ORDER BY s.created_at_epoch DESC"}
        LIMIT ? OFFSET ?
      `;return a.push(t,n),this.db.prepare(f).all(...a)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}findByConcept(e,r={}){let a=[],{limit:t=50,offset:n=0,orderBy:i="date_desc",...o}=r,l={...o,concepts:e},u=this.buildFilterClause(l,a,"o"),d=this.buildOrderClause(i,!1),f=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${d}
      LIMIT ? OFFSET ?
    `;return a.push(t,n),this.db.prepare(f).all(...a)}findByFile(e,r={}){let a=[],{limit:t=50,offset:n=0,orderBy:i="date_desc",...o}=r,l={...o,files:e},u=this.buildFilterClause(l,a,"o"),d=this.buildOrderClause(i,!1),f=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${d}
      LIMIT ? OFFSET ?
    `;a.push(t,n);let m=this.db.prepare(f).all(...a),p=[],y={...o};delete y.type;let h=[];if(y.project&&(h.push("s.project = ?"),p.push(y.project)),y.dateRange){let{start:O,end:E}=y.dateRange;if(O){let T=typeof O=="number"?O:new Date(O).getTime();h.push("s.created_at_epoch >= ?"),p.push(T)}if(E){let T=typeof E=="number"?E:new Date(E).getTime();h.push("s.created_at_epoch <= ?"),p.push(T)}}h.push(`(
      EXISTS (SELECT 1 FROM json_each(s.files_read) WHERE value LIKE ?)
      OR EXISTS (SELECT 1 FROM json_each(s.files_edited) WHERE value LIKE ?)
    )`),p.push(`%${e}%`,`%${e}%`);let g=`
      SELECT s.*, s.discovery_tokens
      FROM session_summaries s
      WHERE ${h.join(" AND ")}
      ORDER BY s.created_at_epoch DESC
      LIMIT ? OFFSET ?
    `;p.push(t,n);let S=this.db.prepare(g).all(...p);return{observations:m,sessions:S}}findByType(e,r={}){let a=[],{limit:t=50,offset:n=0,orderBy:i="date_desc",...o}=r,l={...o,type:e},u=this.buildFilterClause(l,a,"o"),d=this.buildOrderClause(i,!1),f=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${d}
      LIMIT ? OFFSET ?
    `;return a.push(t,n),this.db.prepare(f).all(...a)}searchUserPrompts(e,r={}){let a=[],{limit:t=20,offset:n=0,orderBy:i="relevance",...o}=r,l=[];if(o.project&&(l.push("s.project = ?"),a.push(o.project)),o.dateRange){let{start:u,end:d}=o.dateRange;if(u){let f=typeof u=="number"?u:new Date(u).getTime();l.push("up.created_at_epoch >= ?"),a.push(f)}if(d){let f=typeof d=="number"?d:new Date(d).getTime();l.push("up.created_at_epoch <= ?"),a.push(f)}}if(!e){if(l.length===0)throw new Error("Either query or filters required for search");let f=`
        SELECT up.*
        FROM user_prompts up
        JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
        ${`WHERE ${l.join(" AND ")}`}
        ${i==="date_asc"?"ORDER BY up.created_at_epoch ASC":"ORDER BY up.created_at_epoch DESC"}
        LIMIT ? OFFSET ?
      `;return a.push(t,n),this.db.prepare(f).all(...a)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}getUserPromptsBySession(e){return this.db.prepare(`
      SELECT
        id,
        claude_session_id,
        prompt_number,
        prompt_text,
        created_at,
        created_at_epoch
      FROM user_prompts
      WHERE claude_session_id = ?
      ORDER BY prompt_number ASC
    `).all(e)}close(){this.db.close()}};var Al=Bt(require("better-sqlite3"),1);var un=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n[n.SILENT=4]="SILENT",n))(un||{}),dn=class{level;useColor;constructor(){let e=process.env.CLAUDE_MEM_LOG_LEVEL?.toUpperCase()||"INFO";this.level=un[e]??1,this.useColor=process.stdout.isTTY??!1}correlationId(e,r){return`obs-${e}-${r}`}sessionId(e){return`session-${e}`}formatData(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="object"){if(e instanceof Error)return this.level===0?`${e.message}
${e.stack}`:e.message;if(Array.isArray(e))return`[${e.length} items]`;let r=Object.keys(e);return r.length===0?"{}":r.length<=3?JSON.stringify(e):`{${r.length} keys: ${r.slice(0,3).join(", ")}...}`}return String(e)}formatTool(e,r){if(!r)return e;try{let a=typeof r=="string"?JSON.parse(r):r;if(e==="Bash"&&a.command){let t=a.command.length>50?a.command.substring(0,50)+"...":a.command;return`${e}(${t})`}if(e==="Read"&&a.file_path){let t=a.file_path.split("/").pop()||a.file_path;return`${e}(${t})`}if(e==="Edit"&&a.file_path){let t=a.file_path.split("/").pop()||a.file_path;return`${e}(${t})`}if(e==="Write"&&a.file_path){let t=a.file_path.split("/").pop()||a.file_path;return`${e}(${t})`}return e}catch{return e}}log(e,r,a,t,n){if(e<this.level)return;let i=new Date().toISOString().replace("T"," ").substring(0,23),o=un[e].padEnd(5),l=r.padEnd(6),u="";t?.correlationId?u=`[${t.correlationId}] `:t?.sessionId&&(u=`[session-${t.sessionId}] `);let d="";n!=null&&(this.level===0&&typeof n=="object"?d=`
`+JSON.stringify(n,null,2):d=" "+this.formatData(n));let f="";if(t){let{sessionId:p,sdkSessionId:y,correlationId:h,...g}=t;Object.keys(g).length>0&&(f=` {${Object.entries(g).map(([O,E])=>`${O}=${E}`).join(", ")}}`)}let m=`[${i}] [${o}] [${l}] ${u}${a}${f}${d}`;e===3?console.error(m):console.log(m)}debug(e,r,a,t){this.log(0,e,r,a,t)}info(e,r,a,t){this.log(1,e,r,a,t)}warn(e,r,a,t){this.log(2,e,r,a,t)}error(e,r,a,t){this.log(3,e,r,a,t)}dataIn(e,r,a,t){this.info(e,`\u2192 ${r}`,a,t)}dataOut(e,r,a,t){this.info(e,`\u2190 ${r}`,a,t)}success(e,r,a,t){this.info(e,`\u2713 ${r}`,a,t)}failure(e,r,a,t){this.error(e,`\u2717 ${r}`,a,t)}timing(e,r,a,t){this.info(e,`\u23F1 ${r}`,t,{duration:`${a}ms`})}},$l=new dn;var Vs=class{db;constructor(){qs(it),this.db=new Al.default(Us),this.db.pragma("journal_mode = WAL"),this.db.pragma("synchronous = NORMAL"),this.db.pragma("foreign_keys = ON"),this.initializeSchema(),this.ensureWorkerPortColumn(),this.ensurePromptTrackingColumns(),this.removeSessionSummariesUniqueConstraint(),this.addObservationHierarchicalFields(),this.makeObservationsTextNullable(),this.createUserPromptsTable(),this.ensureDiscoveryTokensColumn()}initializeSchema(){try{this.db.exec(`
        CREATE TABLE IF NOT EXISTS schema_versions (
          id INTEGER PRIMARY KEY,
          version INTEGER UNIQUE NOT NULL,
          applied_at TEXT NOT NULL
        )
      `);let e=this.db.prepare("SELECT version FROM schema_versions ORDER BY version").all();(e.length>0?Math.max(...e.map(a=>a.version)):0)===0&&(console.error("[SessionStore] Initializing fresh database with migration004..."),this.db.exec(`
          CREATE TABLE IF NOT EXISTS sdk_sessions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT UNIQUE NOT NULL,
            sdk_session_id TEXT UNIQUE,
            project TEXT NOT NULL,
            user_prompt TEXT,
            started_at TEXT NOT NULL,
            started_at_epoch INTEGER NOT NULL,
            completed_at TEXT,
            completed_at_epoch INTEGER,
            status TEXT CHECK(status IN ('active', 'completed', 'failed')) NOT NULL DEFAULT 'active'
          );

          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_claude_id ON sdk_sessions(claude_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_sdk_id ON sdk_sessions(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_project ON sdk_sessions(project);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_status ON sdk_sessions(status);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_started ON sdk_sessions(started_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS observations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT NOT NULL,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery')),
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_observations_project ON observations(project);
          CREATE INDEX IF NOT EXISTS idx_observations_type ON observations(type);
          CREATE INDEX IF NOT EXISTS idx_observations_created ON observations(created_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS session_summaries (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT UNIQUE NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.prepare("INSERT INTO schema_versions (version, applied_at) VALUES (?, ?)").run(4,new Date().toISOString()),console.error("[SessionStore] Migration004 applied successfully"))}catch(e){throw console.error("[SessionStore] Schema initialization error:",e.message),e}}ensureWorkerPortColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(5))return;this.db.pragma("table_info(sdk_sessions)").some(t=>t.name==="worker_port")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN worker_port INTEGER"),console.error("[SessionStore] Added worker_port column to sdk_sessions table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(5,new Date().toISOString())}catch(e){console.error("[SessionStore] Migration error:",e.message)}}ensurePromptTrackingColumns(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(6))return;this.db.pragma("table_info(sdk_sessions)").some(l=>l.name==="prompt_counter")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN prompt_counter INTEGER DEFAULT 0"),console.error("[SessionStore] Added prompt_counter column to sdk_sessions table")),this.db.pragma("table_info(observations)").some(l=>l.name==="prompt_number")||(this.db.exec("ALTER TABLE observations ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to observations table")),this.db.pragma("table_info(session_summaries)").some(l=>l.name==="prompt_number")||(this.db.exec("ALTER TABLE session_summaries ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to session_summaries table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(6,new Date().toISOString())}catch(e){console.error("[SessionStore] Prompt tracking migration error:",e.message)}}removeSessionSummariesUniqueConstraint(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(7))return;if(!this.db.pragma("index_list(session_summaries)").some(t=>t.unique===1)){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString());return}console.error("[SessionStore] Removing UNIQUE constraint from session_summaries.sdk_session_id..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE session_summaries_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO session_summaries_new
          SELECT id, sdk_session_id, project, request, investigated, learned,
                 completed, next_steps, files_read, files_edited, notes,
                 prompt_number, created_at, created_at_epoch
          FROM session_summaries
        `),this.db.exec("DROP TABLE session_summaries"),this.db.exec("ALTER TABLE session_summaries_new RENAME TO session_summaries"),this.db.exec(`
          CREATE INDEX idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString()),console.error("[SessionStore] Successfully removed UNIQUE constraint from session_summaries.sdk_session_id")}catch(t){throw this.db.exec("ROLLBACK"),t}}catch(e){console.error("[SessionStore] Migration error (remove UNIQUE constraint):",e.message)}}addObservationHierarchicalFields(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(8))return;if(this.db.pragma("table_info(observations)").some(t=>t.name==="title")){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString());return}console.error("[SessionStore] Adding hierarchical fields to observations table..."),this.db.exec(`
        ALTER TABLE observations ADD COLUMN title TEXT;
        ALTER TABLE observations ADD COLUMN subtitle TEXT;
        ALTER TABLE observations ADD COLUMN facts TEXT;
        ALTER TABLE observations ADD COLUMN narrative TEXT;
        ALTER TABLE observations ADD COLUMN concepts TEXT;
        ALTER TABLE observations ADD COLUMN files_read TEXT;
        ALTER TABLE observations ADD COLUMN files_modified TEXT;
      `),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString()),console.error("[SessionStore] Successfully added hierarchical fields to observations table")}catch(e){console.error("[SessionStore] Migration error (add hierarchical fields):",e.message)}}makeObservationsTextNullable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(9))return;let a=this.db.pragma("table_info(observations)").find(t=>t.name==="text");if(!a||a.notnull===0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString());return}console.error("[SessionStore] Making observations.text nullable..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE observations_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery', 'change')),
            title TEXT,
            subtitle TEXT,
            facts TEXT,
            narrative TEXT,
            concepts TEXT,
            files_read TEXT,
            files_modified TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO observations_new
          SELECT id, sdk_session_id, project, text, type, title, subtitle, facts,
                 narrative, concepts, files_read, files_modified, prompt_number,
                 created_at, created_at_epoch
          FROM observations
        `),this.db.exec("DROP TABLE observations"),this.db.exec("ALTER TABLE observations_new RENAME TO observations"),this.db.exec(`
          CREATE INDEX idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX idx_observations_project ON observations(project);
          CREATE INDEX idx_observations_type ON observations(type);
          CREATE INDEX idx_observations_created ON observations(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString()),console.error("[SessionStore] Successfully made observations.text nullable")}catch(t){throw this.db.exec("ROLLBACK"),t}}catch(e){console.error("[SessionStore] Migration error (make text nullable):",e.message)}}createUserPromptsTable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(10))return;if(this.db.pragma("table_info(user_prompts)").length>0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString());return}console.error("[SessionStore] Creating user_prompts table with FTS5 support..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE user_prompts (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT NOT NULL,
            prompt_number INTEGER NOT NULL,
            prompt_text TEXT NOT NULL,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(claude_session_id) REFERENCES sdk_sessions(claude_session_id) ON DELETE CASCADE
          );

          CREATE INDEX idx_user_prompts_claude_session ON user_prompts(claude_session_id);
          CREATE INDEX idx_user_prompts_created ON user_prompts(created_at_epoch DESC);
          CREATE INDEX idx_user_prompts_prompt_number ON user_prompts(prompt_number);
          CREATE INDEX idx_user_prompts_lookup ON user_prompts(claude_session_id, prompt_number);
        `),this.db.exec(`
          CREATE VIRTUAL TABLE user_prompts_fts USING fts5(
            prompt_text,
            content='user_prompts',
            content_rowid='id'
          );
        `),this.db.exec(`
          CREATE TRIGGER user_prompts_ai AFTER INSERT ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;

          CREATE TRIGGER user_prompts_ad AFTER DELETE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
          END;

          CREATE TRIGGER user_prompts_au AFTER UPDATE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString()),console.error("[SessionStore] Successfully created user_prompts table with FTS5 support")}catch(a){throw this.db.exec("ROLLBACK"),a}}catch(e){console.error("[SessionStore] Migration error (create user_prompts table):",e.message)}}ensureDiscoveryTokensColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(11))return;this.db.pragma("table_info(observations)").some(i=>i.name==="discovery_tokens")||(this.db.exec("ALTER TABLE observations ADD COLUMN discovery_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added discovery_tokens column to observations table")),this.db.pragma("table_info(session_summaries)").some(i=>i.name==="discovery_tokens")||(this.db.exec("ALTER TABLE session_summaries ADD COLUMN discovery_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added discovery_tokens column to session_summaries table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(11,new Date().toISOString())}catch(e){throw console.error("[SessionStore] Discovery tokens migration error:",e.message),e}}getRecentSummaries(e,r=10){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getRecentSummariesWithSessionInfo(e,r=3){return this.db.prepare(`
      SELECT
        sdk_session_id, request, learned, completed, next_steps,
        prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getRecentObservations(e,r=20){return this.db.prepare(`
      SELECT type, text, prompt_number, created_at
      FROM observations
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getAllRecentObservations(e=100){return this.db.prepare(`
      SELECT id, type, title, subtitle, text, project, prompt_number, created_at, created_at_epoch
      FROM observations
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllRecentSummaries(e=50){return this.db.prepare(`
      SELECT id, request, investigated, learned, completed, next_steps,
             files_read, files_edited, notes, project, prompt_number,
             created_at, created_at_epoch
      FROM session_summaries
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllRecentUserPrompts(e=100){return this.db.prepare(`
      SELECT
        up.id,
        up.claude_session_id,
        s.project,
        up.prompt_number,
        up.prompt_text,
        up.created_at,
        up.created_at_epoch
      FROM user_prompts up
      LEFT JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      ORDER BY up.created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllProjects(){return this.db.prepare(`
      SELECT DISTINCT project
      FROM sdk_sessions
      WHERE project IS NOT NULL AND project != ''
      ORDER BY project ASC
    `).all().map(a=>a.project)}getRecentSessionsWithStatus(e,r=3){return this.db.prepare(`
      SELECT * FROM (
        SELECT
          s.sdk_session_id,
          s.status,
          s.started_at,
          s.started_at_epoch,
          s.user_prompt,
          CASE WHEN sum.sdk_session_id IS NOT NULL THEN 1 ELSE 0 END as has_summary
        FROM sdk_sessions s
        LEFT JOIN session_summaries sum ON s.sdk_session_id = sum.sdk_session_id
        WHERE s.project = ? AND s.sdk_session_id IS NOT NULL
        GROUP BY s.sdk_session_id
        ORDER BY s.started_at_epoch DESC
        LIMIT ?
      )
      ORDER BY started_at_epoch ASC
    `).all(e,r)}getObservationsForSession(e){return this.db.prepare(`
      SELECT title, subtitle, type, prompt_number
      FROM observations
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch ASC
    `).all(e)}getObservationById(e){return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id = ?
    `).get(e)||null}getObservationsByIds(e,r={}){if(e.length===0)return[];let{orderBy:a="date_desc",limit:t}=r,n=a==="date_asc"?"ASC":"DESC",i=t?`LIMIT ${t}`:"",o=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id IN (${o})
      ORDER BY created_at_epoch ${n}
      ${i}
    `).all(...e)}getSummaryForSession(e){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch DESC
      LIMIT 1
    `).get(e)||null}getFilesForSession(e){let a=this.db.prepare(`
      SELECT files_read, files_modified
      FROM observations
      WHERE sdk_session_id = ?
    `).all(e),t=new Set,n=new Set;for(let i of a){if(i.files_read)try{let o=JSON.parse(i.files_read);Array.isArray(o)&&o.forEach(l=>t.add(l))}catch{}if(i.files_modified)try{let o=JSON.parse(i.files_modified);Array.isArray(o)&&o.forEach(l=>n.add(l))}catch{}}return{filesRead:Array.from(t),filesModified:Array.from(n)}}getSessionById(e){return this.db.prepare(`
      SELECT id, claude_session_id, sdk_session_id, project, user_prompt
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(e)||null}findActiveSDKSession(e){return this.db.prepare(`
      SELECT id, sdk_session_id, project, worker_port
      FROM sdk_sessions
      WHERE claude_session_id = ? AND status = 'active'
      LIMIT 1
    `).get(e)||null}findAnySDKSession(e){return this.db.prepare(`
      SELECT id
      FROM sdk_sessions
      WHERE claude_session_id = ?
      LIMIT 1
    `).get(e)||null}reactivateSession(e,r){this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'active', user_prompt = ?, worker_port = NULL
      WHERE id = ?
    `).run(r,e)}incrementPromptCounter(e){return this.db.prepare(`
      UPDATE sdk_sessions
      SET prompt_counter = COALESCE(prompt_counter, 0) + 1
      WHERE id = ?
    `).run(e),this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(e)?.prompt_counter||1}getPromptCounter(e){return this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(e)?.prompt_counter||0}createSDKSession(e,r,a){let t=new Date,n=t.getTime(),o=this.db.prepare(`
      INSERT OR IGNORE INTO sdk_sessions
      (claude_session_id, sdk_session_id, project, user_prompt, started_at, started_at_epoch, status)
      VALUES (?, ?, ?, ?, ?, ?, 'active')
    `).run(e,e,r,a,t.toISOString(),n);return o.lastInsertRowid===0||o.changes===0?(r&&r.trim()!==""&&this.db.prepare(`
          UPDATE sdk_sessions
          SET project = ?, user_prompt = ?
          WHERE claude_session_id = ?
        `).run(r,a,e),this.db.prepare(`
        SELECT id FROM sdk_sessions WHERE claude_session_id = ? LIMIT 1
      `).get(e).id):o.lastInsertRowid}updateSDKSessionId(e,r){return this.db.prepare(`
      UPDATE sdk_sessions
      SET sdk_session_id = ?
      WHERE id = ? AND sdk_session_id IS NULL
    `).run(r,e).changes===0?($l.debug("DB","sdk_session_id already set, skipping update",{sessionId:e,sdkSessionId:r}),!1):!0}setWorkerPort(e,r){this.db.prepare(`
      UPDATE sdk_sessions
      SET worker_port = ?
      WHERE id = ?
    `).run(r,e)}getWorkerPort(e){return this.db.prepare(`
      SELECT worker_port
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(e)?.worker_port||null}saveUserPrompt(e,r,a){let t=new Date,n=t.getTime();return this.db.prepare(`
      INSERT INTO user_prompts
      (claude_session_id, prompt_number, prompt_text, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,a,t.toISOString(),n).lastInsertRowid}getUserPrompt(e,r){return this.db.prepare(`
      SELECT prompt_text
      FROM user_prompts
      WHERE claude_session_id = ? AND prompt_number = ?
      LIMIT 1
    `).get(e,r)?.prompt_text??null}storeObservation(e,r,a,t,n=0){let i=new Date,o=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(e)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(e,e,r,i.toISOString(),o),console.error(`[SessionStore] Auto-created session record for session_id: ${e}`));let f=this.db.prepare(`
      INSERT INTO observations
      (sdk_session_id, project, type, title, subtitle, facts, narrative, concepts,
       files_read, files_modified, prompt_number, discovery_tokens, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(e,r,a.type,a.title,a.subtitle,JSON.stringify(a.facts),a.narrative,JSON.stringify(a.concepts),JSON.stringify(a.files_read),JSON.stringify(a.files_modified),t||null,n,i.toISOString(),o);return{id:Number(f.lastInsertRowid),createdAtEpoch:o}}storeSummary(e,r,a,t,n=0){let i=new Date,o=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(e)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(e,e,r,i.toISOString(),o),console.error(`[SessionStore] Auto-created session record for session_id: ${e}`));let f=this.db.prepare(`
      INSERT INTO session_summaries
      (sdk_session_id, project, request, investigated, learned, completed,
       next_steps, notes, prompt_number, discovery_tokens, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(e,r,a.request,a.investigated,a.learned,a.completed,a.next_steps,a.notes,t||null,n,i.toISOString(),o);return{id:Number(f.lastInsertRowid),createdAtEpoch:o}}markSessionCompleted(e){let r=new Date,a=r.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'completed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(r.toISOString(),a,e)}markSessionFailed(e){let r=new Date,a=r.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'failed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(r.toISOString(),a,e)}getSessionSummariesByIds(e,r={}){if(e.length===0)return[];let{orderBy:a="date_desc",limit:t}=r,n=a==="date_asc"?"ASC":"DESC",i=t?`LIMIT ${t}`:"",o=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT * FROM session_summaries
      WHERE id IN (${o})
      ORDER BY created_at_epoch ${n}
      ${i}
    `).all(...e)}getUserPromptsByIds(e,r={}){if(e.length===0)return[];let{orderBy:a="date_desc",limit:t}=r,n=a==="date_asc"?"ASC":"DESC",i=t?`LIMIT ${t}`:"",o=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT
        up.*,
        s.project,
        s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.id IN (${o})
      ORDER BY up.created_at_epoch ${n}
      ${i}
    `).all(...e)}getTimelineAroundTimestamp(e,r=10,a=10,t){return this.getTimelineAroundObservation(null,e,r,a,t)}getTimelineAroundObservation(e,r,a=10,t=10,n){let i=n?"AND project = ?":"",o=n?[n]:[],l,u;if(e!==null){let p=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id <= ? ${i}
        ORDER BY id DESC
        LIMIT ?
      `,y=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id >= ? ${i}
        ORDER BY id ASC
        LIMIT ?
      `;try{let h=this.db.prepare(p).all(e,...o,a+1),g=this.db.prepare(y).all(e,...o,t+1);if(h.length===0&&g.length===0)return{observations:[],sessions:[],prompts:[]};l=h.length>0?h[h.length-1].created_at_epoch:r,u=g.length>0?g[g.length-1].created_at_epoch:r}catch(h){return console.error("[SessionStore] Error getting boundary observations:",h.message),{observations:[],sessions:[],prompts:[]}}}else{let p=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch <= ? ${i}
        ORDER BY created_at_epoch DESC
        LIMIT ?
      `,y=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch >= ? ${i}
        ORDER BY created_at_epoch ASC
        LIMIT ?
      `;try{let h=this.db.prepare(p).all(r,...o,a),g=this.db.prepare(y).all(r,...o,t+1);if(h.length===0&&g.length===0)return{observations:[],sessions:[],prompts:[]};l=h.length>0?h[h.length-1].created_at_epoch:r,u=g.length>0?g[g.length-1].created_at_epoch:r}catch(h){return console.error("[SessionStore] Error getting boundary timestamps:",h.message),{observations:[],sessions:[],prompts:[]}}}let d=`
      SELECT *
      FROM observations
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${i}
      ORDER BY created_at_epoch ASC
    `,f=`
      SELECT *
      FROM session_summaries
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${i}
      ORDER BY created_at_epoch ASC
    `,m=`
      SELECT up.*, s.project, s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.created_at_epoch >= ? AND up.created_at_epoch <= ? ${i.replace("project","s.project")}
      ORDER BY up.created_at_epoch ASC
    `;try{let p=this.db.prepare(d).all(l,u,...o),y=this.db.prepare(f).all(l,u,...o),h=this.db.prepare(m).all(l,u,...o);return{observations:p,sessions:y.map(g=>({id:g.id,sdk_session_id:g.sdk_session_id,project:g.project,request:g.request,completed:g.completed,next_steps:g.next_steps,created_at:g.created_at,created_at_epoch:g.created_at_epoch})),prompts:h.map(g=>({id:g.id,claude_session_id:g.claude_session_id,project:g.project,prompt:g.prompt_text,created_at:g.created_at,created_at_epoch:g.created_at_epoch}))}}catch(p){return console.error("[SessionStore] Error querying timeline records:",p.message),{observations:[],sessions:[],prompts:[]}}}close(){this.db.close()}};var Nl=require("fs"),Dl=require("os"),Cl=require("path"),Ih=(0,Cl.join)((0,Dl.homedir)(),".claude-mem","silent.log");function Zr(s,e,r=""){let a=new Date().toISOString(),o=((new Error().stack||"").split(`
`)[2]||"").match(/at\s+(?:.*\s+)?\(?([^:]+):(\d+):(\d+)\)?/),l=o?`${o[1].split("/").pop()}:${o[2]}`:"unknown",u=`[${a}] [${l}] ${s}`;if(e!==void 0)try{u+=` ${JSON.stringify(e)}`}catch(d){u+=` [stringify error: ${d}]`}u+=`
`;try{(0,Nl.appendFileSync)(Ih,u)}catch(d){console.error("[silent-debug] Failed to write to log:",d)}return r}var Te,ne,$e=null,$h="cm__claude-mem";try{Te=new Bs,ne=new Vs}catch(s){console.error("[search-server] Failed to initialize search:",s.message),process.exit(1)}async function Ge(s,e,r){if(!$e)throw new Error("Chroma client not initialized");Zr("queryChroma called",{query:s,limit:e,whereFilter:r});let a=r?JSON.stringify(r):void 0;Zr("where filter stringified",{whereFilter:r,whereStringified:a});let t={collection_name:$h,query_texts:[s],n_results:e,include:["documents","metadatas","distances"],where:a};Zr("calling chroma_query_documents",t);let n=await $e.callTool({name:"chroma_query_documents",arguments:t}),i=n.content[0]?.text||"";Zr("chroma response received",{hasContent:!!n.content[0]?.text,textLength:i.length,textPreview:i.substring(0,200)});let o;try{o=JSON.parse(i)}catch(m){return console.error("[search-server] Failed to parse Chroma response as JSON:",m),console.error("[search-server] Raw Chroma response:",i),{ids:[],distances:[],metadatas:[]}}let l=[],u=o.ids?.[0]||[];for(let m of u){let p=m.match(/obs_(\d+)_/),y=m.match(/summary_(\d+)_/),h=m.match(/prompt_(\d+)/),g=null;p?g=parseInt(p[1],10):y?g=parseInt(y[1],10):h&&(g=parseInt(h[1],10)),g!==null&&!l.includes(g)&&l.push(g)}let d=o.distances?.[0]||[],f=o.metadatas?.[0]||[];return{ids:l,distances:d,metadatas:f}}function ir(){return`
---
\u{1F4A1} Search Strategy:
ALWAYS search with index format FIRST to get an overview and identify relevant results.
This is critical for token efficiency - index format uses ~10x fewer tokens than full format.

Search workflow:
1. Initial search: Use default (index) format to see titles, dates, and sources
2. Review results: Identify which items are most relevant to your needs
3. Deep dive: Only then use format: "full" on specific items of interest
4. Narrow down: Use filters (type, dateStart/dateEnd, concepts, files) to refine results

Other tips:
\u2022 To search by concept: Use find_by_concept tool
\u2022 To browse by type: Use find_by_type with ["decision", "feature", etc.]
\u2022 To sort by date: Use orderBy: "date_desc" or "date_asc"`}function pn(s,e,r,a,t){if(s.length===0)return s;let n=-1;if(typeof e=="number")n=s.findIndex(l=>l.type==="observation"&&l.data.id===e);else if(typeof e=="string"&&e.startsWith("S")){let l=parseInt(e.slice(1),10);n=s.findIndex(u=>u.type==="session"&&u.data.id===l)}else n=s.findIndex(l=>l.epoch>=r),n===-1&&(n=s.length-1);if(n===-1)return s;let i=Math.max(0,n-a),o=Math.min(s.length,n+t+1);return s.slice(i,o)}function Ct(s,e){let r=s.title||`Observation #${s.id}`,a=new Date(s.created_at_epoch).toLocaleString(),t=s.type?`[${s.type}]`:"";return`${e+1}. ${t} ${r}
   Date: ${a}
   Source: claude-mem://observation/${s.id}`}function fn(s,e){let r=s.request||`Session ${s.sdk_session_id?.substring(0,8)||"unknown"}`,a=new Date(s.created_at_epoch).toLocaleString();return`${e+1}. ${r}
   Date: ${a}
   Source: claude-mem://session/${s.sdk_session_id}`}function kt(s){let e=s.title||`Observation #${s.id}`,r=[];r.push(`## ${e}`),r.push(`*Source: claude-mem://observation/${s.id}*`),r.push(""),s.subtitle&&(r.push(`**${s.subtitle}**`),r.push("")),s.narrative&&(r.push(s.narrative),r.push("")),s.text&&(r.push(s.text),r.push(""));let a=[];if(a.push(`Type: ${s.type}`),s.facts)try{let n=JSON.parse(s.facts);n.length>0&&a.push(`Facts: ${n.join("; ")}`)}catch{}if(s.concepts)try{let n=JSON.parse(s.concepts);n.length>0&&a.push(`Concepts: ${n.join(", ")}`)}catch{}if(s.files_read||s.files_modified){let n=[];if(s.files_read)try{n.push(...JSON.parse(s.files_read))}catch{}if(s.files_modified)try{n.push(...JSON.parse(s.files_modified))}catch{}n.length>0&&a.push(`Files: ${[...new Set(n)].join(", ")}`)}a.length>0&&(r.push("---"),r.push(a.join(" | ")));let t=new Date(s.created_at_epoch).toLocaleString();return r.push(""),r.push("---"),r.push(`Date: ${t}`),r.join(`
`)}function hn(s){let e=s.request||`Session ${s.sdk_session_id?.substring(0,8)||"unknown"}`,r=[];r.push(`## ${e}`),r.push(`*Source: claude-mem://session/${s.sdk_session_id}*`),r.push(""),s.completed&&(r.push(`**Completed:** ${s.completed}`),r.push("")),s.learned&&(r.push(`**Learned:** ${s.learned}`),r.push("")),s.investigated&&(r.push(`**Investigated:** ${s.investigated}`),r.push("")),s.next_steps&&(r.push(`**Next Steps:** ${s.next_steps}`),r.push("")),s.notes&&(r.push(`**Notes:** ${s.notes}`),r.push(""));let a=[];if(s.files_read||s.files_edited){let n=[];if(s.files_read)try{n.push(...JSON.parse(s.files_read))}catch{}if(s.files_edited)try{n.push(...JSON.parse(s.files_edited))}catch{}n.length>0&&a.push(`Files: ${[...new Set(n)].join(", ")}`)}let t=new Date(s.created_at_epoch).toLocaleDateString();return a.push(`Date: ${t}`),a.length>0&&(r.push("---"),r.push(a.join(" | "))),r.join(`
`)}function kl(s,e){let r=new Date(s.created_at_epoch).toLocaleString();return`${e+1}. "${s.prompt_text}"
   Date: ${r} | Prompt #${s.prompt_number}
   Source: claude-mem://user-prompt/${s.id}`}function Ll(s){let e=[];e.push(`## User Prompt #${s.prompt_number}`),e.push(`*Source: claude-mem://user-prompt/${s.id}*`),e.push(""),e.push(s.prompt_text),e.push(""),e.push("---");let r=new Date(s.created_at_epoch).toLocaleString();return e.push(`Date: ${r}`),e.join(`
`)}function mt(s){let e={...s};return e.concepts&&typeof e.concepts=="string"&&(e.concepts=e.concepts.split(",").map(r=>r.trim()).filter(Boolean)),e.files&&typeof e.files=="string"&&(e.files=e.files.split(",").map(r=>r.trim()).filter(Boolean)),e.obs_type&&typeof e.obs_type=="string"&&(e.obs_type=e.obs_type.split(",").map(r=>r.trim()).filter(Boolean)),e.type&&typeof e.type=="string"&&e.type.includes(",")&&(e.type=e.type.split(",").map(r=>r.trim()).filter(Boolean)),(e.dateStart||e.dateEnd)&&(e.dateRange={start:e.dateStart,end:e.dateEnd},delete e.dateStart,delete e.dateEnd),e}var Ah=c.object({project:c.string().optional().describe("Filter by project name"),type:c.union([c.enum(["decision","bugfix","feature","refactor","discovery","change"]),c.array(c.enum(["decision","bugfix","feature","refactor","discovery","change"]))]).optional().describe("Filter by observation type (single value or comma-separated list)"),concepts:c.union([c.string(),c.array(c.string())]).optional().describe("Filter by concept tags (single value or comma-separated list)"),files:c.union([c.string(),c.array(c.string())]).optional().describe("Filter by file paths (single value or comma-separated list for partial match)"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date (ISO string or epoch)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date (ISO string or epoch)"),dateRange:c.object({start:c.union([c.string(),c.number()]).optional().describe("Start date (ISO string or epoch)"),end:c.union([c.string(),c.number()]).optional().describe("End date (ISO string or epoch)")}).optional().describe("Filter by date range (use dateStart/dateEnd instead for simpler URLs)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),jl=4;function Nh(s){if(!s||!(0,Lt.existsSync)(s))return"";try{let e=(0,Lt.readFileSync)(s,"utf-8").trim();if(!e)return"";let r=e.split(`
`);for(let a=r.length-1;a>=0;a--)try{let t=JSON.parse(r[a]);if(t.type==="user"&&t.message?.content){let n=t.message.content;if(typeof n=="string")return n;if(Array.isArray(n))return n.filter(o=>o.type==="text").map(o=>o.text).join(`
`)}}catch{continue}}catch{}return""}function Dh(s){if(!s||!(0,Lt.existsSync)(s))return"";try{let e=(0,Lt.readFileSync)(s,"utf-8").trim();if(!e)return"";let r=e.split(`
`);for(let a=r.length-1;a>=0;a--)try{let t=JSON.parse(r[a]);if(t.type==="assistant"&&t.message?.content){let n="",i=t.message.content;return typeof i=="string"?n=i:Array.isArray(i)&&(n=i.filter(l=>l.type==="text").map(l=>l.text).join(`
`)),n=n.replace(/<system-reminder>[\s\S]*?<\/system-reminder>/g,""),n=n.replace(/\n{3,}/g,`

`).trim(),n}}catch{continue}}catch{}return""}var B={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",cyan:"\x1B[36m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",gray:"\x1B[90m",red:"\x1B[31m"};function Ch(s){if(!s)return[];try{let e=JSON.parse(s);return Array.isArray(e)?e:[]}catch{return[]}}function kh(s){return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Lh(s){return new Date(s).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function jh(s){return new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Fh(s,e){return s.startsWith("/")?(0,cr.relative)(e,s):s}function Hs(s,e,r,a){return e?a?[`${r}${s}:${B.reset} ${e}`,""]:[`**${s}**: ${e}`,""]:[]}function Mh(s){if(s&&s>0)return s;try{let e=(0,cr.join)((0,mn.homedir)(),".claude","settings.json");if((0,Lt.existsSync)(e)){let r=JSON.parse((0,Lt.readFileSync)(e,"utf-8"));if(r.env?.CLAUDE_MEM_CONTEXT_OBSERVATIONS){let a=parseInt(r.env.CLAUDE_MEM_CONTEXT_OBSERVATIONS,10);if(!isNaN(a)&&a>0)return a}}}catch{}return parseInt(process.env.CLAUDE_MEM_CONTEXT_OBSERVATIONS||"50",10)}var Fl=[{name:"search",description:'Unified search across all memory types (observations, sessions, and user prompts) using vector-first semantic search (ChromaDB). Returns combined results from all document types. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({query:c.string().optional().describe("Natural language search query for semantic ranking via ChromaDB vector search. Optional - omit for date-filtered queries only (Chroma cannot filter by date, requires direct SQLite)."),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),type:c.enum(["observations","sessions","prompts"]).optional().describe("Filter by document type (observations, sessions, or prompts). Omit to search all types."),obs_type:c.string().optional().describe('Filter observations by type (single value or comma-separated list: decision,bugfix,feature,refactor,discovery,change). Only applies when type="observations"'),concepts:c.string().optional().describe('Filter by concept tags (single value or comma-separated list). Only applies when type="observations"'),files:c.string().optional().describe('Filter by file paths (single value or comma-separated list for partial match). Only applies when type="observations"'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{query:r,format:a="index",type:t,obs_type:n,concepts:i,files:o,...l}=e,u=[],d=[],f=[],m=!t||t==="observations",p=!t||t==="sessions",y=!t||t==="prompts";if(r)if($e){let E=!1;try{console.error(`[search-server] Using ChromaDB semantic search (type filter: ${t||"all"})`);let T;t==="observations"?T={doc_type:"observation"}:t==="sessions"?T={doc_type:"session_summary"}:t==="prompts"&&(T={doc_type:"user_prompt"});let w=await Ge(r,100,T);if(E=!0,console.error(`[search-server] ChromaDB returned ${w.ids.length} semantic matches`),w.ids.length>0){let x=Date.now()-7776e6,A=w.metadatas.map((L,j)=>({id:w.ids[j],meta:L,isRecent:L&&L.created_at_epoch>x})).filter(L=>L.isRecent);console.error(`[search-server] ${A.length} results within 90-day window`);let D=[],N=[],C=[];for(let L of A){let j=L.meta?.doc_type;j==="observation"&&m?D.push(L.id):j==="session_summary"&&p?N.push(L.id):j==="user_prompt"&&y&&C.push(L.id)}if(console.error(`[search-server] Categorized: ${D.length} obs, ${N.length} sessions, ${C.length} prompts`),D.length>0){let L={...l,type:n,concepts:i,files:o};u=ne.getObservationsByIds(D,L)}N.length>0&&(d=ne.getSessionSummariesByIds(N,{orderBy:"date_desc",limit:l.limit})),C.length>0&&(f=ne.getUserPromptsByIds(C,{orderBy:"date_desc",limit:l.limit})),console.error(`[search-server] Hydrated ${u.length} obs, ${d.length} sessions, ${f.length} prompts from SQLite`)}else console.error("[search-server] ChromaDB found no matches (this is final - NOT falling back to FTS5)")}catch(T){console.error("[search-server] ChromaDB failed - returning empty results (FTS5 fallback removed):",T.message),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),u=[],d=[],f=[]}}else console.error("[search-server] ChromaDB not initialized - returning empty results (FTS5 fallback removed)"),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),u=[],d=[],f=[];else{console.error("[search-server] Filter-only query (no query text), using direct SQLite filtering (enables date filters)");let E={...l,type:n,concepts:i,files:o};m&&(u=Te.searchObservations(void 0,E)),p&&(d=Te.searchSessions(void 0,l)),y&&(f=Te.searchUserPrompts(void 0,l))}let h=u.length+d.length+f.length;if(h===0)return{content:[{type:"text",text:`No results found matching "${r}"`}]};let g=[...u.map(E=>({type:"observation",data:E,epoch:E.created_at_epoch})),...d.map(E=>({type:"session",data:E,epoch:E.created_at_epoch})),...f.map(E=>({type:"prompt",data:E,epoch:E.created_at_epoch}))];l.orderBy==="date_desc"?g.sort((E,T)=>T.epoch-E.epoch):l.orderBy==="date_asc"&&g.sort((E,T)=>E.epoch-T.epoch);let S=g.slice(0,l.limit||20),O;if(a==="index"){let E=`Found ${h} result(s) matching "${r}" (${u.length} obs, ${d.length} sessions, ${f.length} prompts):

`,T=S.map((w,x)=>w.type==="observation"?Ct(w.data,x):w.type==="session"?fn(w.data,x):kl(w.data,x));O=E+T.join(`

`)+ir()}else O=S.map(T=>T.type==="observation"?kt(T.data):T.type==="session"?hn(T.data):Ll(T.data)).join(`

---

`);return{content:[{type:"text",text:O}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"timeline",description:"Get a unified timeline of context around a specific point in time OR search query. Supports two modes: (1) anchor-based: provide observation ID, session ID, or timestamp to center timeline around; (2) query-based: provide natural language query to find relevant observation and center timeline around it. All record types (observations, sessions, prompts) are interleaved chronologically.",inputSchema:c.object({anchor:c.union([c.number(),c.string()]).optional().describe('Anchor point: observation ID (number), session ID (e.g., "S123"), or ISO timestamp. Use this OR query, not both.'),query:c.string().optional().describe("Natural language search query to find relevant observation as anchor. Use this OR anchor, not both."),depth_before:c.number().min(0).max(50).default(10).describe("Number of records to retrieve before anchor (default: 10)"),depth_after:c.number().min(0).max(50).default(10).describe("Number of records to retrieve after anchor (default: 10)"),project:c.string().optional().describe("Filter by project name")}),handler:async s=>{try{let h=function(x){return new Date(x).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},g=function(x){return new Date(x).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},S=function(x){return new Date(x).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},O=function(x){return x?Math.ceil(x.length/4):0};var e=h,r=g,a=S,t=O;let{anchor:n,query:i,depth_before:o=10,depth_after:l=10,project:u}=s;if(!n&&!i)return{content:[{type:"text",text:'Error: Must provide either "anchor" or "query" parameter'}],isError:!0};if(n&&i)return{content:[{type:"text",text:'Error: Cannot provide both "anchor" and "query" parameters. Use one or the other.'}],isError:!0};let d,f,m;if(i){let x=[];if($e)try{console.error("[search-server] Using hybrid semantic search for timeline query");let D=await Ge(i,100);if(console.error(`[search-server] Chroma returned ${D.ids.length} semantic matches`),D.ids.length>0){let N=Date.now()-7776e6,C=D.ids.filter((L,j)=>{let R=D.metadatas[j];return R&&R.created_at_epoch>N});C.length>0&&(x=ne.getObservationsByIds(C,{orderBy:"date_desc",limit:1}))}}catch(D){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",D.message)}if(x.length===0)return{content:[{type:"text",text:`No observations found matching "${i}". Try a different search query.`}]};let A=x[0];d=A.id,f=A.created_at_epoch,console.error(`[search-server] Query mode: Using observation #${A.id} as timeline anchor`),m=ne.getTimelineAroundObservation(A.id,A.created_at_epoch,o,l,u)}else if(typeof n=="number"){let x=ne.getObservationById(n);if(!x)return{content:[{type:"text",text:`Observation #${n} not found`}],isError:!0};d=n,f=x.created_at_epoch,m=ne.getTimelineAroundObservation(n,f,o,l,u)}else if(typeof n=="string")if(n.startsWith("S")||n.startsWith("#S")){let x=n.replace(/^#?S/,""),A=parseInt(x,10),D=ne.getSessionSummariesByIds([A]);if(D.length===0)return{content:[{type:"text",text:`Session #${A} not found`}],isError:!0};f=D[0].created_at_epoch,d=`S${A}`,m=ne.getTimelineAroundTimestamp(f,o,l,u)}else{let x=new Date(n);if(isNaN(x.getTime()))return{content:[{type:"text",text:`Invalid timestamp: ${n}`}],isError:!0};f=x.getTime(),d=n,m=ne.getTimelineAroundTimestamp(f,o,l,u)}else return{content:[{type:"text",text:'Invalid anchor: must be observation ID (number), session ID (e.g., "S123"), or ISO timestamp'}],isError:!0};let p=[...m.observations.map(x=>({type:"observation",data:x,epoch:x.created_at_epoch})),...m.sessions.map(x=>({type:"session",data:x,epoch:x.created_at_epoch})),...m.prompts.map(x=>({type:"prompt",data:x,epoch:x.created_at_epoch}))];p.sort((x,A)=>x.epoch-A.epoch);let y=pn(p,d,f,o,l);if(y.length===0)return{content:[{type:"text",text:i?`Found observation matching "${i}", but no timeline context available (${o} records before, ${l} records after).`:`No context found around anchor (${o} records before, ${l} records after)`}]};let E=[];if(i){let x=y.find(D=>D.type==="observation"&&D.data.id===d),A=x?x.data.title||"Untitled":"Unknown";E.push(`# Timeline for query: "${i}"`),E.push(`**Anchor:** Observation #${d} - ${A}`)}else E.push(`# Timeline around anchor: ${d}`);E.push(`**Window:** ${o} records before \u2192 ${l} records after | **Items:** ${y.length}`),E.push(""),E.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),E.push("");let T=new Map;for(let x of y){let A=h(x.epoch);T.has(A)||T.set(A,[]),T.get(A).push(x)}let w=Array.from(T.entries()).sort((x,A)=>{let D=new Date(x[0]).getTime(),N=new Date(A[0]).getTime();return D-N});for(let[x,A]of w){E.push(`### ${x}`),E.push("");let D=null,N="",C=!1;for(let L of A){let j=typeof d=="number"&&L.type==="observation"&&L.data.id===d||typeof d=="string"&&d.startsWith("S")&&L.type==="session"&&`S${L.data.id}`===d;if(L.type==="session"){C&&(E.push(""),C=!1,D=null,N="");let R=L.data,I=R.request||"Session summary",k=`claude-mem://session-summary/${R.id}`,W=j?" \u2190 **ANCHOR**":"";E.push(`**\u{1F3AF} #S${R.id}** ${I} (${S(L.epoch)}) [\u2192](${k})${W}`),E.push("")}else if(L.type==="prompt"){C&&(E.push(""),C=!1,D=null,N="");let R=L.data,I=R.prompt.length>100?R.prompt.substring(0,100)+"...":R.prompt;E.push(`**\u{1F4AC} User Prompt #${R.prompt_number}** (${S(L.epoch)})`),E.push(`> ${I}`),E.push("")}else if(L.type==="observation"){let R=L.data,I="General";I!==D&&(C&&E.push(""),E.push(`**${I}**`),E.push("| ID | Time | T | Title | Tokens |"),E.push("|----|------|---|-------|--------|"),D=I,C=!0,N="");let k="\u2022";switch(R.type){case"bugfix":k="\u{1F534}";break;case"feature":k="\u{1F7E3}";break;case"refactor":k="\u{1F504}";break;case"change":k="\u2705";break;case"discovery":k="\u{1F535}";break;case"decision":k="\u{1F9E0}";break}let W=g(L.epoch),X=R.title||"Untitled",Y=O(R.narrative),z=W!==N?W:"\u2033";N=W;let ae=j?" \u2190 **ANCHOR**":"";E.push(`| #${R.id} | ${z} | ${k} | ${X}${ae} | ~${Y} |`)}}C&&E.push("")}return{content:[{type:"text",text:E.join(`
`)}]}}catch(n){return{content:[{type:"text",text:`Timeline query failed: ${n.message}`}],isError:!0}}}},{name:"decisions",description:"Semantic shortcut to find decision-type observations. Returns observations where important architectural, technical, or process decisions were made. Supports optional semantic search query to filter decisions by relevance.",inputSchema:c.object({query:c.string().optional().describe("Search query to filter decisions semantically"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{query:r,format:a="index",...t}=e,n=[];if($e)try{if(r){console.error("[search-server] Using Chroma semantic search with type=decision filter");let l=(await Ge(r,Math.min((t.limit||20)*2,100),{type:"decision"})).ids;l.length>0&&(n=ne.getObservationsByIds(l,{...t,type:"decision"}),n.sort((u,d)=>l.indexOf(u.id)-l.indexOf(d.id)))}else{console.error("[search-server] Using metadata-first + semantic ranking for decisions");let o=Te.findByType("decision",t);if(o.length>0){let l=o.map(f=>f.id),u=await Ge("decision",Math.min(l.length,100)),d=[];for(let f of u.ids)l.includes(f)&&!d.includes(f)&&d.push(f);d.length>0&&(n=ne.getObservationsByIds(d,{limit:t.limit||20}),n.sort((f,m)=>d.indexOf(f.id)-d.indexOf(m.id)))}}}catch(o){console.error("[search-server] Chroma search failed, using SQLite fallback:",o.message)}if(n.length===0&&(n=Te.findByType("decision",t)),n.length===0)return{content:[{type:"text",text:"No decision observations found"}]};let i;if(a==="index"){let o=`Found ${n.length} decision(s):

`,l=n.map((u,d)=>Ct(u,d));i=o+l.join(`

`)}else i=n.map(l=>kt(l)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"changes",description:'Semantic shortcut to find change-related observations. Returns observations documenting what changed in the codebase, system behavior, or project state. Searches for type="change" OR concept="change" OR concept="what-changed".',inputSchema:c.object({format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{format:r="index",...a}=e,t=[];if($e)try{console.error("[search-server] Using hybrid search for change-related observations");let i=Te.findByType("change",a),o=Te.findByConcept("change",a),l=Te.findByConcept("what-changed",a),u=new Set;if([...i,...o,...l].forEach(d=>u.add(d.id)),u.size>0){let d=Array.from(u),f=await Ge("what changed",Math.min(d.length,100)),m=[];for(let p of f.ids)d.includes(p)&&!m.includes(p)&&m.push(p);m.length>0&&(t=ne.getObservationsByIds(m,{limit:a.limit||20}),t.sort((p,y)=>m.indexOf(p.id)-m.indexOf(y.id)))}}catch(i){console.error("[search-server] Chroma ranking failed, using SQLite order:",i.message)}if(t.length===0){let i=Te.findByType("change",a),o=Te.findByConcept("change",a),l=Te.findByConcept("what-changed",a),u=new Set;[...i,...o,...l].forEach(d=>u.add(d.id)),t=Array.from(u).map(d=>i.find(f=>f.id===d)||o.find(f=>f.id===d)||l.find(f=>f.id===d)).filter(Boolean),t.sort((d,f)=>f.created_at_epoch-d.created_at_epoch),t=t.slice(0,a.limit||20)}if(t.length===0)return{content:[{type:"text",text:"No change-related observations found"}]};let n;if(r==="index"){let i=`Found ${t.length} change-related observation(s):

`,o=t.map((l,u)=>Ct(l,u));n=i+o.join(`

`)}else n=t.map(o=>kt(o)).join(`

---

`);return{content:[{type:"text",text:n}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"how_it_works",description:'Semantic shortcut to find "how it works" explanations. Returns observations documenting system architecture, component interactions, data flow, and technical mechanisms. Searches for concept="how-it-works".',inputSchema:c.object({format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{format:r="index",...a}=e,t=[];if($e)try{console.error("[search-server] Using metadata-first + semantic ranking for how-it-works");let i=Te.findByConcept("how-it-works",a);if(i.length>0){let o=i.map(d=>d.id),l=await Ge("how it works architecture",Math.min(o.length,100)),u=[];for(let d of l.ids)o.includes(d)&&!u.includes(d)&&u.push(d);u.length>0&&(t=ne.getObservationsByIds(u,{limit:a.limit||20}),t.sort((d,f)=>u.indexOf(d.id)-u.indexOf(f.id)))}}catch(i){console.error("[search-server] Chroma ranking failed, using SQLite order:",i.message)}if(t.length===0&&(t=Te.findByConcept("how-it-works",a)),t.length===0)return{content:[{type:"text",text:'No "how it works" observations found'}]};let n;if(r==="index"){let i=`Found ${t.length} "how it works" observation(s):

`,o=t.map((l,u)=>Ct(l,u));n=i+o.join(`

`)}else n=t.map(o=>kt(o)).join(`

---

`);return{content:[{type:"text",text:n}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"search_observations",description:'DEPRECATED: Use the unified "search" tool instead. Search observations using vector-first semantic search (ChromaDB). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({query:c.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),...Ah.shape}),handler:async s=>{try{let e=mt(s),{query:r,format:a="index",...t}=e,n=[];if($e)try{console.error("[search-server] Using hybrid semantic search (Chroma + SQLite)");let o=await Ge(r,100);if(console.error(`[search-server] Chroma returned ${o.ids.length} semantic matches`),o.ids.length>0){let l=Date.now()-7776e6,u=o.ids.filter((d,f)=>{let m=o.metadatas[f];return m&&m.created_at_epoch>l});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let d=t.limit||20;n=ne.getObservationsByIds(u,{orderBy:"date_desc",limit:d}),console.error(`[search-server] Hydrated ${n.length} observations from SQLite`)}}}catch(o){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",o.message)}if(n.length===0)return{content:[{type:"text",text:`No observations found matching "${r}"`}]};let i;if(a==="index"){let o=`Found ${n.length} observation(s) matching "${r}":

`,l=n.map((u,d)=>Ct(u,d));i=o+l.join(`

`)+ir()}else i=n.map(l=>kt(l)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"search_sessions",description:'DEPRECATED: Use the unified "search" tool instead. Search session summaries using vector-first semantic search (ChromaDB). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({query:c.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{query:r,format:a="index",...t}=e,n=[];if($e)try{console.error("[search-server] Using hybrid semantic search for sessions");let o=await Ge(r,100,{doc_type:"session_summary"});if(console.error(`[search-server] Chroma returned ${o.ids.length} semantic matches`),o.ids.length>0){let l=Date.now()-7776e6,u=o.ids.filter((d,f)=>{let m=o.metadatas[f];return m&&m.created_at_epoch>l});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let d=t.limit||20;n=ne.getSessionSummariesByIds(u,{orderBy:"date_desc",limit:d}),console.error(`[search-server] Hydrated ${n.length} sessions from SQLite`)}}}catch(o){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",o.message)}if(n.length===0)return{content:[{type:"text",text:`No sessions found matching "${r}"`}]};let i;if(a==="index"){let o=`Found ${n.length} session(s) matching "${r}":

`,l=n.map((u,d)=>fn(u,d));i=o+l.join(`

`)+ir()}else i=n.map(l=>hn(l)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_concept",description:'Find observations tagged with a specific concept. Available concepts: "discovery", "problem-solution", "what-changed", "how-it-works", "pattern", "gotcha", "change". IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({concept:c.string().describe("Concept tag to search for. Available: discovery, problem-solution, what-changed, how-it-works, pattern, gotcha, change"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{concept:r,format:a="index",...t}=e,n=[];if($e)try{console.error("[search-server] Using metadata-first + semantic ranking for concept search");let o=Te.findByConcept(r,t);if(console.error(`[search-server] Found ${o.length} observations with concept "${r}"`),o.length>0){let l=o.map(f=>f.id),u=await Ge(r,Math.min(l.length,100)),d=[];for(let f of u.ids)l.includes(f)&&!d.includes(f)&&d.push(f);console.error(`[search-server] Chroma ranked ${d.length} results by semantic relevance`),d.length>0&&(n=ne.getObservationsByIds(d,{limit:t.limit||20}),n.sort((f,m)=>d.indexOf(f.id)-d.indexOf(m.id)))}}catch(o){console.error("[search-server] Chroma ranking failed, using SQLite order:",o.message)}if(n.length===0&&(console.error("[search-server] Using SQLite-only concept search"),n=Te.findByConcept(r,t)),n.length===0)return{content:[{type:"text",text:`No observations found with concept "${r}"`}]};let i;if(a==="index"){let o=`Found ${n.length} observation(s) with concept "${r}":

`,l=n.map((u,d)=>Ct(u,d));i=o+l.join(`

`)+ir()}else i=n.map(l=>kt(l)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_file",description:'Find observations and sessions that reference a specific file path. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({filePath:c.string().describe("File path to search for (supports partial matching)"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{filePath:r,format:a="index",...t}=e,n=[],i=[];if($e)try{console.error("[search-server] Using metadata-first + semantic ranking for file search");let u=Te.findByFile(r,t);if(console.error(`[search-server] Found ${u.observations.length} observations, ${u.sessions.length} sessions for file "${r}"`),i=u.sessions,u.observations.length>0){let d=u.observations.map(p=>p.id),f=await Ge(r,Math.min(d.length,100)),m=[];for(let p of f.ids)d.includes(p)&&!m.includes(p)&&m.push(p);console.error(`[search-server] Chroma ranked ${m.length} observations by semantic relevance`),m.length>0&&(n=ne.getObservationsByIds(m,{limit:t.limit||20}),n.sort((p,y)=>m.indexOf(p.id)-m.indexOf(y.id)))}}catch(u){console.error("[search-server] Chroma ranking failed, using SQLite order:",u.message)}if(n.length===0&&i.length===0){console.error("[search-server] Using SQLite-only file search");let u=Te.findByFile(r,t);n=u.observations,i=u.sessions}let o=n.length+i.length;if(o===0)return{content:[{type:"text",text:`No results found for file "${r}"`}]};let l;if(a==="index"){let u=`Found ${o} result(s) for file "${r}":

`,d=[];n.forEach((f,m)=>{d.push(Ct(f,m))}),i.forEach((f,m)=>{d.push(fn(f,m+n.length))}),l=u+d.join(`

`)+ir()}else{let u=[];n.forEach(d=>{u.push(kt(d))}),i.forEach(d=>{u.push(hn(d))}),l=u.join(`

---

`)}return{content:[{type:"text",text:l}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_type",description:'Find observations of a specific type (decision, bugfix, feature, refactor, discovery, change). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({type:c.string().describe("Observation type(s) to filter by (single value or comma-separated list: decision,bugfix,feature,refactor,discovery,change)"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{type:r,format:a="index",...t}=e,n=Array.isArray(r)?r.join(", "):r,i=[];if($e)try{console.error("[search-server] Using metadata-first + semantic ranking for type search");let l=Te.findByType(r,t);if(console.error(`[search-server] Found ${l.length} observations with type "${n}"`),l.length>0){let u=l.map(m=>m.id),d=await Ge(n,Math.min(u.length,100)),f=[];for(let m of d.ids)u.includes(m)&&!f.includes(m)&&f.push(m);console.error(`[search-server] Chroma ranked ${f.length} results by semantic relevance`),f.length>0&&(i=ne.getObservationsByIds(f,{limit:t.limit||20}),i.sort((m,p)=>f.indexOf(m.id)-f.indexOf(p.id)))}}catch(l){console.error("[search-server] Chroma ranking failed, using SQLite order:",l.message)}if(i.length===0&&(console.error("[search-server] Using SQLite-only type search"),i=Te.findByType(r,t)),i.length===0)return{content:[{type:"text",text:`No observations found with type "${n}"`}]};let o;if(a==="index"){let l=`Found ${i.length} observation(s) with type "${n}":

`,u=i.map((d,f)=>Ct(d,f));o=l+u.join(`

`)+ir()}else o=i.map(u=>kt(u)).join(`

---

`);return{content:[{type:"text",text:o}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"get_recent_context",description:"Get recent session context including summaries and observations for a project",inputSchema:c.object({project:c.string().optional().describe("Project name (defaults to current working directory basename)"),limit:c.number().min(1).max(10).default(3).describe("Number of recent sessions to retrieve")}),handler:async s=>{try{let e=s.project||(0,cr.basename)(process.cwd()),r=s.limit||3,a=ne.getRecentSessionsWithStatus(e,r);if(a.length===0)return{content:[{type:"text",text:`# Recent Session Context

No previous sessions found for project "${e}".`}]};let t=[];t.push("# Recent Session Context"),t.push(""),t.push(`Showing last ${a.length} session(s) for **${e}**:`),t.push("");for(let n of a)if(n.sdk_session_id){if(t.push("---"),t.push(""),n.has_summary){let i=ne.getSummaryForSession(n.sdk_session_id);if(i){let o=i.prompt_number?` (Prompt #${i.prompt_number})`:"";if(t.push(`**Summary${o}**`),t.push(""),i.request&&t.push(`**Request:** ${i.request}`),i.completed&&t.push(`**Completed:** ${i.completed}`),i.learned&&t.push(`**Learned:** ${i.learned}`),i.next_steps&&t.push(`**Next Steps:** ${i.next_steps}`),i.files_read)try{let u=JSON.parse(i.files_read);Array.isArray(u)&&u.length>0&&t.push(`**Files Read:** ${u.join(", ")}`)}catch{i.files_read.trim()&&t.push(`**Files Read:** ${i.files_read}`)}if(i.files_edited)try{let u=JSON.parse(i.files_edited);Array.isArray(u)&&u.length>0&&t.push(`**Files Edited:** ${u.join(", ")}`)}catch{i.files_edited.trim()&&t.push(`**Files Edited:** ${i.files_edited}`)}let l=new Date(i.created_at).toLocaleString();t.push(`**Date:** ${l}`)}}else if(n.status==="active"){t.push("**In Progress**"),t.push(""),n.user_prompt&&t.push(`**Request:** ${n.user_prompt}`);let i=ne.getObservationsForSession(n.sdk_session_id);if(i.length>0){t.push(""),t.push(`**Observations (${i.length}):**`);for(let l of i)t.push(`- ${l.title}`)}else t.push(""),t.push("*No observations yet*");t.push(""),t.push("**Status:** Active - summary pending");let o=new Date(n.started_at).toLocaleString();t.push(`**Date:** ${o}`)}else{t.push(`**${n.status.charAt(0).toUpperCase()+n.status.slice(1)}**`),t.push(""),n.user_prompt&&t.push(`**Request:** ${n.user_prompt}`),t.push(""),t.push(`**Status:** ${n.status} - no summary available`);let i=new Date(n.started_at).toLocaleString();t.push(`**Date:** ${i}`)}t.push("")}return{content:[{type:"text",text:t.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Failed to get recent context: ${e.message}`}],isError:!0}}}},{name:"search_user_prompts",description:'DEPRECATED: Use the unified "search" tool instead. Search raw user prompts using vector-first semantic search (ChromaDB). Use this to find what the user actually said/requested across all sessions. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:c.object({query:c.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:c.enum(["index","full"]).default("index").describe('Output format: "index" for truncated prompts/dates (default, RECOMMENDED for initial search), "full" for complete prompt text (use only after reviewing index results)'),project:c.string().optional().describe("Filter by project name"),dateStart:c.union([c.string(),c.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:c.union([c.string(),c.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:c.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:c.number().min(0).default(0).describe("Number of results to skip"),orderBy:c.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async s=>{try{let e=mt(s),{query:r,format:a="index",...t}=e,n=[];if($e)try{console.error("[search-server] Using hybrid semantic search for user prompts");let o=await Ge(r,100,{doc_type:"user_prompt"});if(console.error(`[search-server] Chroma returned ${o.ids.length} semantic matches`),o.ids.length>0){let l=Date.now()-7776e6,u=o.ids.filter((d,f)=>{let m=o.metadatas[f];return m&&m.created_at_epoch>l});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let d=t.limit||20;n=ne.getUserPromptsByIds(u,{orderBy:"date_desc",limit:d}),console.error(`[search-server] Hydrated ${n.length} user prompts from SQLite`)}}}catch(o){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",o.message)}if(n.length===0)return{content:[{type:"text",text:`No user prompts found matching "${r}"`}]};let i;if(a==="index"){let o=`Found ${n.length} user prompt(s) matching "${r}":

`,l=n.map((u,d)=>kl(u,d));i=o+l.join(`

`)+ir()}else i=n.map(l=>Ll(l)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"get_context_timeline",description:'Get a unified timeline of context (observations, sessions, and prompts) around a specific point in time. All record types are interleaved chronologically. Useful for understanding "what was happening when X occurred". Returns depth_before records before anchor + anchor + depth_after records after (total: depth_before + 1 + depth_after mixed records).',inputSchema:c.object({anchor:c.union([c.number().describe("Observation ID to center timeline around"),c.string().describe("Session ID (format: S123) or ISO timestamp to center timeline around")]).describe('Anchor point: observation ID, session ID (e.g., "S123"), or ISO timestamp'),depth_before:c.number().min(0).max(50).default(10).describe("Number of records to retrieve before anchor, not including anchor (default: 10)"),depth_after:c.number().min(0).max(50).default(10).describe("Number of records to retrieve after anchor, not including anchor (default: 10)"),project:c.string().optional().describe("Filter by project name")}),handler:async s=>{try{let y=function(w){return new Date(w).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},h=function(w){return new Date(w).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},g=function(w){return new Date(w).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},S=function(w){return w?Math.ceil(w.length/4):0};var e=y,r=h,a=g,t=S;let{anchor:n,depth_before:i=10,depth_after:o=10,project:l}=s,u,d=n,f;if(typeof n=="number"){let w=ne.getObservationById(n);if(!w)return{content:[{type:"text",text:`Observation #${n} not found`}],isError:!0};u=w.created_at_epoch,f=ne.getTimelineAroundObservation(n,u,i,o,l)}else if(typeof n=="string")if(n.startsWith("S")||n.startsWith("#S")){let w=n.replace(/^#?S/,""),x=parseInt(w,10),A=ne.getSessionSummariesByIds([x]);if(A.length===0)return{content:[{type:"text",text:`Session #${x} not found`}],isError:!0};u=A[0].created_at_epoch,d=`S${x}`,f=ne.getTimelineAroundTimestamp(u,i,o,l)}else{let w=new Date(n);if(isNaN(w.getTime()))return{content:[{type:"text",text:`Invalid timestamp: ${n}`}],isError:!0};u=w.getTime(),f=ne.getTimelineAroundTimestamp(u,i,o,l)}else return{content:[{type:"text",text:'Invalid anchor: must be observation ID (number), session ID (e.g., "S123"), or ISO timestamp'}],isError:!0};let m=[...f.observations.map(w=>({type:"observation",data:w,epoch:w.created_at_epoch})),...f.sessions.map(w=>({type:"session",data:w,epoch:w.created_at_epoch})),...f.prompts.map(w=>({type:"prompt",data:w,epoch:w.created_at_epoch}))];m.sort((w,x)=>w.epoch-x.epoch);let p=pn(m,d,u,i,o);if(p.length===0)return{content:[{type:"text",text:`No context found around ${new Date(u).toLocaleString()} (${i} records before, ${o} records after)`}]};let O=[];O.push(`# Timeline around anchor: ${d}`),O.push(`**Window:** ${i} records before \u2192 ${o} records after | **Items:** ${p.length}`),O.push(""),O.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),O.push("");let E=new Map;for(let w of p){let x=y(w.epoch);E.has(x)||E.set(x,[]),E.get(x).push(w)}let T=Array.from(E.entries()).sort((w,x)=>{let A=new Date(w[0]).getTime(),D=new Date(x[0]).getTime();return A-D});for(let[w,x]of T){O.push(`### ${w}`),O.push("");let A=null,D="",N=!1;for(let C of x){let L=typeof d=="number"&&C.type==="observation"&&C.data.id===d||typeof d=="string"&&d.startsWith("S")&&C.type==="session"&&`S${C.data.id}`===d;if(C.type==="session"){N&&(O.push(""),N=!1,A=null,D="");let j=C.data,R=j.request||"Session summary",I=`claude-mem://session-summary/${j.id}`,k=L?" \u2190 **ANCHOR**":"";O.push(`**\u{1F3AF} #S${j.id}** ${R} (${g(C.epoch)}) [\u2192](${I})${k}`),O.push("")}else if(C.type==="prompt"){N&&(O.push(""),N=!1,A=null,D="");let j=C.data,R=j.prompt.length>100?j.prompt.substring(0,100)+"...":j.prompt;O.push(`**\u{1F4AC} User Prompt #${j.prompt_number}** (${g(C.epoch)})`),O.push(`> ${R}`),O.push("")}else if(C.type==="observation"){let j=C.data,R="General";R!==A&&(N&&O.push(""),O.push(`**${R}**`),O.push("| ID | Time | T | Title | Tokens |"),O.push("|----|------|---|-------|--------|"),A=R,N=!0,D="");let I="\u2022";switch(j.type){case"bugfix":I="\u{1F534}";break;case"feature":I="\u{1F7E3}";break;case"refactor":I="\u{1F504}";break;case"change":I="\u2705";break;case"discovery":I="\u{1F535}";break;case"decision":I="\u{1F9E0}";break}let k=h(C.epoch),W=j.title||"Untitled",X=S(j.narrative),H=k!==D?k:"\u2033";D=k;let z=L?" \u2190 **ANCHOR**":"";O.push(`| #${j.id} | ${H} | ${I} | ${W}${z} | ~${X} |`)}}N&&O.push("")}return{content:[{type:"text",text:O.join(`
`)}]}}catch(n){return{content:[{type:"text",text:`Timeline query failed: ${n.message}`}],isError:!0}}}},{name:"get_timeline_by_query",description:'Search for observations using natural language and get timeline context around the best match. Two modes: "auto" (default) automatically uses top result as timeline anchor; "interactive" returns top matches for you to choose from. This combines search + timeline into a single operation for faster context discovery.',inputSchema:c.object({query:c.string().describe("Natural language search query to find relevant observations"),mode:c.enum(["auto","interactive"]).default("auto").describe("auto: Automatically use top search result as timeline anchor. interactive: Show top N search results for manual anchor selection."),depth_before:c.number().min(0).max(50).default(10).describe("Number of timeline records before anchor (default: 10)"),depth_after:c.number().min(0).max(50).default(10).describe("Number of timeline records after anchor (default: 10)"),limit:c.number().min(1).max(20).default(5).describe("For interactive mode: number of top search results to display (default: 5)"),project:c.string().optional().describe("Filter by project name")}),handler:async s=>{try{let{query:n,mode:i="auto",depth_before:o=10,depth_after:l=10,limit:u=5,project:d}=s,f=[];if($e)try{console.error("[search-server] Using hybrid semantic search for timeline query");let m=await Ge(n,100);if(console.error(`[search-server] Chroma returned ${m.ids.length} semantic matches`),m.ids.length>0){let p=Date.now()-7776e6,y=m.ids.filter((h,g)=>{let S=m.metadatas[g];return S&&S.created_at_epoch>p});console.error(`[search-server] ${y.length} results within 90-day window`),y.length>0&&(f=ne.getObservationsByIds(y,{orderBy:"date_desc",limit:i==="auto"?1:u}),console.error(`[search-server] Hydrated ${f.length} observations from SQLite`))}}catch(m){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",m.message)}if(f.length===0)return{content:[{type:"text",text:`No observations found matching "${n}". Try a different search query.`}]};if(i==="interactive"){let m=[];m.push("# Timeline Anchor Search Results"),m.push(""),m.push(`Found ${f.length} observation(s) matching "${n}"`),m.push(""),m.push("To get timeline context around any of these observations, use the `get_context_timeline` tool with the observation ID as the anchor."),m.push(""),m.push(`**Top ${f.length} matches:**`),m.push("");for(let p=0;p<f.length;p++){let y=f[p],h=y.title||`Observation #${y.id}`,g=new Date(y.created_at_epoch).toLocaleString(),S=y.type?`[${y.type}]`:"";m.push(`${p+1}. **${S} ${h}**`),m.push(`   - ID: ${y.id}`),m.push(`   - Date: ${g}`),y.subtitle&&m.push(`   - ${y.subtitle}`),m.push(`   - Source: claude-mem://observation/${y.id}`),m.push("")}return{content:[{type:"text",text:m.join(`
`)}]}}else{let g=function(A){return new Date(A).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},S=function(A){return new Date(A).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},O=function(A){return new Date(A).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},E=function(A){return A?Math.ceil(A.length/4):0};var e=g,r=S,a=O,t=E;let m=f[0];console.error(`[search-server] Auto mode: Using observation #${m.id} as timeline anchor`);let p=ne.getTimelineAroundObservation(m.id,m.created_at_epoch,o,l,d),y=[...p.observations.map(A=>({type:"observation",data:A,epoch:A.created_at_epoch})),...p.sessions.map(A=>({type:"session",data:A,epoch:A.created_at_epoch})),...p.prompts.map(A=>({type:"prompt",data:A,epoch:A.created_at_epoch}))];y.sort((A,D)=>A.epoch-D.epoch);let h=pn(y,m.id,0,o,l);if(h.length===0)return{content:[{type:"text",text:`Found observation #${m.id} matching "${n}", but no timeline context available (${o} records before, ${l} records after).`}]};let T=[];T.push(`# Timeline for query: "${n}"`),T.push(`**Anchor:** Observation #${m.id} - ${m.title||"Untitled"}`),T.push(`**Window:** ${o} records before \u2192 ${l} records after | **Items:** ${h.length}`),T.push(""),T.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),T.push("");let w=new Map;for(let A of h){let D=g(A.epoch);w.has(D)||w.set(D,[]),w.get(D).push(A)}let x=Array.from(w.entries()).sort((A,D)=>{let N=new Date(A[0]).getTime(),C=new Date(D[0]).getTime();return N-C});for(let[A,D]of x){T.push(`### ${A}`),T.push("");let N=null,C="",L=!1;for(let j of D){let R=j.type==="observation"&&j.data.id===m.id;if(j.type==="session"){L&&(T.push(""),L=!1,N=null,C="");let I=j.data,k=I.request||"Session summary",W=`claude-mem://session-summary/${I.id}`;T.push(`**\u{1F3AF} #S${I.id}** ${k} (${O(j.epoch)}) [\u2192](${W})`),T.push("")}else if(j.type==="prompt"){L&&(T.push(""),L=!1,N=null,C="");let I=j.data,k=I.prompt.length>100?I.prompt.substring(0,100)+"...":I.prompt;T.push(`**\u{1F4AC} User Prompt #${I.prompt_number}** (${O(j.epoch)})`),T.push(`> ${k}`),T.push("")}else if(j.type==="observation"){let I=j.data,k="General";k!==N&&(L&&T.push(""),T.push(`**${k}**`),T.push("| ID | Time | T | Title | Tokens |"),T.push("|----|------|---|-------|--------|"),N=k,L=!0,C="");let W="\u2022";switch(I.type){case"bugfix":W="\u{1F534}";break;case"feature":W="\u{1F7E3}";break;case"refactor":W="\u{1F504}";break;case"change":W="\u2705";break;case"discovery":W="\u{1F535}";break;case"decision":W="\u{1F9E0}";break}let X=S(j.epoch),Y=I.title||"Untitled",H=E(I.narrative),ae=X!==C?X:"\u2033";C=X;let pe=R?" \u2190 **ANCHOR**":"";T.push(`| #${I.id} | ${ae} | ${W} | ${Y}${pe} | ~${H} |`)}}L&&T.push("")}return{content:[{type:"text",text:T.join(`
`)}]}}}catch(n){return{content:[{type:"text",text:`Timeline query failed: ${n.message}`}],isError:!0}}}},{name:"get_context_session_start",description:"Get formatted context for SessionStart hook including recent observations, summaries, and token economics",inputSchema:c.object({project:c.string().describe("Project name"),useColors:c.boolean().default(!1).describe("Use ANSI colors for terminal output (vs markdown)"),observationCount:c.number().optional().describe("Number of observations to retrieve (overrides settings)"),cwd:c.string().optional().describe("Current working directory for relative path conversion")}),handler:async s=>{try{let e=s.project,r=s.useColors==="true"||s.useColors===!0,a=s.cwd||process.cwd(),t=Mh(s.observationCount),n=10,i=1,o=ne.db.prepare(`
          SELECT
            id, sdk_session_id, type, title, subtitle, narrative,
            facts, concepts, files_read, files_modified, discovery_tokens,
            created_at, created_at_epoch
          FROM observations
          WHERE project = ?
          ORDER BY created_at_epoch DESC
          LIMIT ?
        `).all(e,t),l=ne.db.prepare(`
          SELECT id, sdk_session_id, request, investigated, learned, completed, next_steps, created_at, created_at_epoch
          FROM session_summaries
          WHERE project = ?
          ORDER BY created_at_epoch DESC
          LIMIT ?
        `).all(e,n+i),u="",d="",f="";if(o.length>0)try{let g=o[0],S=ne.db.prepare(`
              SELECT claude_session_id, created_at
              FROM sdk_sessions
              WHERE sdk_session_id = ?
              LIMIT 1
            `).get(g.sdk_session_id);if(S){let O=a.replace(/\//g,"-"),E=(0,cr.join)((0,mn.homedir)(),".claude/projects",O,`${S.claude_session_id}.jsonl`);u=Nh(E),d=Dh(E),f=S.created_at}}catch{}if(o.length===0&&l.length===0)return{content:[{type:"text",text:r?`
${B.bright}${B.cyan}\u{1F4DD} [${e}] recent context${B.reset}
${B.gray}${"\u2500".repeat(60)}${B.reset}

${B.dim}No previous sessions found for this project yet.${B.reset}
`:`# [${e}] recent context

No previous sessions found for this project yet.`}]};let m=o,p=l.slice(0,n),y=m,h=[];if(r?(h.push(""),h.push(`${B.bright}${B.cyan}\u{1F4DD} [${e}] recent context${B.reset}`),h.push(`${B.gray}${"\u2500".repeat(60)}${B.reset}`),h.push("")):(h.push(`# [${e}] recent context`),h.push("")),u||d)if(r){if(h.push(`${B.bright}${B.magenta}\u{1F4AC} Previously${B.reset}`),h.push(""),u){let g=u.length>200?u.substring(0,200)+"...":u;h.push(`${B.dim}You said:${B.reset} ${g}`),h.push("")}if(d){let g=d.length>300?d.substring(0,300)+"...":d;h.push(`${B.dim}I responded:${B.reset} ${g}`),h.push("")}}else{if(h.push("## \u{1F4AC} Previously"),h.push(""),u){let g=u.length>200?u.substring(0,200)+"...":u;h.push(`**You said:** ${g}`),h.push("")}if(d){let g=d.length>300?d.substring(0,300)+"...":d;h.push(`**I responded:** ${g}`),h.push("")}}if(y.length>0){r?h.push(`${B.dim}Legend: \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u2696\uFE0F  decision${B.reset}`):h.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u2696\uFE0F  decision"),h.push(""),r?(h.push(`${B.bright}\u{1F4A1} Column Key${B.reset}`),h.push(`${B.dim}  Read: Tokens to read this observation (cost to learn it now)${B.reset}`),h.push(`${B.dim}  Work: Tokens spent on work that produced this record (\u{1F50D} research, \u{1F6E0}\uFE0F building, \u2696\uFE0F  deciding)${B.reset}`)):(h.push("\u{1F4A1} **Column Key**:"),h.push("- **Read**: Tokens to read this observation (cost to learn it now)"),h.push("- **Work**: Tokens spent on work that produced this record (\u{1F50D} research, \u{1F6E0}\uFE0F building, \u2696\uFE0F  deciding)")),h.push(""),r?(h.push(`${B.dim}\u{1F4A1} Context Index: This semantic index (titles, types, files, tokens) is usually sufficient to understand past work.${B.reset}`),h.push(""),h.push(`${B.dim}When you need implementation details, rationale, or debugging context:${B.reset}`),h.push(`${B.dim}  - Use the mem-search skill to fetch full observations on-demand${B.reset}`),h.push(`${B.dim}  - Critical types (\u{1F534} bugfix, \u2696\uFE0F decision) often need detailed fetching${B.reset}`),h.push(`${B.dim}  - Trust this index over re-reading code for past decisions and learnings${B.reset}`)):(h.push("\u{1F4A1} **Context Index:** This semantic index (titles, types, files, tokens) is usually sufficient to understand past work."),h.push(""),h.push("When you need implementation details, rationale, or debugging context:"),h.push("- Use the mem-search skill to fetch full observations on-demand"),h.push("- Critical types (\u{1F534} bugfix, \u2696\uFE0F decision) often need detailed fetching"),h.push("- Trust this index over re-reading code for past decisions and learnings")),h.push("");let g=m.length,S=m.reduce((R,I)=>{let k=(I.title?.length||0)+(I.subtitle?.length||0)+(I.narrative?.length||0)+JSON.stringify(I.facts||[]).length;return R+Math.ceil(k/jl)},0),O=m.reduce((R,I)=>R+(I.discovery_tokens||0),0),E=O-S,T=O>0?Math.round(E/O*100):0;r?(h.push(`${B.bright}${B.cyan}\u{1F4CA} Context Economics${B.reset}`),h.push(`${B.dim}  Loading: ${g} observations (${S.toLocaleString()} tokens to read)${B.reset}`),h.push(`${B.dim}  Work investment: ${O.toLocaleString()} tokens spent on research, building, and decisions${B.reset}`),O>0&&h.push(`${B.green}  Your savings: ${E.toLocaleString()} tokens (${T}% reduction from reuse)${B.reset}`),h.push("")):(h.push("\u{1F4CA} **Context Economics**:"),h.push(`- Loading: ${g} observations (${S.toLocaleString()} tokens to read)`),h.push(`- Work investment: ${O.toLocaleString()} tokens spent on research, building, and decisions`),O>0&&h.push(`- Your savings: ${E.toLocaleString()} tokens (${T}% reduction from reuse)`),h.push(""));let w=l[0]?.id,x=p.map((R,I)=>{let k=I===0?null:l[I+1];return{...R,displayEpoch:k?k.created_at_epoch:R.created_at_epoch,displayTime:k?k.created_at:R.created_at,shouldShowLink:R.id!==w}}),A=[...y.map(R=>({type:"observation",data:R})),...x.map(R=>({type:"summary",data:R}))];A.sort((R,I)=>{let k=R.type==="observation"?R.data.created_at_epoch:R.data.displayEpoch,W=I.type==="observation"?I.data.created_at_epoch:I.data.displayEpoch;return k-W});let D=new Map;for(let R of A){let I=R.type==="observation"?R.data.created_at:R.data.displayTime,k=jh(I);D.has(k)||D.set(k,[]),D.get(k).push(R)}let N=Array.from(D.entries()).sort((R,I)=>{let k=new Date(R[0]).getTime(),W=new Date(I[0]).getTime();return k-W});for(let[R,I]of N){r?(h.push(`${B.bright}${B.cyan}${R}${B.reset}`),h.push("")):(h.push(`### ${R}`),h.push(""));let k=null,W="",X=!1;for(let Y of I)if(Y.type==="summary"){X&&(h.push(""),X=!1,k=null,W="");let H=Y.data,z=`${H.request||"Session started"} (${kh(H.displayTime)})`,ae=H.shouldShowLink?`claude-mem://session-summary/${H.id}`:"";if(r){let pe=ae?`${B.dim}[${ae}]${B.reset}`:"";h.push(`\u{1F3AF} ${B.yellow}#S${H.id}${B.reset} ${z} ${pe}`)}else{let pe=ae?` [\u2192](${ae})`:"";h.push(`**\u{1F3AF} #S${H.id}** ${z}${pe}`)}h.push("")}else{let H=Y.data,z=Ch(H.files_modified),ae=z.length>0?Fh(z[0],a):"General";ae!==k&&(X&&h.push(""),r?h.push(`${B.dim}${ae}${B.reset}`):h.push(`**${ae}**`),r||(h.push("| ID | Time | T | Title | Read | Work |"),h.push("|----|------|---|-------|------|------|")),k=ae,X=!0,W="");let pe=Lh(H.created_at),Pe=H.title||"Untitled",J="\u2022";switch(H.type){case"bugfix":J="\u{1F534}";break;case"feature":J="\u{1F7E3}";break;case"refactor":J="\u{1F504}";break;case"change":J="\u2705";break;case"discovery":J="\u{1F535}";break;case"decision":J="\u2696\uFE0F";break;default:J="\u2022"}let Ee=(H.title?.length||0)+(H.subtitle?.length||0)+(H.narrative?.length||0)+JSON.stringify(H.facts||[]).length,Se=Math.ceil(Ee/jl),Re=H.discovery_tokens||0,Me="\u{1F50D}";switch(H.type){case"discovery":Me="\u{1F50D}";break;case"change":case"feature":case"bugfix":case"refactor":Me="\u{1F6E0}\uFE0F";break;case"decision":Me="\u2696\uFE0F";break}let rt=Re>0?`${Me} ${Re.toLocaleString()}`:"-",ye=pe!==W,me=ye?pe:"";if(W=pe,r){let vt=ye?`${B.dim}${pe}${B.reset}`:" ".repeat(pe.length),Ie=Se>0?`${B.dim}(~${Se}t)${B.reset}`:"",ce=Re>0?`${B.dim}(${Me} ${Re.toLocaleString()}t)${B.reset}`:"";h.push(`  ${B.dim}#${H.id}${B.reset}  ${vt}  ${J}  ${Pe} ${Ie} ${ce}`)}else h.push(`| #${H.id} | ${me||"\u2033"} | ${J} | ${Pe} | ~${Se} | ${rt} |`)}X&&h.push("")}let C=l[0],L=m[0];if(C&&(C.investigated||C.learned||C.completed||C.next_steps)&&(!L||C.created_at_epoch>L.created_at_epoch)&&(h.push(...Hs("Investigated",C.investigated,B.blue,r)),h.push(...Hs("Learned",C.learned,B.yellow,r)),h.push(...Hs("Completed",C.completed,B.green,r)),h.push(...Hs("Next Steps",C.next_steps,B.magenta,r))),O>0&&E>0){let R=Math.round(O/1e3);h.push(""),r?h.push(`${B.dim}\u{1F4B0} Access ${R}k tokens of past research & decisions for just ${S.toLocaleString()}t. Use the mem-search skill to access memories by ID instead of re-reading files.${B.reset}`):h.push(`\u{1F4B0} Access ${R}k tokens of past research & decisions for just ${S.toLocaleString()}t. Use the mem-search skill to access memories by ID instead of re-reading files.`)}}return{content:[{type:"text",text:h.join(`
`).trimEnd()}]}}catch(e){return{content:[{type:"text",text:`Context retrieval failed: ${e.message}`}],isError:!0}}}}],vn=new $s({name:"claude-mem-search",version:"1.0.0"},{capabilities:{tools:{}}});vn.setRequestHandler(pa,async()=>({tools:Fl.map(s=>({name:s.name,description:s.description,inputSchema:nn(s.inputSchema)}))}));vn.setRequestHandler(ha,async s=>{let e=Fl.find(r=>r.name===s.params.name);if(!e)throw new Error(`Unknown tool: ${s.params.name}`);try{return await e.handler(s.params.arguments||{})}catch(r){return{content:[{type:"text",text:`Tool execution failed: ${r.message}`}],isError:!0}}});async function Ml(){if(console.error("[search-server] Shutting down..."),$e)try{await $e.close(),console.error("[search-server] Chroma client closed")}catch(s){console.error("[search-server] Error closing Chroma client:",s.message)}if(Te)try{Te.close(),console.error("[search-server] SessionSearch closed")}catch(s){console.error("[search-server] Error closing SessionSearch:",s.message)}if(ne)try{ne.close(),console.error("[search-server] SessionStore closed")}catch(s){console.error("[search-server] Error closing SessionStore:",s.message)}console.error("[search-server] Shutdown complete"),process.exit(0)}process.on("SIGTERM",Ml);process.on("SIGINT",Ml);async function Uh(){let s=new Ns;await vn.connect(s),console.error("[search-server] Claude-mem search server started"),setTimeout(async()=>{try{console.error("[search-server] Initializing Chroma client...");let e=new ks({command:"uvx",args:["chroma-mcp","--client-type","persistent","--data-dir",Pl],stderr:"ignore"}),r=new Ds({name:"claude-mem-search-chroma-client",version:"1.0.0"},{capabilities:{}});await r.connect(e),$e=r,console.error("[search-server] Chroma client connected successfully")}catch(e){console.error("[search-server] Failed to initialize Chroma client:",e.message),console.error("[search-server] Vector search unavailable - text queries will return empty results (FTS5 fallback removed)"),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),$e=null}},0)}Uh().catch(s=>{console.error("[search-server] Fatal error:",s),process.exit(1)});
/*! Bundled license information:

uri-js/dist/es5/uri.all.js:
  (** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js *)
*/
