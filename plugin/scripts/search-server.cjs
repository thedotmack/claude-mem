#!/usr/bin/env node
"use strict";var sy=Object.create;var vi=Object.defineProperty;var ny=Object.getOwnPropertyDescriptor;var oy=Object.getOwnPropertyNames;var iy=Object.getPrototypeOf,ay=Object.prototype.hasOwnProperty;var z=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),bi=(t,e)=>{for(var r in e)vi(t,r,{get:e[r],enumerable:!0})},cy=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of oy(e))!ay.call(t,n)&&n!==r&&vi(t,n,{get:()=>e[n],enumerable:!(s=ny(e,n))||s.enumerable});return t};var fr=(t,e,r)=>(r=t!=null?sy(iy(t)):{},cy(e||!t||!t.__esModule?vi(r,"default",{value:t,enumerable:!0}):r,t));var sn=z(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.regexpCode=ie.getEsmExportName=ie.getProperty=ie.safeStringify=ie.stringify=ie.strConcat=ie.addCodeArg=ie.str=ie._=ie.nil=ie._Code=ie.Name=ie.IDENTIFIER=ie._CodeOrName=void 0;var tn=class{};ie._CodeOrName=tn;ie.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;var Ar=class extends tn{constructor(e){if(super(),!ie.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}};ie.Name=Ar;var ct=class extends tn{constructor(e){super(),this._items=typeof e=="string"?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let e=this._items[0];return e===""||e==='""'}get str(){var e;return(e=this._str)!==null&&e!==void 0?e:this._str=this._items.reduce((r,s)=>`${r}${s}`,"")}get names(){var e;return(e=this._names)!==null&&e!==void 0?e:this._names=this._items.reduce((r,s)=>(s instanceof Ar&&(r[s.str]=(r[s.str]||0)+1),r),{})}};ie._Code=ct;ie.nil=new ct("");function pf(t,...e){let r=[t[0]],s=0;for(;s<e.length;)Ba(r,e[s]),r.push(t[++s]);return new ct(r)}ie._=pf;var Va=new ct("+");function mf(t,...e){let r=[rn(t[0])],s=0;for(;s<e.length;)r.push(Va),Ba(r,e[s]),r.push(Va,rn(t[++s]));return yS(r),new ct(r)}ie.str=mf;function Ba(t,e){e instanceof ct?t.push(...e._items):e instanceof Ar?t.push(e):t.push(SS(e))}ie.addCodeArg=Ba;function yS(t){let e=1;for(;e<t.length-1;){if(t[e]===Va){let r=vS(t[e-1],t[e+1]);if(r!==void 0){t.splice(e-1,3,r);continue}t[e++]="+"}e++}}function vS(t,e){if(e==='""')return t;if(t==='""')return e;if(typeof t=="string")return e instanceof Ar||t[t.length-1]!=='"'?void 0:typeof e!="string"?`${t.slice(0,-1)}${e}"`:e[0]==='"'?t.slice(0,-1)+e.slice(1):void 0;if(typeof e=="string"&&e[0]==='"'&&!(t instanceof Ar))return`"${t}${e.slice(1)}`}function bS(t,e){return e.emptyStr()?t:t.emptyStr()?e:mf`${t}${e}`}ie.strConcat=bS;function SS(t){return typeof t=="number"||typeof t=="boolean"||t===null?t:rn(Array.isArray(t)?t.join(","):t)}function xS(t){return new ct(rn(t))}ie.stringify=xS;function rn(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}ie.safeStringify=rn;function ES(t){return typeof t=="string"&&ie.IDENTIFIER.test(t)?new ct(`.${t}`):pf`[${t}]`}ie.getProperty=ES;function $S(t){if(typeof t=="string"&&ie.IDENTIFIER.test(t))return new ct(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)}ie.getEsmExportName=$S;function wS(t){return new ct(t.toString())}ie.regexpCode=wS});var Wa=z(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.ValueScope=Ye.ValueScopeName=Ye.Scope=Ye.varKinds=Ye.UsedValueState=void 0;var Je=sn(),Ha=class extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}},So;(function(t){t[t.Started=0]="Started",t[t.Completed=1]="Completed"})(So||(Ye.UsedValueState=So={}));Ye.varKinds={const:new Je.Name("const"),let:new Je.Name("let"),var:new Je.Name("var")};var xo=class{constructor({prefixes:e,parent:r}={}){this._names={},this._prefixes=e,this._parent=r}toName(e){return e instanceof Je.Name?e:this.name(e)}name(e){return new Je.Name(this._newName(e))}_newName(e){let r=this._names[e]||this._nameGroup(e);return`${e}${r.index++}`}_nameGroup(e){var r,s;if(!((s=(r=this._parent)===null||r===void 0?void 0:r._prefixes)===null||s===void 0)&&s.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}};Ye.Scope=xo;var Eo=class extends Je.Name{constructor(e,r){super(r),this.prefix=e}setValue(e,{property:r,itemIndex:s}){this.value=e,this.scopePath=(0,Je._)`.${new Je.Name(r)}[${s}]`}};Ye.ValueScopeName=Eo;var TS=(0,Je._)`\n`,Ga=class extends xo{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?TS:Je.nil}}get(){return this._scope}name(e){return new Eo(e,this._newName(e))}value(e,r){var s;if(r.ref===void 0)throw new Error("CodeGen: ref must be passed in value");let n=this.toName(e),{prefix:o}=n,i=(s=r.key)!==null&&s!==void 0?s:r.ref,a=this._values[o];if(a){let l=a.get(i);if(l)return l}else a=this._values[o]=new Map;a.set(i,n);let c=this._scope[o]||(this._scope[o]=[]),u=c.length;return c[u]=r.ref,n.setValue(r,{property:o,itemIndex:u}),n}getValue(e,r){let s=this._values[e];if(s)return s.get(r)}scopeRefs(e,r=this._values){return this._reduceValues(r,s=>{if(s.scopePath===void 0)throw new Error(`CodeGen: name "${s}" has no value`);return(0,Je._)`${e}${s.scopePath}`})}scopeCode(e=this._values,r,s){return this._reduceValues(e,n=>{if(n.value===void 0)throw new Error(`CodeGen: name "${n}" has no value`);return n.value.code},r,s)}_reduceValues(e,r,s={},n){let o=Je.nil;for(let i in e){let a=e[i];if(!a)continue;let c=s[i]=s[i]||new Map;a.forEach(u=>{if(c.has(u))return;c.set(u,So.Started);let l=r(u);if(l){let d=this.opts.es5?Ye.varKinds.var:Ye.varKinds.const;o=(0,Je._)`${o}${d} ${u} = ${l};${this.opts._n}`}else if(l=n?.(u))o=(0,Je._)`${o}${l}${this.opts._n}`;else throw new Ha(u);c.set(u,So.Completed)})}return o}};Ye.ValueScope=Ga});var J=z(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.or=Y.and=Y.not=Y.CodeGen=Y.operators=Y.varKinds=Y.ValueScopeName=Y.ValueScope=Y.Scope=Y.Name=Y.regexpCode=Y.stringify=Y.getProperty=Y.nil=Y.strConcat=Y.str=Y._=void 0;var se=sn(),_t=Wa(),sr=sn();Object.defineProperty(Y,"_",{enumerable:!0,get:function(){return sr._}});Object.defineProperty(Y,"str",{enumerable:!0,get:function(){return sr.str}});Object.defineProperty(Y,"strConcat",{enumerable:!0,get:function(){return sr.strConcat}});Object.defineProperty(Y,"nil",{enumerable:!0,get:function(){return sr.nil}});Object.defineProperty(Y,"getProperty",{enumerable:!0,get:function(){return sr.getProperty}});Object.defineProperty(Y,"stringify",{enumerable:!0,get:function(){return sr.stringify}});Object.defineProperty(Y,"regexpCode",{enumerable:!0,get:function(){return sr.regexpCode}});Object.defineProperty(Y,"Name",{enumerable:!0,get:function(){return sr.Name}});var ko=Wa();Object.defineProperty(Y,"Scope",{enumerable:!0,get:function(){return ko.Scope}});Object.defineProperty(Y,"ValueScope",{enumerable:!0,get:function(){return ko.ValueScope}});Object.defineProperty(Y,"ValueScopeName",{enumerable:!0,get:function(){return ko.ValueScopeName}});Object.defineProperty(Y,"varKinds",{enumerable:!0,get:function(){return ko.varKinds}});Y.operators={GT:new se._Code(">"),GTE:new se._Code(">="),LT:new se._Code("<"),LTE:new se._Code("<="),EQ:new se._Code("==="),NEQ:new se._Code("!=="),NOT:new se._Code("!"),OR:new se._Code("||"),AND:new se._Code("&&"),ADD:new se._Code("+")};var Vt=class{optimizeNodes(){return this}optimizeNames(e,r){return this}},Ka=class extends Vt{constructor(e,r,s){super(),this.varKind=e,this.name=r,this.rhs=s}render({es5:e,_n:r}){let s=e?_t.varKinds.var:this.varKind,n=this.rhs===void 0?"":` = ${this.rhs}`;return`${s} ${this.name}${n};`+r}optimizeNames(e,r){if(e[this.name.str])return this.rhs&&(this.rhs=us(this.rhs,e,r)),this}get names(){return this.rhs instanceof se._CodeOrName?this.rhs.names:{}}},$o=class extends Vt{constructor(e,r,s){super(),this.lhs=e,this.rhs=r,this.sideEffects=s}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof se.Name&&!e[this.lhs.str]&&!this.sideEffects))return this.rhs=us(this.rhs,e,r),this}get names(){let e=this.lhs instanceof se.Name?{}:{...this.lhs.names};return To(e,this.rhs)}},Xa=class extends $o{constructor(e,r,s,n){super(e,s,n),this.op=r}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}},Ja=class extends Vt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}},Ya=class extends Vt{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}},Qa=class extends Vt{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}},ec=class extends Vt{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,r){return this.code=us(this.code,e,r),this}get names(){return this.code instanceof se._CodeOrName?this.code.names:{}}},nn=class extends Vt{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((r,s)=>r+s.render(e),"")}optimizeNodes(){let{nodes:e}=this,r=e.length;for(;r--;){let s=e[r].optimizeNodes();Array.isArray(s)?e.splice(r,1,...s):s?e[r]=s:e.splice(r,1)}return e.length>0?this:void 0}optimizeNames(e,r){let{nodes:s}=this,n=s.length;for(;n--;){let o=s[n];o.optimizeNames(e,r)||(kS(e,o.names),s.splice(n,1))}return s.length>0?this:void 0}get names(){return this.nodes.reduce((e,r)=>Lr(e,r.names),{})}},Bt=class extends nn{render(e){return"{"+e._n+super.render(e)+"}"+e._n}},tc=class extends nn{},cs=class extends Bt{};cs.kind="else";var jr=class t extends Bt{constructor(e,r){super(r),this.condition=e}render(e){let r=`if(${this.condition})`+super.render(e);return this.else&&(r+="else "+this.else.render(e)),r}optimizeNodes(){super.optimizeNodes();let e=this.condition;if(e===!0)return this.nodes;let r=this.else;if(r){let s=r.optimizeNodes();r=this.else=Array.isArray(s)?new cs(s):s}if(r)return e===!1?r instanceof t?r:r.nodes:this.nodes.length?this:new t(ff(e),r instanceof t?[r]:r.nodes);if(!(e===!1||!this.nodes.length))return this}optimizeNames(e,r){var s;if(this.else=(s=this.else)===null||s===void 0?void 0:s.optimizeNames(e,r),!!(super.optimizeNames(e,r)||this.else))return this.condition=us(this.condition,e,r),this}get names(){let e=super.names;return To(e,this.condition),this.else&&Lr(e,this.else.names),e}};jr.kind="if";var Dr=class extends Bt{};Dr.kind="for";var rc=class extends Dr{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iteration=us(this.iteration,e,r),this}get names(){return Lr(super.names,this.iteration.names)}},sc=class extends Dr{constructor(e,r,s,n){super(),this.varKind=e,this.name=r,this.from=s,this.to=n}render(e){let r=e.es5?_t.varKinds.var:this.varKind,{name:s,from:n,to:o}=this;return`for(${r} ${s}=${n}; ${s}<${o}; ${s}++)`+super.render(e)}get names(){let e=To(super.names,this.from);return To(e,this.to)}},wo=class extends Dr{constructor(e,r,s,n){super(),this.loop=e,this.varKind=r,this.name=s,this.iterable=n}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,r){if(super.optimizeNames(e,r))return this.iterable=us(this.iterable,e,r),this}get names(){return Lr(super.names,this.iterable.names)}},on=class extends Bt{constructor(e,r,s){super(),this.name=e,this.args=r,this.async=s}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}};on.kind="func";var an=class extends nn{render(e){return"return "+super.render(e)}};an.kind="return";var nc=class extends Bt{render(e){let r="try"+super.render(e);return this.catch&&(r+=this.catch.render(e)),this.finally&&(r+=this.finally.render(e)),r}optimizeNodes(){var e,r;return super.optimizeNodes(),(e=this.catch)===null||e===void 0||e.optimizeNodes(),(r=this.finally)===null||r===void 0||r.optimizeNodes(),this}optimizeNames(e,r){var s,n;return super.optimizeNames(e,r),(s=this.catch)===null||s===void 0||s.optimizeNames(e,r),(n=this.finally)===null||n===void 0||n.optimizeNames(e,r),this}get names(){let e=super.names;return this.catch&&Lr(e,this.catch.names),this.finally&&Lr(e,this.finally.names),e}},cn=class extends Bt{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}};cn.kind="catch";var un=class extends Bt{render(e){return"finally"+super.render(e)}};un.kind="finally";var oc=class{constructor(e,r={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...r,_n:r.lines?`
`:""},this._extScope=e,this._scope=new _t.Scope({parent:e}),this._nodes=[new tc]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,r){let s=this._extScope.value(e,r);return(this._values[s.prefix]||(this._values[s.prefix]=new Set)).add(s),s}getScopeValue(e,r){return this._extScope.getValue(e,r)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,r,s,n){let o=this._scope.toName(r);return s!==void 0&&n&&(this._constants[o.str]=s),this._leafNode(new Ka(e,o,s)),o}const(e,r,s){return this._def(_t.varKinds.const,e,r,s)}let(e,r,s){return this._def(_t.varKinds.let,e,r,s)}var(e,r,s){return this._def(_t.varKinds.var,e,r,s)}assign(e,r,s){return this._leafNode(new $o(e,r,s))}add(e,r){return this._leafNode(new Xa(e,Y.operators.ADD,r))}code(e){return typeof e=="function"?e():e!==se.nil&&this._leafNode(new ec(e)),this}object(...e){let r=["{"];for(let[s,n]of e)r.length>1&&r.push(","),r.push(s),(s!==n||this.opts.es5)&&(r.push(":"),(0,se.addCodeArg)(r,n));return r.push("}"),new se._Code(r)}if(e,r,s){if(this._blockNode(new jr(e)),r&&s)this.code(r).else().code(s).endIf();else if(r)this.code(r).endIf();else if(s)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new jr(e))}else(){return this._elseNode(new cs)}endIf(){return this._endBlockNode(jr,cs)}_for(e,r){return this._blockNode(e),r&&this.code(r).endFor(),this}for(e,r){return this._for(new rc(e),r)}forRange(e,r,s,n,o=this.opts.es5?_t.varKinds.var:_t.varKinds.let){let i=this._scope.toName(e);return this._for(new sc(o,i,r,s),()=>n(i))}forOf(e,r,s,n=_t.varKinds.const){let o=this._scope.toName(e);if(this.opts.es5){let i=r instanceof se.Name?r:this.var("_arr",r);return this.forRange("_i",0,(0,se._)`${i}.length`,a=>{this.var(o,(0,se._)`${i}[${a}]`),s(o)})}return this._for(new wo("of",n,o,r),()=>s(o))}forIn(e,r,s,n=this.opts.es5?_t.varKinds.var:_t.varKinds.const){if(this.opts.ownProperties)return this.forOf(e,(0,se._)`Object.keys(${r})`,s);let o=this._scope.toName(e);return this._for(new wo("in",n,o,r),()=>s(o))}endFor(){return this._endBlockNode(Dr)}label(e){return this._leafNode(new Ja(e))}break(e){return this._leafNode(new Ya(e))}return(e){let r=new an;if(this._blockNode(r),this.code(e),r.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(an)}try(e,r,s){if(!r&&!s)throw new Error('CodeGen: "try" without "catch" and "finally"');let n=new nc;if(this._blockNode(n),this.code(e),r){let o=this.name("e");this._currNode=n.catch=new cn(o),r(o)}return s&&(this._currNode=n.finally=new un,this.code(s)),this._endBlockNode(cn,un)}throw(e){return this._leafNode(new Qa(e))}block(e,r){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(r),this}endBlock(e){let r=this._blockStarts.pop();if(r===void 0)throw new Error("CodeGen: not in self-balancing block");let s=this._nodes.length-r;if(s<0||e!==void 0&&s!==e)throw new Error(`CodeGen: wrong number of nodes: ${s} vs ${e} expected`);return this._nodes.length=r,this}func(e,r=se.nil,s,n){return this._blockNode(new on(e,r,s)),n&&this.code(n).endFunc(),this}endFunc(){return this._endBlockNode(on)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,r){let s=this._currNode;if(s instanceof e||r&&s instanceof r)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${r?`${e.kind}/${r.kind}`:e.kind}"`)}_elseNode(e){let r=this._currNode;if(!(r instanceof jr))throw new Error('CodeGen: "else" without "if"');return this._currNode=r.else=e,this}get _root(){return this._nodes[0]}get _currNode(){let e=this._nodes;return e[e.length-1]}set _currNode(e){let r=this._nodes;r[r.length-1]=e}};Y.CodeGen=oc;function Lr(t,e){for(let r in e)t[r]=(t[r]||0)+(e[r]||0);return t}function To(t,e){return e instanceof se._CodeOrName?Lr(t,e.names):t}function us(t,e,r){if(t instanceof se.Name)return s(t);if(!n(t))return t;return new se._Code(t._items.reduce((o,i)=>(i instanceof se.Name&&(i=s(i)),i instanceof se._Code?o.push(...i._items):o.push(i),o),[]));function s(o){let i=r[o.str];return i===void 0||e[o.str]!==1?o:(delete e[o.str],i)}function n(o){return o instanceof se._Code&&o._items.some(i=>i instanceof se.Name&&e[i.str]===1&&r[i.str]!==void 0)}}function kS(t,e){for(let r in e)t[r]=(t[r]||0)-(e[r]||0)}function ff(t){return typeof t=="boolean"||typeof t=="number"||t===null?!t:(0,se._)`!${ic(t)}`}Y.not=ff;var RS=hf(Y.operators.AND);function zS(...t){return t.reduce(RS)}Y.and=zS;var IS=hf(Y.operators.OR);function OS(...t){return t.reduce(IS)}Y.or=OS;function hf(t){return(e,r)=>e===se.nil?r:r===se.nil?e:(0,se._)`${ic(e)} ${t} ${ic(r)}`}function ic(t){return t instanceof se.Name?t:(0,se._)`(${t})`}});var ae=z(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.checkStrictMode=Q.getErrorPath=Q.Type=Q.useFunc=Q.setEvaluated=Q.evaluatedPropsToName=Q.mergeEvaluated=Q.eachItem=Q.unescapeJsonPointer=Q.escapeJsonPointer=Q.escapeFragment=Q.unescapeFragment=Q.schemaRefOrVal=Q.schemaHasRulesButRef=Q.schemaHasRules=Q.checkUnknownRules=Q.alwaysValidSchema=Q.toHash=void 0;var me=J(),NS=sn();function PS(t){let e={};for(let r of t)e[r]=!0;return e}Q.toHash=PS;function CS(t,e){return typeof e=="boolean"?e:Object.keys(e).length===0?!0:(yf(t,e),!vf(e,t.self.RULES.all))}Q.alwaysValidSchema=CS;function yf(t,e=t.schema){let{opts:r,self:s}=t;if(!r.strictSchema||typeof e=="boolean")return;let n=s.RULES.keywords;for(let o in e)n[o]||xf(t,`unknown keyword: "${o}"`)}Q.checkUnknownRules=yf;function vf(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(e[r])return!0;return!1}Q.schemaHasRules=vf;function AS(t,e){if(typeof t=="boolean")return!t;for(let r in t)if(r!=="$ref"&&e.all[r])return!0;return!1}Q.schemaHasRulesButRef=AS;function jS({topSchemaRef:t,schemaPath:e},r,s,n){if(!n){if(typeof r=="number"||typeof r=="boolean")return r;if(typeof r=="string")return(0,me._)`${r}`}return(0,me._)`${t}${e}${(0,me.getProperty)(s)}`}Q.schemaRefOrVal=jS;function DS(t){return bf(decodeURIComponent(t))}Q.unescapeFragment=DS;function LS(t){return encodeURIComponent(cc(t))}Q.escapeFragment=LS;function cc(t){return typeof t=="number"?`${t}`:t.replace(/~/g,"~0").replace(/\//g,"~1")}Q.escapeJsonPointer=cc;function bf(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}Q.unescapeJsonPointer=bf;function MS(t,e){if(Array.isArray(t))for(let r of t)e(r);else e(t)}Q.eachItem=MS;function _f({mergeNames:t,mergeToName:e,mergeValues:r,resultToName:s}){return(n,o,i,a)=>{let c=i===void 0?o:i instanceof me.Name?(o instanceof me.Name?t(n,o,i):e(n,o,i),i):o instanceof me.Name?(e(n,i,o),o):r(o,i);return a===me.Name&&!(c instanceof me.Name)?s(n,c):c}}Q.mergeEvaluated={props:_f({mergeNames:(t,e,r)=>t.if((0,me._)`${r} !== true && ${e} !== undefined`,()=>{t.if((0,me._)`${e} === true`,()=>t.assign(r,!0),()=>t.assign(r,(0,me._)`${r} || {}`).code((0,me._)`Object.assign(${r}, ${e})`))}),mergeToName:(t,e,r)=>t.if((0,me._)`${r} !== true`,()=>{e===!0?t.assign(r,!0):(t.assign(r,(0,me._)`${r} || {}`),uc(t,r,e))}),mergeValues:(t,e)=>t===!0?!0:{...t,...e},resultToName:Sf}),items:_f({mergeNames:(t,e,r)=>t.if((0,me._)`${r} !== true && ${e} !== undefined`,()=>t.assign(r,(0,me._)`${e} === true ? true : ${r} > ${e} ? ${r} : ${e}`)),mergeToName:(t,e,r)=>t.if((0,me._)`${r} !== true`,()=>t.assign(r,e===!0?!0:(0,me._)`${r} > ${e} ? ${r} : ${e}`)),mergeValues:(t,e)=>t===!0?!0:Math.max(t,e),resultToName:(t,e)=>t.var("items",e)})};function Sf(t,e){if(e===!0)return t.var("props",!0);let r=t.var("props",(0,me._)`{}`);return e!==void 0&&uc(t,r,e),r}Q.evaluatedPropsToName=Sf;function uc(t,e,r){Object.keys(r).forEach(s=>t.assign((0,me._)`${e}${(0,me.getProperty)(s)}`,!0))}Q.setEvaluated=uc;var gf={};function qS(t,e){return t.scopeValue("func",{ref:e,code:gf[e.code]||(gf[e.code]=new NS._Code(e.code))})}Q.useFunc=qS;var ac;(function(t){t[t.Num=0]="Num",t[t.Str=1]="Str"})(ac||(Q.Type=ac={}));function ZS(t,e,r){if(t instanceof me.Name){let s=e===ac.Num;return r?s?(0,me._)`"[" + ${t} + "]"`:(0,me._)`"['" + ${t} + "']"`:s?(0,me._)`"/" + ${t}`:(0,me._)`"/" + ${t}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return r?(0,me.getProperty)(t).toString():"/"+cc(t)}Q.getErrorPath=ZS;function xf(t,e,r=t.opts.strictSchema){if(r){if(e=`strict mode: ${e}`,r===!0)throw new Error(e);t.self.logger.warn(e)}}Q.checkStrictMode=xf});var Ht=z(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});var qe=J(),US={data:new qe.Name("data"),valCxt:new qe.Name("valCxt"),instancePath:new qe.Name("instancePath"),parentData:new qe.Name("parentData"),parentDataProperty:new qe.Name("parentDataProperty"),rootData:new qe.Name("rootData"),dynamicAnchors:new qe.Name("dynamicAnchors"),vErrors:new qe.Name("vErrors"),errors:new qe.Name("errors"),this:new qe.Name("this"),self:new qe.Name("self"),scope:new qe.Name("scope"),json:new qe.Name("json"),jsonPos:new qe.Name("jsonPos"),jsonLen:new qe.Name("jsonLen"),jsonPart:new qe.Name("jsonPart")};lc.default=US});var ln=z(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.extendErrors=Ze.resetErrorsCount=Ze.reportExtraError=Ze.reportError=Ze.keyword$DataError=Ze.keywordError=void 0;var ne=J(),Ro=ae(),He=Ht();Ze.keywordError={message:({keyword:t})=>(0,ne.str)`must pass "${t}" keyword validation`};Ze.keyword$DataError={message:({keyword:t,schemaType:e})=>e?(0,ne.str)`"${t}" keyword must be ${e} ($data)`:(0,ne.str)`"${t}" keyword is invalid ($data)`};function FS(t,e=Ze.keywordError,r,s){let{it:n}=t,{gen:o,compositeRule:i,allErrors:a}=n,c=wf(t,e,r);s??(i||a)?Ef(o,c):$f(n,(0,ne._)`[${c}]`)}Ze.reportError=FS;function VS(t,e=Ze.keywordError,r){let{it:s}=t,{gen:n,compositeRule:o,allErrors:i}=s,a=wf(t,e,r);Ef(n,a),o||i||$f(s,He.default.vErrors)}Ze.reportExtraError=VS;function BS(t,e){t.assign(He.default.errors,e),t.if((0,ne._)`${He.default.vErrors} !== null`,()=>t.if(e,()=>t.assign((0,ne._)`${He.default.vErrors}.length`,e),()=>t.assign(He.default.vErrors,null)))}Ze.resetErrorsCount=BS;function HS({gen:t,keyword:e,schemaValue:r,data:s,errsCount:n,it:o}){if(n===void 0)throw new Error("ajv implementation error");let i=t.name("err");t.forRange("i",n,He.default.errors,a=>{t.const(i,(0,ne._)`${He.default.vErrors}[${a}]`),t.if((0,ne._)`${i}.instancePath === undefined`,()=>t.assign((0,ne._)`${i}.instancePath`,(0,ne.strConcat)(He.default.instancePath,o.errorPath))),t.assign((0,ne._)`${i}.schemaPath`,(0,ne.str)`${o.errSchemaPath}/${e}`),o.opts.verbose&&(t.assign((0,ne._)`${i}.schema`,r),t.assign((0,ne._)`${i}.data`,s))})}Ze.extendErrors=HS;function Ef(t,e){let r=t.const("err",e);t.if((0,ne._)`${He.default.vErrors} === null`,()=>t.assign(He.default.vErrors,(0,ne._)`[${r}]`),(0,ne._)`${He.default.vErrors}.push(${r})`),t.code((0,ne._)`${He.default.errors}++`)}function $f(t,e){let{gen:r,validateName:s,schemaEnv:n}=t;n.$async?r.throw((0,ne._)`new ${t.ValidationError}(${e})`):(r.assign((0,ne._)`${s}.errors`,e),r.return(!1))}var Mr={keyword:new ne.Name("keyword"),schemaPath:new ne.Name("schemaPath"),params:new ne.Name("params"),propertyName:new ne.Name("propertyName"),message:new ne.Name("message"),schema:new ne.Name("schema"),parentSchema:new ne.Name("parentSchema")};function wf(t,e,r){let{createErrors:s}=t.it;return s===!1?(0,ne._)`{}`:GS(t,e,r)}function GS(t,e,r={}){let{gen:s,it:n}=t,o=[WS(n,r),KS(t,r)];return XS(t,e,o),s.object(...o)}function WS({errorPath:t},{instancePath:e}){let r=e?(0,ne.str)`${t}${(0,Ro.getErrorPath)(e,Ro.Type.Str)}`:t;return[He.default.instancePath,(0,ne.strConcat)(He.default.instancePath,r)]}function KS({keyword:t,it:{errSchemaPath:e}},{schemaPath:r,parentSchema:s}){let n=s?e:(0,ne.str)`${e}/${t}`;return r&&(n=(0,ne.str)`${n}${(0,Ro.getErrorPath)(r,Ro.Type.Str)}`),[Mr.schemaPath,n]}function XS(t,{params:e,message:r},s){let{keyword:n,data:o,schemaValue:i,it:a}=t,{opts:c,propertyName:u,topSchemaRef:l,schemaPath:d}=a;s.push([Mr.keyword,n],[Mr.params,typeof e=="function"?e(t):e||(0,ne._)`{}`]),c.messages&&s.push([Mr.message,typeof r=="function"?r(t):r]),c.verbose&&s.push([Mr.schema,i],[Mr.parentSchema,(0,ne._)`${l}${d}`],[He.default.data,o]),u&&s.push([Mr.propertyName,u])}});var kf=z(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.boolOrEmptySchema=ls.topBoolOrEmptySchema=void 0;var JS=ln(),YS=J(),QS=Ht(),ex={message:"boolean schema is false"};function tx(t){let{gen:e,schema:r,validateName:s}=t;r===!1?Tf(t,!1):typeof r=="object"&&r.$async===!0?e.return(QS.default.data):(e.assign((0,YS._)`${s}.errors`,null),e.return(!0))}ls.topBoolOrEmptySchema=tx;function rx(t,e){let{gen:r,schema:s}=t;s===!1?(r.var(e,!1),Tf(t)):r.var(e,!0)}ls.boolOrEmptySchema=rx;function Tf(t,e){let{gen:r,data:s}=t,n={gen:r,keyword:"false schema",data:s,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:t};(0,JS.reportError)(n,ex,void 0,e)}});var dc=z(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.getRules=ds.isJSONType=void 0;var sx=["string","number","integer","boolean","null","object","array"],nx=new Set(sx);function ox(t){return typeof t=="string"&&nx.has(t)}ds.isJSONType=ox;function ix(){let t={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...t,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},t.number,t.string,t.array,t.object],post:{rules:[]},all:{},keywords:{}}}ds.getRules=ix});var pc=z(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.shouldUseRule=nr.shouldUseGroup=nr.schemaHasRulesForType=void 0;function ax({schema:t,self:e},r){let s=e.RULES.types[r];return s&&s!==!0&&Rf(t,s)}nr.schemaHasRulesForType=ax;function Rf(t,e){return e.rules.some(r=>zf(t,r))}nr.shouldUseGroup=Rf;function zf(t,e){var r;return t[e.keyword]!==void 0||((r=e.definition.implements)===null||r===void 0?void 0:r.some(s=>t[s]!==void 0))}nr.shouldUseRule=zf});var dn=z(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.reportTypeError=Ue.checkDataTypes=Ue.checkDataType=Ue.coerceAndCheckDataType=Ue.getJSONTypes=Ue.getSchemaTypes=Ue.DataType=void 0;var cx=dc(),ux=pc(),lx=ln(),K=J(),If=ae(),ps;(function(t){t[t.Correct=0]="Correct",t[t.Wrong=1]="Wrong"})(ps||(Ue.DataType=ps={}));function dx(t){let e=Of(t.type);if(e.includes("null")){if(t.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!e.length&&t.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');t.nullable===!0&&e.push("null")}return e}Ue.getSchemaTypes=dx;function Of(t){let e=Array.isArray(t)?t:t?[t]:[];if(e.every(cx.isJSONType))return e;throw new Error("type must be JSONType or JSONType[]: "+e.join(","))}Ue.getJSONTypes=Of;function px(t,e){let{gen:r,data:s,opts:n}=t,o=mx(e,n.coerceTypes),i=e.length>0&&!(o.length===0&&e.length===1&&(0,ux.schemaHasRulesForType)(t,e[0]));if(i){let a=fc(e,s,n.strictNumbers,ps.Wrong);r.if(a,()=>{o.length?fx(t,e,o):hc(t)})}return i}Ue.coerceAndCheckDataType=px;var Nf=new Set(["string","number","integer","boolean","null"]);function mx(t,e){return e?t.filter(r=>Nf.has(r)||e==="array"&&r==="array"):[]}function fx(t,e,r){let{gen:s,data:n,opts:o}=t,i=s.let("dataType",(0,K._)`typeof ${n}`),a=s.let("coerced",(0,K._)`undefined`);o.coerceTypes==="array"&&s.if((0,K._)`${i} == 'object' && Array.isArray(${n}) && ${n}.length == 1`,()=>s.assign(n,(0,K._)`${n}[0]`).assign(i,(0,K._)`typeof ${n}`).if(fc(e,n,o.strictNumbers),()=>s.assign(a,n))),s.if((0,K._)`${a} !== undefined`);for(let u of r)(Nf.has(u)||u==="array"&&o.coerceTypes==="array")&&c(u);s.else(),hc(t),s.endIf(),s.if((0,K._)`${a} !== undefined`,()=>{s.assign(n,a),hx(t,a)});function c(u){switch(u){case"string":s.elseIf((0,K._)`${i} == "number" || ${i} == "boolean"`).assign(a,(0,K._)`"" + ${n}`).elseIf((0,K._)`${n} === null`).assign(a,(0,K._)`""`);return;case"number":s.elseIf((0,K._)`${i} == "boolean" || ${n} === null
              || (${i} == "string" && ${n} && ${n} == +${n})`).assign(a,(0,K._)`+${n}`);return;case"integer":s.elseIf((0,K._)`${i} === "boolean" || ${n} === null
              || (${i} === "string" && ${n} && ${n} == +${n} && !(${n} % 1))`).assign(a,(0,K._)`+${n}`);return;case"boolean":s.elseIf((0,K._)`${n} === "false" || ${n} === 0 || ${n} === null`).assign(a,!1).elseIf((0,K._)`${n} === "true" || ${n} === 1`).assign(a,!0);return;case"null":s.elseIf((0,K._)`${n} === "" || ${n} === 0 || ${n} === false`),s.assign(a,null);return;case"array":s.elseIf((0,K._)`${i} === "string" || ${i} === "number"
              || ${i} === "boolean" || ${n} === null`).assign(a,(0,K._)`[${n}]`)}}}function hx({gen:t,parentData:e,parentDataProperty:r},s){t.if((0,K._)`${e} !== undefined`,()=>t.assign((0,K._)`${e}[${r}]`,s))}function mc(t,e,r,s=ps.Correct){let n=s===ps.Correct?K.operators.EQ:K.operators.NEQ,o;switch(t){case"null":return(0,K._)`${e} ${n} null`;case"array":o=(0,K._)`Array.isArray(${e})`;break;case"object":o=(0,K._)`${e} && typeof ${e} == "object" && !Array.isArray(${e})`;break;case"integer":o=i((0,K._)`!(${e} % 1) && !isNaN(${e})`);break;case"number":o=i();break;default:return(0,K._)`typeof ${e} ${n} ${t}`}return s===ps.Correct?o:(0,K.not)(o);function i(a=K.nil){return(0,K.and)((0,K._)`typeof ${e} == "number"`,a,r?(0,K._)`isFinite(${e})`:K.nil)}}Ue.checkDataType=mc;function fc(t,e,r,s){if(t.length===1)return mc(t[0],e,r,s);let n,o=(0,If.toHash)(t);if(o.array&&o.object){let i=(0,K._)`typeof ${e} != "object"`;n=o.null?i:(0,K._)`!${e} || ${i}`,delete o.null,delete o.array,delete o.object}else n=K.nil;o.number&&delete o.integer;for(let i in o)n=(0,K.and)(n,mc(i,e,r,s));return n}Ue.checkDataTypes=fc;var _x={message:({schema:t})=>`must be ${t}`,params:({schema:t,schemaValue:e})=>typeof t=="string"?(0,K._)`{type: ${t}}`:(0,K._)`{type: ${e}}`};function hc(t){let e=gx(t);(0,lx.reportError)(e,_x)}Ue.reportTypeError=hc;function gx(t){let{gen:e,data:r,schema:s}=t,n=(0,If.schemaRefOrVal)(t,s,"type");return{gen:e,keyword:"type",data:r,schema:s.type,schemaCode:n,schemaValue:n,parentSchema:s,params:{},it:t}}});var Cf=z(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.assignDefaults=void 0;var ms=J(),yx=ae();function vx(t,e){let{properties:r,items:s}=t.schema;if(e==="object"&&r)for(let n in r)Pf(t,n,r[n].default);else e==="array"&&Array.isArray(s)&&s.forEach((n,o)=>Pf(t,o,n.default))}zo.assignDefaults=vx;function Pf(t,e,r){let{gen:s,compositeRule:n,data:o,opts:i}=t;if(r===void 0)return;let a=(0,ms._)`${o}${(0,ms.getProperty)(e)}`;if(n){(0,yx.checkStrictMode)(t,`default is ignored for: ${a}`);return}let c=(0,ms._)`${a} === undefined`;i.useDefaults==="empty"&&(c=(0,ms._)`${c} || ${a} === null || ${a} === ""`),s.if(c,(0,ms._)`${a} = ${(0,ms.stringify)(r)}`)}});var ut=z(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.validateUnion=de.validateArray=de.usePattern=de.callValidateCode=de.schemaProperties=de.allSchemaProperties=de.noPropertyInData=de.propertyInData=de.isOwnProperty=de.hasPropFunc=de.reportMissingProp=de.checkMissingProp=de.checkReportMissingProp=void 0;var ye=J(),_c=ae(),or=Ht(),bx=ae();function Sx(t,e){let{gen:r,data:s,it:n}=t;r.if(yc(r,s,e,n.opts.ownProperties),()=>{t.setParams({missingProperty:(0,ye._)`${e}`},!0),t.error()})}de.checkReportMissingProp=Sx;function xx({gen:t,data:e,it:{opts:r}},s,n){return(0,ye.or)(...s.map(o=>(0,ye.and)(yc(t,e,o,r.ownProperties),(0,ye._)`${n} = ${o}`)))}de.checkMissingProp=xx;function Ex(t,e){t.setParams({missingProperty:e},!0),t.error()}de.reportMissingProp=Ex;function Af(t){return t.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ye._)`Object.prototype.hasOwnProperty`})}de.hasPropFunc=Af;function gc(t,e,r){return(0,ye._)`${Af(t)}.call(${e}, ${r})`}de.isOwnProperty=gc;function $x(t,e,r,s){let n=(0,ye._)`${e}${(0,ye.getProperty)(r)} !== undefined`;return s?(0,ye._)`${n} && ${gc(t,e,r)}`:n}de.propertyInData=$x;function yc(t,e,r,s){let n=(0,ye._)`${e}${(0,ye.getProperty)(r)} === undefined`;return s?(0,ye.or)(n,(0,ye.not)(gc(t,e,r))):n}de.noPropertyInData=yc;function jf(t){return t?Object.keys(t).filter(e=>e!=="__proto__"):[]}de.allSchemaProperties=jf;function wx(t,e){return jf(e).filter(r=>!(0,_c.alwaysValidSchema)(t,e[r]))}de.schemaProperties=wx;function Tx({schemaCode:t,data:e,it:{gen:r,topSchemaRef:s,schemaPath:n,errorPath:o},it:i},a,c,u){let l=u?(0,ye._)`${t}, ${e}, ${s}${n}`:e,d=[[or.default.instancePath,(0,ye.strConcat)(or.default.instancePath,o)],[or.default.parentData,i.parentData],[or.default.parentDataProperty,i.parentDataProperty],[or.default.rootData,or.default.rootData]];i.opts.dynamicRef&&d.push([or.default.dynamicAnchors,or.default.dynamicAnchors]);let p=(0,ye._)`${l}, ${r.object(...d)}`;return c!==ye.nil?(0,ye._)`${a}.call(${c}, ${p})`:(0,ye._)`${a}(${p})`}de.callValidateCode=Tx;var kx=(0,ye._)`new RegExp`;function Rx({gen:t,it:{opts:e}},r){let s=e.unicodeRegExp?"u":"",{regExp:n}=e.code,o=n(r,s);return t.scopeValue("pattern",{key:o.toString(),ref:o,code:(0,ye._)`${n.code==="new RegExp"?kx:(0,bx.useFunc)(t,n)}(${r}, ${s})`})}de.usePattern=Rx;function zx(t){let{gen:e,data:r,keyword:s,it:n}=t,o=e.name("valid");if(n.allErrors){let a=e.let("valid",!0);return i(()=>e.assign(a,!1)),a}return e.var(o,!0),i(()=>e.break()),o;function i(a){let c=e.const("len",(0,ye._)`${r}.length`);e.forRange("i",0,c,u=>{t.subschema({keyword:s,dataProp:u,dataPropType:_c.Type.Num},o),e.if((0,ye.not)(o),a)})}}de.validateArray=zx;function Ix(t){let{gen:e,schema:r,keyword:s,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(c=>(0,_c.alwaysValidSchema)(n,c))&&!n.opts.unevaluated)return;let i=e.let("valid",!1),a=e.name("_valid");e.block(()=>r.forEach((c,u)=>{let l=t.subschema({keyword:s,schemaProp:u,compositeRule:!0},a);e.assign(i,(0,ye._)`${i} || ${a}`),t.mergeValidEvaluated(l,a)||e.if((0,ye.not)(i))})),t.result(i,()=>t.reset(),()=>t.error(!0))}de.validateUnion=Ix});var Mf=z(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.validateKeywordUsage=zt.validSchemaType=zt.funcKeywordCode=zt.macroKeywordCode=void 0;var Ge=J(),qr=Ht(),Ox=ut(),Nx=ln();function Px(t,e){let{gen:r,keyword:s,schema:n,parentSchema:o,it:i}=t,a=e.macro.call(i.self,n,o,i),c=Lf(r,s,a);i.opts.validateSchema!==!1&&i.self.validateSchema(a,!0);let u=r.name("valid");t.subschema({schema:a,schemaPath:Ge.nil,errSchemaPath:`${i.errSchemaPath}/${s}`,topSchemaRef:c,compositeRule:!0},u),t.pass(u,()=>t.error(!0))}zt.macroKeywordCode=Px;function Cx(t,e){var r;let{gen:s,keyword:n,schema:o,parentSchema:i,$data:a,it:c}=t;jx(c,e);let u=!a&&e.compile?e.compile.call(c.self,o,i,c):e.validate,l=Lf(s,n,u),d=s.let("valid");t.block$data(d,p),t.ok((r=e.valid)!==null&&r!==void 0?r:d);function p(){if(e.errors===!1)g(),e.modifying&&Df(t),_(()=>t.error());else{let v=e.async?m():f();e.modifying&&Df(t),_(()=>Ax(t,v))}}function m(){let v=s.let("ruleErrs",null);return s.try(()=>g((0,Ge._)`await `),$=>s.assign(d,!1).if((0,Ge._)`${$} instanceof ${c.ValidationError}`,()=>s.assign(v,(0,Ge._)`${$}.errors`),()=>s.throw($))),v}function f(){let v=(0,Ge._)`${l}.errors`;return s.assign(v,null),g(Ge.nil),v}function g(v=e.async?(0,Ge._)`await `:Ge.nil){let $=c.opts.passContext?qr.default.this:qr.default.self,y=!("compile"in e&&!a||e.schema===!1);s.assign(d,(0,Ge._)`${v}${(0,Ox.callValidateCode)(t,l,$,y)}`,e.modifying)}function _(v){var $;s.if((0,Ge.not)(($=e.valid)!==null&&$!==void 0?$:d),v)}}zt.funcKeywordCode=Cx;function Df(t){let{gen:e,data:r,it:s}=t;e.if(s.parentData,()=>e.assign(r,(0,Ge._)`${s.parentData}[${s.parentDataProperty}]`))}function Ax(t,e){let{gen:r}=t;r.if((0,Ge._)`Array.isArray(${e})`,()=>{r.assign(qr.default.vErrors,(0,Ge._)`${qr.default.vErrors} === null ? ${e} : ${qr.default.vErrors}.concat(${e})`).assign(qr.default.errors,(0,Ge._)`${qr.default.vErrors}.length`),(0,Nx.extendErrors)(t)},()=>t.error())}function jx({schemaEnv:t},e){if(e.async&&!t.$async)throw new Error("async keyword in sync schema")}function Lf(t,e,r){if(r===void 0)throw new Error(`keyword "${e}" failed to compile`);return t.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,Ge.stringify)(r)})}function Dx(t,e,r=!1){return!e.length||e.some(s=>s==="array"?Array.isArray(t):s==="object"?t&&typeof t=="object"&&!Array.isArray(t):typeof t==s||r&&typeof t>"u")}zt.validSchemaType=Dx;function Lx({schema:t,opts:e,self:r,errSchemaPath:s},n,o){if(Array.isArray(n.keyword)?!n.keyword.includes(o):n.keyword!==o)throw new Error("ajv implementation error");let i=n.dependencies;if(i?.some(a=>!Object.prototype.hasOwnProperty.call(t,a)))throw new Error(`parent schema must have dependencies of ${o}: ${i.join(",")}`);if(n.validateSchema&&!n.validateSchema(t[o])){let c=`keyword "${o}" value is invalid at path "${s}": `+r.errorsText(n.validateSchema.errors);if(e.validateSchema==="log")r.logger.error(c);else throw new Error(c)}}zt.validateKeywordUsage=Lx});var Zf=z(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.extendSubschemaMode=ir.extendSubschemaData=ir.getSubschema=void 0;var It=J(),qf=ae();function Mx(t,{keyword:e,schemaProp:r,schema:s,schemaPath:n,errSchemaPath:o,topSchemaRef:i}){if(e!==void 0&&s!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){let a=t.schema[e];return r===void 0?{schema:a,schemaPath:(0,It._)`${t.schemaPath}${(0,It.getProperty)(e)}`,errSchemaPath:`${t.errSchemaPath}/${e}`}:{schema:a[r],schemaPath:(0,It._)`${t.schemaPath}${(0,It.getProperty)(e)}${(0,It.getProperty)(r)}`,errSchemaPath:`${t.errSchemaPath}/${e}/${(0,qf.escapeFragment)(r)}`}}if(s!==void 0){if(n===void 0||o===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:s,schemaPath:n,topSchemaRef:i,errSchemaPath:o}}throw new Error('either "keyword" or "schema" must be passed')}ir.getSubschema=Mx;function qx(t,e,{dataProp:r,dataPropType:s,data:n,dataTypes:o,propertyName:i}){if(n!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');let{gen:a}=e;if(r!==void 0){let{errorPath:u,dataPathArr:l,opts:d}=e,p=a.let("data",(0,It._)`${e.data}${(0,It.getProperty)(r)}`,!0);c(p),t.errorPath=(0,It.str)`${u}${(0,qf.getErrorPath)(r,s,d.jsPropertySyntax)}`,t.parentDataProperty=(0,It._)`${r}`,t.dataPathArr=[...l,t.parentDataProperty]}if(n!==void 0){let u=n instanceof It.Name?n:a.let("data",n,!0);c(u),i!==void 0&&(t.propertyName=i)}o&&(t.dataTypes=o);function c(u){t.data=u,t.dataLevel=e.dataLevel+1,t.dataTypes=[],e.definedProperties=new Set,t.parentData=e.data,t.dataNames=[...e.dataNames,u]}}ir.extendSubschemaData=qx;function Zx(t,{jtdDiscriminator:e,jtdMetadata:r,compositeRule:s,createErrors:n,allErrors:o}){s!==void 0&&(t.compositeRule=s),n!==void 0&&(t.createErrors=n),o!==void 0&&(t.allErrors=o),t.jtdDiscriminator=e,t.jtdMetadata=r}ir.extendSubschemaMode=Zx});var vc=z((kP,Uf)=>{"use strict";Uf.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var s,n,o;if(Array.isArray(e)){if(s=e.length,s!=r.length)return!1;for(n=s;n--!==0;)if(!t(e[n],r[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),s=o.length,s!==Object.keys(r).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[n]))return!1;for(n=s;n--!==0;){var i=o[n];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var Vf=z((RP,Ff)=>{"use strict";var ar=Ff.exports=function(t,e,r){typeof e=="function"&&(r=e,e={}),r=e.cb||r;var s=typeof r=="function"?r:r.pre||function(){},n=r.post||function(){};Io(e,s,n,t,"",t)};ar.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};ar.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};ar.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};ar.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function Io(t,e,r,s,n,o,i,a,c,u){if(s&&typeof s=="object"&&!Array.isArray(s)){e(s,n,o,i,a,c,u);for(var l in s){var d=s[l];if(Array.isArray(d)){if(l in ar.arrayKeywords)for(var p=0;p<d.length;p++)Io(t,e,r,d[p],n+"/"+l+"/"+p,o,n,l,s,p)}else if(l in ar.propsKeywords){if(d&&typeof d=="object")for(var m in d)Io(t,e,r,d[m],n+"/"+l+"/"+Ux(m),o,n,l,s,m)}else(l in ar.keywords||t.allKeys&&!(l in ar.skipKeywords))&&Io(t,e,r,d,n+"/"+l,o,n,l,s)}r(s,n,o,i,a,c,u)}}function Ux(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}});var pn=z(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.getSchemaRefs=Qe.resolveUrl=Qe.normalizeId=Qe._getFullPath=Qe.getFullPath=Qe.inlineRef=void 0;var Fx=ae(),Vx=vc(),Bx=Vf(),Hx=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Gx(t,e=!0){return typeof t=="boolean"?!0:e===!0?!bc(t):e?Bf(t)<=e:!1}Qe.inlineRef=Gx;var Wx=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function bc(t){for(let e in t){if(Wx.has(e))return!0;let r=t[e];if(Array.isArray(r)&&r.some(bc)||typeof r=="object"&&bc(r))return!0}return!1}function Bf(t){let e=0;for(let r in t){if(r==="$ref")return 1/0;if(e++,!Hx.has(r)&&(typeof t[r]=="object"&&(0,Fx.eachItem)(t[r],s=>e+=Bf(s)),e===1/0))return 1/0}return e}function Hf(t,e="",r){r!==!1&&(e=fs(e));let s=t.parse(e);return Gf(t,s)}Qe.getFullPath=Hf;function Gf(t,e){return t.serialize(e).split("#")[0]+"#"}Qe._getFullPath=Gf;var Kx=/#\/?$/;function fs(t){return t?t.replace(Kx,""):""}Qe.normalizeId=fs;function Xx(t,e,r){return r=fs(r),t.resolve(e,r)}Qe.resolveUrl=Xx;var Jx=/^[a-z_][-a-z0-9._]*$/i;function Yx(t,e){if(typeof t=="boolean")return{};let{schemaId:r,uriResolver:s}=this.opts,n=fs(t[r]||e),o={"":n},i=Hf(s,n,!1),a={},c=new Set;return Bx(t,{allKeys:!0},(d,p,m,f)=>{if(f===void 0)return;let g=i+p,_=o[f];typeof d[r]=="string"&&(_=v.call(this,d[r])),$.call(this,d.$anchor),$.call(this,d.$dynamicAnchor),o[p]=_;function v(y){let x=this.opts.uriResolver.resolve;if(y=fs(_?x(_,y):y),c.has(y))throw l(y);c.add(y);let E=this.refs[y];return typeof E=="string"&&(E=this.refs[E]),typeof E=="object"?u(d,E.schema,y):y!==fs(g)&&(y[0]==="#"?(u(d,a[y],y),a[y]=d):this.refs[y]=g),y}function $(y){if(typeof y=="string"){if(!Jx.test(y))throw new Error(`invalid anchor "${y}"`);v.call(this,`#${y}`)}}}),a;function u(d,p,m){if(p!==void 0&&!Vx(d,p))throw l(m)}function l(d){return new Error(`reference "${d}" resolves to more than one schema`)}}Qe.getSchemaRefs=Yx});var hn=z(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.getData=cr.KeywordCxt=cr.validateFunctionCode=void 0;var Yf=kf(),Wf=dn(),xc=pc(),Oo=dn(),Qx=Cf(),fn=Mf(),Sc=Zf(),M=J(),H=Ht(),eE=pn(),Gt=ae(),mn=ln();function tE(t){if(th(t)&&(rh(t),eh(t))){nE(t);return}Qf(t,()=>(0,Yf.topBoolOrEmptySchema)(t))}cr.validateFunctionCode=tE;function Qf({gen:t,validateName:e,schema:r,schemaEnv:s,opts:n},o){n.code.es5?t.func(e,(0,M._)`${H.default.data}, ${H.default.valCxt}`,s.$async,()=>{t.code((0,M._)`"use strict"; ${Kf(r,n)}`),sE(t,n),t.code(o)}):t.func(e,(0,M._)`${H.default.data}, ${rE(n)}`,s.$async,()=>t.code(Kf(r,n)).code(o))}function rE(t){return(0,M._)`{${H.default.instancePath}="", ${H.default.parentData}, ${H.default.parentDataProperty}, ${H.default.rootData}=${H.default.data}${t.dynamicRef?(0,M._)`, ${H.default.dynamicAnchors}={}`:M.nil}}={}`}function sE(t,e){t.if(H.default.valCxt,()=>{t.var(H.default.instancePath,(0,M._)`${H.default.valCxt}.${H.default.instancePath}`),t.var(H.default.parentData,(0,M._)`${H.default.valCxt}.${H.default.parentData}`),t.var(H.default.parentDataProperty,(0,M._)`${H.default.valCxt}.${H.default.parentDataProperty}`),t.var(H.default.rootData,(0,M._)`${H.default.valCxt}.${H.default.rootData}`),e.dynamicRef&&t.var(H.default.dynamicAnchors,(0,M._)`${H.default.valCxt}.${H.default.dynamicAnchors}`)},()=>{t.var(H.default.instancePath,(0,M._)`""`),t.var(H.default.parentData,(0,M._)`undefined`),t.var(H.default.parentDataProperty,(0,M._)`undefined`),t.var(H.default.rootData,H.default.data),e.dynamicRef&&t.var(H.default.dynamicAnchors,(0,M._)`{}`)})}function nE(t){let{schema:e,opts:r,gen:s}=t;Qf(t,()=>{r.$comment&&e.$comment&&nh(t),uE(t),s.let(H.default.vErrors,null),s.let(H.default.errors,0),r.unevaluated&&oE(t),sh(t),pE(t)})}function oE(t){let{gen:e,validateName:r}=t;t.evaluated=e.const("evaluated",(0,M._)`${r}.evaluated`),e.if((0,M._)`${t.evaluated}.dynamicProps`,()=>e.assign((0,M._)`${t.evaluated}.props`,(0,M._)`undefined`)),e.if((0,M._)`${t.evaluated}.dynamicItems`,()=>e.assign((0,M._)`${t.evaluated}.items`,(0,M._)`undefined`))}function Kf(t,e){let r=typeof t=="object"&&t[e.schemaId];return r&&(e.code.source||e.code.process)?(0,M._)`/*# sourceURL=${r} */`:M.nil}function iE(t,e){if(th(t)&&(rh(t),eh(t))){aE(t,e);return}(0,Yf.boolOrEmptySchema)(t,e)}function eh({schema:t,self:e}){if(typeof t=="boolean")return!t;for(let r in t)if(e.RULES.all[r])return!0;return!1}function th(t){return typeof t.schema!="boolean"}function aE(t,e){let{schema:r,gen:s,opts:n}=t;n.$comment&&r.$comment&&nh(t),lE(t),dE(t);let o=s.const("_errs",H.default.errors);sh(t,o),s.var(e,(0,M._)`${o} === ${H.default.errors}`)}function rh(t){(0,Gt.checkUnknownRules)(t),cE(t)}function sh(t,e){if(t.opts.jtd)return Xf(t,[],!1,e);let r=(0,Wf.getSchemaTypes)(t.schema),s=(0,Wf.coerceAndCheckDataType)(t,r);Xf(t,r,!s,e)}function cE(t){let{schema:e,errSchemaPath:r,opts:s,self:n}=t;e.$ref&&s.ignoreKeywordsWithRef&&(0,Gt.schemaHasRulesButRef)(e,n.RULES)&&n.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function uE(t){let{schema:e,opts:r}=t;e.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Gt.checkStrictMode)(t,"default is ignored in the schema root")}function lE(t){let e=t.schema[t.opts.schemaId];e&&(t.baseId=(0,eE.resolveUrl)(t.opts.uriResolver,t.baseId,e))}function dE(t){if(t.schema.$async&&!t.schemaEnv.$async)throw new Error("async schema in sync schema")}function nh({gen:t,schemaEnv:e,schema:r,errSchemaPath:s,opts:n}){let o=r.$comment;if(n.$comment===!0)t.code((0,M._)`${H.default.self}.logger.log(${o})`);else if(typeof n.$comment=="function"){let i=(0,M.str)`${s}/$comment`,a=t.scopeValue("root",{ref:e.root});t.code((0,M._)`${H.default.self}.opts.$comment(${o}, ${i}, ${a}.schema)`)}}function pE(t){let{gen:e,schemaEnv:r,validateName:s,ValidationError:n,opts:o}=t;r.$async?e.if((0,M._)`${H.default.errors} === 0`,()=>e.return(H.default.data),()=>e.throw((0,M._)`new ${n}(${H.default.vErrors})`)):(e.assign((0,M._)`${s}.errors`,H.default.vErrors),o.unevaluated&&mE(t),e.return((0,M._)`${H.default.errors} === 0`))}function mE({gen:t,evaluated:e,props:r,items:s}){r instanceof M.Name&&t.assign((0,M._)`${e}.props`,r),s instanceof M.Name&&t.assign((0,M._)`${e}.items`,s)}function Xf(t,e,r,s){let{gen:n,schema:o,data:i,allErrors:a,opts:c,self:u}=t,{RULES:l}=u;if(o.$ref&&(c.ignoreKeywordsWithRef||!(0,Gt.schemaHasRulesButRef)(o,l))){n.block(()=>ih(t,"$ref",l.all.$ref.definition));return}c.jtd||fE(t,e),n.block(()=>{for(let p of l.rules)d(p);d(l.post)});function d(p){(0,xc.shouldUseGroup)(o,p)&&(p.type?(n.if((0,Oo.checkDataType)(p.type,i,c.strictNumbers)),Jf(t,p),e.length===1&&e[0]===p.type&&r&&(n.else(),(0,Oo.reportTypeError)(t)),n.endIf()):Jf(t,p),a||n.if((0,M._)`${H.default.errors} === ${s||0}`))}}function Jf(t,e){let{gen:r,schema:s,opts:{useDefaults:n}}=t;n&&(0,Qx.assignDefaults)(t,e.type),r.block(()=>{for(let o of e.rules)(0,xc.shouldUseRule)(s,o)&&ih(t,o.keyword,o.definition,e.type)})}function fE(t,e){t.schemaEnv.meta||!t.opts.strictTypes||(hE(t,e),t.opts.allowUnionTypes||_E(t,e),gE(t,t.dataTypes))}function hE(t,e){if(e.length){if(!t.dataTypes.length){t.dataTypes=e;return}e.forEach(r=>{oh(t.dataTypes,r)||Ec(t,`type "${r}" not allowed by context "${t.dataTypes.join(",")}"`)}),vE(t,e)}}function _E(t,e){e.length>1&&!(e.length===2&&e.includes("null"))&&Ec(t,"use allowUnionTypes to allow union type keyword")}function gE(t,e){let r=t.self.RULES.all;for(let s in r){let n=r[s];if(typeof n=="object"&&(0,xc.shouldUseRule)(t.schema,n)){let{type:o}=n.definition;o.length&&!o.some(i=>yE(e,i))&&Ec(t,`missing type "${o.join(",")}" for keyword "${s}"`)}}}function yE(t,e){return t.includes(e)||e==="number"&&t.includes("integer")}function oh(t,e){return t.includes(e)||e==="integer"&&t.includes("number")}function vE(t,e){let r=[];for(let s of t.dataTypes)oh(e,s)?r.push(s):e.includes("integer")&&s==="number"&&r.push("integer");t.dataTypes=r}function Ec(t,e){let r=t.schemaEnv.baseId+t.errSchemaPath;e+=` at "${r}" (strictTypes)`,(0,Gt.checkStrictMode)(t,e,t.opts.strictTypes)}var No=class{constructor(e,r,s){if((0,fn.validateKeywordUsage)(e,r,s),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=s,this.data=e.data,this.schema=e.schema[s],this.$data=r.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Gt.schemaRefOrVal)(e,this.schema,s,this.$data),this.schemaType=r.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=r,this.$data)this.schemaCode=e.gen.const("vSchema",ah(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,fn.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${s} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=e.gen.const("_errs",H.default.errors))}result(e,r,s){this.failResult((0,M.not)(e),r,s)}failResult(e,r,s){this.gen.if(e),s?s():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,r){this.failResult((0,M.not)(e),void 0,r)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);let{schemaCode:r}=this;this.fail((0,M._)`${r} !== undefined && (${(0,M.or)(this.invalid$data(),e)})`)}error(e,r,s){if(r){this.setParams(r),this._error(e,s),this.setParams({});return}this._error(e,s)}_error(e,r){(e?mn.reportExtraError:mn.reportError)(this,this.def.error,r)}$dataError(){(0,mn.reportError)(this,this.def.$dataError||mn.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,mn.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,r){r?Object.assign(this.params,e):this.params=e}block$data(e,r,s=M.nil){this.gen.block(()=>{this.check$data(e,s),r()})}check$data(e=M.nil,r=M.nil){if(!this.$data)return;let{gen:s,schemaCode:n,schemaType:o,def:i}=this;s.if((0,M.or)((0,M._)`${n} === undefined`,r)),e!==M.nil&&s.assign(e,!0),(o.length||i.validateSchema)&&(s.elseIf(this.invalid$data()),this.$dataError(),e!==M.nil&&s.assign(e,!1)),s.else()}invalid$data(){let{gen:e,schemaCode:r,schemaType:s,def:n,it:o}=this;return(0,M.or)(i(),a());function i(){if(s.length){if(!(r instanceof M.Name))throw new Error("ajv implementation error");let c=Array.isArray(s)?s:[s];return(0,M._)`${(0,Oo.checkDataTypes)(c,r,o.opts.strictNumbers,Oo.DataType.Wrong)}`}return M.nil}function a(){if(n.validateSchema){let c=e.scopeValue("validate$data",{ref:n.validateSchema});return(0,M._)`!${c}(${r})`}return M.nil}}subschema(e,r){let s=(0,Sc.getSubschema)(this.it,e);(0,Sc.extendSubschemaData)(s,this.it,e),(0,Sc.extendSubschemaMode)(s,e);let n={...this.it,...s,items:void 0,props:void 0};return iE(n,r),n}mergeEvaluated(e,r){let{it:s,gen:n}=this;s.opts.unevaluated&&(s.props!==!0&&e.props!==void 0&&(s.props=Gt.mergeEvaluated.props(n,e.props,s.props,r)),s.items!==!0&&e.items!==void 0&&(s.items=Gt.mergeEvaluated.items(n,e.items,s.items,r)))}mergeValidEvaluated(e,r){let{it:s,gen:n}=this;if(s.opts.unevaluated&&(s.props!==!0||s.items!==!0))return n.if(r,()=>this.mergeEvaluated(e,M.Name)),!0}};cr.KeywordCxt=No;function ih(t,e,r,s){let n=new No(t,r,e);"code"in r?r.code(n,s):n.$data&&r.validate?(0,fn.funcKeywordCode)(n,r):"macro"in r?(0,fn.macroKeywordCode)(n,r):(r.compile||r.validate)&&(0,fn.funcKeywordCode)(n,r)}var bE=/^\/(?:[^~]|~0|~1)*$/,SE=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function ah(t,{dataLevel:e,dataNames:r,dataPathArr:s}){let n,o;if(t==="")return H.default.rootData;if(t[0]==="/"){if(!bE.test(t))throw new Error(`Invalid JSON-pointer: ${t}`);n=t,o=H.default.rootData}else{let u=SE.exec(t);if(!u)throw new Error(`Invalid JSON-pointer: ${t}`);let l=+u[1];if(n=u[2],n==="#"){if(l>=e)throw new Error(c("property/index",l));return s[e-l]}if(l>e)throw new Error(c("data",l));if(o=r[e-l],!n)return o}let i=o,a=n.split("/");for(let u of a)u&&(o=(0,M._)`${o}${(0,M.getProperty)((0,Gt.unescapeJsonPointer)(u))}`,i=(0,M._)`${i} && ${o}`);return i;function c(u,l){return`Cannot access ${u} ${l} levels up, current level is ${e}`}}cr.getData=ah});var Po=z(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var $c=class extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}};wc.default=$c});var _n=z(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});var Tc=pn(),kc=class extends Error{constructor(e,r,s,n){super(n||`can't resolve reference ${s} from id ${r}`),this.missingRef=(0,Tc.resolveUrl)(e,r,s),this.missingSchema=(0,Tc.normalizeId)((0,Tc.getFullPath)(e,this.missingRef))}};Rc.default=kc});var Ao=z(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.resolveSchema=lt.getCompilingSchema=lt.resolveRef=lt.compileSchema=lt.SchemaEnv=void 0;var gt=J(),xE=Po(),Zr=Ht(),yt=pn(),ch=ae(),EE=hn(),hs=class{constructor(e){var r;this.refs={},this.dynamicAnchors={};let s;typeof e.schema=="object"&&(s=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(r=e.baseId)!==null&&r!==void 0?r:(0,yt.normalizeId)(s?.[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=s?.$async,this.refs={}}};lt.SchemaEnv=hs;function Ic(t){let e=uh.call(this,t);if(e)return e;let r=(0,yt.getFullPath)(this.opts.uriResolver,t.root.baseId),{es5:s,lines:n}=this.opts.code,{ownProperties:o}=this.opts,i=new gt.CodeGen(this.scope,{es5:s,lines:n,ownProperties:o}),a;t.$async&&(a=i.scopeValue("Error",{ref:xE.default,code:(0,gt._)`require("ajv/dist/runtime/validation_error").default`}));let c=i.scopeName("validate");t.validateName=c;let u={gen:i,allErrors:this.opts.allErrors,data:Zr.default.data,parentData:Zr.default.parentData,parentDataProperty:Zr.default.parentDataProperty,dataNames:[Zr.default.data],dataPathArr:[gt.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:t.schema,code:(0,gt.stringify)(t.schema)}:{ref:t.schema}),validateName:c,ValidationError:a,schema:t.schema,schemaEnv:t,rootId:r,baseId:t.baseId||r,schemaPath:gt.nil,errSchemaPath:t.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,gt._)`""`,opts:this.opts,self:this},l;try{this._compilations.add(t),(0,EE.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);let d=i.toString();l=`${i.scopeRefs(Zr.default.scope)}return ${d}`,this.opts.code.process&&(l=this.opts.code.process(l,t));let m=new Function(`${Zr.default.self}`,`${Zr.default.scope}`,l)(this,this.scope.get());if(this.scope.value(c,{ref:m}),m.errors=null,m.schema=t.schema,m.schemaEnv=t,t.$async&&(m.$async=!0),this.opts.code.source===!0&&(m.source={validateName:c,validateCode:d,scopeValues:i._values}),this.opts.unevaluated){let{props:f,items:g}=u;m.evaluated={props:f instanceof gt.Name?void 0:f,items:g instanceof gt.Name?void 0:g,dynamicProps:f instanceof gt.Name,dynamicItems:g instanceof gt.Name},m.source&&(m.source.evaluated=(0,gt.stringify)(m.evaluated))}return t.validate=m,t}catch(d){throw delete t.validate,delete t.validateName,l&&this.logger.error("Error compiling schema, function code:",l),d}finally{this._compilations.delete(t)}}lt.compileSchema=Ic;function $E(t,e,r){var s;r=(0,yt.resolveUrl)(this.opts.uriResolver,e,r);let n=t.refs[r];if(n)return n;let o=kE.call(this,t,r);if(o===void 0){let i=(s=t.localRefs)===null||s===void 0?void 0:s[r],{schemaId:a}=this.opts;i&&(o=new hs({schema:i,schemaId:a,root:t,baseId:e}))}if(o!==void 0)return t.refs[r]=wE.call(this,o)}lt.resolveRef=$E;function wE(t){return(0,yt.inlineRef)(t.schema,this.opts.inlineRefs)?t.schema:t.validate?t:Ic.call(this,t)}function uh(t){for(let e of this._compilations)if(TE(e,t))return e}lt.getCompilingSchema=uh;function TE(t,e){return t.schema===e.schema&&t.root===e.root&&t.baseId===e.baseId}function kE(t,e){let r;for(;typeof(r=this.refs[e])=="string";)e=r;return r||this.schemas[e]||Co.call(this,t,e)}function Co(t,e){let r=this.opts.uriResolver.parse(e),s=(0,yt._getFullPath)(this.opts.uriResolver,r),n=(0,yt.getFullPath)(this.opts.uriResolver,t.baseId,void 0);if(Object.keys(t.schema).length>0&&s===n)return zc.call(this,r,t);let o=(0,yt.normalizeId)(s),i=this.refs[o]||this.schemas[o];if(typeof i=="string"){let a=Co.call(this,t,i);return typeof a?.schema!="object"?void 0:zc.call(this,r,a)}if(typeof i?.schema=="object"){if(i.validate||Ic.call(this,i),o===(0,yt.normalizeId)(e)){let{schema:a}=i,{schemaId:c}=this.opts,u=a[c];return u&&(n=(0,yt.resolveUrl)(this.opts.uriResolver,n,u)),new hs({schema:a,schemaId:c,root:t,baseId:n})}return zc.call(this,r,i)}}lt.resolveSchema=Co;var RE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function zc(t,{baseId:e,schema:r,root:s}){var n;if(((n=t.fragment)===null||n===void 0?void 0:n[0])!=="/")return;for(let a of t.fragment.slice(1).split("/")){if(typeof r=="boolean")return;let c=r[(0,ch.unescapeFragment)(a)];if(c===void 0)return;r=c;let u=typeof r=="object"&&r[this.opts.schemaId];!RE.has(a)&&u&&(e=(0,yt.resolveUrl)(this.opts.uriResolver,e,u))}let o;if(typeof r!="boolean"&&r.$ref&&!(0,ch.schemaHasRulesButRef)(r,this.RULES)){let a=(0,yt.resolveUrl)(this.opts.uriResolver,e,r.$ref);o=Co.call(this,s,a)}let{schemaId:i}=this.opts;if(o=o||new hs({schema:r,schemaId:i,root:s,baseId:e}),o.schema!==o.root.schema)return o}});var lh=z((CP,zE)=>{zE.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var Nc=z((AP,fh)=>{"use strict";var IE=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),ph=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function Oc(t){let e="",r=0,s=0;for(s=0;s<t.length;s++)if(r=t[s].charCodeAt(0),r!==48){if(!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[s];break}for(s+=1;s<t.length;s++){if(r=t[s].charCodeAt(0),!(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102))return"";e+=t[s]}return e}var OE=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function dh(t){return t.length=0,!0}function NE(t,e,r){if(t.length){let s=Oc(t);if(s!=="")e.push(s);else return r.error=!0,!1;t.length=0}return!0}function PE(t){let e=0,r={error:!1,address:"",zone:""},s=[],n=[],o=!1,i=!1,a=NE;for(let c=0;c<t.length;c++){let u=t[c];if(!(u==="["||u==="]"))if(u===":"){if(o===!0&&(i=!0),!a(n,s,r))break;if(++e>7){r.error=!0;break}c>0&&t[c-1]===":"&&(o=!0),s.push(":");continue}else if(u==="%"){if(!a(n,s,r))break;a=dh}else{n.push(u);continue}}return n.length&&(a===dh?r.zone=n.join(""):i?s.push(n.join("")):s.push(Oc(n))),r.address=s.join(""),r}function mh(t){if(CE(t,":")<2)return{host:t,isIPV6:!1};let e=PE(t);if(e.error)return{host:t,isIPV6:!1};{let r=e.address,s=e.address;return e.zone&&(r+="%"+e.zone,s+="%25"+e.zone),{host:r,isIPV6:!0,escapedHost:s}}}function CE(t,e){let r=0;for(let s=0;s<t.length;s++)t[s]===e&&r++;return r}function AE(t){let e=t,r=[],s=-1,n=0;for(;n=e.length;){if(n===1){if(e===".")break;if(e==="/"){r.push("/");break}else{r.push(e);break}}else if(n===2){if(e[0]==="."){if(e[1]===".")break;if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&(e[1]==="."||e[1]==="/")){r.push("/");break}}else if(n===3&&e==="/.."){r.length!==0&&r.pop(),r.push("/");break}if(e[0]==="."){if(e[1]==="."){if(e[2]==="/"){e=e.slice(3);continue}}else if(e[1]==="/"){e=e.slice(2);continue}}else if(e[0]==="/"&&e[1]==="."){if(e[2]==="/"){e=e.slice(2);continue}else if(e[2]==="."&&e[3]==="/"){e=e.slice(3),r.length!==0&&r.pop();continue}}if((s=e.indexOf("/",1))===-1){r.push(e);break}else r.push(e.slice(0,s)),e=e.slice(s)}return r.join("")}function jE(t,e){let r=e!==!0?escape:unescape;return t.scheme!==void 0&&(t.scheme=r(t.scheme)),t.userinfo!==void 0&&(t.userinfo=r(t.userinfo)),t.host!==void 0&&(t.host=r(t.host)),t.path!==void 0&&(t.path=r(t.path)),t.query!==void 0&&(t.query=r(t.query)),t.fragment!==void 0&&(t.fragment=r(t.fragment)),t}function DE(t){let e=[];if(t.userinfo!==void 0&&(e.push(t.userinfo),e.push("@")),t.host!==void 0){let r=unescape(t.host);if(!ph(r)){let s=mh(r);s.isIPV6===!0?r=`[${s.escapedHost}]`:r=t.host}e.push(r)}return(typeof t.port=="number"||typeof t.port=="string")&&(e.push(":"),e.push(String(t.port))),e.length?e.join(""):void 0}fh.exports={nonSimpleDomain:OE,recomposeAuthority:DE,normalizeComponentEncoding:jE,removeDotSegments:AE,isIPv4:ph,isUUID:IE,normalizeIPv6:mh,stringArrayToHexStripped:Oc}});var vh=z((jP,yh)=>{"use strict";var{isUUID:LE}=Nc(),ME=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,qE=["http","https","ws","wss","urn","urn:uuid"];function ZE(t){return qE.indexOf(t)!==-1}function Pc(t){return t.secure===!0?!0:t.secure===!1?!1:t.scheme?t.scheme.length===3&&(t.scheme[0]==="w"||t.scheme[0]==="W")&&(t.scheme[1]==="s"||t.scheme[1]==="S")&&(t.scheme[2]==="s"||t.scheme[2]==="S"):!1}function hh(t){return t.host||(t.error=t.error||"HTTP URIs must have a host."),t}function _h(t){let e=String(t.scheme).toLowerCase()==="https";return(t.port===(e?443:80)||t.port==="")&&(t.port=void 0),t.path||(t.path="/"),t}function UE(t){return t.secure=Pc(t),t.resourceName=(t.path||"/")+(t.query?"?"+t.query:""),t.path=void 0,t.query=void 0,t}function FE(t){if((t.port===(Pc(t)?443:80)||t.port==="")&&(t.port=void 0),typeof t.secure=="boolean"&&(t.scheme=t.secure?"wss":"ws",t.secure=void 0),t.resourceName){let[e,r]=t.resourceName.split("?");t.path=e&&e!=="/"?e:void 0,t.query=r,t.resourceName=void 0}return t.fragment=void 0,t}function VE(t,e){if(!t.path)return t.error="URN can not be parsed",t;let r=t.path.match(ME);if(r){let s=e.scheme||t.scheme||"urn";t.nid=r[1].toLowerCase(),t.nss=r[2];let n=`${s}:${e.nid||t.nid}`,o=Cc(n);t.path=void 0,o&&(t=o.parse(t,e))}else t.error=t.error||"URN can not be parsed.";return t}function BE(t,e){if(t.nid===void 0)throw new Error("URN without nid cannot be serialized");let r=e.scheme||t.scheme||"urn",s=t.nid.toLowerCase(),n=`${r}:${e.nid||s}`,o=Cc(n);o&&(t=o.serialize(t,e));let i=t,a=t.nss;return i.path=`${s||e.nid}:${a}`,e.skipEscape=!0,i}function HE(t,e){let r=t;return r.uuid=r.nss,r.nss=void 0,!e.tolerant&&(!r.uuid||!LE(r.uuid))&&(r.error=r.error||"UUID is not valid."),r}function GE(t){let e=t;return e.nss=(t.uuid||"").toLowerCase(),e}var gh={scheme:"http",domainHost:!0,parse:hh,serialize:_h},WE={scheme:"https",domainHost:gh.domainHost,parse:hh,serialize:_h},jo={scheme:"ws",domainHost:!0,parse:UE,serialize:FE},KE={scheme:"wss",domainHost:jo.domainHost,parse:jo.parse,serialize:jo.serialize},XE={scheme:"urn",parse:VE,serialize:BE,skipNormalize:!0},JE={scheme:"urn:uuid",parse:HE,serialize:GE,skipNormalize:!0},Do={http:gh,https:WE,ws:jo,wss:KE,urn:XE,"urn:uuid":JE};Object.setPrototypeOf(Do,null);function Cc(t){return t&&(Do[t]||Do[t.toLowerCase()])||void 0}yh.exports={wsIsSecure:Pc,SCHEMES:Do,isValidSchemeName:ZE,getSchemeHandler:Cc}});var xh=z((DP,Mo)=>{"use strict";var{normalizeIPv6:YE,removeDotSegments:gn,recomposeAuthority:QE,normalizeComponentEncoding:Lo,isIPv4:e$,nonSimpleDomain:t$}=Nc(),{SCHEMES:r$,getSchemeHandler:bh}=vh();function s$(t,e){return typeof t=="string"?t=Ot(Wt(t,e),e):typeof t=="object"&&(t=Wt(Ot(t,e),e)),t}function n$(t,e,r){let s=r?Object.assign({scheme:"null"},r):{scheme:"null"},n=Sh(Wt(t,s),Wt(e,s),s,!0);return s.skipEscape=!0,Ot(n,s)}function Sh(t,e,r,s){let n={};return s||(t=Wt(Ot(t,r),r),e=Wt(Ot(e,r),r)),r=r||{},!r.tolerant&&e.scheme?(n.scheme=e.scheme,n.userinfo=e.userinfo,n.host=e.host,n.port=e.port,n.path=gn(e.path||""),n.query=e.query):(e.userinfo!==void 0||e.host!==void 0||e.port!==void 0?(n.userinfo=e.userinfo,n.host=e.host,n.port=e.port,n.path=gn(e.path||""),n.query=e.query):(e.path?(e.path[0]==="/"?n.path=gn(e.path):((t.userinfo!==void 0||t.host!==void 0||t.port!==void 0)&&!t.path?n.path="/"+e.path:t.path?n.path=t.path.slice(0,t.path.lastIndexOf("/")+1)+e.path:n.path=e.path,n.path=gn(n.path)),n.query=e.query):(n.path=t.path,e.query!==void 0?n.query=e.query:n.query=t.query),n.userinfo=t.userinfo,n.host=t.host,n.port=t.port),n.scheme=t.scheme),n.fragment=e.fragment,n}function o$(t,e,r){return typeof t=="string"?(t=unescape(t),t=Ot(Lo(Wt(t,r),!0),{...r,skipEscape:!0})):typeof t=="object"&&(t=Ot(Lo(t,!0),{...r,skipEscape:!0})),typeof e=="string"?(e=unescape(e),e=Ot(Lo(Wt(e,r),!0),{...r,skipEscape:!0})):typeof e=="object"&&(e=Ot(Lo(e,!0),{...r,skipEscape:!0})),t.toLowerCase()===e.toLowerCase()}function Ot(t,e){let r={host:t.host,scheme:t.scheme,userinfo:t.userinfo,port:t.port,path:t.path,query:t.query,nid:t.nid,nss:t.nss,uuid:t.uuid,fragment:t.fragment,reference:t.reference,resourceName:t.resourceName,secure:t.secure,error:""},s=Object.assign({},e),n=[],o=bh(s.scheme||r.scheme);o&&o.serialize&&o.serialize(r,s),r.path!==void 0&&(s.skipEscape?r.path=unescape(r.path):(r.path=escape(r.path),r.scheme!==void 0&&(r.path=r.path.split("%3A").join(":")))),s.reference!=="suffix"&&r.scheme&&n.push(r.scheme,":");let i=QE(r);if(i!==void 0&&(s.reference!=="suffix"&&n.push("//"),n.push(i),r.path&&r.path[0]!=="/"&&n.push("/")),r.path!==void 0){let a=r.path;!s.absolutePath&&(!o||!o.absolutePath)&&(a=gn(a)),i===void 0&&a[0]==="/"&&a[1]==="/"&&(a="/%2F"+a.slice(2)),n.push(a)}return r.query!==void 0&&n.push("?",r.query),r.fragment!==void 0&&n.push("#",r.fragment),n.join("")}var i$=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function Wt(t,e){let r=Object.assign({},e),s={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},n=!1;r.reference==="suffix"&&(r.scheme?t=r.scheme+":"+t:t="//"+t);let o=t.match(i$);if(o){if(s.scheme=o[1],s.userinfo=o[3],s.host=o[4],s.port=parseInt(o[5],10),s.path=o[6]||"",s.query=o[7],s.fragment=o[8],isNaN(s.port)&&(s.port=o[5]),s.host)if(e$(s.host)===!1){let c=YE(s.host);s.host=c.host.toLowerCase(),n=c.isIPV6}else n=!0;s.scheme===void 0&&s.userinfo===void 0&&s.host===void 0&&s.port===void 0&&s.query===void 0&&!s.path?s.reference="same-document":s.scheme===void 0?s.reference="relative":s.fragment===void 0?s.reference="absolute":s.reference="uri",r.reference&&r.reference!=="suffix"&&r.reference!==s.reference&&(s.error=s.error||"URI is not a "+r.reference+" reference.");let i=bh(r.scheme||s.scheme);if(!r.unicodeSupport&&(!i||!i.unicodeSupport)&&s.host&&(r.domainHost||i&&i.domainHost)&&n===!1&&t$(s.host))try{s.host=URL.domainToASCII(s.host.toLowerCase())}catch(a){s.error=s.error||"Host's domain name can not be converted to ASCII: "+a}(!i||i&&!i.skipNormalize)&&(t.indexOf("%")!==-1&&(s.scheme!==void 0&&(s.scheme=unescape(s.scheme)),s.host!==void 0&&(s.host=unescape(s.host))),s.path&&(s.path=escape(unescape(s.path))),s.fragment&&(s.fragment=encodeURI(decodeURIComponent(s.fragment)))),i&&i.parse&&i.parse(s,r)}else s.error=s.error||"URI can not be parsed.";return s}var Ac={SCHEMES:r$,normalize:s$,resolve:n$,resolveComponent:Sh,equal:o$,serialize:Ot,parse:Wt};Mo.exports=Ac;Mo.exports.default=Ac;Mo.exports.fastUri=Ac});var $h=z(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});var Eh=xh();Eh.code='require("ajv/dist/runtime/uri").default';jc.default=Eh});var Nh=z(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.CodeGen=Ce.Name=Ce.nil=Ce.stringify=Ce.str=Ce._=Ce.KeywordCxt=void 0;var a$=hn();Object.defineProperty(Ce,"KeywordCxt",{enumerable:!0,get:function(){return a$.KeywordCxt}});var _s=J();Object.defineProperty(Ce,"_",{enumerable:!0,get:function(){return _s._}});Object.defineProperty(Ce,"str",{enumerable:!0,get:function(){return _s.str}});Object.defineProperty(Ce,"stringify",{enumerable:!0,get:function(){return _s.stringify}});Object.defineProperty(Ce,"nil",{enumerable:!0,get:function(){return _s.nil}});Object.defineProperty(Ce,"Name",{enumerable:!0,get:function(){return _s.Name}});Object.defineProperty(Ce,"CodeGen",{enumerable:!0,get:function(){return _s.CodeGen}});var c$=Po(),zh=_n(),u$=dc(),yn=Ao(),l$=J(),vn=pn(),qo=dn(),Lc=ae(),wh=lh(),d$=$h(),Ih=(t,e)=>new RegExp(t,e);Ih.code="new RegExp";var p$=["removeAdditional","useDefaults","coerceTypes"],m$=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),f$={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},h$={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},Th=200;function _$(t){var e,r,s,n,o,i,a,c,u,l,d,p,m,f,g,_,v,$,y,x,E,T,R,j,P;let q=t.strict,Z=(e=t.code)===null||e===void 0?void 0:e.optimize,W=Z===!0||Z===void 0?1:Z||0,le=(s=(r=t.code)===null||r===void 0?void 0:r.regExp)!==null&&s!==void 0?s:Ih,oe=(n=t.uriResolver)!==null&&n!==void 0?n:d$.default;return{strictSchema:(i=(o=t.strictSchema)!==null&&o!==void 0?o:q)!==null&&i!==void 0?i:!0,strictNumbers:(c=(a=t.strictNumbers)!==null&&a!==void 0?a:q)!==null&&c!==void 0?c:!0,strictTypes:(l=(u=t.strictTypes)!==null&&u!==void 0?u:q)!==null&&l!==void 0?l:"log",strictTuples:(p=(d=t.strictTuples)!==null&&d!==void 0?d:q)!==null&&p!==void 0?p:"log",strictRequired:(f=(m=t.strictRequired)!==null&&m!==void 0?m:q)!==null&&f!==void 0?f:!1,code:t.code?{...t.code,optimize:W,regExp:le}:{optimize:W,regExp:le},loopRequired:(g=t.loopRequired)!==null&&g!==void 0?g:Th,loopEnum:(_=t.loopEnum)!==null&&_!==void 0?_:Th,meta:(v=t.meta)!==null&&v!==void 0?v:!0,messages:($=t.messages)!==null&&$!==void 0?$:!0,inlineRefs:(y=t.inlineRefs)!==null&&y!==void 0?y:!0,schemaId:(x=t.schemaId)!==null&&x!==void 0?x:"$id",addUsedSchema:(E=t.addUsedSchema)!==null&&E!==void 0?E:!0,validateSchema:(T=t.validateSchema)!==null&&T!==void 0?T:!0,validateFormats:(R=t.validateFormats)!==null&&R!==void 0?R:!0,unicodeRegExp:(j=t.unicodeRegExp)!==null&&j!==void 0?j:!0,int32range:(P=t.int32range)!==null&&P!==void 0?P:!0,uriResolver:oe}}var bn=class{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,..._$(e)};let{es5:r,lines:s}=this.opts.code;this.scope=new l$.ValueScope({scope:{},prefixes:m$,es5:r,lines:s}),this.logger=x$(e.logger);let n=e.validateFormats;e.validateFormats=!1,this.RULES=(0,u$.getRules)(),kh.call(this,f$,e,"NOT SUPPORTED"),kh.call(this,h$,e,"DEPRECATED","warn"),this._metaOpts=b$.call(this),e.formats&&y$.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&v$.call(this,e.keywords),typeof e.meta=="object"&&this.addMetaSchema(e.meta),g$.call(this),e.validateFormats=n}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:e,meta:r,schemaId:s}=this.opts,n=wh;s==="id"&&(n={...wh},n.id=n.$id,delete n.$id),r&&e&&this.addMetaSchema(n,n[s],!1)}defaultMeta(){let{meta:e,schemaId:r}=this.opts;return this.opts.defaultMeta=typeof e=="object"?e[r]||e:void 0}validate(e,r){let s;if(typeof e=="string"){if(s=this.getSchema(e),!s)throw new Error(`no schema with key or ref "${e}"`)}else s=this.compile(e);let n=s(r);return"$async"in s||(this.errors=s.errors),n}compile(e,r){let s=this._addSchema(e,r);return s.validate||this._compileSchemaEnv(s)}compileAsync(e,r){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");let{loadSchema:s}=this.opts;return n.call(this,e,r);async function n(l,d){await o.call(this,l.$schema);let p=this._addSchema(l,d);return p.validate||i.call(this,p)}async function o(l){l&&!this.getSchema(l)&&await n.call(this,{$ref:l},!0)}async function i(l){try{return this._compileSchemaEnv(l)}catch(d){if(!(d instanceof zh.default))throw d;return a.call(this,d),await c.call(this,d.missingSchema),i.call(this,l)}}function a({missingSchema:l,missingRef:d}){if(this.refs[l])throw new Error(`AnySchema ${l} is loaded but ${d} cannot be resolved`)}async function c(l){let d=await u.call(this,l);this.refs[l]||await o.call(this,d.$schema),this.refs[l]||this.addSchema(d,l,r)}async function u(l){let d=this._loading[l];if(d)return d;try{return await(this._loading[l]=s(l))}finally{delete this._loading[l]}}}addSchema(e,r,s,n=this.opts.validateSchema){if(Array.isArray(e)){for(let i of e)this.addSchema(i,void 0,s,n);return this}let o;if(typeof e=="object"){let{schemaId:i}=this.opts;if(o=e[i],o!==void 0&&typeof o!="string")throw new Error(`schema ${i} must be string`)}return r=(0,vn.normalizeId)(r||o),this._checkUnique(r),this.schemas[r]=this._addSchema(e,s,r,n,!0),this}addMetaSchema(e,r,s=this.opts.validateSchema){return this.addSchema(e,r,!0,s),this}validateSchema(e,r){if(typeof e=="boolean")return!0;let s;if(s=e.$schema,s!==void 0&&typeof s!="string")throw new Error("$schema must be a string");if(s=s||this.opts.defaultMeta||this.defaultMeta(),!s)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let n=this.validate(s,e);if(!n&&r){let o="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(o);else throw new Error(o)}return n}getSchema(e){let r;for(;typeof(r=Rh.call(this,e))=="string";)e=r;if(r===void 0){let{schemaId:s}=this.opts,n=new yn.SchemaEnv({schema:{},schemaId:s});if(r=yn.resolveSchema.call(this,n,e),!r)return;this.refs[e]=r}return r.validate||this._compileSchemaEnv(r)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let r=Rh.call(this,e);return typeof r=="object"&&this._cache.delete(r.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{let r=e;this._cache.delete(r);let s=e[this.opts.schemaId];return s&&(s=(0,vn.normalizeId)(s),delete this.schemas[s],delete this.refs[s]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(let r of e)this.addKeyword(r);return this}addKeyword(e,r){let s;if(typeof e=="string")s=e,typeof r=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),r.keyword=s);else if(typeof e=="object"&&r===void 0){if(r=e,s=r.keyword,Array.isArray(s)&&!s.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if($$.call(this,s,r),!r)return(0,Lc.eachItem)(s,o=>Dc.call(this,o)),this;T$.call(this,r);let n={...r,type:(0,qo.getJSONTypes)(r.type),schemaType:(0,qo.getJSONTypes)(r.schemaType)};return(0,Lc.eachItem)(s,n.type.length===0?o=>Dc.call(this,o,n):o=>n.type.forEach(i=>Dc.call(this,o,n,i))),this}getKeyword(e){let r=this.RULES.all[e];return typeof r=="object"?r.definition:!!r}removeKeyword(e){let{RULES:r}=this;delete r.keywords[e],delete r.all[e];for(let s of r.rules){let n=s.rules.findIndex(o=>o.keyword===e);n>=0&&s.rules.splice(n,1)}return this}addFormat(e,r){return typeof r=="string"&&(r=new RegExp(r)),this.formats[e]=r,this}errorsText(e=this.errors,{separator:r=", ",dataVar:s="data"}={}){return!e||e.length===0?"No errors":e.map(n=>`${s}${n.instancePath} ${n.message}`).reduce((n,o)=>n+r+o)}$dataMetaSchema(e,r){let s=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(let n of r){let o=n.split("/").slice(1),i=e;for(let a of o)i=i[a];for(let a in s){let c=s[a];if(typeof c!="object")continue;let{$data:u}=c.definition,l=i[a];u&&l&&(i[a]=Oh(l))}}return e}_removeAllSchemas(e,r){for(let s in e){let n=e[s];(!r||r.test(s))&&(typeof n=="string"?delete e[s]:n&&!n.meta&&(this._cache.delete(n.schema),delete e[s]))}}_addSchema(e,r,s,n=this.opts.validateSchema,o=this.opts.addUsedSchema){let i,{schemaId:a}=this.opts;if(typeof e=="object")i=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof e!="boolean")throw new Error("schema must be object or boolean")}let c=this._cache.get(e);if(c!==void 0)return c;s=(0,vn.normalizeId)(i||s);let u=vn.getSchemaRefs.call(this,e,s);return c=new yn.SchemaEnv({schema:e,schemaId:a,meta:r,baseId:s,localRefs:u}),this._cache.set(c.schema,c),o&&!s.startsWith("#")&&(s&&this._checkUnique(s),this.refs[s]=c),n&&this.validateSchema(e,!0),c}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):yn.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){let r=this.opts;this.opts=this._metaOpts;try{yn.compileSchema.call(this,e)}finally{this.opts=r}}};bn.ValidationError=c$.default;bn.MissingRefError=zh.default;Ce.default=bn;function kh(t,e,r,s="error"){for(let n in t){let o=n;o in e&&this.logger[s](`${r}: option ${n}. ${t[o]}`)}}function Rh(t){return t=(0,vn.normalizeId)(t),this.schemas[t]||this.refs[t]}function g$(){let t=this.opts.schemas;if(t)if(Array.isArray(t))this.addSchema(t);else for(let e in t)this.addSchema(t[e],e)}function y$(){for(let t in this.opts.formats){let e=this.opts.formats[t];e&&this.addFormat(t,e)}}function v$(t){if(Array.isArray(t)){this.addVocabulary(t);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let e in t){let r=t[e];r.keyword||(r.keyword=e),this.addKeyword(r)}}function b$(){let t={...this.opts};for(let e of p$)delete t[e];return t}var S$={log(){},warn(){},error(){}};function x$(t){if(t===!1)return S$;if(t===void 0)return console;if(t.log&&t.warn&&t.error)return t;throw new Error("logger must implement log, warn and error methods")}var E$=/^[a-z_$][a-z0-9_$:-]*$/i;function $$(t,e){let{RULES:r}=this;if((0,Lc.eachItem)(t,s=>{if(r.keywords[s])throw new Error(`Keyword ${s} is already defined`);if(!E$.test(s))throw new Error(`Keyword ${s} has invalid name`)}),!!e&&e.$data&&!("code"in e||"validate"in e))throw new Error('$data keyword must have "code" or "validate" function')}function Dc(t,e,r){var s;let n=e?.post;if(r&&n)throw new Error('keyword with "post" flag cannot have "type"');let{RULES:o}=this,i=n?o.post:o.rules.find(({type:c})=>c===r);if(i||(i={type:r,rules:[]},o.rules.push(i)),o.keywords[t]=!0,!e)return;let a={keyword:t,definition:{...e,type:(0,qo.getJSONTypes)(e.type),schemaType:(0,qo.getJSONTypes)(e.schemaType)}};e.before?w$.call(this,i,a,e.before):i.rules.push(a),o.all[t]=a,(s=e.implements)===null||s===void 0||s.forEach(c=>this.addKeyword(c))}function w$(t,e,r){let s=t.rules.findIndex(n=>n.keyword===r);s>=0?t.rules.splice(s,0,e):(t.rules.push(e),this.logger.warn(`rule ${r} is not defined`))}function T$(t){let{metaSchema:e}=t;e!==void 0&&(t.$data&&this.opts.$data&&(e=Oh(e)),t.validateSchema=this.compile(e,!0))}var k$={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Oh(t){return{anyOf:[t,k$]}}});var Ph=z(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});var R$={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Mc.default=R$});var Dh=z(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.callRef=Ur.getValidate=void 0;var z$=_n(),Ch=ut(),et=J(),gs=Ht(),Ah=Ao(),Zo=ae(),I$={keyword:"$ref",schemaType:"string",code(t){let{gen:e,schema:r,it:s}=t,{baseId:n,schemaEnv:o,validateName:i,opts:a,self:c}=s,{root:u}=o;if((r==="#"||r==="#/")&&n===u.baseId)return d();let l=Ah.resolveRef.call(c,u,n,r);if(l===void 0)throw new z$.default(s.opts.uriResolver,n,r);if(l instanceof Ah.SchemaEnv)return p(l);return m(l);function d(){if(o===u)return Uo(t,i,o,o.$async);let f=e.scopeValue("root",{ref:u});return Uo(t,(0,et._)`${f}.validate`,u,u.$async)}function p(f){let g=jh(t,f);Uo(t,g,f,f.$async)}function m(f){let g=e.scopeValue("schema",a.code.source===!0?{ref:f,code:(0,et.stringify)(f)}:{ref:f}),_=e.name("valid"),v=t.subschema({schema:f,dataTypes:[],schemaPath:et.nil,topSchemaRef:g,errSchemaPath:r},_);t.mergeEvaluated(v),t.ok(_)}}};function jh(t,e){let{gen:r}=t;return e.validate?r.scopeValue("validate",{ref:e.validate}):(0,et._)`${r.scopeValue("wrapper",{ref:e})}.validate`}Ur.getValidate=jh;function Uo(t,e,r,s){let{gen:n,it:o}=t,{allErrors:i,schemaEnv:a,opts:c}=o,u=c.passContext?gs.default.this:et.nil;s?l():d();function l(){if(!a.$async)throw new Error("async schema referenced by sync schema");let f=n.let("valid");n.try(()=>{n.code((0,et._)`await ${(0,Ch.callValidateCode)(t,e,u)}`),m(e),i||n.assign(f,!0)},g=>{n.if((0,et._)`!(${g} instanceof ${o.ValidationError})`,()=>n.throw(g)),p(g),i||n.assign(f,!1)}),t.ok(f)}function d(){t.result((0,Ch.callValidateCode)(t,e,u),()=>m(e),()=>p(e))}function p(f){let g=(0,et._)`${f}.errors`;n.assign(gs.default.vErrors,(0,et._)`${gs.default.vErrors} === null ? ${g} : ${gs.default.vErrors}.concat(${g})`),n.assign(gs.default.errors,(0,et._)`${gs.default.vErrors}.length`)}function m(f){var g;if(!o.opts.unevaluated)return;let _=(g=r?.validate)===null||g===void 0?void 0:g.evaluated;if(o.props!==!0)if(_&&!_.dynamicProps)_.props!==void 0&&(o.props=Zo.mergeEvaluated.props(n,_.props,o.props));else{let v=n.var("props",(0,et._)`${f}.evaluated.props`);o.props=Zo.mergeEvaluated.props(n,v,o.props,et.Name)}if(o.items!==!0)if(_&&!_.dynamicItems)_.items!==void 0&&(o.items=Zo.mergeEvaluated.items(n,_.items,o.items));else{let v=n.var("items",(0,et._)`${f}.evaluated.items`);o.items=Zo.mergeEvaluated.items(n,v,o.items,et.Name)}}}Ur.callRef=Uo;Ur.default=I$});var Lh=z(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});var O$=Ph(),N$=Dh(),P$=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",O$.default,N$.default];qc.default=P$});var Mh=z(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});var Fo=J(),ur=Fo.operators,Vo={maximum:{okStr:"<=",ok:ur.LTE,fail:ur.GT},minimum:{okStr:">=",ok:ur.GTE,fail:ur.LT},exclusiveMaximum:{okStr:"<",ok:ur.LT,fail:ur.GTE},exclusiveMinimum:{okStr:">",ok:ur.GT,fail:ur.LTE}},C$={message:({keyword:t,schemaCode:e})=>(0,Fo.str)`must be ${Vo[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,Fo._)`{comparison: ${Vo[t].okStr}, limit: ${e}}`},A$={keyword:Object.keys(Vo),type:"number",schemaType:"number",$data:!0,error:C$,code(t){let{keyword:e,data:r,schemaCode:s}=t;t.fail$data((0,Fo._)`${r} ${Vo[e].fail} ${s} || isNaN(${r})`)}};Zc.default=A$});var qh=z(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});var Sn=J(),j$={message:({schemaCode:t})=>(0,Sn.str)`must be multiple of ${t}`,params:({schemaCode:t})=>(0,Sn._)`{multipleOf: ${t}}`},D$={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:j$,code(t){let{gen:e,data:r,schemaCode:s,it:n}=t,o=n.opts.multipleOfPrecision,i=e.let("res"),a=o?(0,Sn._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${o}`:(0,Sn._)`${i} !== parseInt(${i})`;t.fail$data((0,Sn._)`(${s} === 0 || (${i} = ${r}/${s}, ${a}))`)}};Uc.default=D$});var Uh=z(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});function Zh(t){let e=t.length,r=0,s=0,n;for(;s<e;)r++,n=t.charCodeAt(s++),n>=55296&&n<=56319&&s<e&&(n=t.charCodeAt(s),(n&64512)===56320&&s++);return r}Fc.default=Zh;Zh.code='require("ajv/dist/runtime/ucs2length").default'});var Fh=z(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});var Fr=J(),L$=ae(),M$=Uh(),q$={message({keyword:t,schemaCode:e}){let r=t==="maxLength"?"more":"fewer";return(0,Fr.str)`must NOT have ${r} than ${e} characters`},params:({schemaCode:t})=>(0,Fr._)`{limit: ${t}}`},Z$={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:q$,code(t){let{keyword:e,data:r,schemaCode:s,it:n}=t,o=e==="maxLength"?Fr.operators.GT:Fr.operators.LT,i=n.opts.unicode===!1?(0,Fr._)`${r}.length`:(0,Fr._)`${(0,L$.useFunc)(t.gen,M$.default)}(${r})`;t.fail$data((0,Fr._)`${i} ${o} ${s}`)}};Vc.default=Z$});var Vh=z(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});var U$=ut(),Bo=J(),F$={message:({schemaCode:t})=>(0,Bo.str)`must match pattern "${t}"`,params:({schemaCode:t})=>(0,Bo._)`{pattern: ${t}}`},V$={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:F$,code(t){let{data:e,$data:r,schema:s,schemaCode:n,it:o}=t,i=o.opts.unicodeRegExp?"u":"",a=r?(0,Bo._)`(new RegExp(${n}, ${i}))`:(0,U$.usePattern)(t,s);t.fail$data((0,Bo._)`!${a}.test(${e})`)}};Bc.default=V$});var Bh=z(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});var xn=J(),B$={message({keyword:t,schemaCode:e}){let r=t==="maxProperties"?"more":"fewer";return(0,xn.str)`must NOT have ${r} than ${e} properties`},params:({schemaCode:t})=>(0,xn._)`{limit: ${t}}`},H$={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:B$,code(t){let{keyword:e,data:r,schemaCode:s}=t,n=e==="maxProperties"?xn.operators.GT:xn.operators.LT;t.fail$data((0,xn._)`Object.keys(${r}).length ${n} ${s}`)}};Hc.default=H$});var Hh=z(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});var En=ut(),$n=J(),G$=ae(),W$={message:({params:{missingProperty:t}})=>(0,$n.str)`must have required property '${t}'`,params:({params:{missingProperty:t}})=>(0,$n._)`{missingProperty: ${t}}`},K$={keyword:"required",type:"object",schemaType:"array",$data:!0,error:W$,code(t){let{gen:e,schema:r,schemaCode:s,data:n,$data:o,it:i}=t,{opts:a}=i;if(!o&&r.length===0)return;let c=r.length>=a.loopRequired;if(i.allErrors?u():l(),a.strictRequired){let m=t.parentSchema.properties,{definedProperties:f}=t.it;for(let g of r)if(m?.[g]===void 0&&!f.has(g)){let _=i.schemaEnv.baseId+i.errSchemaPath,v=`required property "${g}" is not defined at "${_}" (strictRequired)`;(0,G$.checkStrictMode)(i,v,i.opts.strictRequired)}}function u(){if(c||o)t.block$data($n.nil,d);else for(let m of r)(0,En.checkReportMissingProp)(t,m)}function l(){let m=e.let("missing");if(c||o){let f=e.let("valid",!0);t.block$data(f,()=>p(m,f)),t.ok(f)}else e.if((0,En.checkMissingProp)(t,r,m)),(0,En.reportMissingProp)(t,m),e.else()}function d(){e.forOf("prop",s,m=>{t.setParams({missingProperty:m}),e.if((0,En.noPropertyInData)(e,n,m,a.ownProperties),()=>t.error())})}function p(m,f){t.setParams({missingProperty:m}),e.forOf(m,s,()=>{e.assign(f,(0,En.propertyInData)(e,n,m,a.ownProperties)),e.if((0,$n.not)(f),()=>{t.error(),e.break()})},$n.nil)}}};Gc.default=K$});var Gh=z(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});var wn=J(),X$={message({keyword:t,schemaCode:e}){let r=t==="maxItems"?"more":"fewer";return(0,wn.str)`must NOT have ${r} than ${e} items`},params:({schemaCode:t})=>(0,wn._)`{limit: ${t}}`},J$={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:X$,code(t){let{keyword:e,data:r,schemaCode:s}=t,n=e==="maxItems"?wn.operators.GT:wn.operators.LT;t.fail$data((0,wn._)`${r}.length ${n} ${s}`)}};Wc.default=J$});var Ho=z(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});var Wh=vc();Wh.code='require("ajv/dist/runtime/equal").default';Kc.default=Wh});var Kh=z(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});var Xc=dn(),Ae=J(),Y$=ae(),Q$=Ho(),ew={message:({params:{i:t,j:e}})=>(0,Ae.str)`must NOT have duplicate items (items ## ${e} and ${t} are identical)`,params:({params:{i:t,j:e}})=>(0,Ae._)`{i: ${t}, j: ${e}}`},tw={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:ew,code(t){let{gen:e,data:r,$data:s,schema:n,parentSchema:o,schemaCode:i,it:a}=t;if(!s&&!n)return;let c=e.let("valid"),u=o.items?(0,Xc.getSchemaTypes)(o.items):[];t.block$data(c,l,(0,Ae._)`${i} === false`),t.ok(c);function l(){let f=e.let("i",(0,Ae._)`${r}.length`),g=e.let("j");t.setParams({i:f,j:g}),e.assign(c,!0),e.if((0,Ae._)`${f} > 1`,()=>(d()?p:m)(f,g))}function d(){return u.length>0&&!u.some(f=>f==="object"||f==="array")}function p(f,g){let _=e.name("item"),v=(0,Xc.checkDataTypes)(u,_,a.opts.strictNumbers,Xc.DataType.Wrong),$=e.const("indices",(0,Ae._)`{}`);e.for((0,Ae._)`;${f}--;`,()=>{e.let(_,(0,Ae._)`${r}[${f}]`),e.if(v,(0,Ae._)`continue`),u.length>1&&e.if((0,Ae._)`typeof ${_} == "string"`,(0,Ae._)`${_} += "_"`),e.if((0,Ae._)`typeof ${$}[${_}] == "number"`,()=>{e.assign(g,(0,Ae._)`${$}[${_}]`),t.error(),e.assign(c,!1).break()}).code((0,Ae._)`${$}[${_}] = ${f}`)})}function m(f,g){let _=(0,Y$.useFunc)(e,Q$.default),v=e.name("outer");e.label(v).for((0,Ae._)`;${f}--;`,()=>e.for((0,Ae._)`${g} = ${f}; ${g}--;`,()=>e.if((0,Ae._)`${_}(${r}[${f}], ${r}[${g}])`,()=>{t.error(),e.assign(c,!1).break(v)})))}}};Jc.default=tw});var Xh=z(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});var Yc=J(),rw=ae(),sw=Ho(),nw={message:"must be equal to constant",params:({schemaCode:t})=>(0,Yc._)`{allowedValue: ${t}}`},ow={keyword:"const",$data:!0,error:nw,code(t){let{gen:e,data:r,$data:s,schemaCode:n,schema:o}=t;s||o&&typeof o=="object"?t.fail$data((0,Yc._)`!${(0,rw.useFunc)(e,sw.default)}(${r}, ${n})`):t.fail((0,Yc._)`${o} !== ${r}`)}};Qc.default=ow});var Jh=z(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});var Tn=J(),iw=ae(),aw=Ho(),cw={message:"must be equal to one of the allowed values",params:({schemaCode:t})=>(0,Tn._)`{allowedValues: ${t}}`},uw={keyword:"enum",schemaType:"array",$data:!0,error:cw,code(t){let{gen:e,data:r,$data:s,schema:n,schemaCode:o,it:i}=t;if(!s&&n.length===0)throw new Error("enum must have non-empty array");let a=n.length>=i.opts.loopEnum,c,u=()=>c??(c=(0,iw.useFunc)(e,aw.default)),l;if(a||s)l=e.let("valid"),t.block$data(l,d);else{if(!Array.isArray(n))throw new Error("ajv implementation error");let m=e.const("vSchema",o);l=(0,Tn.or)(...n.map((f,g)=>p(m,g)))}t.pass(l);function d(){e.assign(l,!1),e.forOf("v",o,m=>e.if((0,Tn._)`${u()}(${r}, ${m})`,()=>e.assign(l,!0).break()))}function p(m,f){let g=n[f];return typeof g=="object"&&g!==null?(0,Tn._)`${u()}(${r}, ${m}[${f}])`:(0,Tn._)`${r} === ${g}`}}};eu.default=uw});var Yh=z(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});var lw=Mh(),dw=qh(),pw=Fh(),mw=Vh(),fw=Bh(),hw=Hh(),_w=Gh(),gw=Kh(),yw=Xh(),vw=Jh(),bw=[lw.default,dw.default,pw.default,mw.default,fw.default,hw.default,_w.default,gw.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},yw.default,vw.default];tu.default=bw});var su=z(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.validateAdditionalItems=void 0;var Vr=J(),ru=ae(),Sw={message:({params:{len:t}})=>(0,Vr.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,Vr._)`{limit: ${t}}`},xw={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Sw,code(t){let{parentSchema:e,it:r}=t,{items:s}=e;if(!Array.isArray(s)){(0,ru.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}Qh(t,s)}};function Qh(t,e){let{gen:r,schema:s,data:n,keyword:o,it:i}=t;i.items=!0;let a=r.const("len",(0,Vr._)`${n}.length`);if(s===!1)t.setParams({len:e.length}),t.pass((0,Vr._)`${a} <= ${e.length}`);else if(typeof s=="object"&&!(0,ru.alwaysValidSchema)(i,s)){let u=r.var("valid",(0,Vr._)`${a} <= ${e.length}`);r.if((0,Vr.not)(u),()=>c(u)),t.ok(u)}function c(u){r.forRange("i",e.length,a,l=>{t.subschema({keyword:o,dataProp:l,dataPropType:ru.Type.Num},u),i.allErrors||r.if((0,Vr.not)(u),()=>r.break())})}}kn.validateAdditionalItems=Qh;kn.default=xw});var nu=z(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.validateTuple=void 0;var e_=J(),Go=ae(),Ew=ut(),$w={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(t){let{schema:e,it:r}=t;if(Array.isArray(e))return t_(t,"additionalItems",e);r.items=!0,!(0,Go.alwaysValidSchema)(r,e)&&t.ok((0,Ew.validateArray)(t))}};function t_(t,e,r=t.schema){let{gen:s,parentSchema:n,data:o,keyword:i,it:a}=t;l(n),a.opts.unevaluated&&r.length&&a.items!==!0&&(a.items=Go.mergeEvaluated.items(s,r.length,a.items));let c=s.name("valid"),u=s.const("len",(0,e_._)`${o}.length`);r.forEach((d,p)=>{(0,Go.alwaysValidSchema)(a,d)||(s.if((0,e_._)`${u} > ${p}`,()=>t.subschema({keyword:i,schemaProp:p,dataProp:p},c)),t.ok(c))});function l(d){let{opts:p,errSchemaPath:m}=a,f=r.length,g=f===d.minItems&&(f===d.maxItems||d[e]===!1);if(p.strictTuples&&!g){let _=`"${i}" is ${f}-tuple, but minItems or maxItems/${e} are not specified or different at path "${m}"`;(0,Go.checkStrictMode)(a,_,p.strictTuples)}}}Rn.validateTuple=t_;Rn.default=$w});var r_=z(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});var ww=nu(),Tw={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:t=>(0,ww.validateTuple)(t,"items")};ou.default=Tw});var n_=z(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});var s_=J(),kw=ae(),Rw=ut(),zw=su(),Iw={message:({params:{len:t}})=>(0,s_.str)`must NOT have more than ${t} items`,params:({params:{len:t}})=>(0,s_._)`{limit: ${t}}`},Ow={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Iw,code(t){let{schema:e,parentSchema:r,it:s}=t,{prefixItems:n}=r;s.items=!0,!(0,kw.alwaysValidSchema)(s,e)&&(n?(0,zw.validateAdditionalItems)(t,n):t.ok((0,Rw.validateArray)(t)))}};iu.default=Ow});var o_=z(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});var dt=J(),Wo=ae(),Nw={message:({params:{min:t,max:e}})=>e===void 0?(0,dt.str)`must contain at least ${t} valid item(s)`:(0,dt.str)`must contain at least ${t} and no more than ${e} valid item(s)`,params:({params:{min:t,max:e}})=>e===void 0?(0,dt._)`{minContains: ${t}}`:(0,dt._)`{minContains: ${t}, maxContains: ${e}}`},Pw={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:Nw,code(t){let{gen:e,schema:r,parentSchema:s,data:n,it:o}=t,i,a,{minContains:c,maxContains:u}=s;o.opts.next?(i=c===void 0?1:c,a=u):i=1;let l=e.const("len",(0,dt._)`${n}.length`);if(t.setParams({min:i,max:a}),a===void 0&&i===0){(0,Wo.checkStrictMode)(o,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(a!==void 0&&i>a){(0,Wo.checkStrictMode)(o,'"minContains" > "maxContains" is always invalid'),t.fail();return}if((0,Wo.alwaysValidSchema)(o,r)){let g=(0,dt._)`${l} >= ${i}`;a!==void 0&&(g=(0,dt._)`${g} && ${l} <= ${a}`),t.pass(g);return}o.items=!0;let d=e.name("valid");a===void 0&&i===1?m(d,()=>e.if(d,()=>e.break())):i===0?(e.let(d,!0),a!==void 0&&e.if((0,dt._)`${n}.length > 0`,p)):(e.let(d,!1),p()),t.result(d,()=>t.reset());function p(){let g=e.name("_valid"),_=e.let("count",0);m(g,()=>e.if(g,()=>f(_)))}function m(g,_){e.forRange("i",0,l,v=>{t.subschema({keyword:"contains",dataProp:v,dataPropType:Wo.Type.Num,compositeRule:!0},g),_()})}function f(g){e.code((0,dt._)`${g}++`),a===void 0?e.if((0,dt._)`${g} >= ${i}`,()=>e.assign(d,!0).break()):(e.if((0,dt._)`${g} > ${a}`,()=>e.assign(d,!1).break()),i===1?e.assign(d,!0):e.if((0,dt._)`${g} >= ${i}`,()=>e.assign(d,!0)))}}};au.default=Pw});var c_=z(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.validateSchemaDeps=Nt.validatePropertyDeps=Nt.error=void 0;var cu=J(),Cw=ae(),zn=ut();Nt.error={message:({params:{property:t,depsCount:e,deps:r}})=>{let s=e===1?"property":"properties";return(0,cu.str)`must have ${s} ${r} when property ${t} is present`},params:({params:{property:t,depsCount:e,deps:r,missingProperty:s}})=>(0,cu._)`{property: ${t},
    missingProperty: ${s},
    depsCount: ${e},
    deps: ${r}}`};var Aw={keyword:"dependencies",type:"object",schemaType:"object",error:Nt.error,code(t){let[e,r]=jw(t);i_(t,e),a_(t,r)}};function jw({schema:t}){let e={},r={};for(let s in t){if(s==="__proto__")continue;let n=Array.isArray(t[s])?e:r;n[s]=t[s]}return[e,r]}function i_(t,e=t.schema){let{gen:r,data:s,it:n}=t;if(Object.keys(e).length===0)return;let o=r.let("missing");for(let i in e){let a=e[i];if(a.length===0)continue;let c=(0,zn.propertyInData)(r,s,i,n.opts.ownProperties);t.setParams({property:i,depsCount:a.length,deps:a.join(", ")}),n.allErrors?r.if(c,()=>{for(let u of a)(0,zn.checkReportMissingProp)(t,u)}):(r.if((0,cu._)`${c} && (${(0,zn.checkMissingProp)(t,a,o)})`),(0,zn.reportMissingProp)(t,o),r.else())}}Nt.validatePropertyDeps=i_;function a_(t,e=t.schema){let{gen:r,data:s,keyword:n,it:o}=t,i=r.name("valid");for(let a in e)(0,Cw.alwaysValidSchema)(o,e[a])||(r.if((0,zn.propertyInData)(r,s,a,o.opts.ownProperties),()=>{let c=t.subschema({keyword:n,schemaProp:a},i);t.mergeValidEvaluated(c,i)},()=>r.var(i,!0)),t.ok(i))}Nt.validateSchemaDeps=a_;Nt.default=Aw});var l_=z(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});var u_=J(),Dw=ae(),Lw={message:"property name must be valid",params:({params:t})=>(0,u_._)`{propertyName: ${t.propertyName}}`},Mw={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:Lw,code(t){let{gen:e,schema:r,data:s,it:n}=t;if((0,Dw.alwaysValidSchema)(n,r))return;let o=e.name("valid");e.forIn("key",s,i=>{t.setParams({propertyName:i}),t.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},o),e.if((0,u_.not)(o),()=>{t.error(!0),n.allErrors||e.break()})}),t.ok(o)}};uu.default=Mw});var du=z(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});var Ko=ut(),vt=J(),qw=Ht(),Xo=ae(),Zw={message:"must NOT have additional properties",params:({params:t})=>(0,vt._)`{additionalProperty: ${t.additionalProperty}}`},Uw={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Zw,code(t){let{gen:e,schema:r,parentSchema:s,data:n,errsCount:o,it:i}=t;if(!o)throw new Error("ajv implementation error");let{allErrors:a,opts:c}=i;if(i.props=!0,c.removeAdditional!=="all"&&(0,Xo.alwaysValidSchema)(i,r))return;let u=(0,Ko.allSchemaProperties)(s.properties),l=(0,Ko.allSchemaProperties)(s.patternProperties);d(),t.ok((0,vt._)`${o} === ${qw.default.errors}`);function d(){e.forIn("key",n,_=>{!u.length&&!l.length?f(_):e.if(p(_),()=>f(_))})}function p(_){let v;if(u.length>8){let $=(0,Xo.schemaRefOrVal)(i,s.properties,"properties");v=(0,Ko.isOwnProperty)(e,$,_)}else u.length?v=(0,vt.or)(...u.map($=>(0,vt._)`${_} === ${$}`)):v=vt.nil;return l.length&&(v=(0,vt.or)(v,...l.map($=>(0,vt._)`${(0,Ko.usePattern)(t,$)}.test(${_})`))),(0,vt.not)(v)}function m(_){e.code((0,vt._)`delete ${n}[${_}]`)}function f(_){if(c.removeAdditional==="all"||c.removeAdditional&&r===!1){m(_);return}if(r===!1){t.setParams({additionalProperty:_}),t.error(),a||e.break();return}if(typeof r=="object"&&!(0,Xo.alwaysValidSchema)(i,r)){let v=e.name("valid");c.removeAdditional==="failing"?(g(_,v,!1),e.if((0,vt.not)(v),()=>{t.reset(),m(_)})):(g(_,v),a||e.if((0,vt.not)(v),()=>e.break()))}}function g(_,v,$){let y={keyword:"additionalProperties",dataProp:_,dataPropType:Xo.Type.Str};$===!1&&Object.assign(y,{compositeRule:!0,createErrors:!1,allErrors:!1}),t.subschema(y,v)}}};lu.default=Uw});var m_=z(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});var Fw=hn(),d_=ut(),pu=ae(),p_=du(),Vw={keyword:"properties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,parentSchema:s,data:n,it:o}=t;o.opts.removeAdditional==="all"&&s.additionalProperties===void 0&&p_.default.code(new Fw.KeywordCxt(o,p_.default,"additionalProperties"));let i=(0,d_.allSchemaProperties)(r);for(let d of i)o.definedProperties.add(d);o.opts.unevaluated&&i.length&&o.props!==!0&&(o.props=pu.mergeEvaluated.props(e,(0,pu.toHash)(i),o.props));let a=i.filter(d=>!(0,pu.alwaysValidSchema)(o,r[d]));if(a.length===0)return;let c=e.name("valid");for(let d of a)u(d)?l(d):(e.if((0,d_.propertyInData)(e,n,d,o.opts.ownProperties)),l(d),o.allErrors||e.else().var(c,!0),e.endIf()),t.it.definedProperties.add(d),t.ok(c);function u(d){return o.opts.useDefaults&&!o.compositeRule&&r[d].default!==void 0}function l(d){t.subschema({keyword:"properties",schemaProp:d,dataProp:d},c)}}};mu.default=Vw});var g_=z(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});var f_=ut(),Jo=J(),h_=ae(),__=ae(),Bw={keyword:"patternProperties",type:"object",schemaType:"object",code(t){let{gen:e,schema:r,data:s,parentSchema:n,it:o}=t,{opts:i}=o,a=(0,f_.allSchemaProperties)(r),c=a.filter(g=>(0,h_.alwaysValidSchema)(o,r[g]));if(a.length===0||c.length===a.length&&(!o.opts.unevaluated||o.props===!0))return;let u=i.strictSchema&&!i.allowMatchingProperties&&n.properties,l=e.name("valid");o.props!==!0&&!(o.props instanceof Jo.Name)&&(o.props=(0,__.evaluatedPropsToName)(e,o.props));let{props:d}=o;p();function p(){for(let g of a)u&&m(g),o.allErrors?f(g):(e.var(l,!0),f(g),e.if(l))}function m(g){for(let _ in u)new RegExp(g).test(_)&&(0,h_.checkStrictMode)(o,`property ${_} matches pattern ${g} (use allowMatchingProperties)`)}function f(g){e.forIn("key",s,_=>{e.if((0,Jo._)`${(0,f_.usePattern)(t,g)}.test(${_})`,()=>{let v=c.includes(g);v||t.subschema({keyword:"patternProperties",schemaProp:g,dataProp:_,dataPropType:__.Type.Str},l),o.opts.unevaluated&&d!==!0?e.assign((0,Jo._)`${d}[${_}]`,!0):!v&&!o.allErrors&&e.if((0,Jo.not)(l),()=>e.break())})})}}};fu.default=Bw});var y_=z(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});var Hw=ae(),Gw={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(t){let{gen:e,schema:r,it:s}=t;if((0,Hw.alwaysValidSchema)(s,r)){t.fail();return}let n=e.name("valid");t.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},n),t.failResult(n,()=>t.reset(),()=>t.error())},error:{message:"must NOT be valid"}};hu.default=Gw});var v_=z(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});var Ww=ut(),Kw={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Ww.validateUnion,error:{message:"must match a schema in anyOf"}};_u.default=Kw});var b_=z(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});var Yo=J(),Xw=ae(),Jw={message:"must match exactly one schema in oneOf",params:({params:t})=>(0,Yo._)`{passingSchemas: ${t.passing}}`},Yw={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:Jw,code(t){let{gen:e,schema:r,parentSchema:s,it:n}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");if(n.opts.discriminator&&s.discriminator)return;let o=r,i=e.let("valid",!1),a=e.let("passing",null),c=e.name("_valid");t.setParams({passing:a}),e.block(u),t.result(i,()=>t.reset(),()=>t.error(!0));function u(){o.forEach((l,d)=>{let p;(0,Xw.alwaysValidSchema)(n,l)?e.var(c,!0):p=t.subschema({keyword:"oneOf",schemaProp:d,compositeRule:!0},c),d>0&&e.if((0,Yo._)`${c} && ${i}`).assign(i,!1).assign(a,(0,Yo._)`[${a}, ${d}]`).else(),e.if(c,()=>{e.assign(i,!0),e.assign(a,d),p&&t.mergeEvaluated(p,Yo.Name)})})}}};gu.default=Yw});var S_=z(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});var Qw=ae(),eT={keyword:"allOf",schemaType:"array",code(t){let{gen:e,schema:r,it:s}=t;if(!Array.isArray(r))throw new Error("ajv implementation error");let n=e.name("valid");r.forEach((o,i)=>{if((0,Qw.alwaysValidSchema)(s,o))return;let a=t.subschema({keyword:"allOf",schemaProp:i},n);t.ok(n),t.mergeEvaluated(a)})}};yu.default=eT});var $_=z(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});var Qo=J(),E_=ae(),tT={message:({params:t})=>(0,Qo.str)`must match "${t.ifClause}" schema`,params:({params:t})=>(0,Qo._)`{failingKeyword: ${t.ifClause}}`},rT={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:tT,code(t){let{gen:e,parentSchema:r,it:s}=t;r.then===void 0&&r.else===void 0&&(0,E_.checkStrictMode)(s,'"if" without "then" and "else" is ignored');let n=x_(s,"then"),o=x_(s,"else");if(!n&&!o)return;let i=e.let("valid",!0),a=e.name("_valid");if(c(),t.reset(),n&&o){let l=e.let("ifClause");t.setParams({ifClause:l}),e.if(a,u("then",l),u("else",l))}else n?e.if(a,u("then")):e.if((0,Qo.not)(a),u("else"));t.pass(i,()=>t.error(!0));function c(){let l=t.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);t.mergeEvaluated(l)}function u(l,d){return()=>{let p=t.subschema({keyword:l},a);e.assign(i,a),t.mergeValidEvaluated(p,i),d?e.assign(d,(0,Qo._)`${l}`):t.setParams({ifClause:l})}}}};function x_(t,e){let r=t.schema[e];return r!==void 0&&!(0,E_.alwaysValidSchema)(t,r)}vu.default=rT});var w_=z(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});var sT=ae(),nT={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:t,parentSchema:e,it:r}){e.if===void 0&&(0,sT.checkStrictMode)(r,`"${t}" without "if" is ignored`)}};bu.default=nT});var T_=z(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});var oT=su(),iT=r_(),aT=nu(),cT=n_(),uT=o_(),lT=c_(),dT=l_(),pT=du(),mT=m_(),fT=g_(),hT=y_(),_T=v_(),gT=b_(),yT=S_(),vT=$_(),bT=w_();function ST(t=!1){let e=[hT.default,_T.default,gT.default,yT.default,vT.default,bT.default,dT.default,pT.default,lT.default,mT.default,fT.default];return t?e.push(iT.default,cT.default):e.push(oT.default,aT.default),e.push(uT.default),e}Su.default=ST});var k_=z(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});var we=J(),xT={message:({schemaCode:t})=>(0,we.str)`must match format "${t}"`,params:({schemaCode:t})=>(0,we._)`{format: ${t}}`},ET={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:xT,code(t,e){let{gen:r,data:s,$data:n,schema:o,schemaCode:i,it:a}=t,{opts:c,errSchemaPath:u,schemaEnv:l,self:d}=a;if(!c.validateFormats)return;n?p():m();function p(){let f=r.scopeValue("formats",{ref:d.formats,code:c.code.formats}),g=r.const("fDef",(0,we._)`${f}[${i}]`),_=r.let("fType"),v=r.let("format");r.if((0,we._)`typeof ${g} == "object" && !(${g} instanceof RegExp)`,()=>r.assign(_,(0,we._)`${g}.type || "string"`).assign(v,(0,we._)`${g}.validate`),()=>r.assign(_,(0,we._)`"string"`).assign(v,g)),t.fail$data((0,we.or)($(),y()));function $(){return c.strictSchema===!1?we.nil:(0,we._)`${i} && !${v}`}function y(){let x=l.$async?(0,we._)`(${g}.async ? await ${v}(${s}) : ${v}(${s}))`:(0,we._)`${v}(${s})`,E=(0,we._)`(typeof ${v} == "function" ? ${x} : ${v}.test(${s}))`;return(0,we._)`${v} && ${v} !== true && ${_} === ${e} && !${E}`}}function m(){let f=d.formats[o];if(!f){$();return}if(f===!0)return;let[g,_,v]=y(f);g===e&&t.pass(x());function $(){if(c.strictSchema===!1){d.logger.warn(E());return}throw new Error(E());function E(){return`unknown format "${o}" ignored in schema at path "${u}"`}}function y(E){let T=E instanceof RegExp?(0,we.regexpCode)(E):c.code.formats?(0,we._)`${c.code.formats}${(0,we.getProperty)(o)}`:void 0,R=r.scopeValue("formats",{key:o,ref:E,code:T});return typeof E=="object"&&!(E instanceof RegExp)?[E.type||"string",E.validate,(0,we._)`${R}.validate`]:["string",E,R]}function x(){if(typeof f=="object"&&!(f instanceof RegExp)&&f.async){if(!l.$async)throw new Error("async format in sync schema");return(0,we._)`await ${v}(${s})`}return typeof _=="function"?(0,we._)`${v}(${s})`:(0,we._)`${v}.test(${s})`}}}};xu.default=ET});var R_=z(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});var $T=k_(),wT=[$T.default];Eu.default=wT});var z_=z(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.contentVocabulary=ys.metadataVocabulary=void 0;ys.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];ys.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var O_=z($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});var TT=Lh(),kT=Yh(),RT=T_(),zT=R_(),I_=z_(),IT=[TT.default,kT.default,(0,RT.default)(),zT.default,I_.metadataVocabulary,I_.contentVocabulary];$u.default=IT});var P_=z(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.DiscrError=void 0;var N_;(function(t){t.Tag="tag",t.Mapping="mapping"})(N_||(ei.DiscrError=N_={}))});var A_=z(Tu=>{"use strict";Object.defineProperty(Tu,"__esModule",{value:!0});var vs=J(),wu=P_(),C_=Ao(),OT=_n(),NT=ae(),PT={message:({params:{discrError:t,tagName:e}})=>t===wu.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:t,tag:e,tagName:r}})=>(0,vs._)`{error: ${t}, tag: ${r}, tagValue: ${e}}`},CT={keyword:"discriminator",type:"object",schemaType:"object",error:PT,code(t){let{gen:e,data:r,schema:s,parentSchema:n,it:o}=t,{oneOf:i}=n;if(!o.opts.discriminator)throw new Error("discriminator: requires discriminator option");let a=s.propertyName;if(typeof a!="string")throw new Error("discriminator: requires propertyName");if(s.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");let c=e.let("valid",!1),u=e.const("tag",(0,vs._)`${r}${(0,vs.getProperty)(a)}`);e.if((0,vs._)`typeof ${u} == "string"`,()=>l(),()=>t.error(!1,{discrError:wu.DiscrError.Tag,tag:u,tagName:a})),t.ok(c);function l(){let m=p();e.if(!1);for(let f in m)e.elseIf((0,vs._)`${u} === ${f}`),e.assign(c,d(m[f]));e.else(),t.error(!1,{discrError:wu.DiscrError.Mapping,tag:u,tagName:a}),e.endIf()}function d(m){let f=e.name("valid"),g=t.subschema({keyword:"oneOf",schemaProp:m},f);return t.mergeEvaluated(g,vs.Name),f}function p(){var m;let f={},g=v(n),_=!0;for(let x=0;x<i.length;x++){let E=i[x];if(E?.$ref&&!(0,NT.schemaHasRulesButRef)(E,o.self.RULES)){let R=E.$ref;if(E=C_.resolveRef.call(o.self,o.schemaEnv.root,o.baseId,R),E instanceof C_.SchemaEnv&&(E=E.schema),E===void 0)throw new OT.default(o.opts.uriResolver,o.baseId,R)}let T=(m=E?.properties)===null||m===void 0?void 0:m[a];if(typeof T!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);_=_&&(g||v(E)),$(T,x)}if(!_)throw new Error(`discriminator: "${a}" must be required`);return f;function v({required:x}){return Array.isArray(x)&&x.includes(a)}function $(x,E){if(x.const)y(x.const,E);else if(x.enum)for(let T of x.enum)y(T,E);else throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`)}function y(x,E){if(typeof x!="string"||x in f)throw new Error(`discriminator: "${a}" values must be unique strings`);f[x]=E}}}};Tu.default=CT});var j_=z((wC,AT)=>{AT.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Ru=z((ve,ku)=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.MissingRefError=ve.ValidationError=ve.CodeGen=ve.Name=ve.nil=ve.stringify=ve.str=ve._=ve.KeywordCxt=ve.Ajv=void 0;var jT=Nh(),DT=O_(),LT=A_(),D_=j_(),MT=["/properties"],ti="http://json-schema.org/draft-07/schema",bs=class extends jT.default{_addVocabularies(){super._addVocabularies(),DT.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(LT.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let e=this.opts.$data?this.$dataMetaSchema(D_,MT):D_;this.addMetaSchema(e,ti,!1),this.refs["http://json-schema.org/schema"]=ti}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(ti)?ti:void 0)}};ve.Ajv=bs;ku.exports=ve=bs;ku.exports.Ajv=bs;Object.defineProperty(ve,"__esModule",{value:!0});ve.default=bs;var qT=hn();Object.defineProperty(ve,"KeywordCxt",{enumerable:!0,get:function(){return qT.KeywordCxt}});var Ss=J();Object.defineProperty(ve,"_",{enumerable:!0,get:function(){return Ss._}});Object.defineProperty(ve,"str",{enumerable:!0,get:function(){return Ss.str}});Object.defineProperty(ve,"stringify",{enumerable:!0,get:function(){return Ss.stringify}});Object.defineProperty(ve,"nil",{enumerable:!0,get:function(){return Ss.nil}});Object.defineProperty(ve,"Name",{enumerable:!0,get:function(){return Ss.Name}});Object.defineProperty(ve,"CodeGen",{enumerable:!0,get:function(){return Ss.CodeGen}});var ZT=Po();Object.defineProperty(ve,"ValidationError",{enumerable:!0,get:function(){return ZT.default}});var UT=_n();Object.defineProperty(ve,"MissingRefError",{enumerable:!0,get:function(){return UT.default}})});var B_=z(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.formatNames=Ct.fastFormats=Ct.fullFormats=void 0;function Pt(t,e){return{validate:t,compare:e}}Ct.fullFormats={date:Pt(Z_,Nu),time:Pt(Iu(!0),Pu),"date-time":Pt(L_(!0),F_),"iso-time":Pt(Iu(),U_),"iso-date-time":Pt(L_(),V_),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:WT,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:tk,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:KT,int32:{type:"number",validate:YT},int64:{type:"number",validate:QT},float:{type:"number",validate:q_},double:{type:"number",validate:q_},password:!0,binary:!0};Ct.fastFormats={...Ct.fullFormats,date:Pt(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Nu),time:Pt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Pu),"date-time":Pt(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,F_),"iso-time":Pt(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,U_),"iso-date-time":Pt(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,V_),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};Ct.formatNames=Object.keys(Ct.fullFormats);function FT(t){return t%4===0&&(t%100!==0||t%400===0)}var VT=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,BT=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Z_(t){let e=VT.exec(t);if(!e)return!1;let r=+e[1],s=+e[2],n=+e[3];return s>=1&&s<=12&&n>=1&&n<=(s===2&&FT(r)?29:BT[s])}function Nu(t,e){if(t&&e)return t>e?1:t<e?-1:0}var zu=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Iu(t){return function(r){let s=zu.exec(r);if(!s)return!1;let n=+s[1],o=+s[2],i=+s[3],a=s[4],c=s[5]==="-"?-1:1,u=+(s[6]||0),l=+(s[7]||0);if(u>23||l>59||t&&!a)return!1;if(n<=23&&o<=59&&i<60)return!0;let d=o-l*c,p=n-u*c-(d<0?1:0);return(p===23||p===-1)&&(d===59||d===-1)&&i<61}}function Pu(t,e){if(!(t&&e))return;let r=new Date("2020-01-01T"+t).valueOf(),s=new Date("2020-01-01T"+e).valueOf();if(r&&s)return r-s}function U_(t,e){if(!(t&&e))return;let r=zu.exec(t),s=zu.exec(e);if(r&&s)return t=r[1]+r[2]+r[3],e=s[1]+s[2]+s[3],t>e?1:t<e?-1:0}var Ou=/t|\s/i;function L_(t){let e=Iu(t);return function(s){let n=s.split(Ou);return n.length===2&&Z_(n[0])&&e(n[1])}}function F_(t,e){if(!(t&&e))return;let r=new Date(t).valueOf(),s=new Date(e).valueOf();if(r&&s)return r-s}function V_(t,e){if(!(t&&e))return;let[r,s]=t.split(Ou),[n,o]=e.split(Ou),i=Nu(r,n);if(i!==void 0)return i||Pu(s,o)}var HT=/\/|:/,GT=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function WT(t){return HT.test(t)&&GT.test(t)}var M_=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function KT(t){return M_.lastIndex=0,M_.test(t)}var XT=-(2**31),JT=2**31-1;function YT(t){return Number.isInteger(t)&&t<=JT&&t>=XT}function QT(t){return Number.isInteger(t)}function q_(){return!0}var ek=/[^\\]\\Z/;function tk(t){if(ek.test(t))return!1;try{return new RegExp(t),!0}catch{return!1}}});var H_=z(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});xs.formatLimitDefinition=void 0;var rk=Ru(),bt=J(),lr=bt.operators,ri={formatMaximum:{okStr:"<=",ok:lr.LTE,fail:lr.GT},formatMinimum:{okStr:">=",ok:lr.GTE,fail:lr.LT},formatExclusiveMaximum:{okStr:"<",ok:lr.LT,fail:lr.GTE},formatExclusiveMinimum:{okStr:">",ok:lr.GT,fail:lr.LTE}},sk={message:({keyword:t,schemaCode:e})=>(0,bt.str)`should be ${ri[t].okStr} ${e}`,params:({keyword:t,schemaCode:e})=>(0,bt._)`{comparison: ${ri[t].okStr}, limit: ${e}}`};xs.formatLimitDefinition={keyword:Object.keys(ri),type:"string",schemaType:"string",$data:!0,error:sk,code(t){let{gen:e,data:r,schemaCode:s,keyword:n,it:o}=t,{opts:i,self:a}=o;if(!i.validateFormats)return;let c=new rk.KeywordCxt(o,a.RULES.all.format.definition,"format");c.$data?u():l();function u(){let p=e.scopeValue("formats",{ref:a.formats,code:i.code.formats}),m=e.const("fmt",(0,bt._)`${p}[${c.schemaCode}]`);t.fail$data((0,bt.or)((0,bt._)`typeof ${m} != "object"`,(0,bt._)`${m} instanceof RegExp`,(0,bt._)`typeof ${m}.compare != "function"`,d(m)))}function l(){let p=c.schema,m=a.formats[p];if(!m||m===!0)return;if(typeof m!="object"||m instanceof RegExp||typeof m.compare!="function")throw new Error(`"${n}": format "${p}" does not define "compare" function`);let f=e.scopeValue("formats",{key:p,ref:m,code:i.code.formats?(0,bt._)`${i.code.formats}${(0,bt.getProperty)(p)}`:void 0});t.fail$data(d(f))}function d(p){return(0,bt._)`${p}.compare(${r}, ${s}) ${ri[n].fail} 0`}},dependencies:["format"]};var nk=t=>(t.addKeyword(xs.formatLimitDefinition),t);xs.default=nk});var X_=z((In,K_)=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});var Es=B_(),ok=H_(),Cu=J(),G_=new Cu.Name("fullFormats"),ik=new Cu.Name("fastFormats"),Au=(t,e={keywords:!0})=>{if(Array.isArray(e))return W_(t,e,Es.fullFormats,G_),t;let[r,s]=e.mode==="fast"?[Es.fastFormats,ik]:[Es.fullFormats,G_],n=e.formats||Es.formatNames;return W_(t,n,r,s),e.keywords&&(0,ok.default)(t),t};Au.get=(t,e="full")=>{let s=(e==="fast"?Es.fastFormats:Es.fullFormats)[t];if(!s)throw new Error(`Unknown format "${t}"`);return s};function W_(t,e,r,s){var n,o;(n=(o=t.opts.code).formats)!==null&&n!==void 0||(o.formats=(0,Cu._)`require("ajv-formats/dist/formats").${s}`);for(let i of e)t.addFormat(i,r[i])}K_.exports=In=Au;Object.defineProperty(In,"__esModule",{value:!0});In.default=Au});var sg=z((JC,rg)=>{rg.exports=tg;tg.sync=dk;var Q_=require("fs");function lk(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var s=0;s<r.length;s++){var n=r[s].toLowerCase();if(n&&t.substr(-n.length).toLowerCase()===n)return!0}return!1}function eg(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:lk(e,r)}function tg(t,e,r){Q_.stat(t,function(s,n){r(s,s?!1:eg(n,t,e))})}function dk(t,e){return eg(Q_.statSync(t),t,e)}});var cg=z((YC,ag)=>{ag.exports=og;og.sync=pk;var ng=require("fs");function og(t,e,r){ng.stat(t,function(s,n){r(s,s?!1:ig(n,e))})}function pk(t,e){return ig(ng.statSync(t),e)}function ig(t,e){return t.isFile()&&mk(t,e)}function mk(t,e){var r=t.mode,s=t.uid,n=t.gid,o=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),i=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),u=parseInt("001",8),l=a|c,d=r&u||r&c&&n===i||r&a&&s===o||r&l&&o===0;return d}});var lg=z((eA,ug)=>{var QC=require("fs"),pi;process.platform==="win32"||global.TESTING_WINDOWS?pi=sg():pi=cg();ug.exports=Du;Du.sync=fk;function Du(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,n){Du(t,e||{},function(o,i){o?n(o):s(i)})})}pi(t,e||{},function(s,n){s&&(s.code==="EACCES"||e&&e.ignoreErrors)&&(s=null,n=!1),r(s,n)})}function fk(t,e){try{return pi.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var gg=z((tA,_g)=>{var Ts=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",dg=require("path"),hk=Ts?";":":",pg=lg(),mg=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),fg=(t,e)=>{let r=e.colon||hk,s=t.match(/\//)||Ts&&t.match(/\\/)?[""]:[...Ts?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],n=Ts?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",o=Ts?n.split(r):[""];return Ts&&t.indexOf(".")!==-1&&o[0]!==""&&o.unshift(""),{pathEnv:s,pathExt:o,pathExtExe:n}},hg=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:s,pathExt:n,pathExtExe:o}=fg(t,e),i=[],a=u=>new Promise((l,d)=>{if(u===s.length)return e.all&&i.length?l(i):d(mg(t));let p=s[u],m=/^".*"$/.test(p)?p.slice(1,-1):p,f=dg.join(m,t),g=!m&&/^\.[\\\/]/.test(t)?t.slice(0,2)+f:f;l(c(g,u,0))}),c=(u,l,d)=>new Promise((p,m)=>{if(d===n.length)return p(a(l+1));let f=n[d];pg(u+f,{pathExt:o},(g,_)=>{if(!g&&_)if(e.all)i.push(u+f);else return p(u+f);return p(c(u,l,d+1))})});return r?a(0).then(u=>r(null,u),r):a(0)},_k=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:s,pathExtExe:n}=fg(t,e),o=[];for(let i=0;i<r.length;i++){let a=r[i],c=/^".*"$/.test(a)?a.slice(1,-1):a,u=dg.join(c,t),l=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+u:u;for(let d=0;d<s.length;d++){let p=l+s[d];try{if(pg.sync(p,{pathExt:n}))if(e.all)o.push(p);else return p}catch{}}}if(e.all&&o.length)return o;if(e.nothrow)return null;throw mg(t)};_g.exports=hg;hg.sync=_k});var vg=z((rA,Lu)=>{"use strict";var yg=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(s=>s.toUpperCase()==="PATH")||"Path"};Lu.exports=yg;Lu.exports.default=yg});var Eg=z((sA,xg)=>{"use strict";var bg=require("path"),gk=gg(),yk=vg();function Sg(t,e){let r=t.options.env||process.env,s=process.cwd(),n=t.options.cwd!=null,o=n&&process.chdir!==void 0&&!process.chdir.disabled;if(o)try{process.chdir(t.options.cwd)}catch{}let i;try{i=gk.sync(t.command,{path:r[yk({env:r})],pathExt:e?bg.delimiter:void 0})}catch{}finally{o&&process.chdir(s)}return i&&(i=bg.resolve(n?t.options.cwd:"",i)),i}function vk(t){return Sg(t)||Sg(t,!0)}xg.exports=vk});var $g=z((nA,qu)=>{"use strict";var Mu=/([()\][%!^"`<>&|;, *?])/g;function bk(t){return t=t.replace(Mu,"^$1"),t}function Sk(t,e){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(Mu,"^$1"),e&&(t=t.replace(Mu,"^$1")),t}qu.exports.command=bk;qu.exports.argument=Sk});var Tg=z((oA,wg)=>{"use strict";wg.exports=/^#!(.*)/});var Rg=z((iA,kg)=>{"use strict";var xk=Tg();kg.exports=(t="")=>{let e=t.match(xk);if(!e)return null;let[r,s]=e[0].replace(/#! ?/,"").split(" "),n=r.split("/").pop();return n==="env"?s:s?`${n} ${s}`:n}});var Ig=z((aA,zg)=>{"use strict";var Zu=require("fs"),Ek=Rg();function $k(t){let r=Buffer.alloc(150),s;try{s=Zu.openSync(t,"r"),Zu.readSync(s,r,0,150,0),Zu.closeSync(s)}catch{}return Ek(r.toString())}zg.exports=$k});var Cg=z((cA,Pg)=>{"use strict";var wk=require("path"),Og=Eg(),Ng=$g(),Tk=Ig(),kk=process.platform==="win32",Rk=/\.(?:com|exe)$/i,zk=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Ik(t){t.file=Og(t);let e=t.file&&Tk(t.file);return e?(t.args.unshift(t.file),t.command=e,Og(t)):t.file}function Ok(t){if(!kk)return t;let e=Ik(t),r=!Rk.test(e);if(t.options.forceShell||r){let s=zk.test(e);t.command=wk.normalize(t.command),t.command=Ng.command(t.command),t.args=t.args.map(o=>Ng.argument(o,s));let n=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${n}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function Nk(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let s={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?s:Ok(s)}Pg.exports=Nk});var Dg=z((uA,jg)=>{"use strict";var Uu=process.platform==="win32";function Fu(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function Pk(t,e){if(!Uu)return;let r=t.emit;t.emit=function(s,n){if(s==="exit"){let o=Ag(n,e);if(o)return r.call(t,"error",o)}return r.apply(t,arguments)}}function Ag(t,e){return Uu&&t===1&&!e.file?Fu(e.original,"spawn"):null}function Ck(t,e){return Uu&&t===1&&!e.file?Fu(e.original,"spawnSync"):null}jg.exports={hookChildProcess:Pk,verifyENOENT:Ag,verifyENOENTSync:Ck,notFoundError:Fu}});var qg=z((lA,ks)=>{"use strict";var Lg=require("child_process"),Vu=Cg(),Bu=Dg();function Mg(t,e,r){let s=Vu(t,e,r),n=Lg.spawn(s.command,s.args,s.options);return Bu.hookChildProcess(n,s),n}function Ak(t,e,r){let s=Vu(t,e,r),n=Lg.spawnSync(s.command,s.args,s.options);return n.error=n.error||Bu.verifyENOENTSync(n.status,s),n}ks.exports=Mg;ks.exports.spawn=Mg;ks.exports.sync=Ak;ks.exports._parse=Vu;ks.exports._enoent=Bu});var h={};bi(h,{BRAND:()=>Cy,DIRTY:()=>hr,EMPTY_PATH:()=>py,INVALID:()=>F,NEVER:()=>yv,OK:()=>De,ParseStatus:()=>Ie,Schema:()=>X,ZodAny:()=>Jt,ZodArray:()=>qt,ZodBigInt:()=>gr,ZodBoolean:()=>yr,ZodBranded:()=>zs,ZodCatch:()=>zr,ZodDate:()=>vr,ZodDefault:()=>Rr,ZodDiscriminatedUnion:()=>Dn,ZodEffects:()=>nt,ZodEnum:()=>Tr,ZodError:()=>We,ZodFirstPartyTypeKind:()=>k,ZodFunction:()=>Mn,ZodIntersection:()=>Er,ZodIssueCode:()=>w,ZodLazy:()=>$r,ZodLiteral:()=>wr,ZodMap:()=>Jr,ZodNaN:()=>Qr,ZodNativeEnum:()=>kr,ZodNever:()=>pt,ZodNull:()=>Sr,ZodNullable:()=>$t,ZodNumber:()=>_r,ZodObject:()=>Ke,ZodOptional:()=>rt,ZodParsedType:()=>N,ZodPipeline:()=>Is,ZodPromise:()=>Yt,ZodReadonly:()=>Ir,ZodRecord:()=>Ln,ZodSchema:()=>X,ZodSet:()=>Yr,ZodString:()=>Xt,ZodSymbol:()=>Kr,ZodTransformer:()=>nt,ZodTuple:()=>Et,ZodType:()=>X,ZodUndefined:()=>br,ZodUnion:()=>xr,ZodUnknown:()=>Mt,ZodVoid:()=>Xr,addIssueToContext:()=>O,any:()=>Fy,array:()=>Gy,bigint:()=>Ly,boolean:()=>dl,coerce:()=>gv,custom:()=>cl,date:()=>My,datetimeRegex:()=>il,defaultErrorMap:()=>Dt,discriminatedUnion:()=>Jy,effect:()=>uv,enum:()=>iv,function:()=>sv,getErrorMap:()=>Hr,getParsedType:()=>xt,instanceof:()=>jy,intersection:()=>Yy,isAborted:()=>An,isAsync:()=>Gr,isDirty:()=>jn,isValid:()=>Kt,late:()=>Ay,lazy:()=>nv,literal:()=>ov,makeIssue:()=>Rs,map:()=>tv,nan:()=>Dy,nativeEnum:()=>av,never:()=>By,null:()=>Uy,nullable:()=>dv,number:()=>ll,object:()=>Wy,objectUtil:()=>Si,oboolean:()=>_v,onumber:()=>hv,optional:()=>lv,ostring:()=>fv,pipeline:()=>mv,preprocess:()=>pv,promise:()=>cv,quotelessJson:()=>uy,record:()=>ev,set:()=>rv,setErrorMap:()=>dy,strictObject:()=>Ky,string:()=>ul,symbol:()=>qy,transformer:()=>uv,tuple:()=>Qy,undefined:()=>Zy,union:()=>Xy,unknown:()=>Vy,util:()=>ee,void:()=>Hy});var ee;(function(t){t.assertEqual=n=>{};function e(n){}t.assertIs=e;function r(n){throw new Error}t.assertNever=r,t.arrayToEnum=n=>{let o={};for(let i of n)o[i]=i;return o},t.getValidEnumValues=n=>{let o=t.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),i={};for(let a of o)i[a]=n[a];return t.objectValues(i)},t.objectValues=n=>t.objectKeys(n).map(function(o){return n[o]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let o=[];for(let i in n)Object.prototype.hasOwnProperty.call(n,i)&&o.push(i);return o},t.find=(n,o)=>{for(let i of n)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,o=" | "){return n.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=s,t.jsonStringifyReplacer=(n,o)=>typeof o=="bigint"?o.toString():o})(ee||(ee={}));var Si;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Si||(Si={}));var N=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xt=t=>{switch(typeof t){case"undefined":return N.undefined;case"string":return N.string;case"number":return Number.isNaN(t)?N.nan:N.number;case"boolean":return N.boolean;case"function":return N.function;case"bigint":return N.bigint;case"symbol":return N.symbol;case"object":return Array.isArray(t)?N.array:t===null?N.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?N.promise:typeof Map<"u"&&t instanceof Map?N.map:typeof Set<"u"&&t instanceof Set?N.set:typeof Date<"u"&&t instanceof Date?N.date:N.object;default:return N.unknown}};var w=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),uy=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),We=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(o){return o.message},s={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(n);else if(i.code==="invalid_return_type")n(i.returnTypeError);else if(i.code==="invalid_arguments")n(i.argumentsError);else if(i.path.length===0)s._errors.push(r(i));else{let a=s,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return n(this),s}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},s=[];for(let n of this.issues)if(n.path.length>0){let o=n.path[0];r[o]=r[o]||[],r[o].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}};We.create=t=>new We(t);var ly=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===N.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ee.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${ee.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ee.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${ee.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ee.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,ee.assertNever(t)}return{message:r}},Dt=ly;var tl=Dt;function dy(t){tl=t}function Hr(){return tl}var Rs=t=>{let{data:e,path:r,errorMaps:s,issueData:n}=t,o=[...r,...n.path||[]],i={...n,path:o};if(n.message!==void 0)return{...n,path:o,message:n.message};let a="",c=s.filter(u=>!!u).slice().reverse();for(let u of c)a=u(i,{data:e,defaultError:a}).message;return{...n,path:o,message:a}},py=[];function O(t,e){let r=Hr(),s=Rs({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Dt?void 0:Dt].filter(n=>!!n)});t.common.issues.push(s)}var Ie=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let s=[];for(let n of r){if(n.status==="aborted")return F;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,r){let s=[];for(let n of r){let o=await n.key,i=await n.value;s.push({key:o,value:i})}return t.mergeObjectSync(e,s)}static mergeObjectSync(e,r){let s={};for(let n of r){let{key:o,value:i}=n;if(o.status==="aborted"||i.status==="aborted")return F;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||n.alwaysSet)&&(s[o.value]=i.value)}return{status:e.value,value:s}}},F=Object.freeze({status:"aborted"}),hr=t=>({status:"dirty",value:t}),De=t=>({status:"valid",value:t}),An=t=>t.status==="aborted",jn=t=>t.status==="dirty",Kt=t=>t.status==="valid",Gr=t=>typeof Promise<"u"&&t instanceof Promise;var C;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(C||(C={}));var st=class{constructor(e,r,s,n){this._cachedPath=[],this.parent=e,this.data=r,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},rl=(t,e)=>{if(Kt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new We(t.common.issues);return this._error=r,this._error}}};function G(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:s,description:n}=t;if(e&&(r||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(i,a)=>{let{message:c}=t;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??s??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:n}}var X=class{get description(){return this._def.description}_getType(e){return xt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:xt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ie,ctx:{common:e.parent.common,data:e.data,parsedType:xt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(Gr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let s=this.safeParse(e,r);if(s.success)return s.data;throw s.error}safeParse(e,r){let s={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xt(e)},n=this._parseSync({data:e,path:s.path,parent:s});return rl(s,n)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xt(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:r});return Kt(s)?{value:s.value}:{issues:r.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(s=>Kt(s)?{value:s.value}:{issues:r.common.issues})}async parseAsync(e,r){let s=await this.safeParseAsync(e,r);if(s.success)return s.data;throw s.error}async safeParseAsync(e,r){let s={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xt(e)},n=this._parse({data:e,path:s.path,parent:s}),o=await(Gr(n)?n:Promise.resolve(n));return rl(s,o)}refine(e,r){let s=n=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(n):r;return this._refinement((n,o)=>{let i=e(n),a=()=>o.addIssue({code:w.custom,...s(n)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,r){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof r=="function"?r(s,n):r),!1))}_refinement(e){return new nt({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return rt.create(this,this._def)}nullable(){return $t.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return qt.create(this)}promise(){return Yt.create(this,this._def)}or(e){return xr.create([this,e],this._def)}and(e){return Er.create(this,e,this._def)}transform(e){return new nt({...G(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...G(this._def),innerType:this,defaultValue:r,typeName:k.ZodDefault})}brand(){return new zs({typeName:k.ZodBranded,type:this,...G(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new zr({...G(this._def),innerType:this,catchValue:r,typeName:k.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Is.create(this,e)}readonly(){return Ir.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},my=/^c[^\s-]{8,}$/i,fy=/^[0-9a-z]+$/,hy=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_y=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,gy=/^[a-z0-9_-]{21}$/i,yy=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vy=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,by=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Sy="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",xi,xy=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ey=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,$y=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,wy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ty=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ky=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ry=new RegExp(`^${nl}$`);function ol(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function zy(t){return new RegExp(`^${ol(t)}$`)}function il(t){let e=`${nl}T${ol(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Iy(t,e){return!!((e==="v4"||!e)&&xy.test(t)||(e==="v6"||!e)&&$y.test(t))}function Oy(t,e){if(!yy.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function Ny(t,e){return!!((e==="v4"||!e)&&Ey.test(t)||(e==="v6"||!e)&&wy.test(t))}var Xt=class t extends X{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==N.string){let o=this._getOrReturnCtx(e);return O(o,{code:w.invalid_type,expected:N.string,received:o.parsedType}),F}let s=new Ie,n;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(n=this._getOrReturnCtx(e,n),O(n,{code:w.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if(o.kind==="max")e.data.length>o.value&&(n=this._getOrReturnCtx(e,n),O(n,{code:w.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if(o.kind==="length"){let i=e.data.length>o.value,a=e.data.length<o.value;(i||a)&&(n=this._getOrReturnCtx(e,n),i?O(n,{code:w.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&O(n,{code:w.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),s.dirty())}else if(o.kind==="email")by.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"email",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="emoji")xi||(xi=new RegExp(Sy,"u")),xi.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"emoji",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="uuid")_y.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"uuid",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="nanoid")gy.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"nanoid",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="cuid")my.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"cuid",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="cuid2")fy.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"cuid2",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="ulid")hy.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"ulid",code:w.invalid_string,message:o.message}),s.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),O(n,{validation:"url",code:w.invalid_string,message:o.message}),s.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"regex",code:w.invalid_string,message:o.message}),s.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),s.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:{startsWith:o.value},message:o.message}),s.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:{endsWith:o.value},message:o.message}),s.dirty()):o.kind==="datetime"?il(o).test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:"datetime",message:o.message}),s.dirty()):o.kind==="date"?Ry.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:"date",message:o.message}),s.dirty()):o.kind==="time"?zy(o).test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:w.invalid_string,validation:"time",message:o.message}),s.dirty()):o.kind==="duration"?vy.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"duration",code:w.invalid_string,message:o.message}),s.dirty()):o.kind==="ip"?Iy(e.data,o.version)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"ip",code:w.invalid_string,message:o.message}),s.dirty()):o.kind==="jwt"?Oy(e.data,o.alg)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"jwt",code:w.invalid_string,message:o.message}),s.dirty()):o.kind==="cidr"?Ny(e.data,o.version)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"cidr",code:w.invalid_string,message:o.message}),s.dirty()):o.kind==="base64"?Ty.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"base64",code:w.invalid_string,message:o.message}),s.dirty()):o.kind==="base64url"?ky.test(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{validation:"base64url",code:w.invalid_string,message:o.message}),s.dirty()):ee.assertNever(o);return{status:s.value,value:e.data}}_regex(e,r,s){return this.refinement(n=>e.test(n),{validation:r,code:w.invalid_string,...C.errToObj(s)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...C.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...C.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...C.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...C.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...C.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...C.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...C.errToObj(r)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Xt.create=t=>new Xt({checks:[],typeName:k.ZodString,coerce:t?.coerce??!1,...G(t)});function Py(t,e){let r=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=r>s?r:s,o=Number.parseInt(t.toFixed(n).replace(".","")),i=Number.parseInt(e.toFixed(n).replace(".",""));return o%i/10**n}var _r=class t extends X{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==N.number){let o=this._getOrReturnCtx(e);return O(o,{code:w.invalid_type,expected:N.number,received:o.parsedType}),F}let s,n=new Ie;for(let o of this._def.checks)o.kind==="int"?ee.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:w.invalid_type,expected:"integer",received:"float",message:o.message}),n.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),n.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),n.dirty()):o.kind==="multipleOf"?Py(e.data,o.value)!==0&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.not_multiple_of,multipleOf:o.value,message:o.message}),n.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:w.not_finite,message:o.message}),n.dirty()):ee.assertNever(o);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,C.toString(r))}gt(e,r){return this.setLimit("min",e,!1,C.toString(r))}lte(e,r){return this.setLimit("max",e,!0,C.toString(r))}lt(e,r){return this.setLimit("max",e,!1,C.toString(r))}setLimit(e,r,s,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:C.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ee.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(r===null||s.value>r)&&(r=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:k.ZodNumber,coerce:t?.coerce||!1,...G(t)});var gr=class t extends X{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==N.bigint)return this._getInvalidInput(e);let s,n=new Ie;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),n.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),n.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),O(s,{code:w.not_multiple_of,multipleOf:o.value,message:o.message}),n.dirty()):ee.assertNever(o);return{status:n.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return O(r,{code:w.invalid_type,expected:N.bigint,received:r.parsedType}),F}gte(e,r){return this.setLimit("min",e,!0,C.toString(r))}gt(e,r){return this.setLimit("min",e,!1,C.toString(r))}lte(e,r){return this.setLimit("max",e,!0,C.toString(r))}lt(e,r){return this.setLimit("max",e,!1,C.toString(r))}setLimit(e,r,s,n){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:C.toString(n)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};gr.create=t=>new gr({checks:[],typeName:k.ZodBigInt,coerce:t?.coerce??!1,...G(t)});var yr=class extends X{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==N.boolean){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.boolean,received:s.parsedType}),F}return De(e.data)}};yr.create=t=>new yr({typeName:k.ZodBoolean,coerce:t?.coerce||!1,...G(t)});var vr=class t extends X{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==N.date){let o=this._getOrReturnCtx(e);return O(o,{code:w.invalid_type,expected:N.date,received:o.parsedType}),F}if(Number.isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return O(o,{code:w.invalid_date}),F}let s=new Ie,n;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(n=this._getOrReturnCtx(e,n),O(n,{code:w.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),s.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(n=this._getOrReturnCtx(e,n),O(n,{code:w.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),s.dirty()):ee.assertNever(o);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};vr.create=t=>new vr({checks:[],coerce:t?.coerce||!1,typeName:k.ZodDate,...G(t)});var Kr=class extends X{_parse(e){if(this._getType(e)!==N.symbol){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.symbol,received:s.parsedType}),F}return De(e.data)}};Kr.create=t=>new Kr({typeName:k.ZodSymbol,...G(t)});var br=class extends X{_parse(e){if(this._getType(e)!==N.undefined){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.undefined,received:s.parsedType}),F}return De(e.data)}};br.create=t=>new br({typeName:k.ZodUndefined,...G(t)});var Sr=class extends X{_parse(e){if(this._getType(e)!==N.null){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.null,received:s.parsedType}),F}return De(e.data)}};Sr.create=t=>new Sr({typeName:k.ZodNull,...G(t)});var Jt=class extends X{constructor(){super(...arguments),this._any=!0}_parse(e){return De(e.data)}};Jt.create=t=>new Jt({typeName:k.ZodAny,...G(t)});var Mt=class extends X{constructor(){super(...arguments),this._unknown=!0}_parse(e){return De(e.data)}};Mt.create=t=>new Mt({typeName:k.ZodUnknown,...G(t)});var pt=class extends X{_parse(e){let r=this._getOrReturnCtx(e);return O(r,{code:w.invalid_type,expected:N.never,received:r.parsedType}),F}};pt.create=t=>new pt({typeName:k.ZodNever,...G(t)});var Xr=class extends X{_parse(e){if(this._getType(e)!==N.undefined){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.void,received:s.parsedType}),F}return De(e.data)}};Xr.create=t=>new Xr({typeName:k.ZodVoid,...G(t)});var qt=class t extends X{_parse(e){let{ctx:r,status:s}=this._processInputParams(e),n=this._def;if(r.parsedType!==N.array)return O(r,{code:w.invalid_type,expected:N.array,received:r.parsedType}),F;if(n.exactLength!==null){let i=r.data.length>n.exactLength.value,a=r.data.length<n.exactLength.value;(i||a)&&(O(r,{code:i?w.too_big:w.too_small,minimum:a?n.exactLength.value:void 0,maximum:i?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&r.data.length<n.minLength.value&&(O(r,{code:w.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&r.data.length>n.maxLength.value&&(O(r,{code:w.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>n.type._parseAsync(new st(r,i,r.path,a)))).then(i=>Ie.mergeArray(s,i));let o=[...r.data].map((i,a)=>n.type._parseSync(new st(r,i,r.path,a)));return Ie.mergeArray(s,o)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:C.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:C.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:C.toString(r)}})}nonempty(e){return this.min(1,e)}};qt.create=(t,e)=>new qt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...G(e)});function Wr(t){if(t instanceof Ke){let e={};for(let r in t.shape){let s=t.shape[r];e[r]=rt.create(Wr(s))}return new Ke({...t._def,shape:()=>e})}else return t instanceof qt?new qt({...t._def,type:Wr(t.element)}):t instanceof rt?rt.create(Wr(t.unwrap())):t instanceof $t?$t.create(Wr(t.unwrap())):t instanceof Et?Et.create(t.items.map(e=>Wr(e))):t}var Ke=class t extends X{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=ee.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==N.object){let u=this._getOrReturnCtx(e);return O(u,{code:w.invalid_type,expected:N.object,received:u.parsedType}),F}let{status:s,ctx:n}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof pt&&this._def.unknownKeys==="strip"))for(let u in n.data)i.includes(u)||a.push(u);let c=[];for(let u of i){let l=o[u],d=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new st(n,d,n.path,u)),alwaysSet:u in n.data})}if(this._def.catchall instanceof pt){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of a)c.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(u==="strict")a.length>0&&(O(n,{code:w.unrecognized_keys,keys:a}),s.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of a){let d=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new st(n,d,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,p=await l.value;u.push({key:d,value:p,alwaysSet:l.alwaysSet})}return u}).then(u=>Ie.mergeObjectSync(s,u)):Ie.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,s)=>{let n=this._def.errorMap?.(r,s).message??s.defaultError;return r.code==="unrecognized_keys"?{message:C.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let s of ee.objectKeys(e))e[s]&&this.shape[s]&&(r[s]=this.shape[s]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let s of ee.objectKeys(this.shape))e[s]||(r[s]=this.shape[s]);return new t({...this._def,shape:()=>r})}deepPartial(){return Wr(this)}partial(e){let r={};for(let s of ee.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?r[s]=n:r[s]=n.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let s of ee.objectKeys(this.shape))if(e&&!e[s])r[s]=this.shape[s];else{let o=this.shape[s];for(;o instanceof rt;)o=o._def.innerType;r[s]=o}return new t({...this._def,shape:()=>r})}keyof(){return al(ee.objectKeys(this.shape))}};Ke.create=(t,e)=>new Ke({shape:()=>t,unknownKeys:"strip",catchall:pt.create(),typeName:k.ZodObject,...G(e)});Ke.strictCreate=(t,e)=>new Ke({shape:()=>t,unknownKeys:"strict",catchall:pt.create(),typeName:k.ZodObject,...G(e)});Ke.lazycreate=(t,e)=>new Ke({shape:t,unknownKeys:"strip",catchall:pt.create(),typeName:k.ZodObject,...G(e)});var xr=class extends X{_parse(e){let{ctx:r}=this._processInputParams(e),s=this._def.options;function n(o){for(let a of o)if(a.result.status==="valid")return a.result;for(let a of o)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=o.map(a=>new We(a.ctx.common.issues));return O(r,{code:w.invalid_union,unionErrors:i}),F}if(r.common.async)return Promise.all(s.map(async o=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(n);{let o,i=[];for(let c of s){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!o&&(o={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(c=>new We(c));return O(r,{code:w.invalid_union,unionErrors:a}),F}}get options(){return this._def.options}};xr.create=(t,e)=>new xr({options:t,typeName:k.ZodUnion,...G(e)});var Lt=t=>t instanceof $r?Lt(t.schema):t instanceof nt?Lt(t.innerType()):t instanceof wr?[t.value]:t instanceof Tr?t.options:t instanceof kr?ee.objectValues(t.enum):t instanceof Rr?Lt(t._def.innerType):t instanceof br?[void 0]:t instanceof Sr?[null]:t instanceof rt?[void 0,...Lt(t.unwrap())]:t instanceof $t?[null,...Lt(t.unwrap())]:t instanceof zs||t instanceof Ir?Lt(t.unwrap()):t instanceof zr?Lt(t._def.innerType):[],Dn=class t extends X{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==N.object)return O(r,{code:w.invalid_type,expected:N.object,received:r.parsedType}),F;let s=this.discriminator,n=r.data[s],o=this.optionsMap.get(n);return o?r.common.async?o._parseAsync({data:r.data,path:r.path,parent:r}):o._parseSync({data:r.data,path:r.path,parent:r}):(O(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),F)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,s){let n=new Map;for(let o of r){let i=Lt(o.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,o)}}return new t({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:n,...G(s)})}};function Ei(t,e){let r=xt(t),s=xt(e);if(t===e)return{valid:!0,data:t};if(r===N.object&&s===N.object){let n=ee.objectKeys(e),o=ee.objectKeys(t).filter(a=>n.indexOf(a)!==-1),i={...t,...e};for(let a of o){let c=Ei(t[a],e[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===N.array&&s===N.array){if(t.length!==e.length)return{valid:!1};let n=[];for(let o=0;o<t.length;o++){let i=t[o],a=e[o],c=Ei(i,a);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return r===N.date&&s===N.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Er=class extends X{_parse(e){let{status:r,ctx:s}=this._processInputParams(e),n=(o,i)=>{if(An(o)||An(i))return F;let a=Ei(o.value,i.value);return a.valid?((jn(o)||jn(i))&&r.dirty(),{status:r.value,value:a.data}):(O(s,{code:w.invalid_intersection_types}),F)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([o,i])=>n(o,i)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Er.create=(t,e,r)=>new Er({left:t,right:e,typeName:k.ZodIntersection,...G(r)});var Et=class t extends X{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.array)return O(s,{code:w.invalid_type,expected:N.array,received:s.parsedType}),F;if(s.data.length<this._def.items.length)return O(s,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),F;!this._def.rest&&s.data.length>this._def.items.length&&(O(s,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let o=[...s.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new st(s,i,s.path,a)):null}).filter(i=>!!i);return s.common.async?Promise.all(o).then(i=>Ie.mergeArray(r,i)):Ie.mergeArray(r,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Et.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Et({items:t,typeName:k.ZodTuple,rest:null,...G(e)})};var Ln=class t extends X{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.object)return O(s,{code:w.invalid_type,expected:N.object,received:s.parsedType}),F;let n=[],o=this._def.keyType,i=this._def.valueType;for(let a in s.data)n.push({key:o._parse(new st(s,a,s.path,a)),value:i._parse(new st(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?Ie.mergeObjectAsync(r,n):Ie.mergeObjectSync(r,n)}get element(){return this._def.valueType}static create(e,r,s){return r instanceof X?new t({keyType:e,valueType:r,typeName:k.ZodRecord,...G(s)}):new t({keyType:Xt.create(),valueType:e,typeName:k.ZodRecord,...G(r)})}},Jr=class extends X{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.map)return O(s,{code:w.invalid_type,expected:N.map,received:s.parsedType}),F;let n=this._def.keyType,o=this._def.valueType,i=[...s.data.entries()].map(([a,c],u)=>({key:n._parse(new st(s,a,s.path,[u,"key"])),value:o._parse(new st(s,c,s.path,[u,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return F;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return F;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),a.set(u.value,l.value)}return{status:r.value,value:a}}}};Jr.create=(t,e,r)=>new Jr({valueType:e,keyType:t,typeName:k.ZodMap,...G(r)});var Yr=class t extends X{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==N.set)return O(s,{code:w.invalid_type,expected:N.set,received:s.parsedType}),F;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(O(s,{code:w.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(O(s,{code:w.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());let o=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return F;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let a=[...s.data.values()].map((c,u)=>o._parse(new st(s,c,s.path,u)));return s.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(e,r){return new t({...this._def,minSize:{value:e,message:C.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:C.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};Yr.create=(t,e)=>new Yr({valueType:t,minSize:null,maxSize:null,typeName:k.ZodSet,...G(e)});var Mn=class t extends X{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==N.function)return O(r,{code:w.invalid_type,expected:N.function,received:r.parsedType}),F;function s(a,c){return Rs({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Hr(),Dt].filter(u=>!!u),issueData:{code:w.invalid_arguments,argumentsError:c}})}function n(a,c){return Rs({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Hr(),Dt].filter(u=>!!u),issueData:{code:w.invalid_return_type,returnTypeError:c}})}let o={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Yt){let a=this;return De(async function(...c){let u=new We([]),l=await a._def.args.parseAsync(c,o).catch(m=>{throw u.addIssue(s(c,m)),u}),d=await Reflect.apply(i,this,l);return await a._def.returns._def.type.parseAsync(d,o).catch(m=>{throw u.addIssue(n(d,m)),u})})}else{let a=this;return De(function(...c){let u=a._def.args.safeParse(c,o);if(!u.success)throw new We([s(c,u.error)]);let l=Reflect.apply(i,this,u.data),d=a._def.returns.safeParse(l,o);if(!d.success)throw new We([n(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Et.create(e).rest(Mt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,s){return new t({args:e||Et.create([]).rest(Mt.create()),returns:r||Mt.create(),typeName:k.ZodFunction,...G(s)})}},$r=class extends X{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};$r.create=(t,e)=>new $r({getter:t,typeName:k.ZodLazy,...G(e)});var wr=class extends X{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return O(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),F}return{status:"valid",value:e.data}}get value(){return this._def.value}};wr.create=(t,e)=>new wr({value:t,typeName:k.ZodLiteral,...G(e)});function al(t,e){return new Tr({values:t,typeName:k.ZodEnum,...G(e)})}var Tr=class t extends X{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),s=this._def.values;return O(r,{expected:ee.joinValues(s),received:r.parsedType,code:w.invalid_type}),F}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),s=this._def.values;return O(r,{received:r.data,code:w.invalid_enum_value,options:s}),F}return De(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(s=>!e.includes(s)),{...this._def,...r})}};Tr.create=al;var kr=class extends X{_parse(e){let r=ee.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==N.string&&s.parsedType!==N.number){let n=ee.objectValues(r);return O(s,{expected:ee.joinValues(n),received:s.parsedType,code:w.invalid_type}),F}if(this._cache||(this._cache=new Set(ee.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=ee.objectValues(r);return O(s,{received:s.data,code:w.invalid_enum_value,options:n}),F}return De(e.data)}get enum(){return this._def.values}};kr.create=(t,e)=>new kr({values:t,typeName:k.ZodNativeEnum,...G(e)});var Yt=class extends X{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==N.promise&&r.common.async===!1)return O(r,{code:w.invalid_type,expected:N.promise,received:r.parsedType}),F;let s=r.parsedType===N.promise?r.data:Promise.resolve(r.data);return De(s.then(n=>this._def.type.parseAsync(n,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Yt.create=(t,e)=>new Yt({type:t,typeName:k.ZodPromise,...G(e)});var nt=class extends X{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:s}=this._processInputParams(e),n=this._def.effect||null,o={addIssue:i=>{O(s,i),i.fatal?r.abort():r.dirty()},get path(){return s.path}};if(o.addIssue=o.addIssue.bind(o),n.type==="preprocess"){let i=n.transform(s.data,o);if(s.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return F;let c=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return c.status==="aborted"?F:c.status==="dirty"?hr(c.value):r.value==="dirty"?hr(c.value):c});{if(r.value==="aborted")return F;let a=this._def.schema._parseSync({data:i,path:s.path,parent:s});return a.status==="aborted"?F:a.status==="dirty"?hr(a.value):r.value==="dirty"?hr(a.value):a}}if(n.type==="refinement"){let i=a=>{let c=n.refinement(a,o);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?F:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?F:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(n.type==="transform")if(s.common.async===!1){let i=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Kt(i))return F;let a=n.transform(i.value,o);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(i=>Kt(i)?Promise.resolve(n.transform(i.value,o)).then(a=>({status:r.value,value:a})):F);ee.assertNever(n)}};nt.create=(t,e,r)=>new nt({schema:t,typeName:k.ZodEffects,effect:e,...G(r)});nt.createWithPreprocess=(t,e,r)=>new nt({schema:e,effect:{type:"preprocess",transform:t},typeName:k.ZodEffects,...G(r)});var rt=class extends X{_parse(e){return this._getType(e)===N.undefined?De(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};rt.create=(t,e)=>new rt({innerType:t,typeName:k.ZodOptional,...G(e)});var $t=class extends X{_parse(e){return this._getType(e)===N.null?De(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};$t.create=(t,e)=>new $t({innerType:t,typeName:k.ZodNullable,...G(e)});var Rr=class extends X{_parse(e){let{ctx:r}=this._processInputParams(e),s=r.data;return r.parsedType===N.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});var zr=class extends X{_parse(e){let{ctx:r}=this._processInputParams(e),s={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Gr(n)?n.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new We(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new We(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};zr.create=(t,e)=>new zr({innerType:t,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});var Qr=class extends X{_parse(e){if(this._getType(e)!==N.nan){let s=this._getOrReturnCtx(e);return O(s,{code:w.invalid_type,expected:N.nan,received:s.parsedType}),F}return{status:"valid",value:e.data}}};Qr.create=t=>new Qr({typeName:k.ZodNaN,...G(t)});var Cy=Symbol("zod_brand"),zs=class extends X{_parse(e){let{ctx:r}=this._processInputParams(e),s=r.data;return this._def.type._parse({data:s,path:r.path,parent:r})}unwrap(){return this._def.type}},Is=class t extends X{_parse(e){let{status:r,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?F:o.status==="dirty"?(r.dirty(),hr(o.value)):this._def.out._parseAsync({data:o.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?F:n.status==="dirty"?(r.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,r){return new t({in:e,out:r,typeName:k.ZodPipeline})}},Ir=class extends X{_parse(e){let r=this._def.innerType._parse(e),s=n=>(Kt(n)&&(n.value=Object.freeze(n.value)),n);return Gr(r)?r.then(n=>s(n)):s(r)}unwrap(){return this._def.innerType}};Ir.create=(t,e)=>new Ir({innerType:t,typeName:k.ZodReadonly,...G(e)});function sl(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function cl(t,e={},r){return t?Jt.create().superRefine((s,n)=>{let o=t(s);if(o instanceof Promise)return o.then(i=>{if(!i){let a=sl(e,s),c=a.fatal??r??!0;n.addIssue({code:"custom",...a,fatal:c})}});if(!o){let i=sl(e,s),a=i.fatal??r??!0;n.addIssue({code:"custom",...i,fatal:a})}}):Jt.create()}var Ay={object:Ke.lazycreate},k;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(k||(k={}));var jy=(t,e={message:`Input not instance of ${t.name}`})=>cl(r=>r instanceof t,e),ul=Xt.create,ll=_r.create,Dy=Qr.create,Ly=gr.create,dl=yr.create,My=vr.create,qy=Kr.create,Zy=br.create,Uy=Sr.create,Fy=Jt.create,Vy=Mt.create,By=pt.create,Hy=Xr.create,Gy=qt.create,Wy=Ke.create,Ky=Ke.strictCreate,Xy=xr.create,Jy=Dn.create,Yy=Er.create,Qy=Et.create,ev=Ln.create,tv=Jr.create,rv=Yr.create,sv=Mn.create,nv=$r.create,ov=wr.create,iv=Tr.create,av=kr.create,cv=Yt.create,uv=nt.create,lv=rt.create,dv=$t.create,pv=nt.createWithPreprocess,mv=Is.create,fv=()=>ul().optional(),hv=()=>ll().optional(),_v=()=>dl().optional(),gv={string:(t=>Xt.create({...t,coerce:!0})),number:(t=>_r.create({...t,coerce:!0})),boolean:(t=>yr.create({...t,coerce:!0})),bigint:(t=>gr.create({...t,coerce:!0})),date:(t=>vr.create({...t,coerce:!0}))};var yv=F;var _R=Object.freeze({status:"aborted"});function S(t,e,r){function s(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(t),e(a,c);for(let l in i.prototype)l in a||Object.defineProperty(a,l,{value:i.prototype[l].bind(a)});a._zod.constr=i,a._zod.def=c}let n=r?.Parent??Object;class o extends n{}Object.defineProperty(o,"name",{value:t});function i(a){var c;let u=r?.Parent?new o:this;s(u,a),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:s}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(i,"name",{value:t}),i}var gR=Symbol("zod_brand"),Zt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},qn={};function ot(t){return t&&Object.assign(qn,t),qn}var ue={};bi(ue,{BIGINT_FORMAT_RANGES:()=>ml,Class:()=>wi,NUMBER_FORMAT_RANGES:()=>Pi,aborted:()=>Nr,allowsEval:()=>Ii,assert:()=>Ev,assertEqual:()=>vv,assertIs:()=>Sv,assertNever:()=>xv,assertNotEqual:()=>bv,assignProp:()=>zi,cached:()=>Ns,captureStackTrace:()=>Un,cleanEnum:()=>jv,cleanRegex:()=>Cs,clone:()=>wt,createTransparentProxy:()=>zv,defineLazy:()=>fe,esc:()=>Or,escapeRegex:()=>Qt,extend:()=>Nv,finalizeIssue:()=>mt,floatSafeRemainder:()=>Ri,getElementAtPath:()=>$v,getEnumValues:()=>Ti,getLengthableOrigin:()=>As,getParsedType:()=>Rv,getSizableOrigin:()=>fl,isObject:()=>es,isPlainObject:()=>ts,issue:()=>Ci,joinValues:()=>Zn,jsonStringifyReplacer:()=>ki,merge:()=>Pv,normalizeParams:()=>V,nullish:()=>Ps,numKeys:()=>kv,omit:()=>Ov,optionalKeys:()=>Ni,partial:()=>Cv,pick:()=>Iv,prefixIssues:()=>Tt,primitiveTypes:()=>pl,promiseAllObject:()=>wv,propertyKeyTypes:()=>Oi,randomString:()=>Tv,required:()=>Av,stringifyPrimitive:()=>Fn,unwrapMessage:()=>Os});function vv(t){return t}function bv(t){return t}function Sv(t){}function xv(t){throw new Error}function Ev(t){}function Ti(t){let e=Object.values(t).filter(s=>typeof s=="number");return Object.entries(t).filter(([s,n])=>e.indexOf(+s)===-1).map(([s,n])=>n)}function Zn(t,e="|"){return t.map(r=>Fn(r)).join(e)}function ki(t,e){return typeof e=="bigint"?e.toString():e}function Ns(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function Ps(t){return t==null}function Cs(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function Ri(t,e){let r=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=r>s?r:s,o=Number.parseInt(t.toFixed(n).replace(".","")),i=Number.parseInt(e.toFixed(n).replace(".",""));return o%i/10**n}function fe(t,e,r){Object.defineProperty(t,e,{get(){{let n=r();return t[e]=n,n}throw new Error("cached value already set")},set(n){Object.defineProperty(t,e,{value:n})},configurable:!0})}function zi(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function $v(t,e){return e?e.reduce((r,s)=>r?.[s],t):t}function wv(t){let e=Object.keys(t),r=e.map(s=>t[s]);return Promise.all(r).then(s=>{let n={};for(let o=0;o<e.length;o++)n[e[o]]=s[o];return n})}function Tv(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let s=0;s<t;s++)r+=e[Math.floor(Math.random()*e.length)];return r}function Or(t){return JSON.stringify(t)}var Un=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function es(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var Ii=Ns(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function ts(t){if(es(t)===!1)return!1;let e=t.constructor;if(e===void 0)return!0;let r=e.prototype;return!(es(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function kv(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var Rv=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Oi=new Set(["string","number","symbol"]),pl=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Qt(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function wt(t,e,r){let s=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(s._zod.parent=t),s}function V(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function zv(t){let e;return new Proxy({},{get(r,s,n){return e??(e=t()),Reflect.get(e,s,n)},set(r,s,n,o){return e??(e=t()),Reflect.set(e,s,n,o)},has(r,s){return e??(e=t()),Reflect.has(e,s)},deleteProperty(r,s){return e??(e=t()),Reflect.deleteProperty(e,s)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,s){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,s)},defineProperty(r,s,n){return e??(e=t()),Reflect.defineProperty(e,s,n)}})}function Fn(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function Ni(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var Pi={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ml={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function Iv(t,e){let r={},s=t._zod.def;for(let n in e){if(!(n in s.shape))throw new Error(`Unrecognized key: "${n}"`);e[n]&&(r[n]=s.shape[n])}return wt(t,{...t._zod.def,shape:r,checks:[]})}function Ov(t,e){let r={...t._zod.def.shape},s=t._zod.def;for(let n in e){if(!(n in s.shape))throw new Error(`Unrecognized key: "${n}"`);e[n]&&delete r[n]}return wt(t,{...t._zod.def,shape:r,checks:[]})}function Nv(t,e){if(!ts(e))throw new Error("Invalid input to extend: expected a plain object");let r={...t._zod.def,get shape(){let s={...t._zod.def.shape,...e};return zi(this,"shape",s),s},checks:[]};return wt(t,r)}function Pv(t,e){return wt(t,{...t._zod.def,get shape(){let r={...t._zod.def.shape,...e._zod.def.shape};return zi(this,"shape",r),r},catchall:e._zod.def.catchall,checks:[]})}function Cv(t,e,r){let s=e._zod.def.shape,n={...s};if(r)for(let o in r){if(!(o in s))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(n[o]=t?new t({type:"optional",innerType:s[o]}):s[o])}else for(let o in s)n[o]=t?new t({type:"optional",innerType:s[o]}):s[o];return wt(e,{...e._zod.def,shape:n,checks:[]})}function Av(t,e,r){let s=e._zod.def.shape,n={...s};if(r)for(let o in r){if(!(o in n))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(n[o]=new t({type:"nonoptional",innerType:s[o]}))}else for(let o in s)n[o]=new t({type:"nonoptional",innerType:s[o]});return wt(e,{...e._zod.def,shape:n,checks:[]})}function Nr(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function Tt(t,e){return e.map(r=>{var s;return(s=r).path??(s.path=[]),r.path.unshift(t),r})}function Os(t){return typeof t=="string"?t:t?.message}function mt(t,e,r){let s={...t,path:t.path??[]};if(!t.message){let n=Os(t.inst?._zod.def?.error?.(t))??Os(e?.error?.(t))??Os(r.customError?.(t))??Os(r.localeError?.(t))??"Invalid input";s.message=n}return delete s.inst,delete s.continue,e?.reportInput||delete s.input,s}function fl(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function As(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Ci(...t){let[e,r,s]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:s}:{...e}}function jv(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var wi=class{constructor(...e){}};var hl=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,ki,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},Vn=S("$ZodError",hl),Ai=S("$ZodError",hl,{Parent:Error});function _l(t,e=r=>r.message){let r={},s=[];for(let n of t.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:r}}function gl(t,e){let r=e||function(o){return o.message},s={_errors:[]},n=o=>{for(let i of o.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>n({issues:a}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)s._errors.push(r(i));else{let a=s,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return n(t),s}var yl=t=>(e,r,s,n)=>{let o=s?Object.assign(s,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new Zt;if(i.issues.length){let a=new(n?.Err??t)(i.issues.map(c=>mt(c,o,ot())));throw Un(a,n?.callee),a}return i.value};var vl=t=>async(e,r,s,n)=>{let o=s?Object.assign(s,{async:!0}):{async:!0},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(n?.Err??t)(i.issues.map(c=>mt(c,o,ot())));throw Un(a,n?.callee),a}return i.value};var ji=t=>(e,r,s)=>{let n=s?{...s,async:!1}:{async:!1},o=e._zod.run({value:r,issues:[]},n);if(o instanceof Promise)throw new Zt;return o.issues.length?{success:!1,error:new(t??Vn)(o.issues.map(i=>mt(i,n,ot())))}:{success:!0,data:o.value}},js=ji(Ai),Di=t=>async(e,r,s)=>{let n=s?Object.assign(s,{async:!0}):{async:!0},o=e._zod.run({value:r,issues:[]},n);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new t(o.issues.map(i=>mt(i,n,ot())))}:{success:!0,data:o.value}},Bn=Di(Ai);var bl=/^[cC][^\s-]{8,}$/,Sl=/^[0-9a-z]+$/,xl=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,El=/^[0-9a-vA-V]{20}$/,$l=/^[A-Za-z0-9]{27}$/,wl=/^[a-zA-Z0-9_-]{21}$/,Tl=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var kl=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Li=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;var Rl=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;var Lv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function zl(){return new RegExp(Lv,"u")}var Il=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ol=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Nl=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Pl=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Cl=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Mi=/^[A-Za-z0-9_-]*$/,Al=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var jl=/^\+(?:[0-9]){6,14}[0-9]$/,Dl="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Ll=new RegExp(`^${Dl}$`);function Ml(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function ql(t){return new RegExp(`^${Ml(t)}$`)}function Zl(t){let e=Ml({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-]\\d{2}:\\d{2})");let s=`${e}(?:${r.join("|")})`;return new RegExp(`^${Dl}T(?:${s})$`)}var Ul=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)};var Fl=/^\d+$/,Vl=/^-?\d+(?:\.\d+)?/i,Bl=/true|false/i,Hl=/null/i;var Gl=/^[^A-Z]*$/,Wl=/^[^a-z]*$/;var Le=S("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),Kl={number:"number",bigint:"bigint",object:"date"},Zi=S("$ZodCheckLessThan",(t,e)=>{Le.init(t,e);let r=Kl[typeof e.value];t._zod.onattach.push(s=>{let n=s._zod.bag,o=(e.inclusive?n.maximum:n.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<o&&(e.inclusive?n.maximum=e.value:n.exclusiveMaximum=e.value)}),t._zod.check=s=>{(e.inclusive?s.value<=e.value:s.value<e.value)||s.issues.push({origin:r,code:"too_big",maximum:e.value,input:s.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Ui=S("$ZodCheckGreaterThan",(t,e)=>{Le.init(t,e);let r=Kl[typeof e.value];t._zod.onattach.push(s=>{let n=s._zod.bag,o=(e.inclusive?n.minimum:n.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>o&&(e.inclusive?n.minimum=e.value:n.exclusiveMinimum=e.value)}),t._zod.check=s=>{(e.inclusive?s.value>=e.value:s.value>e.value)||s.issues.push({origin:r,code:"too_small",minimum:e.value,input:s.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Xl=S("$ZodCheckMultipleOf",(t,e)=>{Le.init(t,e),t._zod.onattach.push(r=>{var s;(s=r._zod.bag).multipleOf??(s.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):Ri(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),Jl=S("$ZodCheckNumberFormat",(t,e)=>{Le.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),s=r?"int":"number",[n,o]=Pi[e.format];t._zod.onattach.push(i=>{let a=i._zod.bag;a.format=e.format,a.minimum=n,a.maximum=o,r&&(a.pattern=Fl)}),t._zod.check=i=>{let a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:s,format:e.format,code:"invalid_type",input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:s,continue:!e.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:s,continue:!e.abort});return}}a<n&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:n,inclusive:!0,inst:t,continue:!e.abort}),a>o&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:o,inst:t})}});var Yl=S("$ZodCheckMaxLength",(t,e)=>{var r;Le.init(t,e),(r=t._zod.def).when??(r.when=s=>{let n=s.value;return!Ps(n)&&n.length!==void 0}),t._zod.onattach.push(s=>{let n=s._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<n&&(s._zod.bag.maximum=e.maximum)}),t._zod.check=s=>{let n=s.value;if(n.length<=e.maximum)return;let i=As(n);s.issues.push({origin:i,code:"too_big",maximum:e.maximum,inclusive:!0,input:n,inst:t,continue:!e.abort})}}),Ql=S("$ZodCheckMinLength",(t,e)=>{var r;Le.init(t,e),(r=t._zod.def).when??(r.when=s=>{let n=s.value;return!Ps(n)&&n.length!==void 0}),t._zod.onattach.push(s=>{let n=s._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>n&&(s._zod.bag.minimum=e.minimum)}),t._zod.check=s=>{let n=s.value;if(n.length>=e.minimum)return;let i=As(n);s.issues.push({origin:i,code:"too_small",minimum:e.minimum,inclusive:!0,input:n,inst:t,continue:!e.abort})}}),ed=S("$ZodCheckLengthEquals",(t,e)=>{var r;Le.init(t,e),(r=t._zod.def).when??(r.when=s=>{let n=s.value;return!Ps(n)&&n.length!==void 0}),t._zod.onattach.push(s=>{let n=s._zod.bag;n.minimum=e.length,n.maximum=e.length,n.length=e.length}),t._zod.check=s=>{let n=s.value,o=n.length;if(o===e.length)return;let i=As(n),a=o>e.length;s.issues.push({origin:i,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:s.value,inst:t,continue:!e.abort})}}),Ds=S("$ZodCheckStringFormat",(t,e)=>{var r,s;Le.init(t,e),t._zod.onattach.push(n=>{let o=n._zod.bag;o.format=e.format,e.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:e.format,input:n.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(s=t._zod).check??(s.check=()=>{})}),td=S("$ZodCheckRegex",(t,e)=>{Ds.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),rd=S("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Gl),Ds.init(t,e)}),sd=S("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Wl),Ds.init(t,e)}),nd=S("$ZodCheckIncludes",(t,e)=>{Le.init(t,e);let r=Qt(e.includes),s=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=s,t._zod.onattach.push(n=>{let o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(s)}),t._zod.check=n=>{n.value.includes(e.includes,e.position)||n.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:n.value,inst:t,continue:!e.abort})}}),od=S("$ZodCheckStartsWith",(t,e)=>{Le.init(t,e);let r=new RegExp(`^${Qt(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(s=>{let n=s._zod.bag;n.patterns??(n.patterns=new Set),n.patterns.add(r)}),t._zod.check=s=>{s.value.startsWith(e.prefix)||s.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:s.value,inst:t,continue:!e.abort})}}),id=S("$ZodCheckEndsWith",(t,e)=>{Le.init(t,e);let r=new RegExp(`.*${Qt(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(s=>{let n=s._zod.bag;n.patterns??(n.patterns=new Set),n.patterns.add(r)}),t._zod.check=s=>{s.value.endsWith(e.suffix)||s.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:s.value,inst:t,continue:!e.abort})}});var ad=S("$ZodCheckOverwrite",(t,e)=>{Le.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Hn=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let s=e.split(`
`).filter(i=>i),n=Math.min(...s.map(i=>i.length-i.trimStart().length)),o=s.map(i=>i.slice(n)).map(i=>" ".repeat(this.indent*2)+i);for(let i of o)this.content.push(i)}compile(){let e=Function,r=this?.args,n=[...(this?.content??[""]).map(o=>`  ${o}`)];return new e(...r,n.join(`
`))}};var ud={major:4,minor:0,patch:0};var he=S("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=ud;let s=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&s.unshift(t);for(let n of s)for(let o of n._zod.onattach)o(t);if(s.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let n=(o,i,a)=>{let c=Nr(o),u;for(let l of i){if(l._zod.def.when){if(!l._zod.def.when(o))continue}else if(c)continue;let d=o.issues.length,p=l._zod.check(o);if(p instanceof Promise&&a?.async===!1)throw new Zt;if(u||p instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await p,o.issues.length!==d&&(c||(c=Nr(o,d)))});else{if(o.issues.length===d)continue;c||(c=Nr(o,d))}}return u?u.then(()=>o):o};t._zod.run=(o,i)=>{let a=t._zod.parse(o,i);if(a instanceof Promise){if(i.async===!1)throw new Zt;return a.then(c=>n(c,s,i))}return n(a,s,i)}}t["~standard"]={validate:n=>{try{let o=js(t,n);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return Bn(t,n).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Wn=S("$ZodString",(t,e)=>{he.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??Ul(t._zod.bag),t._zod.parse=(r,s)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),_e=S("$ZodStringFormat",(t,e)=>{Ds.init(t,e),Wn.init(t,e)}),vd=S("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=kl),_e.init(t,e)}),bd=S("$ZodUUID",(t,e)=>{if(e.version){let s={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(s===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=Li(s))}else e.pattern??(e.pattern=Li());_e.init(t,e)}),Sd=S("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Rl),_e.init(t,e)}),xd=S("$ZodURL",(t,e)=>{_e.init(t,e),t._zod.check=r=>{try{let s=r.value,n=new URL(s),o=n.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(n.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Al.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),!s.endsWith("/")&&o.endsWith("/")?r.value=o.slice(0,-1):r.value=o;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),Ed=S("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=zl()),_e.init(t,e)}),$d=S("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=wl),_e.init(t,e)}),wd=S("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=bl),_e.init(t,e)}),Td=S("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Sl),_e.init(t,e)}),kd=S("$ZodULID",(t,e)=>{e.pattern??(e.pattern=xl),_e.init(t,e)}),Rd=S("$ZodXID",(t,e)=>{e.pattern??(e.pattern=El),_e.init(t,e)}),zd=S("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=$l),_e.init(t,e)}),Id=S("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Zl(e)),_e.init(t,e)}),Od=S("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Ll),_e.init(t,e)}),Nd=S("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=ql(e)),_e.init(t,e)}),Pd=S("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=Tl),_e.init(t,e)}),Cd=S("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Il),_e.init(t,e),t._zod.onattach.push(r=>{let s=r._zod.bag;s.format="ipv4"})}),Ad=S("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Ol),_e.init(t,e),t._zod.onattach.push(r=>{let s=r._zod.bag;s.format="ipv6"}),t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),jd=S("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=Nl),_e.init(t,e)}),Dd=S("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Pl),_e.init(t,e),t._zod.check=r=>{let[s,n]=r.value.split("/");try{if(!n)throw new Error;let o=Number(n);if(`${o}`!==n)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Ld(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var Md=S("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Cl),_e.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),t._zod.check=r=>{Ld(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function Mv(t){if(!Mi.test(t))return!1;let e=t.replace(/[-_]/g,s=>s==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Ld(r)}var qd=S("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=Mi),_e.init(t,e),t._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),t._zod.check=r=>{Mv(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),Zd=S("$ZodE164",(t,e)=>{e.pattern??(e.pattern=jl),_e.init(t,e)});function qv(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[s]=r;if(!s)return!1;let n=JSON.parse(atob(s));return!("typ"in n&&n?.typ!=="JWT"||!n.alg||e&&(!("alg"in n)||n.alg!==e))}catch{return!1}}var Ud=S("$ZodJWT",(t,e)=>{_e.init(t,e),t._zod.check=r=>{qv(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}});var Vi=S("$ZodNumber",(t,e)=>{he.init(t,e),t._zod.pattern=t._zod.bag.pattern??Vl,t._zod.parse=(r,s)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let n=r.value;if(typeof n=="number"&&!Number.isNaN(n)&&Number.isFinite(n))return r;let o=typeof n=="number"?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:n,inst:t,...o?{received:o}:{}}),r}}),Fd=S("$ZodNumber",(t,e)=>{Jl.init(t,e),Vi.init(t,e)}),Vd=S("$ZodBoolean",(t,e)=>{he.init(t,e),t._zod.pattern=Bl,t._zod.parse=(r,s)=>{if(e.coerce)try{r.value=!!r.value}catch{}let n=r.value;return typeof n=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:t}),r}});var Bd=S("$ZodNull",(t,e)=>{he.init(t,e),t._zod.pattern=Hl,t._zod.values=new Set([null]),t._zod.parse=(r,s)=>{let n=r.value;return n===null||r.issues.push({expected:"null",code:"invalid_type",input:n,inst:t}),r}});var Hd=S("$ZodUnknown",(t,e)=>{he.init(t,e),t._zod.parse=r=>r}),Gd=S("$ZodNever",(t,e)=>{he.init(t,e),t._zod.parse=(r,s)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});function ld(t,e,r){t.issues.length&&e.issues.push(...Tt(r,t.issues)),e.value[r]=t.value}var Wd=S("$ZodArray",(t,e)=>{he.init(t,e),t._zod.parse=(r,s)=>{let n=r.value;if(!Array.isArray(n))return r.issues.push({expected:"array",code:"invalid_type",input:n,inst:t}),r;r.value=Array(n.length);let o=[];for(let i=0;i<n.length;i++){let a=n[i],c=e.element._zod.run({value:a,issues:[]},s);c instanceof Promise?o.push(c.then(u=>ld(u,r,i))):ld(c,r,i)}return o.length?Promise.all(o).then(()=>r):r}});function Gn(t,e,r){t.issues.length&&e.issues.push(...Tt(r,t.issues)),e.value[r]=t.value}function dd(t,e,r,s){t.issues.length?s[r]===void 0?r in s?e.value[r]=void 0:e.value[r]=t.value:e.issues.push(...Tt(r,t.issues)):t.value===void 0?r in s&&(e.value[r]=void 0):e.value[r]=t.value}var Kd=S("$ZodObject",(t,e)=>{he.init(t,e);let r=Ns(()=>{let d=Object.keys(e.shape);for(let m of d)if(!(e.shape[m]instanceof he))throw new Error(`Invalid element at key "${m}": expected a Zod schema`);let p=Ni(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(p)}});fe(t._zod,"propValues",()=>{let d=e.shape,p={};for(let m in d){let f=d[m]._zod;if(f.values){p[m]??(p[m]=new Set);for(let g of f.values)p[m].add(g)}}return p});let s=d=>{let p=new Hn(["shape","payload","ctx"]),m=r.value,f=$=>{let y=Or($);return`shape[${y}]._zod.run({ value: input[${y}], issues: [] }, ctx)`};p.write("const input = payload.value;");let g=Object.create(null),_=0;for(let $ of m.keys)g[$]=`key_${_++}`;p.write("const newResult = {}");for(let $ of m.keys)if(m.optionalKeys.has($)){let y=g[$];p.write(`const ${y} = ${f($)};`);let x=Or($);p.write(`
        if (${y}.issues.length) {
          if (input[${x}] === undefined) {
            if (${x} in input) {
              newResult[${x}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${y}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${x}, ...iss.path] : [${x}],
              }))
            );
          }
        } else if (${y}.value === undefined) {
          if (${x} in input) newResult[${x}] = undefined;
        } else {
          newResult[${x}] = ${y}.value;
        }
        `)}else{let y=g[$];p.write(`const ${y} = ${f($)};`),p.write(`
          if (${y}.issues.length) payload.issues = payload.issues.concat(${y}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Or($)}, ...iss.path] : [${Or($)}]
          })));`),p.write(`newResult[${Or($)}] = ${y}.value`)}p.write("payload.value = newResult;"),p.write("return payload;");let v=p.compile();return($,y)=>v(d,$,y)},n,o=es,i=!qn.jitless,c=i&&Ii.value,u=e.catchall,l;t._zod.parse=(d,p)=>{l??(l=r.value);let m=d.value;if(!o(m))return d.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),d;let f=[];if(i&&c&&p?.async===!1&&p.jitless!==!0)n||(n=s(e.shape)),d=n(d,p);else{d.value={};let y=l.shape;for(let x of l.keys){let E=y[x],T=E._zod.run({value:m[x],issues:[]},p),R=E._zod.optin==="optional"&&E._zod.optout==="optional";T instanceof Promise?f.push(T.then(j=>R?dd(j,d,x,m):Gn(j,d,x))):R?dd(T,d,x,m):Gn(T,d,x)}}if(!u)return f.length?Promise.all(f).then(()=>d):d;let g=[],_=l.keySet,v=u._zod,$=v.def.type;for(let y of Object.keys(m)){if(_.has(y))continue;if($==="never"){g.push(y);continue}let x=v.run({value:m[y],issues:[]},p);x instanceof Promise?f.push(x.then(E=>Gn(E,d,y))):Gn(x,d,y)}return g.length&&d.issues.push({code:"unrecognized_keys",keys:g,input:m,inst:t}),f.length?Promise.all(f).then(()=>d):d}});function pd(t,e,r,s){for(let n of t)if(n.issues.length===0)return e.value=n.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(n=>n.issues.map(o=>mt(o,s,ot())))}),e}var Bi=S("$ZodUnion",(t,e)=>{he.init(t,e),fe(t._zod,"optin",()=>e.options.some(r=>r._zod.optin==="optional")?"optional":void 0),fe(t._zod,"optout",()=>e.options.some(r=>r._zod.optout==="optional")?"optional":void 0),fe(t._zod,"values",()=>{if(e.options.every(r=>r._zod.values))return new Set(e.options.flatMap(r=>Array.from(r._zod.values)))}),fe(t._zod,"pattern",()=>{if(e.options.every(r=>r._zod.pattern)){let r=e.options.map(s=>s._zod.pattern);return new RegExp(`^(${r.map(s=>Cs(s.source)).join("|")})$`)}}),t._zod.parse=(r,s)=>{let n=!1,o=[];for(let i of e.options){let a=i._zod.run({value:r.value,issues:[]},s);if(a instanceof Promise)o.push(a),n=!0;else{if(a.issues.length===0)return a;o.push(a)}}return n?Promise.all(o).then(i=>pd(i,r,t,s)):pd(o,r,t,s)}}),Xd=S("$ZodDiscriminatedUnion",(t,e)=>{Bi.init(t,e);let r=t._zod.parse;fe(t._zod,"propValues",()=>{let n={};for(let o of e.options){let i=o._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(let[a,c]of Object.entries(i)){n[a]||(n[a]=new Set);for(let u of c)n[a].add(u)}}return n});let s=Ns(()=>{let n=e.options,o=new Map;for(let i of n){let a=i._zod.propValues[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(let c of a){if(o.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);o.set(c,i)}}return o});t._zod.parse=(n,o)=>{let i=n.value;if(!es(i))return n.issues.push({code:"invalid_type",expected:"object",input:i,inst:t}),n;let a=s.value.get(i?.[e.discriminator]);return a?a._zod.run(n,o):e.unionFallback?r(n,o):(n.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:i,path:[e.discriminator],inst:t}),n)}}),Jd=S("$ZodIntersection",(t,e)=>{he.init(t,e),t._zod.parse=(r,s)=>{let n=r.value,o=e.left._zod.run({value:n,issues:[]},s),i=e.right._zod.run({value:n,issues:[]},s);return o instanceof Promise||i instanceof Promise?Promise.all([o,i]).then(([c,u])=>md(r,c,u)):md(r,o,i)}});function Fi(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(ts(t)&&ts(e)){let r=Object.keys(e),s=Object.keys(t).filter(o=>r.indexOf(o)!==-1),n={...t,...e};for(let o of s){let i=Fi(t[o],e[o]);if(!i.valid)return{valid:!1,mergeErrorPath:[o,...i.mergeErrorPath]};n[o]=i.data}return{valid:!0,data:n}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let s=0;s<t.length;s++){let n=t[s],o=e[s],i=Fi(n,o);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function md(t,e,r){if(e.issues.length&&t.issues.push(...e.issues),r.issues.length&&t.issues.push(...r.issues),Nr(t))return t;let s=Fi(e.value,r.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return t.value=s.data,t}var Yd=S("$ZodRecord",(t,e)=>{he.init(t,e),t._zod.parse=(r,s)=>{let n=r.value;if(!ts(n))return r.issues.push({expected:"record",code:"invalid_type",input:n,inst:t}),r;let o=[];if(e.keyType._zod.values){let i=e.keyType._zod.values;r.value={};for(let c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){let u=e.valueType._zod.run({value:n[c],issues:[]},s);u instanceof Promise?o.push(u.then(l=>{l.issues.length&&r.issues.push(...Tt(c,l.issues)),r.value[c]=l.value})):(u.issues.length&&r.issues.push(...Tt(c,u.issues)),r.value[c]=u.value)}let a;for(let c in n)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:n,inst:t,keys:a})}else{r.value={};for(let i of Reflect.ownKeys(n)){if(i==="__proto__")continue;let a=e.keyType._zod.run({value:i,issues:[]},s);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>mt(u,s,ot())),input:i,path:[i],inst:t}),r.value[a.value]=a.value;continue}let c=e.valueType._zod.run({value:n[i],issues:[]},s);c instanceof Promise?o.push(c.then(u=>{u.issues.length&&r.issues.push(...Tt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...Tt(i,c.issues)),r.value[a.value]=c.value)}}return o.length?Promise.all(o).then(()=>r):r}});var Qd=S("$ZodEnum",(t,e)=>{he.init(t,e);let r=Ti(e.entries);t._zod.values=new Set(r),t._zod.pattern=new RegExp(`^(${r.filter(s=>Oi.has(typeof s)).map(s=>typeof s=="string"?Qt(s):s.toString()).join("|")})$`),t._zod.parse=(s,n)=>{let o=s.value;return t._zod.values.has(o)||s.issues.push({code:"invalid_value",values:r,input:o,inst:t}),s}}),ep=S("$ZodLiteral",(t,e)=>{he.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Qt(r):r?r.toString():String(r)).join("|")})$`),t._zod.parse=(r,s)=>{let n=r.value;return t._zod.values.has(n)||r.issues.push({code:"invalid_value",values:e.values,input:n,inst:t}),r}});var tp=S("$ZodTransform",(t,e)=>{he.init(t,e),t._zod.parse=(r,s)=>{let n=e.transform(r.value,r);if(s.async)return(n instanceof Promise?n:Promise.resolve(n)).then(i=>(r.value=i,r));if(n instanceof Promise)throw new Zt;return r.value=n,r}}),rp=S("$ZodOptional",(t,e)=>{he.init(t,e),t._zod.optin="optional",t._zod.optout="optional",fe(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),fe(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cs(r.source)})?$`):void 0}),t._zod.parse=(r,s)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(r,s):r.value===void 0?r:e.innerType._zod.run(r,s)}),sp=S("$ZodNullable",(t,e)=>{he.init(t,e),fe(t._zod,"optin",()=>e.innerType._zod.optin),fe(t._zod,"optout",()=>e.innerType._zod.optout),fe(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Cs(r.source)}|null)$`):void 0}),fe(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,s)=>r.value===null?r:e.innerType._zod.run(r,s)}),np=S("$ZodDefault",(t,e)=>{he.init(t,e),t._zod.optin="optional",fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,s)=>{if(r.value===void 0)return r.value=e.defaultValue,r;let n=e.innerType._zod.run(r,s);return n instanceof Promise?n.then(o=>fd(o,e)):fd(n,e)}});function fd(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var op=S("$ZodPrefault",(t,e)=>{he.init(t,e),t._zod.optin="optional",fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,s)=>(r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,s))}),ip=S("$ZodNonOptional",(t,e)=>{he.init(t,e),fe(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(s=>s!==void 0)):void 0}),t._zod.parse=(r,s)=>{let n=e.innerType._zod.run(r,s);return n instanceof Promise?n.then(o=>hd(o,t)):hd(n,t)}});function hd(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var ap=S("$ZodCatch",(t,e)=>{he.init(t,e),t._zod.optin="optional",fe(t._zod,"optout",()=>e.innerType._zod.optout),fe(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,s)=>{let n=e.innerType._zod.run(r,s);return n instanceof Promise?n.then(o=>(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(i=>mt(i,s,ot()))},input:r.value}),r.issues=[]),r)):(r.value=n.value,n.issues.length&&(r.value=e.catchValue({...r,error:{issues:n.issues.map(o=>mt(o,s,ot()))},input:r.value}),r.issues=[]),r)}});var cp=S("$ZodPipe",(t,e)=>{he.init(t,e),fe(t._zod,"values",()=>e.in._zod.values),fe(t._zod,"optin",()=>e.in._zod.optin),fe(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(r,s)=>{let n=e.in._zod.run(r,s);return n instanceof Promise?n.then(o=>_d(o,e,s)):_d(n,e,s)}});function _d(t,e,r){return Nr(t)?t:e.out._zod.run({value:t.value,issues:t.issues},r)}var up=S("$ZodReadonly",(t,e)=>{he.init(t,e),fe(t._zod,"propValues",()=>e.innerType._zod.propValues),fe(t._zod,"values",()=>e.innerType._zod.values),fe(t._zod,"optin",()=>e.innerType._zod.optin),fe(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(r,s)=>{let n=e.innerType._zod.run(r,s);return n instanceof Promise?n.then(gd):gd(n)}});function gd(t){return t.value=Object.freeze(t.value),t}var lp=S("$ZodCustom",(t,e)=>{Le.init(t,e),he.init(t,e),t._zod.parse=(r,s)=>r,t._zod.check=r=>{let s=r.value,n=e.fn(s);if(n instanceof Promise)return n.then(o=>yd(o,r,s,t));yd(n,r,s,t)}});function yd(t,e,r,s){if(!t){let n={code:"custom",input:r,inst:s,path:[...s._zod.def.path??[]],continue:!s._zod.def.abort};s._zod.def.params&&(n.params=s._zod.def.params),e.issues.push(Ci(n))}}var Zv=t=>{let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},Uv=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(s){return t[s]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return s=>{switch(s.code){case"invalid_type":return`Invalid input: expected ${s.expected}, received ${Zv(s.input)}`;case"invalid_value":return s.values.length===1?`Invalid input: expected ${Fn(s.values[0])}`:`Invalid option: expected one of ${Zn(s.values,"|")}`;case"too_big":{let n=s.inclusive?"<=":"<",o=e(s.origin);return o?`Too big: expected ${s.origin??"value"} to have ${n}${s.maximum.toString()} ${o.unit??"elements"}`:`Too big: expected ${s.origin??"value"} to be ${n}${s.maximum.toString()}`}case"too_small":{let n=s.inclusive?">=":">",o=e(s.origin);return o?`Too small: expected ${s.origin} to have ${n}${s.minimum.toString()} ${o.unit}`:`Too small: expected ${s.origin} to be ${n}${s.minimum.toString()}`}case"invalid_format":{let n=s;return n.format==="starts_with"?`Invalid string: must start with "${n.prefix}"`:n.format==="ends_with"?`Invalid string: must end with "${n.suffix}"`:n.format==="includes"?`Invalid string: must include "${n.includes}"`:n.format==="regex"?`Invalid string: must match pattern ${n.pattern}`:`Invalid ${r[n.format]??s.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${s.divisor}`;case"unrecognized_keys":return`Unrecognized key${s.keys.length>1?"s":""}: ${Zn(s.keys,", ")}`;case"invalid_key":return`Invalid key in ${s.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${s.origin}`;default:return"Invalid input"}}};function dp(){return{localeError:Uv()}}var OR=Symbol("ZodOutput"),NR=Symbol("ZodInput"),Hi=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...r){let s=r[0];if(this._map.set(e,s),s&&typeof s=="object"&&"id"in s){if(this._idmap.has(s.id))throw new Error(`ID ${s.id} already exists in the registry`);this._idmap.set(s.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let s={...this.get(r)??{}};return delete s.id,{...s,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function Fv(){return new Hi}var Ls=Fv();function pp(t,e){return new t({type:"string",...V(e)})}function mp(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...V(e)})}function Gi(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...V(e)})}function fp(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...V(e)})}function hp(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...V(e)})}function _p(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...V(e)})}function gp(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...V(e)})}function yp(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...V(e)})}function vp(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...V(e)})}function bp(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...V(e)})}function Sp(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...V(e)})}function xp(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...V(e)})}function Ep(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...V(e)})}function $p(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...V(e)})}function wp(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...V(e)})}function Tp(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...V(e)})}function kp(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...V(e)})}function Rp(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...V(e)})}function zp(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...V(e)})}function Ip(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...V(e)})}function Op(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...V(e)})}function Np(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...V(e)})}function Pp(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...V(e)})}function Cp(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...V(e)})}function Ap(t,e){return new t({type:"string",format:"date",check:"string_format",...V(e)})}function jp(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...V(e)})}function Dp(t,e){return new t({type:"string",format:"duration",check:"string_format",...V(e)})}function Lp(t,e){return new t({type:"number",checks:[],...V(e)})}function Mp(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...V(e)})}function qp(t,e){return new t({type:"boolean",...V(e)})}function Zp(t,e){return new t({type:"null",...V(e)})}function Up(t){return new t({type:"unknown"})}function Fp(t,e){return new t({type:"never",...V(e)})}function Kn(t,e){return new Zi({check:"less_than",...V(e),value:t,inclusive:!1})}function Ms(t,e){return new Zi({check:"less_than",...V(e),value:t,inclusive:!0})}function Xn(t,e){return new Ui({check:"greater_than",...V(e),value:t,inclusive:!1})}function qs(t,e){return new Ui({check:"greater_than",...V(e),value:t,inclusive:!0})}function Jn(t,e){return new Xl({check:"multiple_of",...V(e),value:t})}function Yn(t,e){return new Yl({check:"max_length",...V(e),maximum:t})}function rs(t,e){return new Ql({check:"min_length",...V(e),minimum:t})}function Qn(t,e){return new ed({check:"length_equals",...V(e),length:t})}function Wi(t,e){return new td({check:"string_format",format:"regex",...V(e),pattern:t})}function Ki(t){return new rd({check:"string_format",format:"lowercase",...V(t)})}function Xi(t){return new sd({check:"string_format",format:"uppercase",...V(t)})}function Ji(t,e){return new nd({check:"string_format",format:"includes",...V(e),includes:t})}function Yi(t,e){return new od({check:"string_format",format:"starts_with",...V(e),prefix:t})}function Qi(t,e){return new id({check:"string_format",format:"ends_with",...V(e),suffix:t})}function Pr(t){return new ad({check:"overwrite",tx:t})}function ea(t){return Pr(e=>e.normalize(t))}function ta(){return Pr(t=>t.trim())}function ra(){return Pr(t=>t.toLowerCase())}function sa(){return Pr(t=>t.toUpperCase())}function Vp(t,e,r){return new t({type:"array",element:e,...V(r)})}function Bp(t,e,r){let s=V(r);return s.abort??(s.abort=!0),new t({type:"custom",check:"custom",fn:e,...s})}function Hp(t,e,r){return new t({type:"custom",check:"custom",fn:e,...V(r)})}function er(t){return!!t._zod}function Ve(t,e){return er(t)?js(t,e):t.safeParse(e)}function ss(t){var e,r;if(!t)return;let s;if(er(t)?s=(r=(e=t._zod)===null||e===void 0?void 0:e.def)===null||r===void 0?void 0:r.shape:s=t.shape,!!s){if(typeof s=="function")try{return s()}catch{return}return s}}function Gp(t){var e;if(er(t)){let i=(e=t._zod)===null||e===void 0?void 0:e.def;if(i){if(i.value!==void 0)return i.value;if(Array.isArray(i.values)&&i.values.length>0)return i.values[0]}}let s=t._def;if(s){if(s.value!==void 0)return s.value;if(Array.isArray(s.values)&&s.values.length>0)return s.values[0]}let n=t.value;if(n!==void 0)return n}var Us={};bi(Us,{ZodISODate:()=>Kp,ZodISODateTime:()=>Wp,ZodISODuration:()=>Jp,ZodISOTime:()=>Xp,date:()=>oa,datetime:()=>na,duration:()=>aa,time:()=>ia});var Wp=S("ZodISODateTime",(t,e)=>{Id.init(t,e),be.init(t,e)});function na(t){return Cp(Wp,t)}var Kp=S("ZodISODate",(t,e)=>{Od.init(t,e),be.init(t,e)});function oa(t){return Ap(Kp,t)}var Xp=S("ZodISOTime",(t,e)=>{Nd.init(t,e),be.init(t,e)});function ia(t){return jp(Xp,t)}var Jp=S("ZodISODuration",(t,e)=>{Pd.init(t,e),be.init(t,e)});function aa(t){return Dp(Jp,t)}var Yp=(t,e)=>{Vn.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>gl(t,r)},flatten:{value:r=>_l(t,r)},addIssue:{value:r=>t.issues.push(r)},addIssues:{value:r=>t.issues.push(...r)},isEmpty:{get(){return t.issues.length===0}}})},pz=S("ZodError",Yp),Fs=S("ZodError",Yp,{Parent:Error});var Qp=yl(Fs),em=vl(Fs),tm=ji(Fs),rm=Di(Fs);var Ee=S("ZodType",(t,e)=>(he.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone({...e,checks:[...e.checks??[],...r.map(s=>typeof s=="function"?{_zod:{check:s,def:{check:"custom"},onattach:[]}}:s)]}),t.clone=(r,s)=>wt(t,r,s),t.brand=()=>t,t.register=((r,s)=>(r.add(t,s),t)),t.parse=(r,s)=>Qp(t,r,s,{callee:t.parse}),t.safeParse=(r,s)=>tm(t,r,s),t.parseAsync=async(r,s)=>em(t,r,s,{callee:t.parseAsync}),t.safeParseAsync=async(r,s)=>rm(t,r,s),t.spa=t.safeParseAsync,t.refine=(r,s)=>t.check(qb(r,s)),t.superRefine=r=>t.check(Zb(r)),t.overwrite=r=>t.check(Pr(r)),t.optional=()=>D(t),t.nullable=()=>om(t),t.nullish=()=>D(om(t)),t.nonoptional=r=>Pb(t,r),t.array=()=>te(t),t.or=r=>ge([t,r]),t.and=r=>to(t,r),t.transform=r=>ua(t,lm(r)),t.default=r=>Ib(t,r),t.prefault=r=>Nb(t,r),t.catch=r=>Ab(t,r),t.pipe=r=>ua(t,r),t.readonly=()=>Lb(t),t.describe=r=>{let s=t.clone();return Ls.add(s,{description:r}),s},Object.defineProperty(t,"description",{get(){return Ls.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return Ls.get(t);let s=t.clone();return Ls.add(s,r[0]),s},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),im=S("_ZodString",(t,e)=>{Wn.init(t,e),Ee.init(t,e);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...s)=>t.check(Wi(...s)),t.includes=(...s)=>t.check(Ji(...s)),t.startsWith=(...s)=>t.check(Yi(...s)),t.endsWith=(...s)=>t.check(Qi(...s)),t.min=(...s)=>t.check(rs(...s)),t.max=(...s)=>t.check(Yn(...s)),t.length=(...s)=>t.check(Qn(...s)),t.nonempty=(...s)=>t.check(rs(1,...s)),t.lowercase=s=>t.check(Ki(s)),t.uppercase=s=>t.check(Xi(s)),t.trim=()=>t.check(ta()),t.normalize=(...s)=>t.check(ea(...s)),t.toLowerCase=()=>t.check(ra()),t.toUpperCase=()=>t.check(sa())}),Yv=S("ZodString",(t,e)=>{Wn.init(t,e),im.init(t,e),t.email=r=>t.check(mp(Qv,r)),t.url=r=>t.check(yp(eb,r)),t.jwt=r=>t.check(Pp(hb,r)),t.emoji=r=>t.check(vp(tb,r)),t.guid=r=>t.check(Gi(sm,r)),t.uuid=r=>t.check(fp(eo,r)),t.uuidv4=r=>t.check(hp(eo,r)),t.uuidv6=r=>t.check(_p(eo,r)),t.uuidv7=r=>t.check(gp(eo,r)),t.nanoid=r=>t.check(bp(rb,r)),t.guid=r=>t.check(Gi(sm,r)),t.cuid=r=>t.check(Sp(sb,r)),t.cuid2=r=>t.check(xp(nb,r)),t.ulid=r=>t.check(Ep(ob,r)),t.base64=r=>t.check(Ip(pb,r)),t.base64url=r=>t.check(Op(mb,r)),t.xid=r=>t.check($p(ib,r)),t.ksuid=r=>t.check(wp(ab,r)),t.ipv4=r=>t.check(Tp(cb,r)),t.ipv6=r=>t.check(kp(ub,r)),t.cidrv4=r=>t.check(Rp(lb,r)),t.cidrv6=r=>t.check(zp(db,r)),t.e164=r=>t.check(Np(fb,r)),t.datetime=r=>t.check(na(r)),t.date=r=>t.check(oa(r)),t.time=r=>t.check(ia(r)),t.duration=r=>t.check(aa(r))});function b(t){return pp(Yv,t)}var be=S("ZodStringFormat",(t,e)=>{_e.init(t,e),im.init(t,e)}),Qv=S("ZodEmail",(t,e)=>{Sd.init(t,e),be.init(t,e)});var sm=S("ZodGUID",(t,e)=>{vd.init(t,e),be.init(t,e)});var eo=S("ZodUUID",(t,e)=>{bd.init(t,e),be.init(t,e)});var eb=S("ZodURL",(t,e)=>{xd.init(t,e),be.init(t,e)});var tb=S("ZodEmoji",(t,e)=>{Ed.init(t,e),be.init(t,e)});var rb=S("ZodNanoID",(t,e)=>{$d.init(t,e),be.init(t,e)});var sb=S("ZodCUID",(t,e)=>{wd.init(t,e),be.init(t,e)});var nb=S("ZodCUID2",(t,e)=>{Td.init(t,e),be.init(t,e)});var ob=S("ZodULID",(t,e)=>{kd.init(t,e),be.init(t,e)});var ib=S("ZodXID",(t,e)=>{Rd.init(t,e),be.init(t,e)});var ab=S("ZodKSUID",(t,e)=>{zd.init(t,e),be.init(t,e)});var cb=S("ZodIPv4",(t,e)=>{Cd.init(t,e),be.init(t,e)});var ub=S("ZodIPv6",(t,e)=>{Ad.init(t,e),be.init(t,e)});var lb=S("ZodCIDRv4",(t,e)=>{jd.init(t,e),be.init(t,e)});var db=S("ZodCIDRv6",(t,e)=>{Dd.init(t,e),be.init(t,e)});var pb=S("ZodBase64",(t,e)=>{Md.init(t,e),be.init(t,e)});var mb=S("ZodBase64URL",(t,e)=>{qd.init(t,e),be.init(t,e)});var fb=S("ZodE164",(t,e)=>{Zd.init(t,e),be.init(t,e)});var hb=S("ZodJWT",(t,e)=>{Ud.init(t,e),be.init(t,e)});var am=S("ZodNumber",(t,e)=>{Vi.init(t,e),Ee.init(t,e),t.gt=(s,n)=>t.check(Xn(s,n)),t.gte=(s,n)=>t.check(qs(s,n)),t.min=(s,n)=>t.check(qs(s,n)),t.lt=(s,n)=>t.check(Kn(s,n)),t.lte=(s,n)=>t.check(Ms(s,n)),t.max=(s,n)=>t.check(Ms(s,n)),t.int=s=>t.check(nm(s)),t.safe=s=>t.check(nm(s)),t.positive=s=>t.check(Xn(0,s)),t.nonnegative=s=>t.check(qs(0,s)),t.negative=s=>t.check(Kn(0,s)),t.nonpositive=s=>t.check(Ms(0,s)),t.multipleOf=(s,n)=>t.check(Jn(s,n)),t.step=(s,n)=>t.check(Jn(s,n)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function pe(t){return Lp(am,t)}var _b=S("ZodNumberFormat",(t,e)=>{Fd.init(t,e),am.init(t,e)});function nm(t){return Mp(_b,t)}var gb=S("ZodBoolean",(t,e)=>{Vd.init(t,e),Ee.init(t,e)});function Oe(t){return qp(gb,t)}var yb=S("ZodNull",(t,e)=>{Bd.init(t,e),Ee.init(t,e)});function la(t){return Zp(yb,t)}var vb=S("ZodUnknown",(t,e)=>{Hd.init(t,e),Ee.init(t,e)});function Te(){return Up(vb)}var bb=S("ZodNever",(t,e)=>{Gd.init(t,e),Ee.init(t,e)});function Sb(t){return Fp(bb,t)}var xb=S("ZodArray",(t,e)=>{Wd.init(t,e),Ee.init(t,e),t.element=e.element,t.min=(r,s)=>t.check(rs(r,s)),t.nonempty=r=>t.check(rs(1,r)),t.max=(r,s)=>t.check(Yn(r,s)),t.length=(r,s)=>t.check(Qn(r,s)),t.unwrap=()=>t.element});function te(t,e){return Vp(xb,t,e)}var cm=S("ZodObject",(t,e)=>{Kd.init(t,e),Ee.init(t,e),ue.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>Ne(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Te()}),t.loose=()=>t.clone({...t._zod.def,catchall:Te()}),t.strict=()=>t.clone({...t._zod.def,catchall:Sb()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>ue.extend(t,r),t.merge=r=>ue.merge(t,r),t.pick=r=>ue.pick(t,r),t.omit=r=>ue.omit(t,r),t.partial=(...r)=>ue.partial(dm,t,r[0]),t.required=(...r)=>ue.required(pm,t,r[0])});function I(t,e){let r={type:"object",get shape(){return ue.assignProp(this,"shape",{...t}),this.shape},...ue.normalizeParams(e)};return new cm(r)}function it(t,e){return new cm({type:"object",get shape(){return ue.assignProp(this,"shape",{...t}),this.shape},catchall:Te(),...ue.normalizeParams(e)})}var um=S("ZodUnion",(t,e)=>{Bi.init(t,e),Ee.init(t,e),t.options=e.options});function ge(t,e){return new um({type:"union",options:t,...ue.normalizeParams(e)})}var Eb=S("ZodDiscriminatedUnion",(t,e)=>{um.init(t,e),Xd.init(t,e)});function da(t,e,r){return new Eb({type:"union",options:e,discriminator:t,...ue.normalizeParams(r)})}var $b=S("ZodIntersection",(t,e)=>{Jd.init(t,e),Ee.init(t,e)});function to(t,e){return new $b({type:"intersection",left:t,right:e})}var wb=S("ZodRecord",(t,e)=>{Yd.init(t,e),Ee.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function ke(t,e,r){return new wb({type:"record",keyType:t,valueType:e,...ue.normalizeParams(r)})}var ca=S("ZodEnum",(t,e)=>{Qd.init(t,e),Ee.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(s,n)=>{let o={};for(let i of s)if(r.has(i))o[i]=e.entries[i];else throw new Error(`Key ${i} not found in enum`);return new ca({...e,checks:[],...ue.normalizeParams(n),entries:o})},t.exclude=(s,n)=>{let o={...e.entries};for(let i of s)if(r.has(i))delete o[i];else throw new Error(`Key ${i} not found in enum`);return new ca({...e,checks:[],...ue.normalizeParams(n),entries:o})}});function Ne(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(s=>[s,s])):t;return new ca({type:"enum",entries:r,...ue.normalizeParams(e)})}var Tb=S("ZodLiteral",(t,e)=>{ep.init(t,e),Ee.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function L(t,e){return new Tb({type:"literal",values:Array.isArray(t)?t:[t],...ue.normalizeParams(e)})}var kb=S("ZodTransform",(t,e)=>{tp.init(t,e),Ee.init(t,e),t._zod.parse=(r,s)=>{r.addIssue=o=>{if(typeof o=="string")r.issues.push(ue.issue(o,r.value,e));else{let i=o;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=t),i.continue??(i.continue=!0),r.issues.push(ue.issue(i))}};let n=e.transform(r.value,r);return n instanceof Promise?n.then(o=>(r.value=o,r)):(r.value=n,r)}});function lm(t){return new kb({type:"transform",transform:t})}var dm=S("ZodOptional",(t,e)=>{rp.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType});function D(t){return new dm({type:"optional",innerType:t})}var Rb=S("ZodNullable",(t,e)=>{sp.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType});function om(t){return new Rb({type:"nullable",innerType:t})}var zb=S("ZodDefault",(t,e)=>{np.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Ib(t,e){return new zb({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var Ob=S("ZodPrefault",(t,e)=>{op.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Nb(t,e){return new Ob({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}var pm=S("ZodNonOptional",(t,e)=>{ip.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Pb(t,e){return new pm({type:"nonoptional",innerType:t,...ue.normalizeParams(e)})}var Cb=S("ZodCatch",(t,e)=>{ap.init(t,e),Ee.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function Ab(t,e){return new Cb({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var jb=S("ZodPipe",(t,e)=>{cp.init(t,e),Ee.init(t,e),t.in=e.in,t.out=e.out});function ua(t,e){return new jb({type:"pipe",in:t,out:e})}var Db=S("ZodReadonly",(t,e)=>{up.init(t,e),Ee.init(t,e)});function Lb(t){return new Db({type:"readonly",innerType:t})}var mm=S("ZodCustom",(t,e)=>{lp.init(t,e),Ee.init(t,e)});function Mb(t){let e=new Le({check:"custom"});return e._zod.check=t,e}function fm(t,e){return Bp(mm,t??(()=>!0),e)}function qb(t,e={}){return Hp(mm,t,e)}function Zb(t){let e=Mb(r=>(r.addIssue=s=>{if(typeof s=="string")r.issues.push(ue.issue(s,r.value,e._zod.def));else{let n=s;n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=e),n.continue??(n.continue=!e._zod.def.abort),r.issues.push(ue.issue(n))}},t(r.value,r)));return e}function pa(t,e){return ua(lm(t),e)}ot(dp());var Vs="2025-11-25";var so=[Vs,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],Rt="io.modelcontextprotocol/related-task",no="2.0",kt=fm(t=>t!==null&&(typeof t=="object"||typeof t=="function")),hm=ge([b(),pe().int()]),_m=b(),Ub=it({ttl:ge([pe(),la()]).optional(),pollInterval:pe().optional()}),fa=it({taskId:b()}),Fb=it({progressToken:hm.optional(),[Rt]:fa.optional()}),Xe=it({task:Ub.optional(),_meta:Fb.optional()}),Pe=I({method:b(),params:Xe.optional()}),Cr=it({_meta:I({[Rt]:D(fa)}).passthrough().optional()}),at=I({method:b(),params:Cr.optional()}),Me=it({_meta:it({[Rt]:fa.optional()}).optional()}),oo=ge([b(),pe().int()]),gm=I({jsonrpc:L(no),id:oo,...Pe.shape}).strict(),ha=t=>gm.safeParse(t).success,ym=I({jsonrpc:L(no),...at.shape}).strict(),vm=t=>ym.safeParse(t).success,bm=I({jsonrpc:L(no),id:oo,result:Me}).strict(),Bs=t=>bm.safeParse(t).success,U;(function(t){t[t.ConnectionClosed=-32e3]="ConnectionClosed",t[t.RequestTimeout=-32001]="RequestTimeout",t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError",t[t.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(U||(U={}));var Sm=I({jsonrpc:L(no),id:oo,error:I({code:pe().int(),message:b(),data:D(Te())})}).strict(),xm=t=>Sm.safeParse(t).success,Em=ge([gm,ym,bm,Sm]),Ut=Me.strict(),Vb=Cr.extend({requestId:oo,reason:b().optional()}),io=at.extend({method:L("notifications/cancelled"),params:Vb}),Bb=I({src:b(),mimeType:b().optional(),sizes:te(b()).optional()}),Hs=I({icons:te(Bb).optional()}),ns=I({name:b(),title:b().optional()}),$m=ns.extend({...ns.shape,...Hs.shape,version:b(),websiteUrl:b().optional()}),Hb=to(I({applyDefaults:Oe().optional()}),ke(b(),Te())),Gb=pa(t=>t&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length===0?{form:{}}:t,to(I({form:Hb.optional(),url:kt.optional()}),ke(b(),Te()).optional())),Wb=I({list:D(I({}).passthrough()),cancel:D(I({}).passthrough()),requests:D(I({sampling:D(I({createMessage:D(I({}).passthrough())}).passthrough()),elicitation:D(I({create:D(I({}).passthrough())}).passthrough())}).passthrough())}).passthrough(),Kb=I({list:D(I({}).passthrough()),cancel:D(I({}).passthrough()),requests:D(I({tools:D(I({call:D(I({}).passthrough())}).passthrough())}).passthrough())}).passthrough(),Xb=I({experimental:ke(b(),kt).optional(),sampling:I({context:kt.optional(),tools:kt.optional()}).optional(),elicitation:Gb.optional(),roots:I({listChanged:Oe().optional()}).optional(),tasks:D(Wb)}),Jb=Xe.extend({protocolVersion:b(),capabilities:Xb,clientInfo:$m}),_a=Pe.extend({method:L("initialize"),params:Jb});var Yb=I({experimental:ke(b(),kt).optional(),logging:kt.optional(),completions:kt.optional(),prompts:D(I({listChanged:D(Oe())})),resources:I({subscribe:Oe().optional(),listChanged:Oe().optional()}).optional(),tools:I({listChanged:Oe().optional()}).optional(),tasks:D(Kb)}).passthrough(),ga=Me.extend({protocolVersion:b(),capabilities:Yb,serverInfo:$m,instructions:b().optional()}),ya=at.extend({method:L("notifications/initialized")});var ao=Pe.extend({method:L("ping")}),Qb=I({progress:pe(),total:D(pe()),message:D(b())}),e0=I({...Cr.shape,...Qb.shape,progressToken:hm}),co=at.extend({method:L("notifications/progress"),params:e0}),t0=Xe.extend({cursor:_m.optional()}),Gs=Pe.extend({params:t0.optional()}),Ws=Me.extend({nextCursor:D(_m)}),Ks=I({taskId:b(),status:Ne(["working","input_required","completed","failed","cancelled"]),ttl:ge([pe(),la()]),createdAt:b(),lastUpdatedAt:b(),pollInterval:D(pe()),statusMessage:D(b())}),Ft=Me.extend({task:Ks}),r0=Cr.merge(Ks),Xs=at.extend({method:L("notifications/tasks/status"),params:r0}),uo=Pe.extend({method:L("tasks/get"),params:Xe.extend({taskId:b()})}),lo=Me.merge(Ks),po=Pe.extend({method:L("tasks/result"),params:Xe.extend({taskId:b()})}),mo=Gs.extend({method:L("tasks/list")}),fo=Ws.extend({tasks:te(Ks)}),wm=Pe.extend({method:L("tasks/cancel"),params:Xe.extend({taskId:b()})}),Tm=Me.merge(Ks),km=I({uri:b(),mimeType:D(b()),_meta:ke(b(),Te()).optional()}),Rm=km.extend({text:b()}),va=b().refine(t=>{try{return atob(t),!0}catch{return!1}},{message:"Invalid Base64 string"}),zm=km.extend({blob:va}),os=I({audience:te(Ne(["user","assistant"])).optional(),priority:pe().min(0).max(1).optional(),lastModified:Us.datetime({offset:!0}).optional()}),Im=I({...ns.shape,...Hs.shape,uri:b(),description:D(b()),mimeType:D(b()),annotations:os.optional(),_meta:D(it({}))}),s0=I({...ns.shape,...Hs.shape,uriTemplate:b(),description:D(b()),mimeType:D(b()),annotations:os.optional(),_meta:D(it({}))}),n0=Gs.extend({method:L("resources/list")}),ba=Ws.extend({resources:te(Im)}),o0=Gs.extend({method:L("resources/templates/list")}),Sa=Ws.extend({resourceTemplates:te(s0)}),xa=Xe.extend({uri:b()}),i0=xa,a0=Pe.extend({method:L("resources/read"),params:i0}),Ea=Me.extend({contents:te(ge([Rm,zm]))}),c0=at.extend({method:L("notifications/resources/list_changed")}),u0=xa,l0=Pe.extend({method:L("resources/subscribe"),params:u0}),d0=xa,p0=Pe.extend({method:L("resources/unsubscribe"),params:d0}),m0=Cr.extend({uri:b()}),f0=at.extend({method:L("notifications/resources/updated"),params:m0}),h0=I({name:b(),description:D(b()),required:D(Oe())}),_0=I({...ns.shape,...Hs.shape,description:D(b()),arguments:D(te(h0)),_meta:D(it({}))}),g0=Gs.extend({method:L("prompts/list")}),$a=Ws.extend({prompts:te(_0)}),y0=Xe.extend({name:b(),arguments:ke(b(),b()).optional()}),v0=Pe.extend({method:L("prompts/get"),params:y0}),wa=I({type:L("text"),text:b(),annotations:os.optional(),_meta:ke(b(),Te()).optional()}),Ta=I({type:L("image"),data:va,mimeType:b(),annotations:os.optional(),_meta:ke(b(),Te()).optional()}),ka=I({type:L("audio"),data:va,mimeType:b(),annotations:os.optional(),_meta:ke(b(),Te()).optional()}),b0=I({type:L("tool_use"),name:b(),id:b(),input:I({}).passthrough(),_meta:D(I({}).passthrough())}).passthrough(),S0=I({type:L("resource"),resource:ge([Rm,zm]),annotations:os.optional(),_meta:ke(b(),Te()).optional()}),x0=Im.extend({type:L("resource_link")}),Ra=ge([wa,Ta,ka,x0,S0]),E0=I({role:Ne(["user","assistant"]),content:Ra}),za=Me.extend({description:D(b()),messages:te(E0)}),$0=at.extend({method:L("notifications/prompts/list_changed")}),w0=I({title:b().optional(),readOnlyHint:Oe().optional(),destructiveHint:Oe().optional(),idempotentHint:Oe().optional(),openWorldHint:Oe().optional()}),T0=I({taskSupport:Ne(["required","optional","forbidden"]).optional()}),Om=I({...ns.shape,...Hs.shape,description:b().optional(),inputSchema:I({type:L("object"),properties:ke(b(),kt).optional(),required:te(b()).optional()}).catchall(Te()),outputSchema:I({type:L("object"),properties:ke(b(),kt).optional(),required:te(b()).optional()}).catchall(Te()).optional(),annotations:D(w0),execution:D(T0),_meta:ke(b(),Te()).optional()}),Ia=Gs.extend({method:L("tools/list")}),Oa=Ws.extend({tools:te(Om)}),tr=Me.extend({content:te(Ra).default([]),structuredContent:ke(b(),Te()).optional(),isError:D(Oe())}),oI=tr.or(Me.extend({toolResult:Te()})),k0=Xe.extend({name:b(),arguments:D(ke(b(),Te()))}),Js=Pe.extend({method:L("tools/call"),params:k0}),R0=at.extend({method:L("notifications/tools/list_changed")}),Ys=Ne(["debug","info","notice","warning","error","critical","alert","emergency"]),z0=Xe.extend({level:Ys}),Na=Pe.extend({method:L("logging/setLevel"),params:z0}),I0=Cr.extend({level:Ys,logger:b().optional(),data:Te()}),O0=at.extend({method:L("notifications/message"),params:I0}),N0=I({name:b().optional()}),P0=I({hints:D(te(N0)),costPriority:D(pe().min(0).max(1)),speedPriority:D(pe().min(0).max(1)),intelligencePriority:D(pe().min(0).max(1))}),C0=I({mode:D(Ne(["auto","required","none"]))}),A0=I({type:L("tool_result"),toolUseId:b().describe("The unique identifier for the corresponding tool call."),content:te(Ra).default([]),structuredContent:I({}).passthrough().optional(),isError:D(Oe()),_meta:D(I({}).passthrough())}).passthrough(),j0=da("type",[wa,Ta,ka]),ro=da("type",[wa,Ta,ka,b0,A0]),D0=I({role:Ne(["user","assistant"]),content:ge([ro,te(ro)]),_meta:D(I({}).passthrough())}).passthrough(),L0=Xe.extend({messages:te(D0),modelPreferences:P0.optional(),systemPrompt:b().optional(),includeContext:Ne(["none","thisServer","allServers"]).optional(),temperature:pe().optional(),maxTokens:pe().int(),stopSequences:te(b()).optional(),metadata:kt.optional(),tools:D(te(Om)),toolChoice:D(C0)}),Pa=Pe.extend({method:L("sampling/createMessage"),params:L0}),Qs=Me.extend({model:b(),stopReason:D(Ne(["endTurn","stopSequence","maxTokens"]).or(b())),role:Ne(["user","assistant"]),content:j0}),Ca=Me.extend({model:b(),stopReason:D(Ne(["endTurn","stopSequence","maxTokens","toolUse"]).or(b())),role:Ne(["user","assistant"]),content:ge([ro,te(ro)])}),M0=I({type:L("boolean"),title:b().optional(),description:b().optional(),default:Oe().optional()}),q0=I({type:L("string"),title:b().optional(),description:b().optional(),minLength:pe().optional(),maxLength:pe().optional(),format:Ne(["email","uri","date","date-time"]).optional(),default:b().optional()}),Z0=I({type:Ne(["number","integer"]),title:b().optional(),description:b().optional(),minimum:pe().optional(),maximum:pe().optional(),default:pe().optional()}),U0=I({type:L("string"),title:b().optional(),description:b().optional(),enum:te(b()),default:b().optional()}),F0=I({type:L("string"),title:b().optional(),description:b().optional(),oneOf:te(I({const:b(),title:b()})),default:b().optional()}),V0=I({type:L("string"),title:b().optional(),description:b().optional(),enum:te(b()),enumNames:te(b()).optional(),default:b().optional()}),B0=ge([U0,F0]),H0=I({type:L("array"),title:b().optional(),description:b().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:I({type:L("string"),enum:te(b())}),default:te(b()).optional()}),G0=I({type:L("array"),title:b().optional(),description:b().optional(),minItems:pe().optional(),maxItems:pe().optional(),items:I({anyOf:te(I({const:b(),title:b()}))}),default:te(b()).optional()}),W0=ge([H0,G0]),K0=ge([V0,B0,W0]),X0=ge([K0,M0,q0,Z0]),J0=Xe.extend({mode:L("form").optional(),message:b(),requestedSchema:I({type:L("object"),properties:ke(b(),X0),required:te(b()).optional()})}),Y0=Xe.extend({mode:L("url"),message:b(),elicitationId:b(),url:b().url()}),Q0=ge([J0,Y0]),Aa=Pe.extend({method:L("elicitation/create"),params:Q0}),eS=Cr.extend({elicitationId:b()}),tS=at.extend({method:L("notifications/elicitation/complete"),params:eS}),is=Me.extend({action:Ne(["accept","decline","cancel"]),content:pa(t=>t===null?void 0:t,ke(b(),ge([b(),pe(),Oe(),te(b())])).optional())}),rS=I({type:L("ref/resource"),uri:b()});var sS=I({type:L("ref/prompt"),name:b()}),nS=Xe.extend({ref:ge([sS,rS]),argument:I({name:b(),value:b()}),context:I({arguments:ke(b(),b()).optional()}).optional()}),oS=Pe.extend({method:L("completion/complete"),params:nS});var ja=Me.extend({completion:it({values:te(b()).max(100),total:D(pe().int()),hasMore:D(Oe())})}),iS=I({uri:b().startsWith("file://"),name:b().optional(),_meta:ke(b(),Te()).optional()}),aS=Pe.extend({method:L("roots/list")}),Da=Me.extend({roots:te(iS)}),cS=at.extend({method:L("notifications/roots/list_changed")}),iI=ge([ao,_a,oS,Na,v0,g0,n0,o0,a0,l0,p0,Js,Ia,uo,po,mo]),aI=ge([io,co,ya,cS,Xs]),cI=ge([Ut,Qs,Ca,is,Da,lo,fo,Ft]),uI=ge([ao,Pa,Aa,aS,uo,po,mo]),lI=ge([io,co,O0,f0,c0,R0,$0,Xs,tS]),dI=ge([Ut,ga,ja,za,$a,ba,Sa,Ea,tr,Oa,lo,fo,Ft]),A=class t extends Error{constructor(e,r,s){super(`MCP error ${e}: ${r}`),this.code=e,this.data=s,this.name="McpError"}static fromError(e,r,s){if(e===U.UrlElicitationRequired&&s){let n=s;if(n.elicitations)return new ma(n.elicitations,r)}return new t(e,r,s)}},ma=class extends A{constructor(e,r=`URL elicitation${e.length>1?"s":""} required`){super(U.UrlElicitationRequired,r,{elicitations:e})}get elicitations(){var e,r;return(r=(e=this.data)===null||e===void 0?void 0:e.elicitations)!==null&&r!==void 0?r:[]}};function rr(t){return t==="completed"||t==="failed"||t==="cancelled"}var Pm=Symbol("Let zodToJsonSchema decide on which parser to use");var Nm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Cm=t=>typeof t=="string"?{...Nm,name:t}:{...Nm,...t};var Am=t=>{let e=Cm(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([s,n])=>[n._def,{def:n._def,path:[...e.basePath,e.definitionPath,s],jsonSchema:void 0}]))}};function La(t,e,r,s){s?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function re(t,e,r,s,n){t[e]=r,La(t,e,s,n)}var ho=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function Se(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?ho(e,t.currentPath):e.join("/")}}function jm(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==k.ZodAny&&(r.items=B(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&re(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&re(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(re(r,"minItems",t.exactLength.value,t.exactLength.message,e),re(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function Dm(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let s of t.checks)switch(s.kind){case"min":e.target==="jsonSchema7"?s.inclusive?re(r,"minimum",s.value,s.message,e):re(r,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(r.exclusiveMinimum=!0),re(r,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?re(r,"maximum",s.value,s.message,e):re(r,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(r.exclusiveMaximum=!0),re(r,"maximum",s.value,s.message,e));break;case"multipleOf":re(r,"multipleOf",s.value,s.message,e);break}return r}function Lm(){return{type:"boolean"}}function _o(t,e){return B(t.type._def,e)}var Mm=(t,e)=>B(t.innerType._def,e);function Ma(t,e,r){let s=r??e.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((n,o)=>Ma(t,e,n))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return uS(t,e)}}var uS=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let s of t.checks)switch(s.kind){case"min":re(r,"minimum",s.value,s.message,e);break;case"max":re(r,"maximum",s.value,s.message,e);break}return r};function qm(t,e){return{...B(t.innerType._def,e),default:t.defaultValue()}}function Zm(t,e){return e.effectStrategy==="input"?B(t.schema._def,e):Se(e)}function Um(t){return{type:"string",enum:Array.from(t.values)}}var lS=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Fm(t,e){let r=[B(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),B(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o),s=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(o=>{if(lS(o))n.push(...o.allOf),o.unevaluatedProperties===void 0&&(s=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){let{additionalProperties:a,...c}=o;i=c}else s=void 0;n.push(i)}}),n.length?{allOf:n,...s}:void 0}function Vm(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var qa,ft={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(qa===void 0&&(qa=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),qa),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function go(t,e){let r={type:"string"};if(t.checks)for(let s of t.checks)switch(s.kind){case"min":re(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,s.value):s.value,s.message,e);break;case"max":re(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ht(r,"email",s.message,e);break;case"format:idn-email":ht(r,"idn-email",s.message,e);break;case"pattern:zod":Be(r,ft.email,s.message,e);break}break;case"url":ht(r,"uri",s.message,e);break;case"uuid":ht(r,"uuid",s.message,e);break;case"regex":Be(r,s.regex,s.message,e);break;case"cuid":Be(r,ft.cuid,s.message,e);break;case"cuid2":Be(r,ft.cuid2,s.message,e);break;case"startsWith":Be(r,RegExp(`^${Za(s.value,e)}`),s.message,e);break;case"endsWith":Be(r,RegExp(`${Za(s.value,e)}$`),s.message,e);break;case"datetime":ht(r,"date-time",s.message,e);break;case"date":ht(r,"date",s.message,e);break;case"time":ht(r,"time",s.message,e);break;case"duration":ht(r,"duration",s.message,e);break;case"length":re(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,s.value):s.value,s.message,e),re(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,s.value):s.value,s.message,e);break;case"includes":{Be(r,RegExp(Za(s.value,e)),s.message,e);break}case"ip":{s.version!=="v6"&&ht(r,"ipv4",s.message,e),s.version!=="v4"&&ht(r,"ipv6",s.message,e);break}case"base64url":Be(r,ft.base64url,s.message,e);break;case"jwt":Be(r,ft.jwt,s.message,e);break;case"cidr":{s.version!=="v6"&&Be(r,ft.ipv4Cidr,s.message,e),s.version!=="v4"&&Be(r,ft.ipv6Cidr,s.message,e);break}case"emoji":Be(r,ft.emoji(),s.message,e);break;case"ulid":{Be(r,ft.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{ht(r,"binary",s.message,e);break}case"contentEncoding:base64":{re(r,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Be(r,ft.base64,s.message,e);break}}break}case"nanoid":Be(r,ft.nanoid,s.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function Za(t,e){return e.patternStrategy==="escape"?pS(t):t}var dS=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function pS(t){let e="";for(let r=0;r<t.length;r++)dS.has(t[r])||(e+="\\"),e+=t[r];return e}function ht(t,e,r,s){t.format||t.anyOf?.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&s.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&s.errorMessages&&{errorMessage:{format:r}}})):re(t,"format",e,r,s)}function Be(t,e,r,s){t.pattern||t.allOf?.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&s.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Bm(e,s),...r&&s.errorMessages&&{errorMessage:{pattern:r}}})):re(t,"pattern",Bm(e,s),r,s)}function Bm(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source,n="",o=!1,i=!1,a=!1;for(let c=0;c<s.length;c++){if(o){n+=s[c],o=!1;continue}if(r.i){if(i){if(s[c].match(/[a-z]/)){a?(n+=s[c],n+=`${s[c-2]}-${s[c]}`.toUpperCase(),a=!1):s[c+1]==="-"&&s[c+2]?.match(/[a-z]/)?(n+=s[c],a=!0):n+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){n+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(r.m){if(s[c]==="^"){n+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){n+=`($|(?=[\r
]))`;continue}}if(r.s&&s[c]==="."){n+=i?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}n+=s[c],s[c]==="\\"?o=!0:i&&s[c]==="]"?i=!1:!i&&s[c]==="["&&(i=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return n}function yo(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===k.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((s,n)=>({...s,[n]:B(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",n]})??Se(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:B(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===k.ZodString&&t.keyType._def.checks?.length){let{type:s,...n}=go(t.keyType._def,e);return{...r,propertyNames:n}}else{if(t.keyType?._def.typeName===k.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===k.ZodBranded&&t.keyType._def.type._def.typeName===k.ZodString&&t.keyType._def.type._def.checks?.length){let{type:s,...n}=_o(t.keyType._def,e);return{...r,propertyNames:n}}}return r}function Hm(t,e){if(e.mapStrategy==="record")return yo(t,e);let r=B(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Se(e),s=B(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Se(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,s],minItems:2,maxItems:2}}}function Gm(t){let e=t.values,s=Object.keys(t.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),n=Array.from(new Set(s.map(o=>typeof o)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:s}}function Wm(t){return t.target==="openAi"?void 0:{not:Se({...t,currentPath:[...t.currentPath,"not"]})}}function Km(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var en={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Jm(t,e){if(e.target==="openApi3")return Xm(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(s=>s._def.typeName in en&&(!s._def.checks||!s._def.checks.length))){let s=r.reduce((n,o)=>{let i=en[o._def.typeName];return i&&!n.includes(i)?[...n,i]:n},[]);return{type:s.length>1?s:s[0]}}else if(r.every(s=>s._def.typeName==="ZodLiteral"&&!s.description)){let s=r.reduce((n,o)=>{let i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...n,i];case"bigint":return[...n,"integer"];case"object":if(o._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(s.length===r.length){let n=s.filter((o,i,a)=>a.indexOf(o)===i);return{type:n.length>1?n:n[0],enum:r.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(r.every(s=>s._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((s,n)=>[...s,...n._def.values.filter(o=>!s.includes(o))],[])};return Xm(t,e)}var Xm=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((s,n)=>B(s._def,{...e,currentPath:[...e.currentPath,"anyOf",`${n}`]})).filter(s=>!!s&&(!e.strictUnions||typeof s=="object"&&Object.keys(s).length>0));return r.length?{anyOf:r}:void 0};function Ym(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:en[t.innerType._def.typeName],nullable:!0}:{type:[en[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let s=B(t.innerType._def,{...e,currentPath:[...e.currentPath]});return s&&"$ref"in s?{allOf:[s],nullable:!0}:s&&{...s,nullable:!0}}let r=B(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Qm(t,e){let r={type:"number"};if(!t.checks)return r;for(let s of t.checks)switch(s.kind){case"int":r.type="integer",La(r,"type",s.message,e);break;case"min":e.target==="jsonSchema7"?s.inclusive?re(r,"minimum",s.value,s.message,e):re(r,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(r.exclusiveMinimum=!0),re(r,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?re(r,"maximum",s.value,s.message,e):re(r,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(r.exclusiveMaximum=!0),re(r,"maximum",s.value,s.message,e));break;case"multipleOf":re(r,"multipleOf",s.value,s.message,e);break}return r}function ef(t,e){let r=e.target==="openAi",s={type:"object",properties:{}},n=[],o=t.shape();for(let a in o){let c=o[a];if(c===void 0||c._def===void 0)continue;let u=fS(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=B(c._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});l!==void 0&&(s.properties[a]=l,u||n.push(a))}n.length&&(s.required=n);let i=mS(t,e);return i!==void 0&&(s.additionalProperties=i),s}function mS(t,e){if(t.catchall._def.typeName!=="ZodNever")return B(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function fS(t){try{return t.isOptional()}catch{return!0}}var tf=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return B(t.innerType._def,e);let r=B(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Se(e)},r]}:Se(e)};var rf=(t,e)=>{if(e.pipeStrategy==="input")return B(t.in._def,e);if(e.pipeStrategy==="output")return B(t.out._def,e);let r=B(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),s=B(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(n=>n!==void 0)}};function sf(t,e){return B(t.type._def,e)}function nf(t,e){let s={type:"array",uniqueItems:!0,items:B(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&re(s,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&re(s,"maxItems",t.maxSize.value,t.maxSize.message,e),s}function of(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,s)=>B(r._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((r,s)=>s===void 0?r:[...r,s],[]),additionalItems:B(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,s)=>B(r._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((r,s)=>s===void 0?r:[...r,s],[])}}function af(t){return{not:Se(t)}}function cf(t){return Se(t)}var uf=(t,e)=>B(t.innerType._def,e);var lf=(t,e,r)=>{switch(e){case k.ZodString:return go(t,r);case k.ZodNumber:return Qm(t,r);case k.ZodObject:return ef(t,r);case k.ZodBigInt:return Dm(t,r);case k.ZodBoolean:return Lm();case k.ZodDate:return Ma(t,r);case k.ZodUndefined:return af(r);case k.ZodNull:return Km(r);case k.ZodArray:return jm(t,r);case k.ZodUnion:case k.ZodDiscriminatedUnion:return Jm(t,r);case k.ZodIntersection:return Fm(t,r);case k.ZodTuple:return of(t,r);case k.ZodRecord:return yo(t,r);case k.ZodLiteral:return Vm(t,r);case k.ZodEnum:return Um(t);case k.ZodNativeEnum:return Gm(t);case k.ZodNullable:return Ym(t,r);case k.ZodOptional:return tf(t,r);case k.ZodMap:return Hm(t,r);case k.ZodSet:return nf(t,r);case k.ZodLazy:return()=>t.getter()._def;case k.ZodPromise:return sf(t,r);case k.ZodNaN:case k.ZodNever:return Wm(r);case k.ZodEffects:return Zm(t,r);case k.ZodAny:return Se(r);case k.ZodUnknown:return cf(r);case k.ZodDefault:return qm(t,r);case k.ZodBranded:return _o(t,r);case k.ZodReadonly:return uf(t,r);case k.ZodCatch:return Mm(t,r);case k.ZodPipeline:return rf(t,r);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(s=>{})(e)}};function B(t,e,r=!1){let s=e.seen.get(t);if(e.override){let a=e.override?.(t,e,s,r);if(a!==Pm)return a}if(s&&!r){let a=hS(s,e);if(a!==void 0)return a}let n={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,n);let o=lf(t,t.typeName,e),i=typeof o=="function"?B(o(),e):o;if(i&&_S(t,e,i),e.postProcess){let a=e.postProcess(i,t,e);return n.jsonSchema=i,a}return n.jsonSchema=i,i}var hS=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:ho(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Se(e)):e.$refStrategy==="seen"?Se(e):void 0}},_S=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var vo=(t,e)=>{let r=Am(e),s=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:B(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??Se(r)}),{}):void 0,n=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,o=B(t._def,n===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??Se(r),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(o.title=i),r.flags.hasReferencedOpenAiAnyType&&(s||(s={}),s[r.openAiAnyTypeName]||(s[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let a=n===void 0?s?{...o,[r.definitionPath]:s}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...s,[n]:o}};return r.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Ua(t){let e=ss(t),r=e?.method;if(!r)throw new Error("Schema is missing a method literal");let s=Gp(r);if(typeof s!="string")throw new Error("Schema method literal must be a string");return s}function Fa(t,e){let r=Ve(t,e);if(!r.success)throw r.error;return r.data}var gS=6e4,as=class{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(io,r=>{this._oncancel(r)}),this.setNotificationHandler(co,r=>{this._onprogress(r)}),this.setRequestHandler(ao,r=>({})),this._taskStore=e?.taskStore,this._taskMessageQueue=e?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(uo,async(r,s)=>{let n=await this._taskStore.getTask(r.params.taskId,s.sessionId);if(!n)throw new A(U.InvalidParams,"Failed to retrieve task: Task not found");return{...n}}),this.setRequestHandler(po,async(r,s)=>{let n=async()=>{var o;let i=r.params.taskId;if(this._taskMessageQueue){let c;for(;c=await this._taskMessageQueue.dequeue(i,s.sessionId);){if(c.type==="response"||c.type==="error"){let u=c.message,l=u.id,d=this._requestResolvers.get(l);if(d)if(this._requestResolvers.delete(l),c.type==="response")d(u);else{let p=u,m=new A(p.error.code,p.error.message,p.error.data);d(m)}else{let p=c.type==="response"?"Response":"Error";this._onerror(new Error(`${p} handler missing for request ${l}`))}continue}await((o=this._transport)===null||o===void 0?void 0:o.send(c.message,{relatedRequestId:s.requestId}))}}let a=await this._taskStore.getTask(i,s.sessionId);if(!a)throw new A(U.InvalidParams,`Task not found: ${i}`);if(!rr(a.status))return await this._waitForTaskUpdate(i,s.signal),await n();if(rr(a.status)){let c=await this._taskStore.getTaskResult(i,s.sessionId);return this._clearTaskQueue(i),{...c,_meta:{...c._meta,[Rt]:{taskId:i}}}}return await n()};return await n()}),this.setRequestHandler(mo,async(r,s)=>{var n;try{let{tasks:o,nextCursor:i}=await this._taskStore.listTasks((n=r.params)===null||n===void 0?void 0:n.cursor,s.sessionId);return{tasks:o,nextCursor:i,_meta:{}}}catch(o){throw new A(U.InvalidParams,`Failed to list tasks: ${o instanceof Error?o.message:String(o)}`)}}),this.setRequestHandler(wm,async(r,s)=>{try{let n=await this._taskStore.getTask(r.params.taskId,s.sessionId);if(!n)throw new A(U.InvalidParams,`Task not found: ${r.params.taskId}`);if(rr(n.status))throw new A(U.InvalidParams,`Cannot cancel task in terminal status: ${n.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",s.sessionId),this._clearTaskQueue(r.params.taskId);let o=await this._taskStore.getTask(r.params.taskId,s.sessionId);if(!o)throw new A(U.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...o}}catch(n){throw n instanceof A?n:new A(U.InvalidRequest,`Failed to cancel task: ${n instanceof Error?n.message:String(n)}`)}}))}async _oncancel(e){let r=this._requestHandlerAbortControllers.get(e.params.requestId);r?.abort(e.params.reason)}_setupTimeout(e,r,s,n,o=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(n,r),startTime:Date.now(),timeout:r,maxTotalTimeout:s,resetTimeoutOnProgress:o,onTimeout:n})}_resetTimeout(e){let r=this._timeoutInfo.get(e);if(!r)return!1;let s=Date.now()-r.startTime;if(r.maxTotalTimeout&&s>=r.maxTotalTimeout)throw this._timeoutInfo.delete(e),A.fromError(U.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:s});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(e){let r=this._timeoutInfo.get(e);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var r,s,n;this._transport=e;let o=(r=this.transport)===null||r===void 0?void 0:r.onclose;this._transport.onclose=()=>{o?.(),this._onclose()};let i=(s=this.transport)===null||s===void 0?void 0:s.onerror;this._transport.onerror=c=>{i?.(c),this._onerror(c)};let a=(n=this._transport)===null||n===void 0?void 0:n.onmessage;this._transport.onmessage=(c,u)=>{a?.(c,u),Bs(c)||xm(c)?this._onresponse(c):ha(c)?this._onrequest(c,u):vm(c)?this._onnotification(c):this._onerror(new Error(`Unknown message type: ${JSON.stringify(c)}`))},await this._transport.start()}_onclose(){var e;let r=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let s=A.fromError(U.ConnectionClosed,"Connection closed");this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);for(let n of r.values())n(s)}_onerror(e){var r;(r=this.onerror)===null||r===void 0||r.call(this,e)}_onnotification(e){var r;let s=(r=this._notificationHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackNotificationHandler;s!==void 0&&Promise.resolve().then(()=>s(e)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(e,r){var s,n,o,i,a,c;let u=(s=this._requestHandlers.get(e.method))!==null&&s!==void 0?s:this.fallbackRequestHandler,l=this._transport,d=(i=(o=(n=e.params)===null||n===void 0?void 0:n._meta)===null||o===void 0?void 0:o[Rt])===null||i===void 0?void 0:i.taskId;if(u===void 0){let _={jsonrpc:"2.0",id:e.id,error:{code:U.MethodNotFound,message:"Method not found"}};d&&this._taskMessageQueue?this._enqueueTaskMessage(d,{type:"error",message:_,timestamp:Date.now()},l?.sessionId).catch(v=>this._onerror(new Error(`Failed to enqueue error response: ${v}`))):l?.send(_).catch(v=>this._onerror(new Error(`Failed to send an error response: ${v}`)));return}let p=new AbortController;this._requestHandlerAbortControllers.set(e.id,p);let m=(a=e.params)===null||a===void 0?void 0:a.task,f=this._taskStore?this.requestTaskStore(e,l?.sessionId):void 0,g={signal:p.signal,sessionId:l?.sessionId,_meta:(c=e.params)===null||c===void 0?void 0:c._meta,sendNotification:async _=>{let v={relatedRequestId:e.id};d&&(v.relatedTask={taskId:d}),await this.notification(_,v)},sendRequest:async(_,v,$)=>{var y,x;let E={...$,relatedRequestId:e.id};d&&!E.relatedTask&&(E.relatedTask={taskId:d});let T=(x=(y=E.relatedTask)===null||y===void 0?void 0:y.taskId)!==null&&x!==void 0?x:d;return T&&f&&await f.updateTaskStatus(T,"input_required"),await this.request(_,v,E)},authInfo:r?.authInfo,requestId:e.id,requestInfo:r?.requestInfo,taskId:d,taskStore:f,taskRequestedTtl:m?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{m&&this.assertTaskHandlerCapability(e.method)}).then(()=>u(e,g)).then(async _=>{if(p.signal.aborted)return;let v={result:_,jsonrpc:"2.0",id:e.id};d&&this._taskMessageQueue?await this._enqueueTaskMessage(d,{type:"response",message:v,timestamp:Date.now()},l?.sessionId):await l?.send(v)},async _=>{var v;if(p.signal.aborted)return;let $={jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(_.code)?_.code:U.InternalError,message:(v=_.message)!==null&&v!==void 0?v:"Internal error",..._.data!==void 0&&{data:_.data}}};d&&this._taskMessageQueue?await this._enqueueTaskMessage(d,{type:"error",message:$,timestamp:Date.now()},l?.sessionId):await l?.send($)}).catch(_=>this._onerror(new Error(`Failed to send response: ${_}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){let{progressToken:r,...s}=e.params,n=Number(r),o=this._progressHandlers.get(n);if(!o){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}let i=this._responseHandlers.get(n),a=this._timeoutInfo.get(n);if(a&&i&&a.resetTimeoutOnProgress)try{this._resetTimeout(n)}catch(c){this._responseHandlers.delete(n),this._progressHandlers.delete(n),this._cleanupTimeout(n),i(c);return}o(s)}_onresponse(e){let r=Number(e.id),s=this._requestResolvers.get(r);if(s){if(this._requestResolvers.delete(r),Bs(e))s(e);else{let i=new A(e.error.code,e.error.message,e.error.data);s(i)}return}let n=this._responseHandlers.get(r);if(n===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let o=!1;if(Bs(e)&&e.result&&typeof e.result=="object"){let i=e.result;if(i.task&&typeof i.task=="object"){let a=i.task;typeof a.taskId=="string"&&(o=!0,this._taskProgressTokens.set(a.taskId,r))}}if(o||this._progressHandlers.delete(r),Bs(e))n(e);else{let i=A.fromError(e.error.code,e.error.message,e.error.data);n(i)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}async*requestStream(e,r,s){var n,o,i,a;let{task:c}=s??{};if(!c){try{yield{type:"result",result:await this.request(e,r,s)}}catch(l){yield{type:"error",error:l instanceof A?l:new A(U.InternalError,String(l))}}return}let u;try{let l=await this.request(e,Ft,s);if(l.task)u=l.task.taskId,yield{type:"taskCreated",task:l.task};else throw new A(U.InternalError,"Task creation did not return a task");for(;;){let d=await this.getTask({taskId:u},s);if(yield{type:"taskStatus",task:d},rr(d.status)){d.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:u},r,s)}:d.status==="failed"?yield{type:"error",error:new A(U.InternalError,`Task ${u} failed`)}:d.status==="cancelled"&&(yield{type:"error",error:new A(U.InternalError,`Task ${u} was cancelled`)});return}if(d.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:u},r,s)};return}let p=(i=(n=d.pollInterval)!==null&&n!==void 0?n:(o=this._options)===null||o===void 0?void 0:o.defaultTaskPollInterval)!==null&&i!==void 0?i:1e3;await new Promise(m=>setTimeout(m,p)),(a=s?.signal)===null||a===void 0||a.throwIfAborted()}}catch(l){yield{type:"error",error:l instanceof A?l:new A(U.InternalError,String(l))}}}request(e,r,s){let{relatedRequestId:n,resumptionToken:o,onresumptiontoken:i,task:a,relatedTask:c}=s??{};return new Promise((u,l)=>{var d,p,m,f,g,_,v;let $=P=>{l(P)};if(!this._transport){$(new Error("Not connected"));return}if(((d=this._options)===null||d===void 0?void 0:d.enforceStrictCapabilities)===!0)try{this.assertCapabilityForMethod(e.method),a&&this.assertTaskCapability(e.method)}catch(P){$(P);return}(p=s?.signal)===null||p===void 0||p.throwIfAborted();let y=this._requestMessageId++,x={...e,jsonrpc:"2.0",id:y};s?.onprogress&&(this._progressHandlers.set(y,s.onprogress),x.params={...e.params,_meta:{...((m=e.params)===null||m===void 0?void 0:m._meta)||{},progressToken:y}}),a&&(x.params={...x.params,task:a}),c&&(x.params={...x.params,_meta:{...((f=x.params)===null||f===void 0?void 0:f._meta)||{},[Rt]:c}});let E=P=>{var q;this._responseHandlers.delete(y),this._progressHandlers.delete(y),this._cleanupTimeout(y),(q=this._transport)===null||q===void 0||q.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:y,reason:String(P)}},{relatedRequestId:n,resumptionToken:o,onresumptiontoken:i}).catch(W=>this._onerror(new Error(`Failed to send cancellation: ${W}`)));let Z=P instanceof A?P:new A(U.RequestTimeout,String(P));l(Z)};this._responseHandlers.set(y,P=>{var q;if(!(!((q=s?.signal)===null||q===void 0)&&q.aborted)){if(P instanceof Error)return l(P);try{let Z=Ve(r,P.result);Z.success?u(Z.data):l(Z.error)}catch(Z){l(Z)}}}),(g=s?.signal)===null||g===void 0||g.addEventListener("abort",()=>{var P;E((P=s?.signal)===null||P===void 0?void 0:P.reason)});let T=(_=s?.timeout)!==null&&_!==void 0?_:gS,R=()=>E(A.fromError(U.RequestTimeout,"Request timed out",{timeout:T}));this._setupTimeout(y,T,s?.maxTotalTimeout,R,(v=s?.resetTimeoutOnProgress)!==null&&v!==void 0?v:!1);let j=c?.taskId;if(j){let P=q=>{let Z=this._responseHandlers.get(y);Z?Z(q):this._onerror(new Error(`Response handler missing for side-channeled request ${y}`))};this._requestResolvers.set(y,P),this._enqueueTaskMessage(j,{type:"request",message:x,timestamp:Date.now()}).catch(q=>{this._cleanupTimeout(y),l(q)})}else this._transport.send(x,{relatedRequestId:n,resumptionToken:o,onresumptiontoken:i}).catch(P=>{this._cleanupTimeout(y),l(P)})})}async getTask(e,r){return this.request({method:"tasks/get",params:e},lo,r)}async getTaskResult(e,r,s){return this.request({method:"tasks/result",params:e},r,s)}async listTasks(e,r){return this.request({method:"tasks/list",params:e},fo,r)}async cancelTask(e,r){return this.request({method:"tasks/cancel",params:e},Tm,r)}async notification(e,r){var s,n,o,i,a;if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);let c=(s=r?.relatedTask)===null||s===void 0?void 0:s.taskId;if(c){let p={...e,jsonrpc:"2.0",params:{...e.params,_meta:{...((n=e.params)===null||n===void 0?void 0:n._meta)||{},[Rt]:r.relatedTask}}};await this._enqueueTaskMessage(c,{type:"notification",message:p,timestamp:Date.now()});return}if(((i=(o=this._options)===null||o===void 0?void 0:o.debouncedNotificationMethods)!==null&&i!==void 0?i:[]).includes(e.method)&&!e.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(e.method))return;this._pendingDebouncedNotifications.add(e.method),Promise.resolve().then(()=>{var p,m;if(this._pendingDebouncedNotifications.delete(e.method),!this._transport)return;let f={...e,jsonrpc:"2.0"};r?.relatedTask&&(f={...f,params:{...f.params,_meta:{...((p=f.params)===null||p===void 0?void 0:p._meta)||{},[Rt]:r.relatedTask}}}),(m=this._transport)===null||m===void 0||m.send(f,r).catch(g=>this._onerror(g))});return}let d={...e,jsonrpc:"2.0"};r?.relatedTask&&(d={...d,params:{...d.params,_meta:{...((a=d.params)===null||a===void 0?void 0:a._meta)||{},[Rt]:r.relatedTask}}}),await this._transport.send(d,r)}setRequestHandler(e,r){let s=Ua(e);this.assertRequestHandlerCapability(s),this._requestHandlers.set(s,(n,o)=>{let i=Fa(e,n);return Promise.resolve(r(i,o))})}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,r){let s=Ua(e);this._notificationHandlers.set(s,n=>{let o=Fa(e,n);return Promise.resolve(r(o))})}removeNotificationHandler(e){this._notificationHandlers.delete(e)}_cleanupTaskProgressHandler(e){let r=this._taskProgressTokens.get(e);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(e))}async _enqueueTaskMessage(e,r,s){var n;if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let o=(n=this._options)===null||n===void 0?void 0:n.maxTaskQueueSize;await this._taskMessageQueue.enqueue(e,r,s,o)}async _clearTaskQueue(e,r){if(this._taskMessageQueue){let s=await this._taskMessageQueue.dequeueAll(e,r);for(let n of s)if(n.type==="request"&&ha(n.message)){let o=n.message.id,i=this._requestResolvers.get(o);i?(i(new A(U.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(o)):this._onerror(new Error(`Resolver missing for request ${o} during task ${e} cleanup`))}}}async _waitForTaskUpdate(e,r){var s,n,o;let i=(n=(s=this._options)===null||s===void 0?void 0:s.defaultTaskPollInterval)!==null&&n!==void 0?n:1e3;try{let a=await((o=this._taskStore)===null||o===void 0?void 0:o.getTask(e));a?.pollInterval&&(i=a.pollInterval)}catch{}return new Promise((a,c)=>{if(r.aborted){c(new A(U.InvalidRequest,"Request cancelled"));return}let u=setTimeout(a,i);r.addEventListener("abort",()=>{clearTimeout(u),c(new A(U.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(e,r){let s=this._taskStore;if(!s)throw new Error("No task store configured");return{createTask:async n=>{if(!e)throw new Error("No request provided");return await s.createTask(n,e.id,{method:e.method,params:e.params},r)},getTask:async n=>{let o=await s.getTask(n,r);if(!o)throw new A(U.InvalidParams,"Failed to retrieve task: Task not found");return o},storeTaskResult:async(n,o,i)=>{await s.storeTaskResult(n,o,i,r);let a=await s.getTask(n,r);if(a){let c=Xs.parse({method:"notifications/tasks/status",params:a});await this.notification(c),rr(a.status)&&this._cleanupTaskProgressHandler(n)}},getTaskResult:n=>s.getTaskResult(n,r),updateTaskStatus:async(n,o,i)=>{let a=await s.getTask(n,r);if(!a)throw new A(U.InvalidParams,`Task "${n}" not found - it may have been cleaned up`);if(rr(a.status))throw new A(U.InvalidParams,`Cannot update task "${n}" from terminal status "${a.status}" to "${o}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await s.updateTaskStatus(n,o,i,r);let c=await s.getTask(n,r);if(c){let u=Xs.parse({method:"notifications/tasks/status",params:c});await this.notification(u),rr(c.status)&&this._cleanupTaskProgressHandler(n)}},listTasks:n=>s.listTasks(n,r)}}};function df(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function bo(t,e){let r={...t};for(let s in e){let n=s,o=e[n];if(o===void 0)continue;let i=r[n];df(i)&&df(o)?r[n]={...i,...o}:r[n]=o}return r}var J_=fr(Ru(),1),Y_=fr(X_(),1);function ak(){let t=new J_.Ajv({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return(0,Y_.default)(t),t}var $s=class{constructor(e){this._ajv=e??ak()}getValidator(e){var r;let s="$id"in e&&typeof e.$id=="string"?(r=this._ajv.getSchema(e.$id))!==null&&r!==void 0?r:this._ajv.compile(e):this._ajv.compile(e);return n=>s(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(s.errors)}}};var si=class{constructor(e){this._server=e}requestStream(e,r,s){return this._server.requestStream(e,r,s)}async getTask(e,r){return this._server.getTask({taskId:e},r)}async getTaskResult(e,r,s){return this._server.getTaskResult({taskId:e},r,s)}async listTasks(e,r){return this._server.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._server.cancelTask({taskId:e},r)}};function ni(t,e,r){var s;if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"tools/call":if(!(!((s=t.tools)===null||s===void 0)&&s.call))throw new Error(`${r} does not support task creation for tools/call (required for ${e})`);break;default:break}}function oi(t,e,r){var s,n;if(!t)throw new Error(`${r} does not support task creation (required for ${e})`);switch(e){case"sampling/createMessage":if(!(!((s=t.sampling)===null||s===void 0)&&s.createMessage))throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${e})`);break;case"elicitation/create":if(!(!((n=t.elicitation)===null||n===void 0)&&n.create))throw new Error(`${r} does not support task creation for elicitation/create (required for ${e})`);break;default:break}}var ii=class extends as{constructor(e,r){var s,n;super(r),this._serverInfo=e,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(Ys.options.map((o,i)=>[o,i])),this.isMessageIgnored=(o,i)=>{let a=this._loggingLevels.get(i);return a?this.LOG_LEVEL_SEVERITY.get(o)<this.LOG_LEVEL_SEVERITY.get(a):!1},this._capabilities=(s=r?.capabilities)!==null&&s!==void 0?s:{},this._instructions=r?.instructions,this._jsonSchemaValidator=(n=r?.jsonSchemaValidator)!==null&&n!==void 0?n:new $s,this.setRequestHandler(_a,o=>this._oninitialize(o)),this.setNotificationHandler(ya,()=>{var o;return(o=this.oninitialized)===null||o===void 0?void 0:o.call(this)}),this._capabilities.logging&&this.setRequestHandler(Na,async(o,i)=>{var a;let c=i.sessionId||((a=i.requestInfo)===null||a===void 0?void 0:a.headers["mcp-session-id"])||void 0,{level:u}=o.params,l=Ys.safeParse(u);return l.success&&this._loggingLevels.set(c,l.data),{}})}get experimental(){return this._experimental||(this._experimental={tasks:new si(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=bo(this._capabilities,e)}setRequestHandler(e,r){var s,n,o;let i=ss(e),a=i?.method;if(!a)throw new Error("Schema is missing a method literal");let c;if(er(a)){let l=a,d=(s=l._zod)===null||s===void 0?void 0:s.def;c=(n=d?.value)!==null&&n!==void 0?n:l.value}else{let l=a,d=l._def;c=(o=d?.value)!==null&&o!==void 0?o:l.value}if(typeof c!="string")throw new Error("Schema method literal must be a string");if(c==="tools/call"){let l=async(d,p)=>{let m=Ve(Js,d);if(!m.success){let v=m.error instanceof Error?m.error.message:String(m.error);throw new A(U.InvalidParams,`Invalid tools/call request: ${v}`)}let{params:f}=m.data,g=await Promise.resolve(r(d,p));if(f.task){let v=Ve(Ft,g);if(!v.success){let $=v.error instanceof Error?v.error.message:String(v.error);throw new A(U.InvalidParams,`Invalid task creation result: ${$}`)}return v.data}let _=Ve(tr,g);if(!_.success){let v=_.error instanceof Error?_.error.message:String(_.error);throw new A(U.InvalidParams,`Invalid tools/call result: ${v}`)}return _.data};return super.setRequestHandler(e,l)}return super.setRequestHandler(e,r)}assertCapabilityForMethod(e){var r,s,n;switch(e){case"sampling/createMessage":if(!(!((r=this._clientCapabilities)===null||r===void 0)&&r.sampling))throw new Error(`Client does not support sampling (required for ${e})`);break;case"elicitation/create":if(!(!((s=this._clientCapabilities)===null||s===void 0)&&s.elicitation))throw new Error(`Client does not support elicitation (required for ${e})`);break;case"roots/list":if(!(!((n=this._clientCapabilities)===null||n===void 0)&&n.roots))throw new Error(`Client does not support listing roots (required for ${e})`);break;case"ping":break}}assertNotificationCapability(e){var r,s;switch(e){case"notifications/message":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw new Error(`Server does not support notifying about resources (required for ${e})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw new Error(`Server does not support notifying of tool list changes (required for ${e})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw new Error(`Server does not support notifying of prompt list changes (required for ${e})`);break;case"notifications/elicitation/complete":if(!(!((s=(r=this._clientCapabilities)===null||r===void 0?void 0:r.elicitation)===null||s===void 0)&&s.url))throw new Error(`Client does not support URL elicitation (required for ${e})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"completion/complete":if(!this._capabilities.completions)throw new Error(`Server does not support completions (required for ${e})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw new Error(`Server does not support resources (required for ${e})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw new Error(`Server does not support tools (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Server does not support tasks capability (required for ${e})`);break;case"ping":case"initialize":break}}assertTaskCapability(e){var r,s;oi((s=(r=this._clientCapabilities)===null||r===void 0?void 0:r.tasks)===null||s===void 0?void 0:s.requests,e,"Client")}assertTaskHandlerCapability(e){var r;this._capabilities&&ni((r=this._capabilities.tasks)===null||r===void 0?void 0:r.requests,e,"Server")}async _oninitialize(e){let r=e.params.protocolVersion;return this._clientCapabilities=e.params.capabilities,this._clientVersion=e.params.clientInfo,{protocolVersion:so.includes(r)?r:Vs,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},Ut)}async createMessage(e,r){var s,n;if((e.tools||e.toolChoice)&&!(!((n=(s=this._clientCapabilities)===null||s===void 0?void 0:s.sampling)===null||n===void 0)&&n.tools))throw new Error("Client does not support sampling tools capability.");if(e.messages.length>0){let o=e.messages[e.messages.length-1],i=Array.isArray(o.content)?o.content:[o.content],a=i.some(d=>d.type==="tool_result"),c=e.messages.length>1?e.messages[e.messages.length-2]:void 0,u=c?Array.isArray(c.content)?c.content:[c.content]:[],l=u.some(d=>d.type==="tool_use");if(a){if(i.some(d=>d.type!=="tool_result"))throw new Error("The last message must contain only tool_result content if any is present");if(!l)throw new Error("tool_result blocks are not matching any tool_use from the previous message")}if(l){let d=new Set(u.filter(m=>m.type==="tool_use").map(m=>m.id)),p=new Set(i.filter(m=>m.type==="tool_result").map(m=>m.toolUseId));if(d.size!==p.size||![...d].every(m=>p.has(m)))throw new Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}return e.tools?this.request({method:"sampling/createMessage",params:e},Ca,r):this.request({method:"sampling/createMessage",params:e},Qs,r)}async elicitInput(e,r){var s,n,o,i,a;switch((s=e.mode)!==null&&s!==void 0?s:"form"){case"url":{if(!(!((o=(n=this._clientCapabilities)===null||n===void 0?void 0:n.elicitation)===null||o===void 0)&&o.url))throw new Error("Client does not support url elicitation.");let u=e;return this.request({method:"elicitation/create",params:u},is,r)}case"form":{if(!(!((a=(i=this._clientCapabilities)===null||i===void 0?void 0:i.elicitation)===null||a===void 0)&&a.form))throw new Error("Client does not support form elicitation.");let u=e.mode==="form"?e:{...e,mode:"form"},l=await this.request({method:"elicitation/create",params:u},is,r);if(l.action==="accept"&&l.content&&u.requestedSchema)try{let p=this._jsonSchemaValidator.getValidator(u.requestedSchema)(l.content);if(!p.valid)throw new A(U.InvalidParams,`Elicitation response content does not match requested schema: ${p.errorMessage}`)}catch(d){throw d instanceof A?d:new A(U.InternalError,`Error validating elicitation response: ${d instanceof Error?d.message:String(d)}`)}return l}}}createElicitationCompletionNotifier(e,r){var s,n;if(!(!((n=(s=this._clientCapabilities)===null||s===void 0?void 0:s.elicitation)===null||n===void 0)&&n.url))throw new Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:e}},r)}async listRoots(e,r){return this.request({method:"roots/list",params:e},Da,r)}async sendLoggingMessage(e,r){if(this._capabilities.logging&&!this.isMessageIgnored(e.level,r))return this.notification({method:"notifications/message",params:e})}async sendResourceUpdated(e){return this.notification({method:"notifications/resources/updated",params:e})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}};var ju=fr(require("node:process"),1);var ws=class{append(e){this._buffer=this._buffer?Buffer.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;let e=this._buffer.indexOf(`
`);if(e===-1)return null;let r=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),ck(r)}clear(){this._buffer=void 0}};function ck(t){return Em.parse(JSON.parse(t))}function ai(t){return JSON.stringify(t)+`
`}var ci=class{constructor(e=ju.default.stdin,r=ju.default.stdout){this._stdin=e,this._stdout=r,this._readBuffer=new ws,this._started=!1,this._ondata=s=>{this._readBuffer.append(s),this.processReadBuffer()},this._onerror=s=>{var n;(n=this.onerror)===null||n===void 0||n.call(this,s)}}async start(){if(this._started)throw new Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){for(var e,r;;)try{let s=this._readBuffer.readMessage();if(s===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,s)}catch(s){(r=this.onerror)===null||r===void 0||r.call(this,s)}}async close(){var e;this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0&&this._stdin.pause(),this._readBuffer.clear(),(e=this.onclose)===null||e===void 0||e.call(this)}send(e){return new Promise(r=>{let s=ai(e);this._stdout.write(s)?r():this._stdout.once("drain",r)})}};var ui=class{constructor(e){this._client=e}async*callToolStream(e,r=tr,s){var n;let o=this._client,i={...s,task:(n=s?.task)!==null&&n!==void 0?n:o.isToolTask(e.name)?{}:void 0},a=o.requestStream({method:"tools/call",params:e},r,i),c=o.getToolOutputValidator(e.name);for await(let u of a){if(u.type==="result"&&c){let l=u.result;if(!l.structuredContent&&!l.isError){yield{type:"error",error:new A(U.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`)};return}if(l.structuredContent)try{let d=c(l.structuredContent);if(!d.valid){yield{type:"error",error:new A(U.InvalidParams,`Structured content does not match the tool's output schema: ${d.errorMessage}`)};return}}catch(d){if(d instanceof A){yield{type:"error",error:d};return}yield{type:"error",error:new A(U.InvalidParams,`Failed to validate structured content: ${d instanceof Error?d.message:String(d)}`)};return}}yield u}}async getTask(e,r){return this._client.getTask({taskId:e},r)}async getTaskResult(e,r,s){return this._client.getTaskResult({taskId:e},r,s)}async listTasks(e,r){return this._client.listTasks(e?{cursor:e}:void 0,r)}async cancelTask(e,r){return this._client.cancelTask({taskId:e},r)}requestStream(e,r,s){return this._client.requestStream(e,r,s)}};function li(t,e){if(!(!t||e===null||typeof e!="object")){if(t.type==="object"&&t.properties&&typeof t.properties=="object"){let r=e,s=t.properties;for(let n of Object.keys(s)){let o=s[n];r[n]===void 0&&Object.prototype.hasOwnProperty.call(o,"default")&&(r[n]=o.default),r[n]!==void 0&&li(o,r[n])}}if(Array.isArray(t.anyOf))for(let r of t.anyOf)li(r,e);if(Array.isArray(t.oneOf))for(let r of t.oneOf)li(r,e)}}function uk(t){if(!t)return{supportsFormMode:!1,supportsUrlMode:!1};let e=t.form!==void 0,r=t.url!==void 0;return{supportsFormMode:e||!e&&!r,supportsUrlMode:r}}var di=class extends as{constructor(e,r){var s,n;super(r),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._capabilities=(s=r?.capabilities)!==null&&s!==void 0?s:{},this._jsonSchemaValidator=(n=r?.jsonSchemaValidator)!==null&&n!==void 0?n:new $s}get experimental(){return this._experimental||(this._experimental={tasks:new ui(this)}),this._experimental}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=bo(this._capabilities,e)}setRequestHandler(e,r){var s,n,o;let i=ss(e),a=i?.method;if(!a)throw new Error("Schema is missing a method literal");let c;if(er(a)){let l=a,d=(s=l._zod)===null||s===void 0?void 0:s.def;c=(n=d?.value)!==null&&n!==void 0?n:l.value}else{let l=a,d=l._def;c=(o=d?.value)!==null&&o!==void 0?o:l.value}if(typeof c!="string")throw new Error("Schema method literal must be a string");let u=c;if(u==="elicitation/create"){let l=async(d,p)=>{var m,f,g;let _=Ve(Aa,d);if(!_.success){let P=_.error instanceof Error?_.error.message:String(_.error);throw new A(U.InvalidParams,`Invalid elicitation request: ${P}`)}let{params:v}=_.data,$=(m=v.mode)!==null&&m!==void 0?m:"form",{supportsFormMode:y,supportsUrlMode:x}=uk(this._capabilities.elicitation);if($==="form"&&!y)throw new A(U.InvalidParams,"Client does not support form-mode elicitation requests");if($==="url"&&!x)throw new A(U.InvalidParams,"Client does not support URL-mode elicitation requests");let E=await Promise.resolve(r(d,p));if(v.task){let P=Ve(Ft,E);if(!P.success){let q=P.error instanceof Error?P.error.message:String(P.error);throw new A(U.InvalidParams,`Invalid task creation result: ${q}`)}return P.data}let T=Ve(is,E);if(!T.success){let P=T.error instanceof Error?T.error.message:String(T.error);throw new A(U.InvalidParams,`Invalid elicitation result: ${P}`)}let R=T.data,j=$==="form"?v.requestedSchema:void 0;if($==="form"&&R.action==="accept"&&R.content&&j&&!((g=(f=this._capabilities.elicitation)===null||f===void 0?void 0:f.form)===null||g===void 0)&&g.applyDefaults)try{li(j,R.content)}catch{}return R};return super.setRequestHandler(e,l)}if(u==="sampling/createMessage"){let l=async(d,p)=>{let m=Ve(Pa,d);if(!m.success){let v=m.error instanceof Error?m.error.message:String(m.error);throw new A(U.InvalidParams,`Invalid sampling request: ${v}`)}let{params:f}=m.data,g=await Promise.resolve(r(d,p));if(f.task){let v=Ve(Ft,g);if(!v.success){let $=v.error instanceof Error?v.error.message:String(v.error);throw new A(U.InvalidParams,`Invalid task creation result: ${$}`)}return v.data}let _=Ve(Qs,g);if(!_.success){let v=_.error instanceof Error?_.error.message:String(_.error);throw new A(U.InvalidParams,`Invalid sampling result: ${v}`)}return _.data};return super.setRequestHandler(e,l)}return super.setRequestHandler(e,r)}assertCapability(e,r){var s;if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s[e]))throw new Error(`Server does not support ${e} (required for ${r})`)}async connect(e,r){if(await super.connect(e),e.sessionId===void 0)try{let s=await this.request({method:"initialize",params:{protocolVersion:Vs,capabilities:this._capabilities,clientInfo:this._clientInfo}},ga,r);if(s===void 0)throw new Error(`Server sent invalid initialize result: ${s}`);if(!so.includes(s.protocolVersion))throw new Error(`Server's protocol version is not supported: ${s.protocolVersion}`);this._serverCapabilities=s.capabilities,this._serverVersion=s.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(s.protocolVersion),this._instructions=s.instructions,await this.notification({method:"notifications/initialized"})}catch(s){throw this.close(),s}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var r,s,n,o,i;switch(e){case"logging/setLevel":if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((n=this._serverCapabilities)===null||n===void 0)&&n.resources))throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(!((o=this._serverCapabilities)===null||o===void 0)&&o.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.completions))throw new Error(`Server does not support completions (required for ${e})`);break;case"initialize":break;case"ping":break}}assertNotificationCapability(e){var r;switch(e){case"notifications/roots/list_changed":if(!(!((r=this._capabilities.roots)===null||r===void 0)&&r.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break;case"notifications/initialized":break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(e){if(this._capabilities)switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${e})`);break;case"ping":break}}assertTaskCapability(e){var r,s;ni((s=(r=this._serverCapabilities)===null||r===void 0?void 0:r.tasks)===null||s===void 0?void 0:s.requests,e,"Server")}assertTaskHandlerCapability(e){var r;this._capabilities&&oi((r=this._capabilities.tasks)===null||r===void 0?void 0:r.requests,e,"Client")}async ping(e){return this.request({method:"ping"},Ut,e)}async complete(e,r){return this.request({method:"completion/complete",params:e},ja,r)}async setLoggingLevel(e,r){return this.request({method:"logging/setLevel",params:{level:e}},Ut,r)}async getPrompt(e,r){return this.request({method:"prompts/get",params:e},za,r)}async listPrompts(e,r){return this.request({method:"prompts/list",params:e},$a,r)}async listResources(e,r){return this.request({method:"resources/list",params:e},ba,r)}async listResourceTemplates(e,r){return this.request({method:"resources/templates/list",params:e},Sa,r)}async readResource(e,r){return this.request({method:"resources/read",params:e},Ea,r)}async subscribeResource(e,r){return this.request({method:"resources/subscribe",params:e},Ut,r)}async unsubscribeResource(e,r){return this.request({method:"resources/unsubscribe",params:e},Ut,r)}async callTool(e,r=tr,s){if(this.isToolTaskRequired(e.name))throw new A(U.InvalidRequest,`Tool "${e.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);let n=await this.request({method:"tools/call",params:e},r,s),o=this.getToolOutputValidator(e.name);if(o){if(!n.structuredContent&&!n.isError)throw new A(U.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(n.structuredContent)try{let i=o(n.structuredContent);if(!i.valid)throw new A(U.InvalidParams,`Structured content does not match the tool's output schema: ${i.errorMessage}`)}catch(i){throw i instanceof A?i:new A(U.InvalidParams,`Failed to validate structured content: ${i instanceof Error?i.message:String(i)}`)}}return n}isToolTask(e){var r,s,n,o;return!((o=(n=(s=(r=this._serverCapabilities)===null||r===void 0?void 0:r.tasks)===null||s===void 0?void 0:s.requests)===null||n===void 0?void 0:n.tools)===null||o===void 0)&&o.call?this._cachedKnownTaskTools.has(e):!1}isToolTaskRequired(e){return this._cachedRequiredTaskTools.has(e)}cacheToolMetadata(e){var r;this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(let s of e){if(s.outputSchema){let o=this._jsonSchemaValidator.getValidator(s.outputSchema);this._cachedToolOutputValidators.set(s.name,o)}let n=(r=s.execution)===null||r===void 0?void 0:r.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(s.name),n==="required"&&this._cachedRequiredTaskTools.add(s.name)}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,r){let s=await this.request({method:"tools/list",params:e},Oa,r);return this.cacheToolMetadata(s.tools),s}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}};var Zg=fr(qg(),1),On=fr(require("node:process"),1),Ug=require("node:stream");var jk=On.default.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function Dk(){let t={};for(let e of jk){let r=On.default.env[e];r!==void 0&&(r.startsWith("()")||(t[e]=r))}return t}var mi=class{constructor(e){this._readBuffer=new ws,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new Ug.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,r)=>{var s,n,o,i,a;this._process=(0,Zg.default)(this._serverParams.command,(s=this._serverParams.args)!==null&&s!==void 0?s:[],{env:{...Dk(),...this._serverParams.env},stdio:["pipe","pipe",(n=this._serverParams.stderr)!==null&&n!==void 0?n:"inherit"],shell:!1,windowsHide:On.default.platform==="win32"&&Lk(),cwd:this._serverParams.cwd}),this._process.on("error",c=>{var u;r(c),(u=this.onerror)===null||u===void 0||u.call(this,c)}),this._process.on("spawn",()=>{e()}),this._process.on("close",c=>{var u;this._process=void 0,(u=this.onclose)===null||u===void 0||u.call(this)}),(o=this._process.stdin)===null||o===void 0||o.on("error",c=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,c)}),(i=this._process.stdout)===null||i===void 0||i.on("data",c=>{this._readBuffer.append(c),this.processReadBuffer()}),(a=this._process.stdout)===null||a===void 0||a.on("error",c=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,c)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var e,r;return this._stderrStream?this._stderrStream:(r=(e=this._process)===null||e===void 0?void 0:e.stderr)!==null&&r!==void 0?r:null}get pid(){var e,r;return(r=(e=this._process)===null||e===void 0?void 0:e.pid)!==null&&r!==void 0?r:null}processReadBuffer(){for(var e,r;;)try{let s=this._readBuffer.readMessage();if(s===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,s)}catch(s){(r=this.onerror)===null||r===void 0||r.call(this,s)}}async close(){var e;if(this._process){let r=this._process;this._process=void 0;let s=new Promise(n=>{r.once("close",()=>{n()})});try{(e=r.stdin)===null||e===void 0||e.end()}catch{}if(await Promise.race([s,new Promise(n=>setTimeout(n,2e3).unref())]),r.exitCode===null){try{r.kill("SIGTERM")}catch{}await Promise.race([s,new Promise(n=>setTimeout(n,2e3).unref())])}if(r.exitCode===null)try{r.kill("SIGKILL")}catch{}}this._readBuffer.clear()}send(e){return new Promise(r=>{var s;if(!(!((s=this._process)===null||s===void 0)&&s.stdin))throw new Error("Not connected");let n=ai(e);this._process.stdin.write(n)?r():this._process.stdin.once("drain",r)})}};function Lk(){return"type"in On.default}var Qg=require("path");var Bg=fr(require("better-sqlite3"),1);var Fe=require("path"),Hu=require("os"),Gu=require("fs");var Fg=require("url"),qk={};function Mk(){return typeof __dirname<"u"?__dirname:(0,Fe.dirname)((0,Fg.fileURLToPath)(qk.url))}var _A=Mk(),St=process.env.CLAUDE_MEM_DATA_DIR||(0,Fe.join)((0,Hu.homedir)(),".claude-mem"),Wu=process.env.CLAUDE_CONFIG_DIR||(0,Fe.join)((0,Hu.homedir)(),".claude"),gA=(0,Fe.join)(St,"archives"),yA=(0,Fe.join)(St,"logs"),vA=(0,Fe.join)(St,"trash"),bA=(0,Fe.join)(St,"backups"),SA=(0,Fe.join)(St,"settings.json"),fi=(0,Fe.join)(St,"claude-mem.db"),Vg=(0,Fe.join)(St,"vector-db"),xA=(0,Fe.join)(Wu,"settings.json"),EA=(0,Fe.join)(Wu,"commands"),$A=(0,Fe.join)(Wu,"CLAUDE.md");function hi(t){(0,Gu.mkdirSync)(t,{recursive:!0})}var _i=class{db;constructor(e){e||(hi(St),e=fi),this.db=new Bg.default(e),this.db.pragma("journal_mode = WAL"),this.ensureFTSTables()}ensureFTSTables(){try{if(this.db.prepare("SELECT name FROM sqlite_master WHERE type='table' AND name LIKE '%_fts'").all().some(s=>s.name==="observations_fts"||s.name==="session_summaries_fts"))return;console.error("[SessionSearch] Creating FTS5 tables..."),this.db.exec(`
        CREATE VIRTUAL TABLE IF NOT EXISTS observations_fts USING fts5(
          title,
          subtitle,
          narrative,
          text,
          facts,
          concepts,
          content='observations',
          content_rowid='id'
        );
      `),this.db.exec(`
        INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
        SELECT id, title, subtitle, narrative, text, facts, concepts
        FROM observations;
      `),this.db.exec(`
        CREATE TRIGGER IF NOT EXISTS observations_ai AFTER INSERT ON observations BEGIN
          INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES (new.id, new.title, new.subtitle, new.narrative, new.text, new.facts, new.concepts);
        END;

        CREATE TRIGGER IF NOT EXISTS observations_ad AFTER DELETE ON observations BEGIN
          INSERT INTO observations_fts(observations_fts, rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES('delete', old.id, old.title, old.subtitle, old.narrative, old.text, old.facts, old.concepts);
        END;

        CREATE TRIGGER IF NOT EXISTS observations_au AFTER UPDATE ON observations BEGIN
          INSERT INTO observations_fts(observations_fts, rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES('delete', old.id, old.title, old.subtitle, old.narrative, old.text, old.facts, old.concepts);
          INSERT INTO observations_fts(rowid, title, subtitle, narrative, text, facts, concepts)
          VALUES (new.id, new.title, new.subtitle, new.narrative, new.text, new.facts, new.concepts);
        END;
      `),this.db.exec(`
        CREATE VIRTUAL TABLE IF NOT EXISTS session_summaries_fts USING fts5(
          request,
          investigated,
          learned,
          completed,
          next_steps,
          notes,
          content='session_summaries',
          content_rowid='id'
        );
      `),this.db.exec(`
        INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
        SELECT id, request, investigated, learned, completed, next_steps, notes
        FROM session_summaries;
      `),this.db.exec(`
        CREATE TRIGGER IF NOT EXISTS session_summaries_ai AFTER INSERT ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES (new.id, new.request, new.investigated, new.learned, new.completed, new.next_steps, new.notes);
        END;

        CREATE TRIGGER IF NOT EXISTS session_summaries_ad AFTER DELETE ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(session_summaries_fts, rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES('delete', old.id, old.request, old.investigated, old.learned, old.completed, old.next_steps, old.notes);
        END;

        CREATE TRIGGER IF NOT EXISTS session_summaries_au AFTER UPDATE ON session_summaries BEGIN
          INSERT INTO session_summaries_fts(session_summaries_fts, rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES('delete', old.id, old.request, old.investigated, old.learned, old.completed, old.next_steps, old.notes);
          INSERT INTO session_summaries_fts(rowid, request, investigated, learned, completed, next_steps, notes)
          VALUES (new.id, new.request, new.investigated, new.learned, new.completed, new.next_steps, new.notes);
        END;
      `),console.error("[SessionSearch] FTS5 tables created successfully")}catch(e){console.error("[SessionSearch] FTS migration error:",e.message)}}buildFilterClause(e,r,s="o"){let n=[];if(e.project&&(n.push(`${s}.project = ?`),r.push(e.project)),e.type)if(Array.isArray(e.type)){let o=e.type.map(()=>"?").join(",");n.push(`${s}.type IN (${o})`),r.push(...e.type)}else n.push(`${s}.type = ?`),r.push(e.type);if(e.dateRange){let{start:o,end:i}=e.dateRange;if(o){let a=typeof o=="number"?o:new Date(o).getTime();n.push(`${s}.created_at_epoch >= ?`),r.push(a)}if(i){let a=typeof i=="number"?i:new Date(i).getTime();n.push(`${s}.created_at_epoch <= ?`),r.push(a)}}if(e.concepts){let o=Array.isArray(e.concepts)?e.concepts:[e.concepts],i=o.map(()=>`EXISTS (SELECT 1 FROM json_each(${s}.concepts) WHERE value = ?)`);i.length>0&&(n.push(`(${i.join(" OR ")})`),r.push(...o))}if(e.files){let o=Array.isArray(e.files)?e.files:[e.files],i=o.map(()=>`(
          EXISTS (SELECT 1 FROM json_each(${s}.files_read) WHERE value LIKE ?)
          OR EXISTS (SELECT 1 FROM json_each(${s}.files_modified) WHERE value LIKE ?)
        )`);i.length>0&&(n.push(`(${i.join(" OR ")})`),o.forEach(a=>{r.push(`%${a}%`,`%${a}%`)}))}return n.length>0?n.join(" AND "):""}buildOrderClause(e="relevance",r=!0,s="observations_fts"){switch(e){case"relevance":return r?`ORDER BY ${s}.rank ASC`:"ORDER BY o.created_at_epoch DESC";case"date_desc":return"ORDER BY o.created_at_epoch DESC";case"date_asc":return"ORDER BY o.created_at_epoch ASC";default:return"ORDER BY o.created_at_epoch DESC"}}searchObservations(e,r={}){let s=[],{limit:n=50,offset:o=0,orderBy:i="relevance",...a}=r;if(!e){let c=this.buildFilterClause(a,s,"o");if(!c)throw new Error("Either query or filters required for search");let u=this.buildOrderClause(i,!1),l=`
        SELECT o.*, o.discovery_tokens
        FROM observations o
        WHERE ${c}
        ${u}
        LIMIT ? OFFSET ?
      `;return s.push(n,o),this.db.prepare(l).all(...s)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}searchSessions(e,r={}){let s=[],{limit:n=50,offset:o=0,orderBy:i="relevance",...a}=r;if(!e){let c={...a};delete c.type;let u=this.buildFilterClause(c,s,"s");if(!u)throw new Error("Either query or filters required for search");let d=`
        SELECT s.*, s.discovery_tokens
        FROM session_summaries s
        WHERE ${u}
        ${i==="date_asc"?"ORDER BY s.created_at_epoch ASC":"ORDER BY s.created_at_epoch DESC"}
        LIMIT ? OFFSET ?
      `;return s.push(n,o),this.db.prepare(d).all(...s)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}findByConcept(e,r={}){let s=[],{limit:n=50,offset:o=0,orderBy:i="date_desc",...a}=r,c={...a,concepts:e},u=this.buildFilterClause(c,s,"o"),l=this.buildOrderClause(i,!1),d=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${l}
      LIMIT ? OFFSET ?
    `;return s.push(n,o),this.db.prepare(d).all(...s)}findByFile(e,r={}){let s=[],{limit:n=50,offset:o=0,orderBy:i="date_desc",...a}=r,c={...a,files:e},u=this.buildFilterClause(c,s,"o"),l=this.buildOrderClause(i,!1),d=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${l}
      LIMIT ? OFFSET ?
    `;s.push(n,o);let p=this.db.prepare(d).all(...s),m=[],f={...a};delete f.type;let g=[];if(f.project&&(g.push("s.project = ?"),m.push(f.project)),f.dateRange){let{start:$,end:y}=f.dateRange;if($){let x=typeof $=="number"?$:new Date($).getTime();g.push("s.created_at_epoch >= ?"),m.push(x)}if(y){let x=typeof y=="number"?y:new Date(y).getTime();g.push("s.created_at_epoch <= ?"),m.push(x)}}g.push(`(
      EXISTS (SELECT 1 FROM json_each(s.files_read) WHERE value LIKE ?)
      OR EXISTS (SELECT 1 FROM json_each(s.files_edited) WHERE value LIKE ?)
    )`),m.push(`%${e}%`,`%${e}%`);let _=`
      SELECT s.*, s.discovery_tokens
      FROM session_summaries s
      WHERE ${g.join(" AND ")}
      ORDER BY s.created_at_epoch DESC
      LIMIT ? OFFSET ?
    `;m.push(n,o);let v=this.db.prepare(_).all(...m);return{observations:p,sessions:v}}findByType(e,r={}){let s=[],{limit:n=50,offset:o=0,orderBy:i="date_desc",...a}=r,c={...a,type:e},u=this.buildFilterClause(c,s,"o"),l=this.buildOrderClause(i,!1),d=`
      SELECT o.*, o.discovery_tokens
      FROM observations o
      WHERE ${u}
      ${l}
      LIMIT ? OFFSET ?
    `;return s.push(n,o),this.db.prepare(d).all(...s)}searchUserPrompts(e,r={}){let s=[],{limit:n=20,offset:o=0,orderBy:i="relevance",...a}=r,c=[];if(a.project&&(c.push("s.project = ?"),s.push(a.project)),a.dateRange){let{start:u,end:l}=a.dateRange;if(u){let d=typeof u=="number"?u:new Date(u).getTime();c.push("up.created_at_epoch >= ?"),s.push(d)}if(l){let d=typeof l=="number"?l:new Date(l).getTime();c.push("up.created_at_epoch <= ?"),s.push(d)}}if(!e){if(c.length===0)throw new Error("Either query or filters required for search");let d=`
        SELECT up.*
        FROM user_prompts up
        JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
        ${`WHERE ${c.join(" AND ")}`}
        ${i==="date_asc"?"ORDER BY up.created_at_epoch ASC":"ORDER BY up.created_at_epoch DESC"}
        LIMIT ? OFFSET ?
      `;return s.push(n,o),this.db.prepare(d).all(...s)}return console.warn("[SessionSearch] Text search not supported - use ChromaDB for vector search"),[]}getUserPromptsBySession(e){return this.db.prepare(`
      SELECT
        id,
        claude_session_id,
        prompt_number,
        prompt_text,
        created_at,
        created_at_epoch
      FROM user_prompts
      WHERE claude_session_id = ?
      ORDER BY prompt_number ASC
    `).all(e)}close(){this.db.close()}};var Xg=fr(require("better-sqlite3"),1);var Ku=(o=>(o[o.DEBUG=0]="DEBUG",o[o.INFO=1]="INFO",o[o.WARN=2]="WARN",o[o.ERROR=3]="ERROR",o[o.SILENT=4]="SILENT",o))(Ku||{}),Xu=class{level;useColor;constructor(){let e=process.env.CLAUDE_MEM_LOG_LEVEL?.toUpperCase()||"INFO";this.level=Ku[e]??1,this.useColor=process.stdout.isTTY??!1}correlationId(e,r){return`obs-${e}-${r}`}sessionId(e){return`session-${e}`}formatData(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="object"){if(e instanceof Error)return this.level===0?`${e.message}
${e.stack}`:e.message;if(Array.isArray(e))return`[${e.length} items]`;let r=Object.keys(e);return r.length===0?"{}":r.length<=3?JSON.stringify(e):`{${r.length} keys: ${r.slice(0,3).join(", ")}...}`}return String(e)}formatTool(e,r){if(!r)return e;try{let s=typeof r=="string"?JSON.parse(r):r;if(e==="Bash"&&s.command){let n=s.command.length>50?s.command.substring(0,50)+"...":s.command;return`${e}(${n})`}if(e==="Read"&&s.file_path){let n=s.file_path.split("/").pop()||s.file_path;return`${e}(${n})`}if(e==="Edit"&&s.file_path){let n=s.file_path.split("/").pop()||s.file_path;return`${e}(${n})`}if(e==="Write"&&s.file_path){let n=s.file_path.split("/").pop()||s.file_path;return`${e}(${n})`}return e}catch{return e}}log(e,r,s,n,o){if(e<this.level)return;let i=new Date().toISOString().replace("T"," ").substring(0,23),a=Ku[e].padEnd(5),c=r.padEnd(6),u="";n?.correlationId?u=`[${n.correlationId}] `:n?.sessionId&&(u=`[session-${n.sessionId}] `);let l="";o!=null&&(this.level===0&&typeof o=="object"?l=`
`+JSON.stringify(o,null,2):l=" "+this.formatData(o));let d="";if(n){let{sessionId:m,sdkSessionId:f,correlationId:g,..._}=n;Object.keys(_).length>0&&(d=` {${Object.entries(_).map(([$,y])=>`${$}=${y}`).join(", ")}}`)}let p=`[${i}] [${a}] [${c}] ${u}${s}${d}${l}`;e===3?console.error(p):console.log(p)}debug(e,r,s,n){this.log(0,e,r,s,n)}info(e,r,s,n){this.log(1,e,r,s,n)}warn(e,r,s,n){this.log(2,e,r,s,n)}error(e,r,s,n){this.log(3,e,r,s,n)}dataIn(e,r,s,n){this.info(e,`\u2192 ${r}`,s,n)}dataOut(e,r,s,n){this.info(e,`\u2190 ${r}`,s,n)}success(e,r,s,n){this.info(e,`\u2713 ${r}`,s,n)}failure(e,r,s,n){this.error(e,`\u2717 ${r}`,s,n)}timing(e,r,s,n){this.info(e,`\u23F1 ${r}`,n,{duration:`${s}ms`})}},Hg=new Xu;var Gg=require("fs"),Wg=require("os"),Kg=require("path"),Zk=(0,Kg.join)((0,Wg.homedir)(),".pm2","logs","claude-mem-worker-error.log");function je(t,e,r=""){let s=new Date().toISOString(),a=((new Error().stack?.split(`
`)??[])[2]??"").match(/at\s+(?:.*\s+)?\(?([^:]+):(\d+):(\d+)\)?/),c=a?`${a[1].split("/").pop()}:${a[2]}`:"unknown",u=`[${s}] [HAPPY-PATH-ERROR] [${c}] ${t}`;if(e!==void 0)try{u+=` ${JSON.stringify(e)}`}catch(l){u+=` [stringify error: ${l}]`}u+=`
`;try{(0,Gg.appendFileSync)(Zk,u)}catch{}return r}var At=je;var gi=class{db;constructor(){hi(St),this.db=new Xg.default(fi),this.db.pragma("journal_mode = WAL"),this.db.pragma("synchronous = NORMAL"),this.db.pragma("foreign_keys = ON"),this.initializeSchema(),this.ensureWorkerPortColumn(),this.ensurePromptTrackingColumns(),this.removeSessionSummariesUniqueConstraint(),this.addObservationHierarchicalFields(),this.makeObservationsTextNullable(),this.addEndlessModeStatsColumns(),this.createUserPromptsTable(),this.ensureDiscoveryTokensColumn(),this.addToolUseIdColumn(),this.removeToolUseIdUniqueConstraint()}initializeSchema(){try{this.db.exec(`
        CREATE TABLE IF NOT EXISTS schema_versions (
          id INTEGER PRIMARY KEY,
          version INTEGER UNIQUE NOT NULL,
          applied_at TEXT NOT NULL
        )
      `);let e=this.db.prepare("SELECT version FROM schema_versions ORDER BY version").all();(e.length>0?Math.max(...e.map(s=>s.version)):0)===0&&(console.error("[SessionStore] Initializing fresh database with migration004..."),this.db.exec(`
          CREATE TABLE IF NOT EXISTS sdk_sessions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT UNIQUE NOT NULL,
            sdk_session_id TEXT UNIQUE,
            project TEXT NOT NULL,
            user_prompt TEXT,
            started_at TEXT NOT NULL,
            started_at_epoch INTEGER NOT NULL,
            completed_at TEXT,
            completed_at_epoch INTEGER,
            status TEXT CHECK(status IN ('active', 'completed', 'failed')) NOT NULL DEFAULT 'active',
            endless_original_tokens INTEGER DEFAULT 0,
            endless_compressed_tokens INTEGER DEFAULT 0,
            endless_tokens_saved INTEGER DEFAULT 0
          );

          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_claude_id ON sdk_sessions(claude_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_sdk_id ON sdk_sessions(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_project ON sdk_sessions(project);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_status ON sdk_sessions(status);
          CREATE INDEX IF NOT EXISTS idx_sdk_sessions_started ON sdk_sessions(started_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS observations (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT NOT NULL,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery')),
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_observations_project ON observations(project);
          CREATE INDEX IF NOT EXISTS idx_observations_type ON observations(type);
          CREATE INDEX IF NOT EXISTS idx_observations_created ON observations(created_at_epoch DESC);

          CREATE TABLE IF NOT EXISTS session_summaries (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT UNIQUE NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          );

          CREATE INDEX IF NOT EXISTS idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX IF NOT EXISTS idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.prepare("INSERT INTO schema_versions (version, applied_at) VALUES (?, ?)").run(4,new Date().toISOString()),console.error("[SessionStore] Migration004 applied successfully"))}catch(e){throw console.error("[SessionStore] Schema initialization error:",e.message),e}}ensureWorkerPortColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(5))return;this.db.pragma("table_info(sdk_sessions)").some(n=>n.name==="worker_port")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN worker_port INTEGER"),console.error("[SessionStore] Added worker_port column to sdk_sessions table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(5,new Date().toISOString())}catch(e){console.error("[SessionStore] Migration error:",e.message)}}ensurePromptTrackingColumns(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(6))return;this.db.pragma("table_info(sdk_sessions)").some(c=>c.name==="prompt_counter")||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN prompt_counter INTEGER DEFAULT 0"),console.error("[SessionStore] Added prompt_counter column to sdk_sessions table")),this.db.pragma("table_info(observations)").some(c=>c.name==="prompt_number")||(this.db.exec("ALTER TABLE observations ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to observations table")),this.db.pragma("table_info(session_summaries)").some(c=>c.name==="prompt_number")||(this.db.exec("ALTER TABLE session_summaries ADD COLUMN prompt_number INTEGER"),console.error("[SessionStore] Added prompt_number column to session_summaries table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(6,new Date().toISOString())}catch(e){console.error("[SessionStore] Prompt tracking migration error:",e.message)}}removeSessionSummariesUniqueConstraint(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(7))return;if(!this.db.pragma("index_list(session_summaries)").some(n=>n.unique===1)){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString());return}console.error("[SessionStore] Removing UNIQUE constraint from session_summaries.sdk_session_id..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE session_summaries_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            request TEXT,
            investigated TEXT,
            learned TEXT,
            completed TEXT,
            next_steps TEXT,
            files_read TEXT,
            files_edited TEXT,
            notes TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO session_summaries_new
          SELECT id, sdk_session_id, project, request, investigated, learned,
                 completed, next_steps, files_read, files_edited, notes,
                 prompt_number, created_at, created_at_epoch
          FROM session_summaries
        `),this.db.exec("DROP TABLE session_summaries"),this.db.exec("ALTER TABLE session_summaries_new RENAME TO session_summaries"),this.db.exec(`
          CREATE INDEX idx_session_summaries_sdk_session ON session_summaries(sdk_session_id);
          CREATE INDEX idx_session_summaries_project ON session_summaries(project);
          CREATE INDEX idx_session_summaries_created ON session_summaries(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(7,new Date().toISOString()),console.error("[SessionStore] Successfully removed UNIQUE constraint from session_summaries.sdk_session_id")}catch(n){throw this.db.exec("ROLLBACK"),n}}catch(e){console.error("[SessionStore] Migration error (remove UNIQUE constraint):",e.message)}}addObservationHierarchicalFields(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(8))return;if(this.db.pragma("table_info(observations)").some(n=>n.name==="title")){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString());return}console.error("[SessionStore] Adding hierarchical fields to observations table..."),this.db.exec(`
        ALTER TABLE observations ADD COLUMN title TEXT;
        ALTER TABLE observations ADD COLUMN subtitle TEXT;
        ALTER TABLE observations ADD COLUMN facts TEXT;
        ALTER TABLE observations ADD COLUMN narrative TEXT;
        ALTER TABLE observations ADD COLUMN concepts TEXT;
        ALTER TABLE observations ADD COLUMN files_read TEXT;
        ALTER TABLE observations ADD COLUMN files_modified TEXT;
      `),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(8,new Date().toISOString()),console.error("[SessionStore] Successfully added hierarchical fields to observations table")}catch(e){console.error("[SessionStore] Migration error (add hierarchical fields):",e.message)}}makeObservationsTextNullable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(9))return;let s=this.db.pragma("table_info(observations)").find(n=>n.name==="text");if(!s||s.notnull===0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString());return}console.error("[SessionStore] Making observations.text nullable..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE observations_new (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            sdk_session_id TEXT NOT NULL,
            project TEXT NOT NULL,
            text TEXT,
            type TEXT NOT NULL CHECK(type IN ('decision', 'bugfix', 'feature', 'refactor', 'discovery', 'change')),
            title TEXT,
            subtitle TEXT,
            facts TEXT,
            narrative TEXT,
            concepts TEXT,
            files_read TEXT,
            files_modified TEXT,
            prompt_number INTEGER,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(sdk_session_id) REFERENCES sdk_sessions(sdk_session_id) ON DELETE CASCADE
          )
        `),this.db.exec(`
          INSERT INTO observations_new
          SELECT id, sdk_session_id, project, text, type, title, subtitle, facts,
                 narrative, concepts, files_read, files_modified, prompt_number,
                 created_at, created_at_epoch
          FROM observations
        `),this.db.exec("DROP TABLE observations"),this.db.exec("ALTER TABLE observations_new RENAME TO observations"),this.db.exec(`
          CREATE INDEX idx_observations_sdk_session ON observations(sdk_session_id);
          CREATE INDEX idx_observations_project ON observations(project);
          CREATE INDEX idx_observations_type ON observations(type);
          CREATE INDEX idx_observations_created ON observations(created_at_epoch DESC);
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(9,new Date().toISOString()),console.error("[SessionStore] Successfully made observations.text nullable")}catch(n){throw this.db.exec("ROLLBACK"),n}}catch(e){console.error("[SessionStore] Migration error (make text nullable):",e.message)}}createUserPromptsTable(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(10))return;if(this.db.pragma("table_info(user_prompts)").length>0){this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString());return}console.error("[SessionStore] Creating user_prompts table with FTS5 support..."),this.db.exec("BEGIN TRANSACTION");try{this.db.exec(`
          CREATE TABLE user_prompts (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            claude_session_id TEXT NOT NULL,
            prompt_number INTEGER NOT NULL,
            prompt_text TEXT NOT NULL,
            created_at TEXT NOT NULL,
            created_at_epoch INTEGER NOT NULL,
            FOREIGN KEY(claude_session_id) REFERENCES sdk_sessions(claude_session_id) ON DELETE CASCADE
          );

          CREATE INDEX idx_user_prompts_claude_session ON user_prompts(claude_session_id);
          CREATE INDEX idx_user_prompts_created ON user_prompts(created_at_epoch DESC);
          CREATE INDEX idx_user_prompts_prompt_number ON user_prompts(prompt_number);
          CREATE INDEX idx_user_prompts_lookup ON user_prompts(claude_session_id, prompt_number);
        `),this.db.exec(`
          CREATE VIRTUAL TABLE user_prompts_fts USING fts5(
            prompt_text,
            content='user_prompts',
            content_rowid='id'
          );
        `),this.db.exec(`
          CREATE TRIGGER user_prompts_ai AFTER INSERT ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;

          CREATE TRIGGER user_prompts_ad AFTER DELETE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
          END;

          CREATE TRIGGER user_prompts_au AFTER UPDATE ON user_prompts BEGIN
            INSERT INTO user_prompts_fts(user_prompts_fts, rowid, prompt_text)
            VALUES('delete', old.id, old.prompt_text);
            INSERT INTO user_prompts_fts(rowid, prompt_text)
            VALUES (new.id, new.prompt_text);
          END;
        `),this.db.exec("COMMIT"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(10,new Date().toISOString()),console.error("[SessionStore] Successfully created user_prompts table with FTS5 support")}catch(s){throw this.db.exec("ROLLBACK"),s}}catch(e){console.error("[SessionStore] Migration error (create user_prompts table):",e.message)}}ensureDiscoveryTokensColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(11))return;this.db.pragma("table_info(observations)").some(i=>i.name==="discovery_tokens")||(this.db.exec("ALTER TABLE observations ADD COLUMN discovery_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added discovery_tokens column to observations table")),this.db.pragma("table_info(session_summaries)").some(i=>i.name==="discovery_tokens")||(this.db.exec("ALTER TABLE session_summaries ADD COLUMN discovery_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added discovery_tokens column to session_summaries table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(11,new Date().toISOString())}catch(e){throw console.error("[SessionStore] Discovery tokens migration error:",e.message),e}}addToolUseIdColumn(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(12))return;this.db.pragma("table_info(observations)").some(n=>n.name==="tool_use_id")||(this.db.exec("ALTER TABLE observations ADD COLUMN tool_use_id TEXT"),console.error("[SessionStore] Added tool_use_id column to observations table"),this.db.exec("CREATE INDEX IF NOT EXISTS idx_observations_tool_use_id ON observations(tool_use_id) WHERE tool_use_id IS NOT NULL"),console.error("[SessionStore] Created index on tool_use_id column")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(12,new Date().toISOString())}catch(e){console.error("[SessionStore] Tool use ID migration error:",e.message)}}addEndlessModeStatsColumns(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(13))return;let r=this.db.pragma("table_info(sdk_sessions)"),s=r.some(i=>i.name==="endless_original_tokens"),n=r.some(i=>i.name==="endless_compressed_tokens"),o=r.some(i=>i.name==="endless_tokens_saved");s||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN endless_original_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added endless_original_tokens column to sdk_sessions table")),n||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN endless_compressed_tokens INTEGER DEFAULT 0"),console.error("[SessionStore] Added endless_compressed_tokens column to sdk_sessions table")),o||(this.db.exec("ALTER TABLE sdk_sessions ADD COLUMN endless_tokens_saved INTEGER DEFAULT 0"),console.error("[SessionStore] Added endless_tokens_saved column to sdk_sessions table")),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(13,new Date().toISOString())}catch(e){console.error("[SessionStore] Endless Mode stats migration error:",e.message)}}removeToolUseIdUniqueConstraint(){try{if(this.db.prepare("SELECT version FROM schema_versions WHERE version = ?").get(14))return;this.db.exec("DROP INDEX IF EXISTS idx_observations_tool_use_id"),console.error("[SessionStore] Dropped UNIQUE index on tool_use_id"),this.db.exec("CREATE INDEX IF NOT EXISTS idx_observations_tool_use_id ON observations(tool_use_id) WHERE tool_use_id IS NOT NULL"),console.error("[SessionStore] Recreated tool_use_id index without UNIQUE constraint"),this.db.prepare("INSERT OR IGNORE INTO schema_versions (version, applied_at) VALUES (?, ?)").run(14,new Date().toISOString())}catch(e){console.error("[SessionStore] Remove UNIQUE constraint migration error:",e.message)}}getRecentSummaries(e,r=10){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getRecentSummariesWithSessionInfo(e,r=3){return this.db.prepare(`
      SELECT
        sdk_session_id, request, learned, completed, next_steps,
        prompt_number, created_at
      FROM session_summaries
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getRecentObservations(e,r=20){return this.db.prepare(`
      SELECT type, text, prompt_number, created_at
      FROM observations
      WHERE project = ?
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e,r)}getAllRecentObservations(e=100){return this.db.prepare(`
      SELECT id, type, title, subtitle, text, project, prompt_number, created_at, created_at_epoch
      FROM observations
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllRecentSummaries(e=50){return this.db.prepare(`
      SELECT id, request, investigated, learned, completed, next_steps,
             files_read, files_edited, notes, project, prompt_number,
             created_at, created_at_epoch
      FROM session_summaries
      ORDER BY created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllRecentUserPrompts(e=100){return this.db.prepare(`
      SELECT
        up.id,
        up.claude_session_id,
        s.project,
        up.prompt_number,
        up.prompt_text,
        up.created_at,
        up.created_at_epoch
      FROM user_prompts up
      LEFT JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      ORDER BY up.created_at_epoch DESC
      LIMIT ?
    `).all(e)}getAllProjects(){return this.db.prepare(`
      SELECT DISTINCT project
      FROM sdk_sessions
      WHERE project IS NOT NULL AND project != ''
      ORDER BY project ASC
    `).all().map(s=>s.project)}getRecentSessionsWithStatus(e,r=3){return this.db.prepare(`
      SELECT * FROM (
        SELECT
          s.sdk_session_id,
          s.status,
          s.started_at,
          s.started_at_epoch,
          s.user_prompt,
          CASE WHEN sum.sdk_session_id IS NOT NULL THEN 1 ELSE 0 END as has_summary
        FROM sdk_sessions s
        LEFT JOIN session_summaries sum ON s.sdk_session_id = sum.sdk_session_id
        WHERE s.project = ? AND s.sdk_session_id IS NOT NULL
        GROUP BY s.sdk_session_id
        ORDER BY s.started_at_epoch DESC
        LIMIT ?
      )
      ORDER BY started_at_epoch ASC
    `).all(e,r)}getObservationsForSession(e){return this.db.prepare(`
      SELECT title, subtitle, type, prompt_number
      FROM observations
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch ASC
    `).all(e)}getObservationById(e){return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id = ?
    `).get(e)||je("SessionStore.getObservationById: No observation found",{id:e},null)}getObservationsByIds(e,r={}){if(e.length===0)return[];let{orderBy:s="date_desc",limit:n}=r,o=s==="date_asc"?"ASC":"DESC",i=n?`LIMIT ${n}`:"",a=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT *
      FROM observations
      WHERE id IN (${a})
      ORDER BY created_at_epoch ${o}
      ${i}
    `).all(...e)}getSummaryForSession(e){return this.db.prepare(`
      SELECT
        request, investigated, learned, completed, next_steps,
        files_read, files_edited, notes, prompt_number, created_at
      FROM session_summaries
      WHERE sdk_session_id = ?
      ORDER BY created_at_epoch DESC
      LIMIT 1
    `).get(e)||je("SessionStore.getSummaryForSession: No summary found",{sdkSessionId:e},null)}getFilesForSession(e){let s=this.db.prepare(`
      SELECT files_read, files_modified
      FROM observations
      WHERE sdk_session_id = ?
    `).all(e),n=new Set,o=new Set;for(let i of s){if(i.files_read)try{let a=JSON.parse(i.files_read);Array.isArray(a)&&a.forEach(c=>n.add(c))}catch{}if(i.files_modified)try{let a=JSON.parse(i.files_modified);Array.isArray(a)&&a.forEach(c=>o.add(c))}catch{}}return{filesRead:Array.from(n),filesModified:Array.from(o)}}getSessionById(e){return this.db.prepare(`
      SELECT id, claude_session_id, sdk_session_id, project, user_prompt
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(e)||je("SessionStore.getSessionById: No session found",{id:e},null)}findActiveSDKSession(e){return this.db.prepare(`
      SELECT id, sdk_session_id, project, worker_port
      FROM sdk_sessions
      WHERE claude_session_id = ? AND status = 'active'
      LIMIT 1
    `).get(e)||je("SessionStore.findActiveSDKSession: No active session found",{claudeSessionId:e},null)}findAnySDKSession(e){return this.db.prepare(`
      SELECT id
      FROM sdk_sessions
      WHERE claude_session_id = ?
      LIMIT 1
    `).get(e)||je("SessionStore.findAnySDKSession: No session found",{claudeSessionId:e},null)}reactivateSession(e,r){this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'active', user_prompt = ?, worker_port = NULL
      WHERE id = ?
    `).run(r,e)}incrementPromptCounter(e){return this.db.prepare(`
      UPDATE sdk_sessions
      SET prompt_counter = COALESCE(prompt_counter, 0) + 1
      WHERE id = ?
    `).run(e),this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(e)?.prompt_counter||je("SessionStore.incrementPromptCounter: result or prompt_counter is null",{id:e},1)}getPromptCounter(e){return this.db.prepare(`
      SELECT prompt_counter FROM sdk_sessions WHERE id = ?
    `).get(e)?.prompt_counter||je("SessionStore.getPromptCounter: prompt_counter is null",{id:e},0)}createSDKSession(e,r,s){let n=new Date,o=n.getTime(),a=this.db.prepare(`
      INSERT OR IGNORE INTO sdk_sessions
      (claude_session_id, sdk_session_id, project, user_prompt, started_at, started_at_epoch, status)
      VALUES (?, ?, ?, ?, ?, ?, 'active')
    `).run(e,e,r,s,n.toISOString(),o);return a.lastInsertRowid===0||a.changes===0?(r&&r.trim()!==""&&this.db.prepare(`
          UPDATE sdk_sessions
          SET project = ?, user_prompt = ?
          WHERE claude_session_id = ?
        `).run(r,s,e),this.db.prepare(`
        SELECT id FROM sdk_sessions WHERE claude_session_id = ? LIMIT 1
      `).get(e).id):a.lastInsertRowid}updateSDKSessionId(e,r){return this.db.prepare(`
      UPDATE sdk_sessions
      SET sdk_session_id = ?
      WHERE id = ? AND sdk_session_id IS NULL
    `).run(r,e).changes===0?(Hg.debug("DB","sdk_session_id already set, skipping update",{sessionId:e,sdkSessionId:r}),!1):!0}setWorkerPort(e,r){this.db.prepare(`
      UPDATE sdk_sessions
      SET worker_port = ?
      WHERE id = ?
    `).run(r,e)}getWorkerPort(e){return this.db.prepare(`
      SELECT worker_port
      FROM sdk_sessions
      WHERE id = ?
      LIMIT 1
    `).get(e)?.worker_port||je("SessionStore.getWorkerPort: worker_port is null",{id:e},null)}saveUserPrompt(e,r,s){let n=new Date,o=n.getTime();return this.db.prepare(`
      INSERT INTO user_prompts
      (claude_session_id, prompt_number, prompt_text, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,s,n.toISOString(),o).lastInsertRowid}getUserPrompt(e,r){return this.db.prepare(`
      SELECT prompt_text
      FROM user_prompts
      WHERE claude_session_id = ? AND prompt_number = ?
      LIMIT 1
    `).get(e,r)?.prompt_text??null}storeObservation(e,r,s,n,o=0){let i=new Date,a=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(e)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(e,e,r,i.toISOString(),a),console.error(`[SessionStore] Auto-created session record for session_id: ${e}`));let d=this.db.prepare(`
      INSERT INTO observations
      (sdk_session_id, project, type, title, subtitle, facts, narrative, concepts,
       files_read, files_modified, prompt_number, discovery_tokens, tool_use_id, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(e,r,s.type,s.title,s.subtitle,JSON.stringify(s.facts),s.narrative,JSON.stringify(s.concepts),JSON.stringify(s.files_read),JSON.stringify(s.files_modified),n||je("SessionStore.storeObservation: promptNumber is null",{sdkSessionId:e},null),o,s.tool_use_id||je("SessionStore.storeObservation: tool_use_id is null",{sdkSessionId:e},null),i.toISOString(),a);return{id:Number(d.lastInsertRowid),createdAtEpoch:a}}getObservationByToolUseId(e){return this.db.prepare(`
      SELECT * FROM observations
      WHERE tool_use_id = ?
      LIMIT 1
    `).get(e)||je("SessionStore.getObservationByToolUseId: No observation found",{toolUseId:e},null)}getAllObservationsForToolUseId(e){return this.db.prepare(`
      SELECT * FROM observations
      WHERE tool_use_id = ?
      ORDER BY created_at_epoch ASC
    `).all(e)}getObservationsByToolUseIds(e){if(e.length===0)return new Map;let r=e.map(()=>"?").join(","),n=this.db.prepare(`
      SELECT * FROM observations
      WHERE tool_use_id IN (${r})
    `).all(...e),o=new Map;for(let i of n)i.tool_use_id&&o.set(i.tool_use_id,i);return o}storeSummary(e,r,s,n,o=0){let i=new Date,a=i.getTime();this.db.prepare(`
      SELECT id FROM sdk_sessions WHERE sdk_session_id = ?
    `).get(e)||(this.db.prepare(`
        INSERT INTO sdk_sessions
        (claude_session_id, sdk_session_id, project, started_at, started_at_epoch, status)
        VALUES (?, ?, ?, ?, ?, 'active')
      `).run(e,e,r,i.toISOString(),a),console.error(`[SessionStore] Auto-created session record for session_id: ${e}`));let d=this.db.prepare(`
      INSERT INTO session_summaries
      (sdk_session_id, project, request, investigated, learned, completed,
       next_steps, notes, prompt_number, discovery_tokens, created_at, created_at_epoch)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(e,r,s.request,s.investigated,s.learned,s.completed,s.next_steps,s.notes,n||je("SessionStore.storeSummary: promptNumber is null",{sdkSessionId:e},null),o,i.toISOString(),a);return{id:Number(d.lastInsertRowid),createdAtEpoch:a}}markSessionCompleted(e){let r=new Date,s=r.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'completed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(r.toISOString(),s,e)}markSessionFailed(e){let r=new Date,s=r.getTime();this.db.prepare(`
      UPDATE sdk_sessions
      SET status = 'failed', completed_at = ?, completed_at_epoch = ?
      WHERE id = ?
    `).run(r.toISOString(),s,e)}getSessionSummariesByIds(e,r={}){if(e.length===0)return[];let{orderBy:s="date_desc",limit:n}=r,o=s==="date_asc"?"ASC":"DESC",i=n?`LIMIT ${n}`:"",a=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT * FROM session_summaries
      WHERE id IN (${a})
      ORDER BY created_at_epoch ${o}
      ${i}
    `).all(...e)}getUserPromptsByIds(e,r={}){if(e.length===0)return[];let{orderBy:s="date_desc",limit:n}=r,o=s==="date_asc"?"ASC":"DESC",i=n?`LIMIT ${n}`:"",a=e.map(()=>"?").join(",");return this.db.prepare(`
      SELECT
        up.*,
        s.project,
        s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.id IN (${a})
      ORDER BY up.created_at_epoch ${o}
      ${i}
    `).all(...e)}getTimelineAroundTimestamp(e,r=10,s=10,n){return this.getTimelineAroundObservation(null,e,r,s,n)}getTimelineAroundObservation(e,r,s=10,n=10,o){let i=o?"AND project = ?":"",a=o?[o]:[],c,u;if(e!==null){let m=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id <= ? ${i}
        ORDER BY id DESC
        LIMIT ?
      `,f=`
        SELECT id, created_at_epoch
        FROM observations
        WHERE id >= ? ${i}
        ORDER BY id ASC
        LIMIT ?
      `;try{let g=this.db.prepare(m).all(e,...a,s+1),_=this.db.prepare(f).all(e,...a,n+1);if(g.length===0&&_.length===0)return{observations:[],sessions:[],prompts:[]};c=g.length>0?g[g.length-1].created_at_epoch:r,u=_.length>0?_[_.length-1].created_at_epoch:r}catch(g){return console.error("[SessionStore] Error getting boundary observations:",g.message),{observations:[],sessions:[],prompts:[]}}}else{let m=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch <= ? ${i}
        ORDER BY created_at_epoch DESC
        LIMIT ?
      `,f=`
        SELECT created_at_epoch
        FROM observations
        WHERE created_at_epoch >= ? ${i}
        ORDER BY created_at_epoch ASC
        LIMIT ?
      `;try{let g=this.db.prepare(m).all(r,...a,s),_=this.db.prepare(f).all(r,...a,n+1);if(g.length===0&&_.length===0)return{observations:[],sessions:[],prompts:[]};c=g.length>0?g[g.length-1].created_at_epoch:r,u=_.length>0?_[_.length-1].created_at_epoch:r}catch(g){return console.error("[SessionStore] Error getting boundary timestamps:",g.message),{observations:[],sessions:[],prompts:[]}}}let l=`
      SELECT *
      FROM observations
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${i}
      ORDER BY created_at_epoch ASC
    `,d=`
      SELECT *
      FROM session_summaries
      WHERE created_at_epoch >= ? AND created_at_epoch <= ? ${i}
      ORDER BY created_at_epoch ASC
    `,p=`
      SELECT up.*, s.project, s.sdk_session_id
      FROM user_prompts up
      JOIN sdk_sessions s ON up.claude_session_id = s.claude_session_id
      WHERE up.created_at_epoch >= ? AND up.created_at_epoch <= ? ${i.replace("project","s.project")}
      ORDER BY up.created_at_epoch ASC
    `;try{let m=this.db.prepare(l).all(c,u,...a),f=this.db.prepare(d).all(c,u,...a),g=this.db.prepare(p).all(c,u,...a);return{observations:m,sessions:f.map(_=>({id:_.id,sdk_session_id:_.sdk_session_id,project:_.project,request:_.request,completed:_.completed,next_steps:_.next_steps,created_at:_.created_at,created_at_epoch:_.created_at_epoch})),prompts:g.map(_=>({id:_.id,claude_session_id:_.claude_session_id,project:_.project,prompt:_.prompt_text,created_at:_.created_at,created_at_epoch:_.created_at_epoch}))}}catch(m){return console.error("[SessionStore] Error querying timeline records:",m.message),{observations:[],sessions:[],prompts:[]}}}incrementEndlessModeStats(e,r,s){let n=r-s;this.db.prepare(`
      UPDATE sdk_sessions
      SET
        endless_original_tokens = COALESCE(endless_original_tokens, 0) + ?,
        endless_compressed_tokens = COALESCE(endless_compressed_tokens, 0) + ?,
        endless_tokens_saved = COALESCE(endless_tokens_saved, 0) + ?
      WHERE claude_session_id = ?
    `).run(r,s,n,e)}getEndlessModeStats(e){let s=this.db.prepare(`
      SELECT
        endless_original_tokens,
        endless_compressed_tokens,
        endless_tokens_saved
      FROM sdk_sessions
      WHERE claude_session_id = ?
    `).get(e);return s?{originalTokens:s.endless_original_tokens||je("SessionStore.getEndlessModeStats: endless_original_tokens is null",{claudeSessionId:e},0),compressedTokens:s.endless_compressed_tokens||je("SessionStore.getEndlessModeStats: endless_compressed_tokens is null",{claudeSessionId:e},0),tokensSaved:s.endless_tokens_saved||je("SessionStore.getEndlessModeStats: endless_tokens_saved is null",{claudeSessionId:e},0)}:null}close(){this.db.close()}};var $e,ce,Re=null,Uk="cm__claude-mem";try{$e=new _i,ce=new gi}catch(t){console.error("[search-server] Failed to initialize search:",t.message),process.exit(1)}async function tt(t,e,r){if(!Re)throw new Error("Chroma client not initialized");At("queryChroma called",{query:t,limit:e,whereFilter:r});let s=r?JSON.stringify(r):void 0;At("where filter stringified",{whereFilter:r,whereStringified:s});let n={collection_name:Uk,query_texts:[t],n_results:e,include:["documents","metadatas","distances"],where:s};At("calling chroma_query_documents",n);let o=await Re.callTool({name:"chroma_query_documents",arguments:n}),i=o.content[0]?.text||At("search-server.queryChroma: result.content[0].text is missing",{queryText:t});At("chroma response received",{hasContent:!!o.content[0]?.text,textLength:i.length,textPreview:i.substring(0,200)});let a;try{a=JSON.parse(i)}catch(p){return console.error("[search-server] Failed to parse Chroma response as JSON:",p),console.error("[search-server] Raw Chroma response:",i),{ids:[],distances:[],metadatas:[]}}let c=[],u=a.ids?.[0]||At("search-server.queryChroma: parsed.ids[0] is missing",{query:t},[]);for(let p of u){let m=p.match(/obs_(\d+)_/),f=p.match(/summary_(\d+)_/),g=p.match(/prompt_(\d+)/),_=null;m?_=parseInt(m[1],10):f?_=parseInt(f[1],10):g&&(_=parseInt(g[1],10)),_!==null&&!c.includes(_)&&c.push(_)}let l=a.distances?.[0]||At("search-server.queryChroma: parsed.distances[0] is missing",{query:t},[]),d=a.metadatas?.[0]||At("search-server.queryChroma: parsed.metadatas[0] is missing",{query:t},[]);return{ids:c,distances:l,metadatas:d}}function Br(){return`
---
\u{1F4A1} Search Strategy:
ALWAYS search with index format FIRST to get an overview and identify relevant results.
This is critical for token efficiency - index format uses ~10x fewer tokens than full format.

Search workflow:
1. Initial search: Use default (index) format to see titles, dates, and sources
2. Review results: Identify which items are most relevant to your needs
3. Deep dive: Only then use format: "full" on specific items of interest
4. Narrow down: Use filters (type, dateStart/dateEnd, concepts, files) to refine results

Other tips:
\u2022 To search by concept: Use find_by_concept tool
\u2022 To browse by type: Use find_by_type with ["decision", "feature", etc.]
\u2022 To sort by date: Use orderBy: "date_desc" or "date_asc"`}function Ju(t,e,r,s,n){if(t.length===0)return t;let o=-1;if(typeof e=="number")o=t.findIndex(c=>c.type==="observation"&&c.data.id===e);else if(typeof e=="string"&&e.startsWith("S")){let c=parseInt(e.slice(1),10);o=t.findIndex(u=>u.type==="session"&&u.data.id===c)}else o=t.findIndex(c=>c.epoch>=r),o===-1&&(o=t.length-1);if(o===-1)return t;let i=Math.max(0,o-s),a=Math.min(t.length,o+n+1);return t.slice(i,a)}function dr(t,e){let r=t.title||`Observation #${t.id}`,s=new Date(t.created_at_epoch).toLocaleString(),n=t.type?`[${t.type}]`:"";return`${e+1}. ${n} ${r}
   Date: ${s}
   Source: claude-mem://observation/${t.id}`}function Yu(t,e){let r=t.request||`Session ${t.sdk_session_id?.substring(0,8)||"unknown"}`,s=new Date(t.created_at_epoch).toLocaleString();return`${e+1}. ${r}
   Date: ${s}
   Source: claude-mem://session/${t.sdk_session_id}`}function pr(t){let e=t.title||`Observation #${t.id}`,r=[];r.push(`## ${e}`),r.push(`*Source: claude-mem://observation/${t.id}*`),r.push(""),t.subtitle&&(r.push(`**${t.subtitle}**`),r.push("")),t.narrative&&(r.push(t.narrative),r.push("")),t.text&&(r.push(t.text),r.push(""));let s=[];if(s.push(`Type: ${t.type}`),t.facts)try{let o=JSON.parse(t.facts);o.length>0&&s.push(`Facts: ${o.join("; ")}`)}catch{}if(t.concepts)try{let o=JSON.parse(t.concepts);o.length>0&&s.push(`Concepts: ${o.join(", ")}`)}catch{}if(t.files_read||t.files_modified){let o=[];if(t.files_read)try{o.push(...JSON.parse(t.files_read))}catch{}if(t.files_modified)try{o.push(...JSON.parse(t.files_modified))}catch{}o.length>0&&s.push(`Files: ${[...new Set(o)].join(", ")}`)}s.length>0&&(r.push("---"),r.push(s.join(" | ")));let n=new Date(t.created_at_epoch).toLocaleString();return r.push(""),r.push("---"),r.push(`Date: ${n}`),r.join(`
`)}function Qu(t){let e=t.request||`Session ${t.sdk_session_id?.substring(0,8)||"unknown"}`,r=[];r.push(`## ${e}`),r.push(`*Source: claude-mem://session/${t.sdk_session_id}*`),r.push(""),t.completed&&(r.push(`**Completed:** ${t.completed}`),r.push("")),t.learned&&(r.push(`**Learned:** ${t.learned}`),r.push("")),t.investigated&&(r.push(`**Investigated:** ${t.investigated}`),r.push("")),t.next_steps&&(r.push(`**Next Steps:** ${t.next_steps}`),r.push("")),t.notes&&(r.push(`**Notes:** ${t.notes}`),r.push(""));let s=[];if(t.files_read||t.files_edited){let o=[];if(t.files_read)try{o.push(...JSON.parse(t.files_read))}catch{}if(t.files_edited)try{o.push(...JSON.parse(t.files_edited))}catch{}o.length>0&&s.push(`Files: ${[...new Set(o)].join(", ")}`)}let n=new Date(t.created_at_epoch).toLocaleDateString();return s.push(`Date: ${n}`),s.length>0&&(r.push("---"),r.push(s.join(" | "))),r.join(`
`)}function Jg(t,e){let r=new Date(t.created_at_epoch).toLocaleString();return`${e+1}. "${t.prompt_text}"
   Date: ${r} | Prompt #${t.prompt_number}
   Source: claude-mem://user-prompt/${t.id}`}function Yg(t){let e=[];e.push(`## User Prompt #${t.prompt_number}`),e.push(`*Source: claude-mem://user-prompt/${t.id}*`),e.push(""),e.push(t.prompt_text),e.push(""),e.push("---");let r=new Date(t.created_at_epoch).toLocaleString();return e.push(`Date: ${r}`),e.join(`
`)}function jt(t){let e={...t};return e.concepts&&typeof e.concepts=="string"&&(e.concepts=e.concepts.split(",").map(r=>r.trim()).filter(Boolean)),e.files&&typeof e.files=="string"&&(e.files=e.files.split(",").map(r=>r.trim()).filter(Boolean)),e.obs_type&&typeof e.obs_type=="string"&&(e.obs_type=e.obs_type.split(",").map(r=>r.trim()).filter(Boolean)),e.type&&typeof e.type=="string"&&e.type.includes(",")&&(e.type=e.type.split(",").map(r=>r.trim()).filter(Boolean)),(e.dateStart||e.dateEnd)&&(e.dateRange={start:e.dateStart,end:e.dateEnd},delete e.dateStart,delete e.dateEnd),e}var Fk=h.object({project:h.string().optional().describe("Filter by project name"),type:h.union([h.enum(["decision","bugfix","feature","refactor","discovery","change"]),h.array(h.enum(["decision","bugfix","feature","refactor","discovery","change"]))]).optional().describe("Filter by observation type (single value or comma-separated list)"),concepts:h.union([h.string(),h.array(h.string())]).optional().describe("Filter by concept tags (single value or comma-separated list)"),files:h.union([h.string(),h.array(h.string())]).optional().describe("Filter by file paths (single value or comma-separated list for partial match)"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date (ISO string or epoch)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date (ISO string or epoch)"),dateRange:h.object({start:h.union([h.string(),h.number()]).optional().describe("Start date (ISO string or epoch)"),end:h.union([h.string(),h.number()]).optional().describe("End date (ISO string or epoch)")}).optional().describe("Filter by date range (use dateStart/dateEnd instead for simpler URLs)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),ey=[{name:"search",description:'Unified search across all memory types (observations, sessions, and user prompts) using vector-first semantic search (ChromaDB). Returns combined results from all document types. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({query:h.string().optional().describe("Natural language search query for semantic ranking via ChromaDB vector search. Optional - omit for date-filtered queries only (Chroma cannot filter by date, requires direct SQLite)."),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),type:h.enum(["observations","sessions","prompts"]).optional().describe("Filter by document type (observations, sessions, or prompts). Omit to search all types."),obs_type:h.string().optional().describe('Filter observations by type (single value or comma-separated list: decision,bugfix,feature,refactor,discovery,change). Only applies when type="observations"'),concepts:h.string().optional().describe('Filter by concept tags (single value or comma-separated list). Only applies when type="observations"'),files:h.string().optional().describe('Filter by file paths (single value or comma-separated list for partial match). Only applies when type="observations"'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{query:r,format:s="index",type:n,obs_type:o,concepts:i,files:a,...c}=e,u=[],l=[],d=[],p=!n||n==="observations",m=!n||n==="sessions",f=!n||n==="prompts";if(r)if(Re){let y=!1;try{console.error(`[search-server] Using ChromaDB semantic search (type filter: ${n||"all"})`);let x;n==="observations"?x={doc_type:"observation"}:n==="sessions"?x={doc_type:"session_summary"}:n==="prompts"&&(x={doc_type:"user_prompt"});let E=await tt(r,100,x);if(y=!0,console.error(`[search-server] ChromaDB returned ${E.ids.length} semantic matches`),E.ids.length>0){let T=Date.now()-7776e6,R=E.metadatas.map((Z,W)=>({id:E.ids[W],meta:Z,isRecent:Z&&Z.created_at_epoch>T})).filter(Z=>Z.isRecent);console.error(`[search-server] ${R.length} results within 90-day window`);let j=[],P=[],q=[];for(let Z of R){let W=Z.meta?.doc_type;W==="observation"&&p?j.push(Z.id):W==="session_summary"&&m?P.push(Z.id):W==="user_prompt"&&f&&q.push(Z.id)}if(console.error(`[search-server] Categorized: ${j.length} obs, ${P.length} sessions, ${q.length} prompts`),j.length>0){let Z={...c,type:o,concepts:i,files:a};u=ce.getObservationsByIds(j,Z)}P.length>0&&(l=ce.getSessionSummariesByIds(P,{orderBy:"date_desc",limit:c.limit})),q.length>0&&(d=ce.getUserPromptsByIds(q,{orderBy:"date_desc",limit:c.limit})),console.error(`[search-server] Hydrated ${u.length} obs, ${l.length} sessions, ${d.length} prompts from SQLite`)}else console.error("[search-server] ChromaDB found no matches (this is final - NOT falling back to FTS5)")}catch(x){console.error("[search-server] ChromaDB failed - returning empty results (FTS5 fallback removed):",x.message),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),u=[],l=[],d=[]}}else console.error("[search-server] ChromaDB not initialized - returning empty results (FTS5 fallback removed)"),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),u=[],l=[],d=[];else{console.error("[search-server] Filter-only query (no query text), using direct SQLite filtering (enables date filters)");let y={...c,type:o,concepts:i,files:a};p&&(u=$e.searchObservations(void 0,y)),m&&(l=$e.searchSessions(void 0,c)),f&&(d=$e.searchUserPrompts(void 0,c))}let g=u.length+l.length+d.length;if(g===0)return{content:[{type:"text",text:`No results found matching "${r}"`}]};let _=[...u.map(y=>({type:"observation",data:y,epoch:y.created_at_epoch})),...l.map(y=>({type:"session",data:y,epoch:y.created_at_epoch})),...d.map(y=>({type:"prompt",data:y,epoch:y.created_at_epoch}))];c.orderBy==="date_desc"?_.sort((y,x)=>x.epoch-y.epoch):c.orderBy==="date_asc"&&_.sort((y,x)=>y.epoch-x.epoch);let v=_.slice(0,c.limit||20),$;if(s==="index"){let y=`Found ${g} result(s) matching "${r}" (${u.length} obs, ${l.length} sessions, ${d.length} prompts):

`,x=v.map((E,T)=>E.type==="observation"?dr(E.data,T):E.type==="session"?Yu(E.data,T):Jg(E.data,T));$=y+x.join(`

`)+Br()}else $=v.map(x=>x.type==="observation"?pr(x.data):x.type==="session"?Qu(x.data):Yg(x.data)).join(`

---

`);return{content:[{type:"text",text:$}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"timeline",description:"Get a unified timeline of context around a specific point in time OR search query. Supports two modes: (1) anchor-based: provide observation ID, session ID, or timestamp to center timeline around; (2) query-based: provide natural language query to find relevant observation and center timeline around it. All record types (observations, sessions, prompts) are interleaved chronologically.",inputSchema:h.object({anchor:h.union([h.number(),h.string()]).optional().describe('Anchor point: observation ID (number), session ID (e.g., "S123"), or ISO timestamp. Use this OR query, not both.'),query:h.string().optional().describe("Natural language search query to find relevant observation as anchor. Use this OR anchor, not both."),depth_before:h.number().min(0).max(50).default(10).describe("Number of records to retrieve before anchor (default: 10)"),depth_after:h.number().min(0).max(50).default(10).describe("Number of records to retrieve after anchor (default: 10)"),project:h.string().optional().describe("Filter by project name")}),handler:async t=>{try{let g=function(T){return new Date(T).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},_=function(T){return new Date(T).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},v=function(T){return new Date(T).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},$=function(T){return T?Math.ceil(T.length/4):0};var e=g,r=_,s=v,n=$;let{anchor:o,query:i,depth_before:a=10,depth_after:c=10,project:u}=t;if(!o&&!i)return{content:[{type:"text",text:'Error: Must provide either "anchor" or "query" parameter'}],isError:!0};if(o&&i)return{content:[{type:"text",text:'Error: Cannot provide both "anchor" and "query" parameters. Use one or the other.'}],isError:!0};let l,d,p;if(i){let T=[];if(Re)try{console.error("[search-server] Using hybrid semantic search for timeline query");let j=await tt(i,100);if(console.error(`[search-server] Chroma returned ${j.ids.length} semantic matches`),j.ids.length>0){let P=Date.now()-7776e6,q=j.ids.filter((Z,W)=>{let le=j.metadatas[W];return le&&le.created_at_epoch>P});q.length>0&&(T=ce.getObservationsByIds(q,{orderBy:"date_desc",limit:1}))}}catch(j){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",j.message)}if(T.length===0)return{content:[{type:"text",text:`No observations found matching "${i}". Try a different search query.`}]};let R=T[0];l=R.id,d=R.created_at_epoch,console.error(`[search-server] Query mode: Using observation #${R.id} as timeline anchor`),p=ce.getTimelineAroundObservation(R.id,R.created_at_epoch,a,c,u)}else if(typeof o=="number"){let T=ce.getObservationById(o);if(!T)return{content:[{type:"text",text:`Observation #${o} not found`}],isError:!0};l=o,d=T.created_at_epoch,p=ce.getTimelineAroundObservation(o,d,a,c,u)}else if(typeof o=="string")if(o.startsWith("S")||o.startsWith("#S")){let T=o.replace(/^#?S/,""),R=parseInt(T,10),j=ce.getSessionSummariesByIds([R]);if(j.length===0)return{content:[{type:"text",text:`Session #${R} not found`}],isError:!0};d=j[0].created_at_epoch,l=`S${R}`,p=ce.getTimelineAroundTimestamp(d,a,c,u)}else{let T=new Date(o);if(isNaN(T.getTime()))return{content:[{type:"text",text:`Invalid timestamp: ${o}`}],isError:!0};d=T.getTime(),l=o,p=ce.getTimelineAroundTimestamp(d,a,c,u)}else return{content:[{type:"text",text:'Invalid anchor: must be observation ID (number), session ID (e.g., "S123"), or ISO timestamp'}],isError:!0};let m=[...p.observations.map(T=>({type:"observation",data:T,epoch:T.created_at_epoch})),...p.sessions.map(T=>({type:"session",data:T,epoch:T.created_at_epoch})),...p.prompts.map(T=>({type:"prompt",data:T,epoch:T.created_at_epoch}))];m.sort((T,R)=>T.epoch-R.epoch);let f=Ju(m,l,d,a,c);if(f.length===0)return{content:[{type:"text",text:i?`Found observation matching "${i}", but no timeline context available (${a} records before, ${c} records after).`:`No context found around anchor (${a} records before, ${c} records after)`}]};let y=[];if(i){let T=f.find(j=>j.type==="observation"&&j.data.id===l),R=T?T.data.title||"Untitled":"Unknown";y.push(`# Timeline for query: "${i}"`),y.push(`**Anchor:** Observation #${l} - ${R}`)}else y.push(`# Timeline around anchor: ${l}`);y.push(`**Window:** ${a} records before \u2192 ${c} records after | **Items:** ${f.length}`),y.push(""),y.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),y.push("");let x=new Map;for(let T of f){let R=g(T.epoch);x.has(R)||x.set(R,[]),x.get(R).push(T)}let E=Array.from(x.entries()).sort((T,R)=>{let j=new Date(T[0]).getTime(),P=new Date(R[0]).getTime();return j-P});for(let[T,R]of E){y.push(`### ${T}`),y.push("");let j=null,P="",q=!1;for(let Z of R){let W=typeof l=="number"&&Z.type==="observation"&&Z.data.id===l||typeof l=="string"&&l.startsWith("S")&&Z.type==="session"&&`S${Z.data.id}`===l;if(Z.type==="session"){q&&(y.push(""),q=!1,j=null,P="");let le=Z.data,oe=le.request||"Session summary",xe=`claude-mem://session-summary/${le.id}`,ze=W?" \u2190 **ANCHOR**":"";y.push(`**\u{1F3AF} #S${le.id}** ${oe} (${v(Z.epoch)}) [\u2192](${xe})${ze}`),y.push("")}else if(Z.type==="prompt"){q&&(y.push(""),q=!1,j=null,P="");let le=Z.data,oe=le.prompt.length>100?le.prompt.substring(0,100)+"...":le.prompt;y.push(`**\u{1F4AC} User Prompt #${le.prompt_number}** (${v(Z.epoch)})`),y.push(`> ${oe}`),y.push("")}else if(Z.type==="observation"){let le=Z.data,oe="General";oe!==j&&(q&&y.push(""),y.push(`**${oe}**`),y.push("| ID | Time | T | Title | Tokens |"),y.push("|----|------|---|-------|--------|"),j=oe,q=!0,P="");let xe="\u2022";switch(le.type){case"bugfix":xe="\u{1F534}";break;case"feature":xe="\u{1F7E3}";break;case"refactor":xe="\u{1F504}";break;case"change":xe="\u2705";break;case"discovery":xe="\u{1F535}";break;case"decision":xe="\u{1F9E0}";break}let ze=_(Z.epoch),mr=le.title||"Untitled",Nn=$(le.narrative),Cn=ze!==P?ze:"\u2033";P=ze;let yi=W?" \u2190 **ANCHOR**":"";y.push(`| #${le.id} | ${Cn} | ${xe} | ${mr}${yi} | ~${Nn} |`)}}q&&y.push("")}return{content:[{type:"text",text:y.join(`
`)}]}}catch(o){return{content:[{type:"text",text:`Timeline query failed: ${o.message}`}],isError:!0}}}},{name:"decisions",description:"Semantic shortcut to find decision-type observations. Returns observations where important architectural, technical, or process decisions were made. Supports optional semantic search query to filter decisions by relevance.",inputSchema:h.object({query:h.string().optional().describe("Search query to filter decisions semantically"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{query:r,format:s="index",...n}=e,o=[];if(Re)try{if(r){console.error("[search-server] Using Chroma semantic search with type=decision filter");let c=(await tt(r,Math.min((n.limit||20)*2,100),{type:"decision"})).ids;c.length>0&&(o=ce.getObservationsByIds(c,{...n,type:"decision"}),o.sort((u,l)=>c.indexOf(u.id)-c.indexOf(l.id)))}else{console.error("[search-server] Using metadata-first + semantic ranking for decisions");let a=$e.findByType("decision",n);if(a.length>0){let c=a.map(d=>d.id),u=await tt("decision",Math.min(c.length,100)),l=[];for(let d of u.ids)c.includes(d)&&!l.includes(d)&&l.push(d);l.length>0&&(o=ce.getObservationsByIds(l,{limit:n.limit||20}),o.sort((d,p)=>l.indexOf(d.id)-l.indexOf(p.id)))}}}catch(a){console.error("[search-server] Chroma search failed, using SQLite fallback:",a.message)}if(o.length===0&&(o=$e.findByType("decision",n)),o.length===0)return{content:[{type:"text",text:"No decision observations found"}]};let i;if(s==="index"){let a=`Found ${o.length} decision(s):

`,c=o.map((u,l)=>dr(u,l));i=a+c.join(`

`)}else i=o.map(c=>pr(c)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"changes",description:'Semantic shortcut to find change-related observations. Returns observations documenting what changed in the codebase, system behavior, or project state. Searches for type="change" OR concept="change" OR concept="what-changed".',inputSchema:h.object({format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{format:r="index",...s}=e,n=[];if(Re)try{console.error("[search-server] Using hybrid search for change-related observations");let i=$e.findByType("change",s),a=$e.findByConcept("change",s),c=$e.findByConcept("what-changed",s),u=new Set;if([...i,...a,...c].forEach(l=>u.add(l.id)),u.size>0){let l=Array.from(u),d=await tt("what changed",Math.min(l.length,100)),p=[];for(let m of d.ids)l.includes(m)&&!p.includes(m)&&p.push(m);p.length>0&&(n=ce.getObservationsByIds(p,{limit:s.limit||20}),n.sort((m,f)=>p.indexOf(m.id)-p.indexOf(f.id)))}}catch(i){console.error("[search-server] Chroma ranking failed, using SQLite order:",i.message)}if(n.length===0){let i=$e.findByType("change",s),a=$e.findByConcept("change",s),c=$e.findByConcept("what-changed",s),u=new Set;[...i,...a,...c].forEach(l=>u.add(l.id)),n=Array.from(u).map(l=>i.find(d=>d.id===l)||a.find(d=>d.id===l)||c.find(d=>d.id===l)).filter(Boolean),n.sort((l,d)=>d.created_at_epoch-l.created_at_epoch),n=n.slice(0,s.limit||20)}if(n.length===0)return{content:[{type:"text",text:"No change-related observations found"}]};let o;if(r==="index"){let i=`Found ${n.length} change-related observation(s):

`,a=n.map((c,u)=>dr(c,u));o=i+a.join(`

`)}else o=n.map(a=>pr(a)).join(`

---

`);return{content:[{type:"text",text:o}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"how_it_works",description:'Semantic shortcut to find "how it works" explanations. Returns observations documenting system architecture, component interactions, data flow, and technical mechanisms. Searches for concept="how-it-works".',inputSchema:h.object({format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default), "full" for complete details'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{format:r="index",...s}=e,n=[];if(Re)try{console.error("[search-server] Using metadata-first + semantic ranking for how-it-works");let i=$e.findByConcept("how-it-works",s);if(i.length>0){let a=i.map(l=>l.id),c=await tt("how it works architecture",Math.min(a.length,100)),u=[];for(let l of c.ids)a.includes(l)&&!u.includes(l)&&u.push(l);u.length>0&&(n=ce.getObservationsByIds(u,{limit:s.limit||20}),n.sort((l,d)=>u.indexOf(l.id)-u.indexOf(d.id)))}}catch(i){console.error("[search-server] Chroma ranking failed, using SQLite order:",i.message)}if(n.length===0&&(n=$e.findByConcept("how-it-works",s)),n.length===0)return{content:[{type:"text",text:'No "how it works" observations found'}]};let o;if(r==="index"){let i=`Found ${n.length} "how it works" observation(s):

`,a=n.map((c,u)=>dr(c,u));o=i+a.join(`

`)}else o=n.map(a=>pr(a)).join(`

---

`);return{content:[{type:"text",text:o}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"search_observations",description:'DEPRECATED: Use the unified "search" tool instead. Search observations using vector-first semantic search (ChromaDB). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({query:h.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),...Fk.shape}),handler:async t=>{try{let e=jt(t),{query:r,format:s="index",...n}=e,o=[];if(Re)try{console.error("[search-server] Using hybrid semantic search (Chroma + SQLite)");let a=await tt(r,100);if(console.error(`[search-server] Chroma returned ${a.ids.length} semantic matches`),a.ids.length>0){let c=Date.now()-7776e6,u=a.ids.filter((l,d)=>{let p=a.metadatas[d];return p&&p.created_at_epoch>c});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let l=n.limit||20;o=ce.getObservationsByIds(u,{orderBy:"date_desc",limit:l}),console.error(`[search-server] Hydrated ${o.length} observations from SQLite`)}}}catch(a){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",a.message)}if(o.length===0)return{content:[{type:"text",text:`No observations found matching "${r}"`}]};let i;if(s==="index"){let a=`Found ${o.length} observation(s) matching "${r}":

`,c=o.map((u,l)=>dr(u,l));i=a+c.join(`

`)+Br()}else i=o.map(c=>pr(c)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"search_sessions",description:'DEPRECATED: Use the unified "search" tool instead. Search session summaries using vector-first semantic search (ChromaDB). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({query:h.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{query:r,format:s="index",...n}=e,o=[];if(Re)try{console.error("[search-server] Using hybrid semantic search for sessions");let a=await tt(r,100,{doc_type:"session_summary"});if(console.error(`[search-server] Chroma returned ${a.ids.length} semantic matches`),a.ids.length>0){let c=Date.now()-7776e6,u=a.ids.filter((l,d)=>{let p=a.metadatas[d];return p&&p.created_at_epoch>c});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let l=n.limit||20;o=ce.getSessionSummariesByIds(u,{orderBy:"date_desc",limit:l}),console.error(`[search-server] Hydrated ${o.length} sessions from SQLite`)}}}catch(a){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",a.message)}if(o.length===0)return{content:[{type:"text",text:`No sessions found matching "${r}"`}]};let i;if(s==="index"){let a=`Found ${o.length} session(s) matching "${r}":

`,c=o.map((u,l)=>Yu(u,l));i=a+c.join(`

`)+Br()}else i=o.map(c=>Qu(c)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_concept",description:'Find observations tagged with a specific concept. Available concepts: "discovery", "problem-solution", "what-changed", "how-it-works", "pattern", "gotcha", "change". IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({concept:h.string().describe("Concept tag to search for. Available: discovery, problem-solution, what-changed, how-it-works, pattern, gotcha, change"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{concept:r,format:s="index",...n}=e,o=[];if(Re)try{console.error("[search-server] Using metadata-first + semantic ranking for concept search");let a=$e.findByConcept(r,n);if(console.error(`[search-server] Found ${a.length} observations with concept "${r}"`),a.length>0){let c=a.map(d=>d.id),u=await tt(r,Math.min(c.length,100)),l=[];for(let d of u.ids)c.includes(d)&&!l.includes(d)&&l.push(d);console.error(`[search-server] Chroma ranked ${l.length} results by semantic relevance`),l.length>0&&(o=ce.getObservationsByIds(l,{limit:n.limit||20}),o.sort((d,p)=>l.indexOf(d.id)-l.indexOf(p.id)))}}catch(a){console.error("[search-server] Chroma ranking failed, using SQLite order:",a.message)}if(o.length===0&&(console.error("[search-server] Using SQLite-only concept search"),o=$e.findByConcept(r,n)),o.length===0)return{content:[{type:"text",text:`No observations found with concept "${r}"`}]};let i;if(s==="index"){let a=`Found ${o.length} observation(s) with concept "${r}":

`,c=o.map((u,l)=>dr(u,l));i=a+c.join(`

`)+Br()}else i=o.map(c=>pr(c)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_file",description:'Find observations and sessions that reference a specific file path. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({filePath:h.string().describe("File path to search for (supports partial matching)"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{filePath:r,format:s="index",...n}=e,o=[],i=[];if(Re)try{console.error("[search-server] Using metadata-first + semantic ranking for file search");let u=$e.findByFile(r,n);if(console.error(`[search-server] Found ${u.observations.length} observations, ${u.sessions.length} sessions for file "${r}"`),i=u.sessions,u.observations.length>0){let l=u.observations.map(m=>m.id),d=await tt(r,Math.min(l.length,100)),p=[];for(let m of d.ids)l.includes(m)&&!p.includes(m)&&p.push(m);console.error(`[search-server] Chroma ranked ${p.length} observations by semantic relevance`),p.length>0&&(o=ce.getObservationsByIds(p,{limit:n.limit||20}),o.sort((m,f)=>p.indexOf(m.id)-p.indexOf(f.id)))}}catch(u){console.error("[search-server] Chroma ranking failed, using SQLite order:",u.message)}if(o.length===0&&i.length===0){console.error("[search-server] Using SQLite-only file search");let u=$e.findByFile(r,n);o=u.observations,i=u.sessions}let a=o.length+i.length;if(a===0)return{content:[{type:"text",text:`No results found for file "${r}"`}]};let c;if(s==="index"){let u=`Found ${a} result(s) for file "${r}":

`,l=[];o.forEach((d,p)=>{l.push(dr(d,p))}),i.forEach((d,p)=>{l.push(Yu(d,p+o.length))}),c=u+l.join(`

`)+Br()}else{let u=[];o.forEach(l=>{u.push(pr(l))}),i.forEach(l=>{u.push(Qu(l))}),c=u.join(`

---

`)}return{content:[{type:"text",text:c}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"find_by_type",description:'Find observations of a specific type (decision, bugfix, feature, refactor, discovery, change). IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({type:h.string().describe("Observation type(s) to filter by (single value or comma-separated list: decision,bugfix,feature,refactor,discovery,change)"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for titles/dates only (default, RECOMMENDED for initial search), "full" for complete details (use only after reviewing index results)'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum results. IMPORTANT: Start with 3-5 to avoid exceeding MCP token limits, even in index mode."),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{type:r,format:s="index",...n}=e,o=Array.isArray(r)?r.join(", "):r,i=[];if(Re)try{console.error("[search-server] Using metadata-first + semantic ranking for type search");let c=$e.findByType(r,n);if(console.error(`[search-server] Found ${c.length} observations with type "${o}"`),c.length>0){let u=c.map(p=>p.id),l=await tt(o,Math.min(u.length,100)),d=[];for(let p of l.ids)u.includes(p)&&!d.includes(p)&&d.push(p);console.error(`[search-server] Chroma ranked ${d.length} results by semantic relevance`),d.length>0&&(i=ce.getObservationsByIds(d,{limit:n.limit||20}),i.sort((p,m)=>d.indexOf(p.id)-d.indexOf(m.id)))}}catch(c){console.error("[search-server] Chroma ranking failed, using SQLite order:",c.message)}if(i.length===0&&(console.error("[search-server] Using SQLite-only type search"),i=$e.findByType(r,n)),i.length===0)return{content:[{type:"text",text:`No observations found with type "${o}"`}]};let a;if(s==="index"){let c=`Found ${i.length} observation(s) with type "${o}":

`,u=i.map((l,d)=>dr(l,d));a=c+u.join(`

`)+Br()}else a=i.map(u=>pr(u)).join(`

---

`);return{content:[{type:"text",text:a}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"get_recent_context",description:"Get recent session context including summaries and observations for a project",inputSchema:h.object({project:h.string().optional().describe("Project name (defaults to current working directory basename)"),limit:h.number().min(1).max(10).default(3).describe("Number of recent sessions to retrieve")}),handler:async t=>{try{let e=t.project||(0,Qg.basename)(process.cwd()),r=t.limit||3,s=ce.getRecentSessionsWithStatus(e,r);if(s.length===0)return{content:[{type:"text",text:`# Recent Session Context

No previous sessions found for project "${e}".`}]};let n=[];n.push("# Recent Session Context"),n.push(""),n.push(`Showing last ${s.length} session(s) for **${e}**:`),n.push("");for(let o of s)if(o.sdk_session_id){if(n.push("---"),n.push(""),o.has_summary){let i=ce.getSummaryForSession(o.sdk_session_id);if(i){let a=i.prompt_number?` (Prompt #${i.prompt_number})`:"";if(n.push(`**Summary${a}**`),n.push(""),i.request&&n.push(`**Request:** ${i.request}`),i.completed&&n.push(`**Completed:** ${i.completed}`),i.learned&&n.push(`**Learned:** ${i.learned}`),i.next_steps&&n.push(`**Next Steps:** ${i.next_steps}`),i.files_read)try{let u=JSON.parse(i.files_read);Array.isArray(u)&&u.length>0&&n.push(`**Files Read:** ${u.join(", ")}`)}catch{i.files_read.trim()&&n.push(`**Files Read:** ${i.files_read}`)}if(i.files_edited)try{let u=JSON.parse(i.files_edited);Array.isArray(u)&&u.length>0&&n.push(`**Files Edited:** ${u.join(", ")}`)}catch{i.files_edited.trim()&&n.push(`**Files Edited:** ${i.files_edited}`)}let c=new Date(i.created_at).toLocaleString();n.push(`**Date:** ${c}`)}}else if(o.status==="active"){n.push("**In Progress**"),n.push(""),o.user_prompt&&n.push(`**Request:** ${o.user_prompt}`);let i=ce.getObservationsForSession(o.sdk_session_id);if(i.length>0){n.push(""),n.push(`**Observations (${i.length}):**`);for(let c of i)n.push(`- ${c.title}`)}else n.push(""),n.push("*No observations yet*");n.push(""),n.push("**Status:** Active - summary pending");let a=new Date(o.started_at).toLocaleString();n.push(`**Date:** ${a}`)}else{n.push(`**${o.status.charAt(0).toUpperCase()+o.status.slice(1)}**`),n.push(""),o.user_prompt&&n.push(`**Request:** ${o.user_prompt}`),n.push(""),n.push(`**Status:** ${o.status} - no summary available`);let i=new Date(o.started_at).toLocaleString();n.push(`**Date:** ${i}`)}n.push("")}return{content:[{type:"text",text:n.join(`
`)}]}}catch(e){return{content:[{type:"text",text:`Failed to get recent context: ${e.message}`}],isError:!0}}}},{name:"search_user_prompts",description:'DEPRECATED: Use the unified "search" tool instead. Search raw user prompts using vector-first semantic search (ChromaDB). Use this to find what the user actually said/requested across all sessions. IMPORTANT: Always use index format first (default) to get an overview with minimal token usage, then use format: "full" only for specific items of interest.',inputSchema:h.object({query:h.string().describe("Natural language search query for semantic ranking via ChromaDB vector search"),format:h.enum(["index","full"]).default("index").describe('Output format: "index" for truncated prompts/dates (default, RECOMMENDED for initial search), "full" for complete prompt text (use only after reviewing index results)'),project:h.string().optional().describe("Filter by project name"),dateStart:h.union([h.string(),h.number()]).optional().describe("Start date for filtering (ISO string or epoch timestamp)"),dateEnd:h.union([h.string(),h.number()]).optional().describe("End date for filtering (ISO string or epoch timestamp)"),limit:h.number().min(1).max(100).default(20).describe("Maximum number of results"),offset:h.number().min(0).default(0).describe("Number of results to skip"),orderBy:h.enum(["relevance","date_desc","date_asc"]).default("date_desc").describe("Sort order")}),handler:async t=>{try{let e=jt(t),{query:r,format:s="index",...n}=e,o=[];if(Re)try{console.error("[search-server] Using hybrid semantic search for user prompts");let a=await tt(r,100,{doc_type:"user_prompt"});if(console.error(`[search-server] Chroma returned ${a.ids.length} semantic matches`),a.ids.length>0){let c=Date.now()-7776e6,u=a.ids.filter((l,d)=>{let p=a.metadatas[d];return p&&p.created_at_epoch>c});if(console.error(`[search-server] ${u.length} results within 90-day window`),u.length>0){let l=n.limit||20;o=ce.getUserPromptsByIds(u,{orderBy:"date_desc",limit:l}),console.error(`[search-server] Hydrated ${o.length} user prompts from SQLite`)}}}catch(a){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",a.message)}if(o.length===0)return{content:[{type:"text",text:`No user prompts found matching "${r}"`}]};let i;if(s==="index"){let a=`Found ${o.length} user prompt(s) matching "${r}":

`,c=o.map((u,l)=>Jg(u,l));i=a+c.join(`

`)+Br()}else i=o.map(c=>Yg(c)).join(`

---

`);return{content:[{type:"text",text:i}]}}catch(e){return{content:[{type:"text",text:`Search failed: ${e.message}`}],isError:!0}}}},{name:"get_context_timeline",description:'Get a unified timeline of context (observations, sessions, and prompts) around a specific point in time. All record types are interleaved chronologically. Useful for understanding "what was happening when X occurred". Returns depth_before records before anchor + anchor + depth_after records after (total: depth_before + 1 + depth_after mixed records).',inputSchema:h.object({anchor:h.union([h.number().describe("Observation ID to center timeline around"),h.string().describe("Session ID (format: S123) or ISO timestamp to center timeline around")]).describe('Anchor point: observation ID, session ID (e.g., "S123"), or ISO timestamp'),depth_before:h.number().min(0).max(50).default(10).describe("Number of records to retrieve before anchor, not including anchor (default: 10)"),depth_after:h.number().min(0).max(50).default(10).describe("Number of records to retrieve after anchor, not including anchor (default: 10)"),project:h.string().optional().describe("Filter by project name")}),handler:async t=>{try{let f=function(E){return new Date(E).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},g=function(E){return new Date(E).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},_=function(E){return new Date(E).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},v=function(E){return E?Math.ceil(E.length/4):0};var e=f,r=g,s=_,n=v;let{anchor:o,depth_before:i=10,depth_after:a=10,project:c}=t,u,l=o,d;if(typeof o=="number"){let E=ce.getObservationById(o);if(!E)return{content:[{type:"text",text:`Observation #${o} not found`}],isError:!0};u=E.created_at_epoch,d=ce.getTimelineAroundObservation(o,u,i,a,c)}else if(typeof o=="string")if(o.startsWith("S")||o.startsWith("#S")){let E=o.replace(/^#?S/,""),T=parseInt(E,10),R=ce.getSessionSummariesByIds([T]);if(R.length===0)return{content:[{type:"text",text:`Session #${T} not found`}],isError:!0};u=R[0].created_at_epoch,l=`S${T}`,d=ce.getTimelineAroundTimestamp(u,i,a,c)}else{let E=new Date(o);if(isNaN(E.getTime()))return{content:[{type:"text",text:`Invalid timestamp: ${o}`}],isError:!0};u=E.getTime(),d=ce.getTimelineAroundTimestamp(u,i,a,c)}else return{content:[{type:"text",text:'Invalid anchor: must be observation ID (number), session ID (e.g., "S123"), or ISO timestamp'}],isError:!0};let p=[...d.observations.map(E=>({type:"observation",data:E,epoch:E.created_at_epoch})),...d.sessions.map(E=>({type:"session",data:E,epoch:E.created_at_epoch})),...d.prompts.map(E=>({type:"prompt",data:E,epoch:E.created_at_epoch}))];p.sort((E,T)=>E.epoch-T.epoch);let m=Ju(p,l,u,i,a);if(m.length===0)return{content:[{type:"text",text:`No context found around ${new Date(u).toLocaleString()} (${i} records before, ${a} records after)`}]};let $=[];$.push(`# Timeline around anchor: ${l}`),$.push(`**Window:** ${i} records before \u2192 ${a} records after | **Items:** ${m.length}`),$.push(""),$.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),$.push("");let y=new Map;for(let E of m){let T=f(E.epoch);y.has(T)||y.set(T,[]),y.get(T).push(E)}let x=Array.from(y.entries()).sort((E,T)=>{let R=new Date(E[0]).getTime(),j=new Date(T[0]).getTime();return R-j});for(let[E,T]of x){$.push(`### ${E}`),$.push("");let R=null,j="",P=!1;for(let q of T){let Z=typeof l=="number"&&q.type==="observation"&&q.data.id===l||typeof l=="string"&&l.startsWith("S")&&q.type==="session"&&`S${q.data.id}`===l;if(q.type==="session"){P&&($.push(""),P=!1,R=null,j="");let W=q.data,le=W.request||"Session summary",oe=`claude-mem://session-summary/${W.id}`,xe=Z?" \u2190 **ANCHOR**":"";$.push(`**\u{1F3AF} #S${W.id}** ${le} (${_(q.epoch)}) [\u2192](${oe})${xe}`),$.push("")}else if(q.type==="prompt"){P&&($.push(""),P=!1,R=null,j="");let W=q.data,le=W.prompt.length>100?W.prompt.substring(0,100)+"...":W.prompt;$.push(`**\u{1F4AC} User Prompt #${W.prompt_number}** (${_(q.epoch)})`),$.push(`> ${le}`),$.push("")}else if(q.type==="observation"){let W=q.data,le="General";le!==R&&(P&&$.push(""),$.push(`**${le}**`),$.push("| ID | Time | T | Title | Tokens |"),$.push("|----|------|---|-------|--------|"),R=le,P=!0,j="");let oe="\u2022";switch(W.type){case"bugfix":oe="\u{1F534}";break;case"feature":oe="\u{1F7E3}";break;case"refactor":oe="\u{1F504}";break;case"change":oe="\u2705";break;case"discovery":oe="\u{1F535}";break;case"decision":oe="\u{1F9E0}";break}let xe=g(q.epoch),ze=W.title||"Untitled",mr=v(W.narrative),Pn=xe!==j?xe:"\u2033";j=xe;let Cn=Z?" \u2190 **ANCHOR**":"";$.push(`| #${W.id} | ${Pn} | ${oe} | ${ze}${Cn} | ~${mr} |`)}}P&&$.push("")}return{content:[{type:"text",text:$.join(`
`)}]}}catch(o){return{content:[{type:"text",text:`Timeline query failed: ${o.message}`}],isError:!0}}}},{name:"get_timeline_by_query",description:'Search for observations using natural language and get timeline context around the best match. Two modes: "auto" (default) automatically uses top result as timeline anchor; "interactive" returns top matches for you to choose from. This combines search + timeline into a single operation for faster context discovery.',inputSchema:h.object({query:h.string().describe("Natural language search query to find relevant observations"),mode:h.enum(["auto","interactive"]).default("auto").describe("auto: Automatically use top search result as timeline anchor. interactive: Show top N search results for manual anchor selection."),depth_before:h.number().min(0).max(50).default(10).describe("Number of timeline records before anchor (default: 10)"),depth_after:h.number().min(0).max(50).default(10).describe("Number of timeline records after anchor (default: 10)"),limit:h.number().min(1).max(20).default(5).describe("For interactive mode: number of top search results to display (default: 5)"),project:h.string().optional().describe("Filter by project name")}),handler:async t=>{try{let{query:o,mode:i="auto",depth_before:a=10,depth_after:c=10,limit:u=5,project:l}=t,d=[];if(Re)try{console.error("[search-server] Using hybrid semantic search for timeline query");let p=await tt(o,100);if(console.error(`[search-server] Chroma returned ${p.ids.length} semantic matches`),p.ids.length>0){let m=Date.now()-7776e6,f=p.ids.filter((g,_)=>{let v=p.metadatas[_];return v&&v.created_at_epoch>m});console.error(`[search-server] ${f.length} results within 90-day window`),f.length>0&&(d=ce.getObservationsByIds(f,{orderBy:"date_desc",limit:i==="auto"?1:u}),console.error(`[search-server] Hydrated ${d.length} observations from SQLite`))}}catch(p){console.error("[search-server] Chroma query failed - no results (FTS5 fallback removed):",p.message)}if(d.length===0)return{content:[{type:"text",text:`No observations found matching "${o}". Try a different search query.`}]};if(i==="interactive"){let p=[];p.push("# Timeline Anchor Search Results"),p.push(""),p.push(`Found ${d.length} observation(s) matching "${o}"`),p.push(""),p.push("To get timeline context around any of these observations, use the `get_context_timeline` tool with the observation ID as the anchor."),p.push(""),p.push(`**Top ${d.length} matches:**`),p.push("");for(let m=0;m<d.length;m++){let f=d[m],g=f.title||`Observation #${f.id}`,_=new Date(f.created_at_epoch).toLocaleString(),v=f.type?`[${f.type}]`:"";p.push(`${m+1}. **${v} ${g}**`),p.push(`   - ID: ${f.id}`),p.push(`   - Date: ${_}`),f.subtitle&&p.push(`   - ${f.subtitle}`),p.push(`   - Source: claude-mem://observation/${f.id}`),p.push("")}return{content:[{type:"text",text:p.join(`
`)}]}}else{let _=function(R){return new Date(R).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})},v=function(R){return new Date(R).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},$=function(R){return new Date(R).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},y=function(R){return R?Math.ceil(R.length/4):0};var e=_,r=v,s=$,n=y;let p=d[0];console.error(`[search-server] Auto mode: Using observation #${p.id} as timeline anchor`);let m=ce.getTimelineAroundObservation(p.id,p.created_at_epoch,a,c,l),f=[...m.observations.map(R=>({type:"observation",data:R,epoch:R.created_at_epoch})),...m.sessions.map(R=>({type:"session",data:R,epoch:R.created_at_epoch})),...m.prompts.map(R=>({type:"prompt",data:R,epoch:R.created_at_epoch}))];f.sort((R,j)=>R.epoch-j.epoch);let g=Ju(f,p.id,0,a,c);if(g.length===0)return{content:[{type:"text",text:`Found observation #${p.id} matching "${o}", but no timeline context available (${a} records before, ${c} records after).`}]};let x=[];x.push(`# Timeline for query: "${o}"`),x.push(`**Anchor:** Observation #${p.id} - ${p.title||"Untitled"}`),x.push(`**Window:** ${a} records before \u2192 ${c} records after | **Items:** ${g.length}`),x.push(""),x.push("**Legend:** \u{1F3AF} session-request | \u{1F534} bugfix | \u{1F7E3} feature | \u{1F504} refactor | \u2705 change | \u{1F535} discovery | \u{1F9E0} decision"),x.push("");let E=new Map;for(let R of g){let j=_(R.epoch);E.has(j)||E.set(j,[]),E.get(j).push(R)}let T=Array.from(E.entries()).sort((R,j)=>{let P=new Date(R[0]).getTime(),q=new Date(j[0]).getTime();return P-q});for(let[R,j]of T){x.push(`### ${R}`),x.push("");let P=null,q="",Z=!1;for(let W of j){let le=W.type==="observation"&&W.data.id===p.id;if(W.type==="session"){Z&&(x.push(""),Z=!1,P=null,q="");let oe=W.data,xe=oe.request||"Session summary",ze=`claude-mem://session-summary/${oe.id}`;x.push(`**\u{1F3AF} #S${oe.id}** ${xe} (${$(W.epoch)}) [\u2192](${ze})`),x.push("")}else if(W.type==="prompt"){Z&&(x.push(""),Z=!1,P=null,q="");let oe=W.data,xe=oe.prompt.length>100?oe.prompt.substring(0,100)+"...":oe.prompt;x.push(`**\u{1F4AC} User Prompt #${oe.prompt_number}** (${$(W.epoch)})`),x.push(`> ${xe}`),x.push("")}else if(W.type==="observation"){let oe=W.data,xe="General";xe!==P&&(Z&&x.push(""),x.push(`**${xe}**`),x.push("| ID | Time | T | Title | Tokens |"),x.push("|----|------|---|-------|--------|"),P=xe,Z=!0,q="");let ze="\u2022";switch(oe.type){case"bugfix":ze="\u{1F534}";break;case"feature":ze="\u{1F7E3}";break;case"refactor":ze="\u{1F504}";break;case"change":ze="\u2705";break;case"discovery":ze="\u{1F535}";break;case"decision":ze="\u{1F9E0}";break}let mr=v(W.epoch),Nn=oe.title||"Untitled",Pn=y(oe.narrative),yi=mr!==q?mr:"\u2033";q=mr;let ry=le?" \u2190 **ANCHOR**":"";x.push(`| #${oe.id} | ${yi} | ${ze} | ${Nn}${ry} | ~${Pn} |`)}}Z&&x.push("")}return{content:[{type:"text",text:x.join(`
`)}]}}}catch(o){return{content:[{type:"text",text:`Timeline query failed: ${o.message}`}],isError:!0}}}}],el=new ii({name:"claude-mem-search",version:"1.0.0"},{capabilities:{tools:{}}});el.setRequestHandler(Ia,async()=>({tools:ey.map(t=>({name:t.name,description:t.description,inputSchema:vo(t.inputSchema)}))}));el.setRequestHandler(Js,async t=>{let e=ey.find(r=>r.name===t.params.name);if(!e)throw new Error(`Unknown tool: ${t.params.name}`);try{return await e.handler(t.params.arguments||At("search-server.handleToolCall: request.params.arguments is missing",{toolName:t.params.name},{}))}catch(r){return{content:[{type:"text",text:`Tool execution failed: ${r.message}`}],isError:!0}}});async function ty(){if(console.error("[search-server] Shutting down..."),Re)try{await Re.close(),console.error("[search-server] Chroma client closed")}catch(t){console.error("[search-server] Error closing Chroma client:",t.message)}if($e)try{$e.close(),console.error("[search-server] SessionSearch closed")}catch(t){console.error("[search-server] Error closing SessionSearch:",t.message)}if(ce)try{ce.close(),console.error("[search-server] SessionStore closed")}catch(t){console.error("[search-server] Error closing SessionStore:",t.message)}console.error("[search-server] Shutdown complete"),process.exit(0)}process.on("SIGTERM",ty);process.on("SIGINT",ty);async function Vk(){let t=new ci;await el.connect(t),console.error("[search-server] Claude-mem search server started"),setTimeout(async()=>{try{console.error("[search-server] Initializing Chroma client...");let e=new mi({command:"uvx",args:["chroma-mcp","--client-type","persistent","--data-dir",Vg],stderr:"ignore"}),r=new di({name:"claude-mem-search-chroma-client",version:"1.0.0"},{capabilities:{}});await r.connect(e),Re=r,console.error("[search-server] Chroma client connected successfully")}catch(e){console.error("[search-server] Failed to initialize Chroma client:",e.message),console.error("[search-server] Vector search unavailable - text queries will return empty results (FTS5 fallback removed)"),console.error("[search-server] Install UVX/Python to enable vector search: https://docs.astral.sh/uv/getting-started/installation/"),Re=null}},0)}Vk().catch(t=>{console.error("[search-server] Fatal error:",t),process.exit(1)});
