---
name: mem-search
description: claude-memの永続的なクロスセッションメモリデータベースを検索します。「前に解決したっけ？」「前回どうやったっけ？」「過去のセッションの作業を探したい」といった質問で使用します。
---

# メモリ検索

過去のセッションの作業を検索します。シンプルなワークフロー：検索 → IDを取得 → IDで詳細を取得

## 使用場面

**現在の会話ではなく**、過去のセッションについて聞かれた時に使用：

- 「前にこれ直したっけ？」
- 「前回Xをどう解決した？」
- 「先週何やった？」

## ワークフロー

**必ずこの流れに従ってください：**

1. **検索** - IDを含む結果一覧を取得
2. **タイムライン** - トップ結果の周辺コンテキストを取得して状況を理解
3. **確認** - タイトル/日付/コンテキストを見て、関連するIDを選択
4. **取得** - 選んだIDの詳細**のみ**を取得

### ステップ1：まず検索

`search` MCPツールを使用：

**必須パラメータ：**

- `query` - 検索キーワード
- `limit: 20` - 必要に応じて大きな件数を指定可能
- `project` - プロジェクト名（必須）

**例：**

```
search(query="認証", limit=20, project="my-project")
```

**返却値：**

```
| ID | Time | T | Title | Read | Work |
|----|------|---|-------|------|------|
| #11131 | 3:48 PM | 🟣 | JWT認証を追加 | ~75 | 🛠️ 450 |
| #10942 | 2:15 PM | 🔴 | 認証トークン期限切れを修正 | ~50 | 🛠️ 200 |
```

### ステップ2：タイムラインで文脈を把握

結果の「何が起きていたか」を理解することが**必須**です。

`timeline` MCPツールを使用：

**観察IDを指定する例：**

```
timeline(anchor=11131, depth_before=3, depth_after=3, project="my-project")
```

**クエリで自動検索する例：**

```
timeline(query="認証", depth_before=3, depth_after=3, project="my-project")
```

**返却値:** `depth_before + 1 + depth_after` 件のアイテム - アンカーを中心に、観察・セッション・プロンプトが時系列で混在

**使用場面：**

- 「〜の時に何が起きてた？」
- イベントの順序を理解したい時
- 特定の観察の周辺コンテキストが欲しい時

### ステップ3：IDを選別

検索結果（とタイムライン）を確認。実際に関連するIDを特定し、残りは除外。

### ステップ4：IDで詳細取得

関連するIDごとに、MCPツールで詳細を取得：

**複数の観察を取得（2件以上は必ずこれを使用）：**

```
get_observations(ids=[11131, 10942, 10855])
```

**並べ替えと件数制限付き：**

```
get_observations(
  ids=[11131, 10942, 10855],
  orderBy="date_desc",
  limit=10,
  project="my-project"
)
```

**単一の観察を取得（1件のみの場合）：**

```
get_observation(id=11131)
```

**セッションを取得：**

```
get_session(id=2005)  # S2005から数字だけ
```

**プロンプトを取得：**

```
get_prompt(id=5421)
```

**IDの形式：**

- 観察：数字のみ（11131）
- セッション：「S2005」から数字のみ（2005）
- プロンプト：数字のみ（5421）

**バッチ取得の最適化：**

- **2件以上の観察は必ず `get_observations` を使用**
- 個別取得より10〜100倍効率的
- N回のリクエストではなく1回のHTTPリクエスト
- 1レスポンスで全結果を返却
- 並べ替えとフィルタリング対応

## 検索パラメータ

**基本：**

- `query` - 検索キーワード（必須）
- `limit` - 結果件数（デフォルト20）
- `project` - プロジェクト名でフィルタ（必須）

**フィルタ（任意）：**

- `type` - "observations"、"sessions"、"prompts"でフィルタ
- `dateStart` - 開始日（YYYY-MM-DDまたはエポックタイムスタンプ）
- `dateEnd` - 終了日（YYYY-MM-DDまたはエポックタイムスタンプ）
- `obs_type` - 観察タイプでフィルタ（カンマ区切り）: bugfix, feature, decision, discovery, change

## 使用例

**最近のバグ修正を検索：**

フィルタ付きで `search` MCPツールを使用：

```
search(query="バグ", type="observations", obs_type="bugfix", limit=20, project="my-project")
```

**先週の作業を検索：**

日付フィルタを使用：

```
search(type="observations", dateStart="2025-11-11", limit=20, project="my-project")
```

**全体検索：**

シンプルなクエリ検索：

```
search(query="データベースマイグレーション", limit=20, project="my-project")
```

**詳細な使い方を取得：**

`help` ツールでオンデマンドで詳細な説明を読み込み：

```
help(topic="workflow")  # 4ステップワークフロー
help(topic="search_params")  # パラメータリファレンス
help(topic="examples")  # 使用例
help(topic="all")  # 完全ガイド
```

## なぜこのワークフロー？

**トークン効率：**

- **検索結果：** 1件あたり〜50-100トークン（テーブルインデックス）
- **完全な観察：** 各〜500-1000トークン
- **10倍の節約** - 関連性が確認できてから詳細を取得

**バッチ取得：**

- **個別取得：** 10回のHTTPリクエスト、〜5-10秒の遅延
- **バッチ取得：** 1回のHTTPリクエスト、〜0.5-1秒の遅延
- **10〜100倍高速** - 複数観察のクエリに最適

**明確性：**

- まず全体を確認（テーブルインデックス）
- 興味深い結果の周辺コンテキストを取得
- コンテキストに基づいて重要なものを選択
- 必要なものだけ詳細を取得（可能な限りバッチで）

---

**重要：**

- 状況を理解するために**必ず**タイムラインでコンテキストを取得
- 2件以上の観察を取得する時は**必ず** `get_observations` を使用
- ワークフローは最適化済み：検索 → タイムライン → バッチ取得 = 10〜100倍高速
