[{"type":"text","text":"## MCP Search Server Tool Implementation\n*Source: claude-mem://observation/10630*\n\n**Search server defines unified MCP tool with hybrid semantic and full-text search across all memory types.**\n\nThe MCP search server implementation in src/servers/search-server.ts defines a unified search tool that serves as the canonical search source. The tool implements hybrid search combining ChromaDB's semantic ranking with SQLite FTS5 full-text search as a fallback. It provides a comprehensive search interface across all memory types (observations, sessions, user prompts) with configurable parameters including natural language queries, output formats (index/full), project filtering, date ranges, pagination (limit/offset), and multiple sort orders (relevance, date ascending/descending). The design emphasizes token efficiency by defaulting to index format and recommending it for initial searches before requesting full details.\n\n---\nType: discovery | Facts: File src/servers/search-server.ts implements MCP search tool with handler at line 345; Search tool uses ChromaDB for semantic search with SQLite FTS5 as fallback; Unified search covers observations, sessions, and user prompts document types; Tool supports index and full formats, with index format recommended for initial queries to minimize tokens; Search parameters include query, format, project filter, date range, limit, offset, and orderBy options | Concepts: how-it-works, pattern, why-it-exists | Files: src/servers/search-server.ts\n\n---\nDate: 11/17/2025, 9:21:38 PM\n\n---\n\n## Unified search tool uses hybrid semantic and full-text search\n*Source: claude-mem://observation/10626*\n\n**Search tool combines ChromaDB semantic search with SQLite FTS5 fallback across all memory types.**\n\nThe unified search tool in src/servers/search-server.ts implements a sophisticated hybrid search strategy. It first attempts semantic search via ChromaDB without document type filtering, allowing it to search across observations, session summaries, and user prompts simultaneously. The system retrieves up to 100 semantic matches, then filters by a 90-day recency window, and finally categorizes results by document type. The tool defaults to 'index' format to minimize token usage on initial searches, recommending users review the index before requesting 'full' details. The implementation includes comprehensive filtering options (project, date range) and sorting capabilities (relevance, date ascending/descending), with configurable pagination through limit and offset parameters.\n\n---\nType: discovery | Facts: The search tool named 'search' is defined in src/servers/search-server.ts starting at line 348; Search uses hybrid approach with ChromaDB as primary semantic search and SQLite FTS5 as fallback; Search returns combined results from observations, sessions, and user prompts document types; Default format is 'index' for minimal token usage, with 'full' format available for detailed results; Search filters results to 90-day recency window after semantic matching returns up to 100 results; Search supports filtering by project name, date range, with configurable limit, offset, and orderBy parameters; Chroma semantic search does not use doc_type filter, allowing search across all document types simultaneously | Concepts: how-it-works, pattern, trade-off | Files: src/servers/search-server.ts\n\n---\nDate: 11/17/2025, 9:19:38 PM\n\n---\n\n## Unified search tool with hybrid semantic search across all memory types\n*Source: claude-mem://observation/10623*\n\n**Search server implements unified search tool using ChromaDB semantic search with SQLite FTS5 fallback for observations, sessions, and user prompts.**\n\nThe search-server.ts file implements a unified search tool that searches across all memory types (observations, sessions, and user prompts) simultaneously. The search uses a hybrid approach with ChromaDB as the primary semantic search engine and SQLite FTS5 as a fallback. The tool schema includes comprehensive parameters for filtering and pagination: query (natural language), format (index or full), project filtering, date range filtering, limit, offset, and orderBy. The tool description emphasizes using 'index' format first to get an overview with minimal token usage, then switching to 'full' format only for specific items of interest. This design optimizes for token efficiency while providing flexible search capabilities.\n\n---\nType: discovery | Facts: The search tool in search-server.ts provides unified search across observations, sessions, and user prompts using hybrid semantic and full-text search; ChromaDB is the primary search mechanism with SQLite FTS5 as fallback for semantic search; The search tool supports format parameter with 'index' (default, titles/dates only) and 'full' (complete details) modes to minimize token usage; Search parameters include query, format, project, dateRange, limit (1-100, default 20), offset (default 0), and orderBy (relevance/date_desc/date_asc); The hybrid search performs ChromaDB semantic search first across all document types without doc_type filtering | Concepts: how-it-works, pattern, trade-off | Files: src/servers/search-server.ts\n\n---\nDate: 11/17/2025, 9:17:15 PM\n\n---\n\n## Unified search implements hybrid semantic+FTS strategy with ChromaDB primary\n*Source: claude-mem://observation/10620*\n\n**Search handler tries ChromaDB semantic search first across all document types, filters by 90-day recency window**\n\nThe unified search implementation demonstrates the DRY architecture principle by centralizing search logic in the MCP search server. The handler implements a sophisticated hybrid search strategy: first attempting semantic search via ChromaDB across all document types (observations, sessions, prompts), then filtering results to a 90-day recency window to prioritize recent context. The queryChroma function is called with limit 100 and no doc_type filter to get comprehensive semantic matches. Results are then categorized by document type for structured presentation. This confirms ChromaDB serves as the primary search source with semantic capabilities, while the architecture maintains SQLite FTS5 as fallback.\n\n---\nType: discovery | Facts: Unified search tool handler starts at line 364 with async handler function; Search strategy: ChromaDB semantic search attempted first, SQLite FTS5 as fallback; ChromaDB query fetches up to 100 semantic matches across all document types without doc_type filter; Results filtered to 90-day recency window (ninetyDaysAgo = Date.now() - 90 days); Search handler separates results into observations, sessions, and prompts arrays; Filtering checks meta.created_at_epoch > ninetyDaysAgo to determine recency | Concepts: how-it-works, pattern | Files: src/servers/search-server.ts\n\n---\nDate: 11/17/2025, 9:11:14 PM\n\n---\n\n## Search server defines MCP tools matching HTTP API routing\n*Source: claude-mem://observation/10616*\n\n**Four primary MCP tools defined: search, timeline, decisions, and contextualize with comprehensive schema definitions**\n\nThe search server defines MCP tools that directly correspond to the HTTP API endpoints found in worker-service.ts. The 'search', 'timeline', 'decisions', and 'contextualize' tools match the HTTP handlers that route through this.mcpClient.callTool. Each tool has comprehensive Zod schema definitions describing parameters, validation rules, and usage guidance. The architecture emphasizes token efficiency with index format as default and full format only when needed. The search tool implements hybrid search using ChromaDB as primary source with SQLite FTS5 fallback, confirming the architectural approach of not deprecating MCP while providing robust search capabilities.\n\n---\nType: discovery | Facts: MCP tool 'search' provides unified search across observations, sessions, and prompts using ChromaDB primary with SQLite FTS5 fallback; MCP tool 'timeline' supports two modes: anchor-based (observation ID, session ID, or timestamp) and query-based (natural language search); MCP tool 'decisions' is a semantic shortcut to find decision-type observations, equivalent to find_by_type with type=\"decision\"; MCP tool 'contextualize' is a hybrid context builder fetching recent observations (7), sessions (7), and prompts (3) with timeline around newest activity; All tools support format parameter with 'index' (default, token-efficient) and 'full' (complete details) options; Tool schemas use Zod for validation with detailed descriptions for each parameter; Tools support optional project filtering and date range filtering | Concepts: how-it-works, pattern | Files: src/servers/search-server.ts\n\n---\nDate: 11/17/2025, 9:10:36 PM"}]